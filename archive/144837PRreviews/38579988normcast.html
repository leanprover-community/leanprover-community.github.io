---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/144837PRreviews/38579988normcast.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/144837PRreviews/index.html">PR reviews</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html">#988 norm_cast</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="165104082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165104082" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165104082">Johan Commelin (May 07 2019 at 19:43)</a>:</h4>
<p>Currently there is a very long list of attributes being added starting at <a href="https://github.com/leanprover-community/mathlib/pull/988/files#diff-836b1338043521d5628c0a4b8832505dR357" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/988/files#diff-836b1338043521d5628c0a4b8832505dR357">https://github.com/leanprover-community/mathlib/pull/988/files#diff-836b1338043521d5628c0a4b8832505dR357</a><br>
Does it make sense to move these to the respective files <code>real.lean</code> and <code>complex.lean</code> (or whatever they are). Of course some of these lemmas are in core, so then it's fine to keep them here. Do we want this tactic to depend on the complex numbers?</p>

<a name="165107284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165107284" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165107284">Sebastien Gouezel (May 07 2019 at 20:21)</a>:</h4>
<p>Is it possible to have a syntax</p>
<div class="codehilite"><pre><span></span><span class="n">attributes</span> <span class="o">[</span><span class="n">norm_cast</span><span class="o">]</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">cast_add</span><span class="o">,</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_add</span><span class="o">,</span> <span class="n">int</span><span class="bp">.</span><span class="n">cast_add</span><span class="o">]</span>
</pre></div>


<p>?</p>

<a name="165107335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165107335" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165107335">Patrick Massot (May 07 2019 at 20:22)</a>:</h4>
<p>you already have it</p>

<a name="165107347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165107347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165107347">Patrick Massot (May 07 2019 at 20:22)</a>:</h4>
<p>remove the s and the second series of []</p>

<a name="165108000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165108000" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165108000">Sebastien Gouezel (May 07 2019 at 20:29)</a>:</h4>
<p>Great! I think I would rather keep the attributes with the tactic, unless we want to start using the tactic earlier, i.e., before all the lemmas with the attributes are even defined.</p>

<a name="165108605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165108605" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165108605">Patrick Massot (May 07 2019 at 20:35)</a>:</h4>
<p>I just used it for the first time! The goal was <code>0 &lt; ↑n + 1</code> where coercion goes to real numbers. <code>norm_cast, linarith</code> <span aria-label="victory" class="emoji emoji-270c" role="img" title="victory">:victory:</span></p>

<a name="165108793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165108793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165108793">Patrick Massot (May 07 2019 at 20:37)</a>:</h4>
<p>I can feel Rob is worried</p>

<a name="165108798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165108798" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165108798">Patrick Massot (May 07 2019 at 20:37)</a>:</h4>
<p>he knows what is coming</p>

<a name="165108867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165108867" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165108867">Johan Commelin (May 07 2019 at 20:38)</a>:</h4>
<blockquote>
<p>he knows what is coming</p>
</blockquote>
<p><code>linarith_mod_cast</code> bitte</p>

<a name="165108893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165108893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165108893">Johan Commelin (May 07 2019 at 20:38)</a>:</h4>
<p>No, I think we can just chain tactics like you just did...</p>

<a name="165109238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165109238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165109238">Patrick Massot (May 07 2019 at 20:42)</a>:</h4>
<p>Bad news is importing this kills all my other proofs</p>

<a name="165109259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165109259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165109259">Patrick Massot (May 07 2019 at 20:42)</a>:</h4>
<p>I get deterministic timeout in proofs not using <code>norm_cast</code></p>

<a name="165109306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165109306" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165109306">Patrick Massot (May 07 2019 at 20:43)</a>:</h4>
<p>that used to type check instantaneously</p>

<a name="165112468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165112468" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165112468">Johan Commelin (May 07 2019 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> What is your reason for keeping the attributes in this file?</p>

<a name="165112521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165112521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165112521">Johan Commelin (May 07 2019 at 21:22)</a>:</h4>
<p>I don't really care either way... To me it just feels more natural to have them close the the lemma's if possible.</p>

<a name="165140890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165140890" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165140890">Sebastien Gouezel (May 08 2019 at 07:17)</a>:</h4>
<p>I don't really mind either. Maybe the current setup is easier to modify, and helps to understand the role of the different attributes.</p>

<a name="165145712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165145712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165145712">Rob Lewis (May 08 2019 at 08:57)</a>:</h4>
<p>Actually, I didn't even look at the imports. I don't think <code>tactic.norm_cast</code> should import any more than is necessary to define the tactic. Most of the attributes should be added when the lemmas are proved.</p>

<a name="165145728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165145728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165145728">Rob Lewis (May 08 2019 at 08:57)</a>:</h4>
<p>It would be silly if you needed to import <code>data.complex</code> in order to simplify <code>nat</code>-to-<code>int</code> casts.</p>

<a name="165145737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165145737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165145737">Rob Lewis (May 08 2019 at 08:58)</a>:</h4>
<p><span class="user-mention" data-user-id="213273">@Paul-Nicolas Madelaine</span></p>

<a name="165145814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165145814" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165145814">Rob Lewis (May 08 2019 at 08:59)</a>:</h4>
<p>Patrick, that must be caused by a transitive import. Do you get the same problem importing <code>data.complex.basic</code> instead of <code>norm_cast</code>?</p>

<a name="165145816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165145816" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165145816">Johan Commelin (May 08 2019 at 08:59)</a>:</h4>
<p>After all, <code>data.complex</code> is very ... <em>complex</em> <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span> <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>

<a name="165160163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165160163" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165160163">Paul-Nicolas Madelaine (May 08 2019 at 12:59)</a>:</h4>
<p>I removed all the unnecessary imports from norm_cast.lean<br>
<span class="user-mention" data-user-id="110031">@Patrick Massot</span> could you check if that soled the problem?</p>
<p>They are two reasons why I had left these attributes in the norm_cast.lean file :<br>
- compile time, now any modification in the file requires recompiling a lot of things<br>
- clarity, you could see the general shape of the lemmas, and they different versions for different data types</p>
<p>There's nothing much that can be done about the first point,<br>
but about the second, I could add a comment with a list of  "typical" norm_cast and simp_cast lemmas</p>

<a name="165187998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165187998" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165187998">Patrick Massot (May 08 2019 at 18:26)</a>:</h4>
<p>I should say that I didn't pull the branch. I copied the content of the tactic file into a new file in a project depending on an old version of mathlib. I have a real workflow issue here, and it was the same with <code>omega</code> and <code>cooper</code>. It's very hard to test a tactic until it actually is in mathlib (or can be dumped in a completely autonomous file)</p>

<a name="165257466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165257466" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165257466">Paul-Nicolas Madelaine (May 09 2019 at 14:29)</a>:</h4>
<p>Right now I registered lemmas like <code>complex.of_real_im</code> as elimination lemmas,<br>
and lemmas like <code>rat.cast_mk_of_ne_zero</code> as compositionnal lemmas.<br>
But the fact is that, unlike simplier lemmas like <code>nat.cast_add</code>, these don't just move casts around, they also change what's around.<br>
Do you think that these lemmas should be used by norm_cast, or should they be left to the simplifier?<br>
More generally, where do we draw the line between what is a norm_cast lemma and what should be left to simp?</p>

<a name="165257604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165257604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165257604">Johan Commelin (May 09 2019 at 14:31)</a>:</h4>
<p>Ooh, I think <code>norm_cast</code> should do as much as possible. Because it's still a very small thing that it tries to do. But it tries to do it really well.</p>

<a name="165257626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/165257626" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#165257626">Johan Commelin (May 09 2019 at 14:31)</a>:</h4>
<p>Simp tries to do a lot, and for that reason it's not popular to call simp half-way a proof.</p>

<a name="167282488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23988%20norm_cast/near/167282488" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/38579988normcast.html#167282488">Fabian Glöckle (Jun 04 2019 at 11:27)</a>:</h4>
<p>We were just discussing whether it would make sense to introduce a <code>cast_mode</code> or <code>mod_cast</code> tactic combinator. It would accept a list of tactics and normalize all casts between the steps.<br>
<span class="user-mention" data-user-id="112680">@Johan Commelin</span> told me he's running into proofs in which <code>rw</code> and <code>norm_cast</code> lines alternate repeatedly.<br>
I have to say I do not have any idea how the cast tactics are implemented ;)</p>


{% endraw %}
