---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/144837PRreviews/83628850mulaction.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/144837PRreviews/index.html">PR reviews</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html">#850 mul_action</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="161794418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161794418" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161794418">Johan Commelin (Mar 26 2019 at 19:20)</a>:</h4>
<p>I'm having some issues with this PR. In the file <code>algebra/pi_instances.lean</code> there seems to be an issue with the <code>pi.module</code> instance. Lean is no longer happy with <code>{..pi.semimodule _}</code> as proof term. I don't really understand how these issues arise from making <code>semimodule</code> extend <code>mul_action</code>.<br>
If someone with more Lean-fu than me wants to take a look, I would be very grateful.</p>

<a name="161835623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161835623" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161835623">Johan Commelin (Mar 27 2019 at 07:34)</a>:</h4>
<p>This is the error that I'm getting:</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">field</span> <span class="err">&#39;</span><span class="n">to_mul_action_add&#39;</span>
  <span class="bp">@</span><span class="n">semimodule</span><span class="bp">.</span><span class="n">to_mul_action_add</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span> <span class="o">(</span><span class="n">max</span> <span class="err">?</span><span class="n">l_2</span> <span class="err">?</span><span class="n">l_3</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_5</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_2</span> <span class="err">?</span><span class="n">l_3</span><span class="o">}</span> <span class="err">?</span><span class="n">m_4</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_5</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_6</span> <span class="n">i</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_2</span> <span class="err">?</span><span class="n">l_3</span> <span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="err">?</span><span class="n">m_4</span> <span class="err">?</span><span class="n">m_5</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">)</span> <span class="err">?</span><span class="n">m_6</span> <span class="err">?</span><span class="n">m_7</span><span class="o">)</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">mul_action_add</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span> <span class="o">(</span><span class="n">max</span> <span class="err">?</span><span class="n">l_2</span> <span class="err">?</span><span class="n">l_3</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_5</span> <span class="n">i</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">semiring</span><span class="bp">.</span><span class="n">to_monoid</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid</span><span class="bp">.</span><span class="n">to_add_monoid</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="err">?</span><span class="n">l_2</span> <span class="err">?</span><span class="n">l_3</span><span class="o">)}</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_5</span> <span class="n">i</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_2</span> <span class="err">?</span><span class="n">l_3</span><span class="o">}</span> <span class="err">?</span><span class="n">m_4</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_5</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">m_4</span><span class="o">),</span> <span class="err">?</span><span class="n">m_6</span> <span class="n">i</span><span class="o">)))</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span>
        <span class="err">?</span><span class="n">l_1</span>
        <span class="err">?</span><span class="n">l_2</span>
        <span class="err">?</span><span class="n">l_3</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">@</span><span class="n">mul_action_add</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">semiring</span><span class="bp">.</span><span class="n">to_monoid</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="err">?</span><span class="n">l_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_monoid</span><span class="bp">.</span><span class="n">to_add_monoid</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="n">to_add_comm_monoid</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">I</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">))))</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="err">?</span><span class="n">l_1</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span>
</pre></div>


<p>It looks like some kind of diamond to me. But I don't think it's an actual diamond. Also, there are a scary amount of universe variables that Lean isn't figuring out on its own. I don't know why...<br>
The relevant code in the context is:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">mul_action</span>     <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">monoid</span> <span class="n">α</span><span class="o">}</span>                                      <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">mul_action</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>     <span class="o">:</span> <span class="n">mul_action</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span> <span class="n">c</span> <span class="err">•</span> <span class="n">f</span> <span class="n">i</span><span class="o">,</span>
  <span class="n">mul_smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">r</span> <span class="n">s</span> <span class="n">f</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">mul_smul</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">one_smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">one_smul</span> <span class="n">α</span> <span class="bp">_</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="n">mul_action_add</span> <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="n">monoid</span> <span class="n">α</span><span class="o">}</span>         <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_monoid</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>      <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">mul_action_add</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span> <span class="o">:</span> <span class="n">mul_action_add</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">smul_zero</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">smul_zero</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">smul_add</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">smul_add</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">pi</span><span class="bp">.</span><span class="n">mul_action</span> <span class="bp">_</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="n">semimodule</span>     <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">α</span><span class="o">}</span>       <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_comm_monoid</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">semimodule</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>     <span class="o">:</span> <span class="n">semimodule</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add_smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_smul</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">zero_smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">zero_smul</span> <span class="n">α</span> <span class="bp">_</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">pi</span><span class="bp">.</span><span class="n">mul_action_add</span> <span class="bp">_</span> <span class="o">}</span>

<span class="kn">set_option</span> <span class="n">pp</span><span class="bp">.</span><span class="n">all</span> <span class="n">true</span>
<span class="kn">instance</span> <span class="n">module</span>         <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">α</span><span class="o">}</span>           <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_comm_group</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>  <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">module</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>         <span class="o">:</span> <span class="n">module</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>       <span class="o">:=</span> <span class="o">{</span><span class="bp">..</span><span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span> <span class="n">α</span><span class="o">}</span>
<span class="kn">instance</span> <span class="n">vector_space</span>   <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">discrete_field</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_comm_group</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>  <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">vector_space</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>   <span class="o">:</span> <span class="n">vector_space</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="bp">..</span><span class="n">pi</span><span class="bp">.</span><span class="n">module</span> <span class="n">α</span><span class="o">}</span>
</pre></div>

<a name="161835635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161835635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161835635">Johan Commelin (Mar 27 2019 at 07:34)</a>:</h4>
<p>As mentioned above: the error is for the <code>instance module</code> line.</p>

<a name="161836087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836087">Kevin Buzzard (Mar 27 2019 at 07:44)</a>:</h4>
<p>Try filling in some of the _'s?</p>

<a name="161836091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836091" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836091">Kevin Buzzard (Mar 27 2019 at 07:44)</a>:</h4>
<p>This has helped in other situations like this</p>

<a name="161836163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836163" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836163">Johan Commelin (Mar 27 2019 at 07:46)</a>:</h4>
<p>This works:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">module</span>         <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">α</span><span class="o">}</span>           <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_comm_group</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>  <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">module</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>         <span class="o">:</span> <span class="n">module</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>       <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_semimodule</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">convert</span> <span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span> <span class="n">α</span><span class="o">,</span>
  <span class="n">swap</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="o">},</span>
  <span class="n">swap</span><span class="o">,</span>
  <span class="o">{</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="o">},</span>
  <span class="n">refl</span>
<span class="kn">end</span> <span class="o">}</span>
</pre></div>

<a name="161836180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836180">Johan Commelin (Mar 27 2019 at 07:46)</a>:</h4>
<p>But the fact that it didn't figure out those instances from the beginning is not a good sign.</p>

<a name="161836191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836191" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836191">Johan Commelin (Mar 27 2019 at 07:47)</a>:</h4>
<p>Because that is going to lead to problems in lots of places.</p>

<a name="161836257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836257" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836257">Johan Commelin (Mar 27 2019 at 07:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you know what is the right way to guide type class search in the right direction here?</p>

<a name="161836261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836261">Kevin Buzzard (Mar 27 2019 at 07:48)</a>:</h4>
<p>Why not post some working code if you're asking others for help?</p>

<a name="161836282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836282" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836282">Johan Commelin (Mar 27 2019 at 07:49)</a>:</h4>
<p>I feel that is somewhat complicated here.</p>

<a name="161836291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836291" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836291">Mario Carneiro (Mar 27 2019 at 07:49)</a>:</h4>
<p>asking for help often is</p>

<a name="161836292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836292" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836292">Kevin Buzzard (Mar 27 2019 at 07:49)</a>:</h4>
<p>I feared you'd say that</p>

<a name="161836346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836346">Mario Carneiro (Mar 27 2019 at 07:50)</a>:</h4>
<p>My advice doesn't differ significantly from Kevin's</p>

<a name="161836392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836392" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836392">Kevin Buzzard (Mar 27 2019 at 07:51)</a>:</h4>
<p>I've seen <code>convert</code> used in that way too. I don't know how it works and I know that whenever someone writes a tactic other people want it to do just epsilon more</p>

<a name="161836401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836401">Johan Commelin (Mar 27 2019 at 07:51)</a>:</h4>
<p>The fact that I'm using <code>convert</code> here is already a bad omen.</p>

<a name="161836402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836402" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836402">Mario Carneiro (Mar 27 2019 at 07:51)</a>:</h4>
<p>The <code>convert</code> is a bad idea, because it will cause diamond problems down the line</p>

<a name="161836454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836454" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836454">Mario Carneiro (Mar 27 2019 at 07:52)</a>:</h4>
<p>it adds an <code>eq.rec</code> into the term, but instance fields need to be defeq to stuff</p>

<a name="161836469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836469">Mario Carneiro (Mar 27 2019 at 07:52)</a>:</h4>
<p>In this case it's actually <code>eq.rec ... refl</code> so it might be okay</p>

<a name="161836495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836495" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836495">Mario Carneiro (Mar 27 2019 at 07:53)</a>:</h4>
<p>I would recommend adding the typeclass arguments until it stops erroring, and find out which is the operative one</p>

<a name="161836496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836496">Kevin Buzzard (Mar 27 2019 at 07:53)</a>:</h4>
<p>I was going to continue "but if it (convert) is not filling in easy things, then you might wonder whether it needs more help filling in metavariables earlier on"</p>

<a name="161836562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836562">Johan Commelin (Mar 27 2019 at 07:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> But it isn't a problem to have <code>@pi.semimodule _ _ _</code> in the code?</p>

<a name="161836573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836573">Mario Carneiro (Mar 27 2019 at 07:55)</a>:</h4>
<p>not really</p>

<a name="161836575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836575">Johan Commelin (Mar 27 2019 at 07:55)</a>:</h4>
<p>I mean: that avoids the diamond. But does it mean that users will have to write <code>@...</code> all the time?</p>

<a name="161836587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836587" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836587">Mario Carneiro (Mar 27 2019 at 07:55)</a>:</h4>
<p>if they have to write it all the time, sure it's a problem</p>

<a name="161836589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836589" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836589">Mario Carneiro (Mar 27 2019 at 07:55)</a>:</h4>
<p>but I wouldn't say it's never needed</p>

<a name="161836593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836593">Johan Commelin (Mar 27 2019 at 07:55)</a>:</h4>
<p>By the way: <code>convert</code> created the following proof term:</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="kn">instance</span><span class="o">]</span>
<span class="kn">protected</span> <span class="n">def</span> <span class="n">pi</span><span class="bp">.</span><span class="n">module</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)]</span>
<span class="o">[</span><span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">@</span><span class="n">module</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">v</span><span class="o">}</span> <span class="n">α</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="n">r</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">)],</span>
  <span class="bp">@</span><span class="n">module</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="n">r</span> <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">I</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">))</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)]</span>
<span class="o">[</span><span class="bp">_</span><span class="n">inst_2</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">@</span><span class="n">module</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">v</span><span class="o">}</span> <span class="n">α</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="n">r</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">)],</span>
  <span class="bp">@</span><span class="n">module</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="n">r</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">I</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">@</span><span class="n">eq</span><span class="bp">.</span><span class="n">mpr</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="o">(</span><span class="n">u_1</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">((</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span><span class="bp">+</span><span class="mi">1</span><span class="o">))}</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">semimodule</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="n">to_add_comm_monoid</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">I</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">semimodule</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)}</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">add_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">I</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>
             <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">@</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="n">to_add_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">))))</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">module</span><span class="bp">._</span><span class="n">proof_1</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u_1</span> <span class="n">v</span><span class="o">}</span> <span class="n">I</span> <span class="n">f</span> <span class="n">α</span> <span class="n">r</span> <span class="bp">_</span><span class="n">inst_1</span><span class="o">)</span>
       <span class="o">(</span><span class="bp">@</span><span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span> <span class="n">u_1</span><span class="o">}</span> <span class="n">I</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="n">α</span> <span class="o">(</span><span class="bp">@</span><span class="n">ring</span><span class="bp">.</span><span class="n">to_semiring</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="n">α</span> <span class="n">r</span><span class="o">)</span>
          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">@</span><span class="n">add_comm_group</span><span class="bp">.</span><span class="n">to_add_comm_monoid</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">))</span>
          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="bp">@</span><span class="n">module</span><span class="bp">.</span><span class="n">to_semimodule</span><span class="bp">.</span><span class="o">{</span><span class="n">u_1</span> <span class="n">v</span><span class="o">}</span> <span class="n">α</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="n">r</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_1</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">_</span><span class="n">inst_2</span> <span class="n">i</span><span class="o">))))</span>
</pre></div>


<p>which seems reasonably clean.</p>

<a name="161836644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836644" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836644">Mario Carneiro (Mar 27 2019 at 07:56)</a>:</h4>
<p><code>(@eq.mpr.{(max (u_1+1) ((max u v)+1))}...</code></p>

<a name="161836647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836647" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836647">Johan Commelin (Mar 27 2019 at 07:56)</a>:</h4>
<p>But the <code>eq.mpr</code> is a problem, I guess.</p>

<a name="161836657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836657" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836657">Mario Carneiro (Mar 27 2019 at 07:56)</a>:</h4>
<p>where's the refl at the end?</p>

<a name="161836668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836668">Mario Carneiro (Mar 27 2019 at 07:57)</a>:</h4>
<p>oh, that's probably <code>pi.module._proof_1</code></p>

<a name="161836735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836735" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836735">Johan Commelin (Mar 27 2019 at 07:58)</a>:</h4>
<p>The problem goes away if we make the family <code>f</code> explicit.</p>

<a name="161836804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836804" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836804">Johan Commelin (Mar 27 2019 at 08:00)</a>:</h4>
<p>Huh, no... that's not enough</p>

<a name="161836806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836806" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836806">Johan Commelin (Mar 27 2019 at 08:00)</a>:</h4>
<p>I don't understand Lean.</p>

<a name="161836833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836833" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836833">Johan Commelin (Mar 27 2019 at 08:01)</a>:</h4>
<p>It needs both <code>I</code> and <code>f</code> explicitly!</p>

<a name="161836835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836835" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836835">Johan Commelin (Mar 27 2019 at 08:01)</a>:</h4>
<p>But <code>I</code> can trivially be inferred from <code>f</code>.</p>

<a name="161836949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161836949" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161836949">Mario Carneiro (Mar 27 2019 at 08:03)</a>:</h4>
<p>did you try putting a type ascription on <code>pi.semimodule</code>? The <code>..foo</code> position of a term doesn't get any expected type assistance</p>

<a name="161837030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837030">Johan Commelin (Mar 27 2019 at 08:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">variables</span> <span class="o">(</span><span class="n">I</span> <span class="n">f</span><span class="o">)</span>

<span class="kn">instance</span> <span class="n">semimodule</span>     <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">semiring</span> <span class="n">α</span><span class="o">}</span>       <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_comm_monoid</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span> <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">semimodule</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>     <span class="o">:</span> <span class="n">semimodule</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">add_smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_smul</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">zero_smul</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">zero_smul</span> <span class="n">α</span> <span class="bp">_</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">pi</span><span class="bp">.</span><span class="n">mul_action_add</span> <span class="bp">_</span> <span class="o">}</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">I</span> <span class="n">f</span><span class="o">}</span>

<span class="kn">instance</span> <span class="n">module</span>         <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ring</span> <span class="n">α</span><span class="o">}</span>           <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">add_comm_group</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>  <span class="o">[</span><span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">module</span> <span class="n">α</span> <span class="err">$</span> <span class="n">f</span> <span class="n">i</span><span class="o">]</span>         <span class="o">:</span> <span class="n">module</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span>       <span class="o">:=</span> <span class="o">{</span><span class="bp">..</span><span class="n">pi</span><span class="bp">.</span><span class="n">semimodule</span> <span class="n">I</span> <span class="n">f</span> <span class="n">α</span><span class="o">}</span>
</pre></div>

<a name="161837041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837041">Johan Commelin (Mar 27 2019 at 08:04)</a>:</h4>
<p>That's what I have now</p>

<a name="161837065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837065" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837065">Mario Carneiro (Mar 27 2019 at 08:04)</a>:</h4>
<p><code>..(pi.mul_action_add _ : bla bla)</code></p>

<a name="161837067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837067" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837067">Johan Commelin (Mar 27 2019 at 08:04)</a>:</h4>
<p>But if I tell Lean <code>f</code>, it should be able to figure out <code>I</code>, shouldn't it?</p>

<a name="161837071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837071" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837071">Johan Commelin (Mar 27 2019 at 08:04)</a>:</h4>
<p>Because <code>f : I → _</code></p>

<a name="161837073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837073" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837073">Mario Carneiro (Mar 27 2019 at 08:05)</a>:</h4>
<p>I have no idea what the issue is</p>

<a name="161837085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837085" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837085">Mario Carneiro (Mar 27 2019 at 08:05)</a>:</h4>
<p>it could be an order of operations thing</p>

<a name="161837108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837108">Johan Commelin (Mar 27 2019 at 08:05)</a>:</h4>
<p>Is my current version okay? Or is it better to write <code>@pi.semimodule I f α _ _ _</code>?</p>

<a name="161837110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837110" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837110">Johan Commelin (Mar 27 2019 at 08:05)</a>:</h4>
<p>And leave the variables implicit</p>

<a name="161837116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837116" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837116">Kevin Buzzard (Mar 27 2019 at 08:05)</a>:</h4>
<p>Sebastian once showed us how to switch on debugging so you can see exactly what the unifier is doing, if anyone really cares.</p>

<a name="161837156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837156">Mario Carneiro (Mar 27 2019 at 08:06)</a>:</h4>
<p>if it works, the current version is fine</p>

<a name="161837170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161837170" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161837170">Johan Commelin (Mar 27 2019 at 08:06)</a>:</h4>
<p>Let's see what Travis says</p>

<a name="161838691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161838691" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161838691">Kevin Buzzard (Mar 27 2019 at 08:38)</a>:</h4>
<p><a href="#narrow/stream/113488-general/topic/unification/near/156841375" title="#narrow/stream/113488-general/topic/unification/near/156841375">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/unification/near/156841375</a> is what happens if you ask Sebastian this sort of question -- he just inspects what the unifier is doing and then can tell you why your original type mismatch occurred. The set_options he used are a few posts later. I've seen Kenny using them at Xena.</p>

<a name="161894784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161894784" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161894784">Johan Commelin (Mar 27 2019 at 19:54)</a>:</h4>
<p>I find that I need to bump up the type class search depth in a lot of files... is that an issue. Or is that just inherent to the growth of our algebraic hierarchy?</p>

<a name="161895526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161895526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161895526">Johannes Hölzl (Mar 27 2019 at 20:02)</a>:</h4>
<p>it is not related to the number of <code>instance</code>s we have, but with the constructed terms and that we have many instances which depend on many other searches. So especially when a <code>module</code> instance is looked after, it may require three different instances to be found: the ring, the group, and the module itself. Then the number of found instances in the previous type class arguments count to the "depth" itself.</p>

<a name="161895596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161895596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161895596">Johan Commelin (Mar 27 2019 at 20:03)</a>:</h4>
<p>But if you have deeply nested structures, this increases the search depth, not?</p>

<a name="161896892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161896892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161896892">Kevin Buzzard (Mar 27 2019 at 20:20)</a>:</h4>
<p>I always get a bit edgy when Lean wants me to bump up the type class search depth. I usually only do this as a last resort; I prefer to try and help Lean along the way with some intermediate instances, or guide it to the right instance. See for example, in our very own project, <a href="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/6dc770a9e40a61e3e31362ea8cf9f83661283369/src/valuation/canonical.lean#L699" target="_blank" title="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/6dc770a9e40a61e3e31362ea8cf9f83661283369/src/valuation/canonical.lean#L699">https://github.com/leanprover-community/lean-perfectoid-spaces/blob/6dc770a9e40a61e3e31362ea8cf9f83661283369/src/valuation/canonical.lean#L699</a> for me supplying the proof instead of letting type class inference do it, and <a href="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/53905461e2069d1396578a3d034d6b5b49c54f60/src/valuation/basic.lean#L652" target="_blank" title="https://github.com/leanprover-community/lean-perfectoid-spaces/blob/53905461e2069d1396578a3d034d6b5b49c54f60/src/valuation/basic.lean#L652">https://github.com/leanprover-community/lean-perfectoid-spaces/blob/53905461e2069d1396578a3d034d6b5b49c54f60/src/valuation/basic.lean#L652</a> for me using <code>by apply_instance</code> judiciously to save me having to bump up the depth.</p>

<a name="161897401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161897401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161897401">Patrick Massot (Mar 27 2019 at 20:26)</a>:</h4>
<p>Remember that adding shortcut instance is a double-edged sword, because this instance could be tried by type class search while solving an unrelated problem. But I guess it's fine in case this shortcut fails quickly (for instance it doesn't go hunting for a ring structure on an unknown type).</p>

<a name="161899166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161899166" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161899166">Kevin Buzzard (Mar 27 2019 at 20:48)</a>:</h4>
<p>Well this is interesting. I don't really understand typeclass search. I just didn't like changing the defaults. I was putting standard instances on elaborate structures which type class inference should feel free to try if it is convinced that it should be understanding those structures. I would be happy to be guided by principles but I don't really know any</p>

<a name="161927959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161927959" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161927959">Johan Commelin (Mar 28 2019 at 06:42)</a>:</h4>
<p>Travis seems to be hanging for a very long time on "Booting virtual machine" for the 2nd build stage. But the first build stage succesfully checked the entire build in 9 minutes... so I think this one is fine.</p>

<a name="161927975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%23850%20mul_action/near/161927975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/83628850mulaction.html#161927975">Johan Commelin (Mar 28 2019 at 06:43)</a>:</h4>
<p>If possible this should be merged quickly, because otherwise it risks breaking again.</p>


{% endraw %}

{% include archive_update.html %}