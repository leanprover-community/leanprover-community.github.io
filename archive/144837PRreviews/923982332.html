---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/144837PRreviews/923982332.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/144837PRreviews/index.html">PR reviews</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html">#2332</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="193021096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193021096" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193021096">Sebastien Gouezel (Apr 06 2020 at 10:21)</a>:</h4>
<p>In <a href="https://github.com/leanprover-community/mathlib/issues/2332" title="https://github.com/leanprover-community/mathlib/issues/2332">#2332</a> Yury removes some <code>decidable_eq</code>assumptions that were used in proofs but not in the statements. Could we have a linter for this, that says : your statement does not use <code>decidable_eq</code> but your proof does, could you instead turn classical?</p>

<a name="193022899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193022899" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193022899">Gabriel Ebner (Apr 06 2020 at 10:38)</a>:</h4>
<p>Writing a linter is really easy.  If anybody wants to attempt this, you just need to copy&amp;paste <code>linter.inhabited_nonempty</code>.</p>

<a name="193022935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193022935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193022935">Gabriel Ebner (Apr 06 2020 at 10:39)</a>:</h4>
<p>It's more work to fix the new linting errors than writing the linter, I promise.</p>

<a name="193022965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193022965" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193022965">Patrick Massot (Apr 06 2020 at 10:39)</a>:</h4>
<p>Documenting it seems harder. Yesterday I had a linter complaining about missing inhabited instance. I put nolint without understanding what this linter is about.</p>

<a name="193023333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193023333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193023333">Rob Lewis (Apr 06 2020 at 10:43)</a>:</h4>
<p>Floris made a start at implementing this linter a long time ago. I also tried, there should be a half-finished attempt on a branch somewhere. I don't remember if there was a theoretical problem or if it was just lots of effort to fix the errors.</p>

<a name="193023451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193023451" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193023451">Gabriel Ebner (Apr 06 2020 at 10:44)</a>:</h4>
<p>Yeah, I'm not sure anymore if this linter was such a great idea.  Most of the linters were written carefully to produce very few false positives, so that you should never have to use <code>nolint</code>.  The motivation behind the <code>has_inhabited_instance</code> linter was that people should provide <code>inhabited</code> instances for <code>finset α</code>.  But it's ok not to have <code>inhabited</code> instances for types that are essentially Type-valued propositions, like the predicate for filters with countable bases in your last PR.</p>

<a name="193023542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193023542" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193023542">Kevin Buzzard (Apr 06 2020 at 10:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/144837-PR-reviews/topic/.232332/near/193022965" title="#narrow/stream/144837-PR-reviews/topic/.232332/near/193022965">said</a>:</p>
<blockquote>
<p>Documenting it seems harder. Yesterday I had a linter complaining about missing inhabited instance. I put nolint without understanding what this linter is about.</p>
</blockquote>
<p>You couldn't prove your instance was inhabited? Did you try 37?</p>

<a name="193023562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193023562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193023562">Gabriel Ebner (Apr 06 2020 at 10:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> I think Sébastien is asking for something different.  The linter you were working on was looking for <code>classical.decidable_eq</code> instances in the statement.  This linter here should complain about decidability assumptions on theorems that do <em>not</em> appear in the statement.</p>

<a name="193023666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193023666" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193023666">Rob Lewis (Apr 06 2020 at 10:46)</a>:</h4>
<p>Oh, sorry, I should have read more carefully.</p>

<a name="193023680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193023680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193023680">Rob Lewis (Apr 06 2020 at 10:46)</a>:</h4>
<p>You're right, this one should be very easy to implement.</p>

<a name="193038081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193038081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193038081">Scott Morrison (Apr 06 2020 at 13:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>, for a long time I disliked the <code>has_inhabited_instance</code> linter, but when I realised it was a chance to write mini-examples I decided it was okay. Think of it as a documentation linter.</p>

<a name="193161652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193161652" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193161652">Sebastien Gouezel (Apr 07 2020 at 09:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/144837-PR-reviews/topic/.232332/near/193021096" title="#narrow/stream/144837-PR-reviews/topic/.232332/near/193021096">said</a>:</p>
<blockquote>
<p>In <a href="https://github.com/leanprover-community/mathlib/issues/2332" title="https://github.com/leanprover-community/mathlib/issues/2332">#2332</a> Yury removes some <code>decidable_eq</code>assumptions that were used in proofs but not in the statements. Could we have a linter for this, that says : your statement does not use <code>decidable_eq</code> but your proof does, could you instead turn classical?</p>
</blockquote>
<p>I am working on it. As Gabriel says, writing the linter is easy (I just copied the one for <code>inhabited_nonempty</code> -- by the way, it is only active for props, do you know why?), but fixing the issues it detects is much longer...</p>

<a name="193162278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193162278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193162278">Yury G. Kudryashov (Apr 07 2020 at 09:47)</a>:</h4>
<p>It is only active for <code>Prop</code>s because if the result is not a <code>Prop</code>, then might use <code>inhabited</code> in the definition, not the type.</p>

<a name="193162396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193162396" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193162396">Yury G. Kudryashov (Apr 07 2020 at 09:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> BTW, would it be hard to lint for "asks for <code>inhabited</code>, uses only <code>inhabited.to_nonempty</code>"?</p>

<a name="193162527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193162527" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193162527">Mario Carneiro (Apr 07 2020 at 09:49)</a>:</h4>
<p>That generalizes to "asks for instance A, but all uses filter through A_of_B"</p>

<a name="193162649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193162649" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193162649">Mario Carneiro (Apr 07 2020 at 09:50)</a>:</h4>
<p>which sounds like a really useful lint; it would really quickly clean up all that "all rings are commutative" nonsense</p>

<a name="193211152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193211152" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193211152">Sebastien Gouezel (Apr 07 2020 at 16:08)</a>:</h4>
<p>The linter is done in <a href="https://github.com/leanprover-community/mathlib/issues/2352" title="https://github.com/leanprover-community/mathlib/issues/2352">#2352</a>. The linter was easy to do, the cleanup of mathlib much more tedious (but definitely useful, I think). There are a few edge cases where I didn't know what to do, so I would like to hear your opinions. The following is copied from the PR message.</p>
<p>There is the question of basic files such as <code>logic/basic.lean</code>, where the point is to prove weak theorems without excluded middle, so it wouldn't make sense to add classical in the proofs (although I don't really understand the point of these theorems). Also in <code>algebra/order.lean</code> you have a section <code>decidable</code> with lemmas such as</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">lt_or_eq_of_le</span> <span class="o">[</span><span class="n">partial_order</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="bp">@</span><span class="n">decidable_rel</span> <span class="n">α</span> <span class="o">(</span><span class="bp">≤</span><span class="o">)]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">hab</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">∨</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
</pre></div>


<p>I understand the desire to have a decidability predicate to be able to compute and to program, but I really don't get why it matters when it comes to proving Props. So, I would happily remove the decidability assumption from this lemma and its friends, but I thought I would ask here first.</p>
<p>Also, there is the lemma <code>imp_of_not_imp_not</code> in <code>tactic/push_neg</code>. If I drop the decidability assumption and make it classical, then the tactic does not work any more, so I didn't touch it.</p>

<a name="193211470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193211470" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193211470">Gabriel Ebner (Apr 07 2020 at 16:10)</a>:</h4>
<p>I am on the classical side.  I don't see a point in having decidability assumptions on lemmas.</p>

<a name="193218566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193218566" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193218566">Yury G. Kudryashov (Apr 07 2020 at 17:05)</a>:</h4>
<p>I vote for "go classical outside of <code>logic/basic</code>"</p>

<a name="193218662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193218662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193218662">Patrick Massot (Apr 07 2020 at 17:05)</a>:</h4>
<p>Yeah, leaving <code>logic.basic</code> as home for intuitionists seems like a fair deal.</p>

<a name="193218729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193218729" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193218729">Yury G. Kudryashov (Apr 07 2020 at 17:06)</a>:</h4>
<p>Not in the sense "open_locale classical" but in the sense of this PR: don't assume <code>decidable</code> if you just want the excluded middle.</p>

<a name="193220426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193220426" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193220426">Gabriel Ebner (Apr 07 2020 at 17:20)</a>:</h4>
<p>Honestly, I don't think that mathlib is the right place to play with intuitionism.  Most results depend on classical logic, and definitely on the law of excluded middle.  On the other hand, keeping central files like <code>logic/basic</code> intuitionistic has downsides: e.g. <code>simp</code> will give bad results if you don't <code>open_locale classical</code>.</p>

<a name="193222380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193222380" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193222380">Sebastien Gouezel (Apr 07 2020 at 17:35)</a>:</h4>
<p>A middle way is to remove the simp attribute from all the lemmas that have too strong assumptions in <code>logic/basic</code>, and put it on the corresponding lemmas without the decidability assumption. If I had it my way, I would remove all decidability assumptions from the lemmas in this file also. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> , any thoughts on this?</p>

<a name="193252722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193252722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193252722">Mario Carneiro (Apr 07 2020 at 21:49)</a>:</h4>
<p>I like the solution I used in <code>algebra.order</code> regarding linear order theorems. There, there are several theorems that prove the same things as in linear orders but without choice, and they live in the <code>decidable</code> namespace and take an additional <code>decidable</code> argument. No one references these theorems, which is fine, no one is harmed by the presence of the side condition.</p>
<p>My proposal for <code>logic.basic</code> would be to rename all the theorems with <code>decidable</code> assumptions to have <code>decidable</code> prefix, and remove the <code>classical</code> prefix from those which have it, essentially switching the default choice. Many theorems only have a decidable version right now; let's make all of them classical. We can also remove any <code>decidable.*</code> theorems that don't look useful or applicable (I mean, how often are you going to have <code>decidable (\exists x, p x)</code> available?), or even remove them all and re-add them on an as-needed basis.</p>
<p>The intent is to use <code>decidable.*</code> theorems when we are in a context that is known to be decidable, and when we also care about avoiding choice. If you don't fulfill both of those conditions feel free to never touch these lemmas, but also don't block any PRs that use them in order to make a particular target theorem choice free. Does this sound reasonable?</p>

<a name="193253204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193253204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193253204">Mario Carneiro (Apr 07 2020 at 21:53)</a>:</h4>
<p>Also, sometimes a theorem can be proven choice free without the decidability assumption. For example <code>lt_of_le_of_ne'</code> is a replacement for <code>lt_of_le_of_ne</code> that uses a proof that avoids choice. In this case, I think we should just replace the original theorem and skip the <code>decidable</code> prefix. Again, the rule for PRs would be, don't feel obligated to avoid choice but allow people to make refactors of your code later to fix up choice usage, as long as it doesn't affect theorem statements.</p>

<a name="193274454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193274454" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193274454">Johan Commelin (Apr 08 2020 at 04:18)</a>:</h4>
<p>I like this plan a lot.</p>

<a name="193282111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193282111" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193282111">Sebastien Gouezel (Apr 08 2020 at 07:13)</a>:</h4>
<p>May I suggest that we postpone this to a later PR, and merge <a href="https://github.com/leanprover-community/mathlib/issues/2332" title="https://github.com/leanprover-community/mathlib/issues/2332">#2332</a> rather quickly? Since the PR touches 40 files, I am afraid that merge conflicts will show up all the time.</p>

<a name="193282367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193282367" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193282367">Yury G. Kudryashov (Apr 08 2020 at 07:17)</a>:</h4>
<p>Do you mean <a href="https://github.com/leanprover-community/mathlib/issues/2352" title="https://github.com/leanprover-community/mathlib/issues/2352">#2352</a>?</p>

<a name="193284162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/144837-PR%20reviews/topic/%232332/near/193284162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/144837PRreviews/923982332.html#193284162">Sebastien Gouezel (Apr 08 2020 at 07:39)</a>:</h4>
<p>Yes, sorry.</p>


{% endraw %}

{% include archive_update.html %}