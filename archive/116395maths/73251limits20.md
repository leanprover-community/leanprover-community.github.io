---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/116395maths/73251limits20.html
---

## Stream: [maths](index.html)
### Topic: [limits 2.0](73251limits20.html)

---


{% raw %}
#### [ Reid Barton (Nov 02 2018 at 22:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137084883):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span>, how are the new limits coming along? I took a peek at community mathlib and it looks like things are happening!</p>

#### [ Scott Morrison (Nov 02 2018 at 23:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137086701):
<p>Yes, I think it's pretty close now.</p>

#### [ Scott Morrison (Nov 02 2018 at 23:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137086760):
<p>I spent (too long) trying to follow the argument Emily Riehl uses in her book to explain why (C \func D) has limits of shape J whenever D has limits of shape J.</p>

#### [ Scott Morrison (Nov 02 2018 at 23:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137086763):
<p>It turned out to be really gross to formalise.</p>

#### [ Scott Morrison (Nov 02 2018 at 23:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137086772):
<p>(She first explains that (discrete C) \func D has those limits, and then shows that the forgetful functor (C \func D) \func ((discete C) \func D) creates limits.)</p>

#### [ Scott Morrison (Nov 02 2018 at 23:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137086854):
<p>So I've just switched to much more directly constructing limits in (C \func D), and then showing that the evaluation functor ev_X : (C \func D) \func D preserves limits.</p>

#### [ Scott Morrison (Nov 02 2018 at 23:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137086861):
<p>This seems to be nice and clean, so I think I'm happy with that for now.</p>

#### [ Scott Morrison (Nov 02 2018 at 23:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137087044):
<p>Still to do:<br>
1. copy-and-pasting for all the dual notions (I think I'm not ready to make tactics for this yet)<br>
2. quite a bit of cleanup...<br>
3. port a few examples from the old development<br>
4. a few @[simp] lemmas describing how colimit.pre and colimit.desc work in the category of types, which I got confused about...</p>

#### [ Scott Morrison (Nov 02 2018 at 23:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137087053):
<p>If anyone wants to hack on the <code>limits-others-new</code> branch on leanprover-community, feel free. :-)</p>

#### [ Scott Morrison (Nov 02 2018 at 23:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137087081):
<p>oh, and 5. I need to try porting the construction of limits from equalizers and products to the new setup.</p>

#### [ Reid Barton (Nov 03 2018 at 00:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137090585):
<p>Sounds good! I fixed the build by making <code>auto_cases</code> work on quotients again and I also made a couple of minor simplifications which you might still be interested in.</p>

#### [ Reid Barton (Nov 03 2018 at 00:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137090591):
<p>I think I will try to check off a few of the items on my "basic category theory" list, then.</p>

#### [ Johan Commelin (Nov 03 2018 at 11:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137107888):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I'm happy to help out with some of the dualising work. Which parts would I best start to work on?</p>

#### [ Johan Commelin (Nov 03 2018 at 11:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137107895):
<p>Are certain files pretty stable, and others in flux? Or can I just start anywhere?</p>

#### [ Reid Barton (Nov 03 2018 at 16:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137116560):
<p>lol, I started looking at the new limits in more detail, and got annoyed by all these <code>const J C X</code> with so many explicit arguments, and tried making at least the <code>C</code> argument implicit (<code>X : C</code>), and immediately got a bunch of errors related to coercions</p>

#### [ Reid Barton (Nov 03 2018 at 16:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137116561):
<p>No wonder Scott went on that rant recently :)</p>

#### [ Scott Morrison (Nov 03 2018 at 23:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137131371):
<p>That rant got started after I tried making a coercion all the way from <code>C</code> to <code>J \func C</code>, so you really could just write <code>X</code> instead of <code>const J C X</code>, as we do in the real world.</p>

#### [ Scott Morrison (Nov 03 2018 at 23:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137131372):
<p>Let's just say it didn't work out. :-)</p>

#### [ Scott Morrison (Nov 04 2018 at 03:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137138441):
<p>(deleted a dumb question; I really should check the statement when I'm having trouble proving something....)</p>

#### [ Scott Morrison (Nov 04 2018 at 11:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137151311):
<p>Hi <span class="user-mention" data-user-id="110032">@Reid Barton</span>, any chance you'd like to help me with any of the following sorries, on the HEAD of <code>limits-others-new</code>:</p>
<div class="codehilite"><pre><span></span>def is_limit.of_extensions_iso (h : is_iso t.extensions) : is_limit t :=
{ lift := Œª s, (inv t.extensions) s.X s.œÄ,
  fac&#39; := begin tidy, sorry, end,
  uniq&#39; := begin tidy, sorry, end }
</pre></div>

#### [ Scott Morrison (Nov 04 2018 at 11:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137151313):
<div class="codehilite"><pre><span></span>def cone.of_representable_cones (F : J ‚•§ C) [r : representable F.cones] : cone F :=
{ X := r.X,
  œÄ := r.w.hom r.X (ùüô r.X) }

def extensions_iso_of_representable_cones (F : J ‚•§ C) [r : representable F.cones] :
  is_iso (cone.of_representable_cones F).extensions :=
{ inv :=
  { app := Œª X, r.w.inv X,
    naturality&#39; := Œª X Y f, begin tidy, sorry end },
  hom_inv_id&#39; := begin tidy, sorry end,
  inv_hom_id&#39; := sorry }

def has_limit_of_cones_representable (F : J ‚•§ C) [r : representable F.cones] : has_limit F :=
{ cone := cone.of_representable_cones F,
  is_limit := is_limit.of_extensions_iso (extensions_iso_of_representable_cones F) }

def cones_representable_of_has_limit (F : J ‚•§ C) [has_limit F] : representable F.cones :=
{ X := (has_limit.cone F).X,
  w := (has_limit.is_limit F).natural_equiv }
</pre></div>

#### [ Scott Morrison (Nov 04 2018 at 11:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137151406):
<p>For context, here <code>F.cones</code> is the functor <code>C^op \to Type</code> so <code>F.cones X</code> is the type of natural transformations <code>X \natt F</code>, and <code>t.extensions</code>, for <code>t</code> a cone, is the natural transformation <code>yoneda C t.X ‚ü∂ F.cones</code> given by whiskering a cone.</p>

#### [ Scott Morrison (Nov 04 2018 at 11:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137151412):
<p>I'm finding these sorries very confusing. I'm not sure that this is a sign that the design is bad, just that this is a corner of basic category theory that no one ever writes out the details of. :-)</p>

#### [ Reid Barton (Nov 05 2018 at 00:12)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175002):
<p>I managed to prove them. It took me 2 hours to write about a dozen lines of code.</p>

#### [ Scott Morrison (Nov 05 2018 at 00:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175591):
<p>Awesome!</p>

#### [ Scott Morrison (Nov 05 2018 at 00:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175819):
<p>1. I'm glad it took you a while, it makes me feel less incompetent. :-)</p>

#### [ Scott Morrison (Nov 05 2018 at 00:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175821):
<p>2. Is there something we can learn from this having been hard??</p>

#### [ Scott Morrison (Nov 05 2018 at 00:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175831):
<p>It seems like a bad sign that something a textbook contents itself with merely stating, was a struggle in the library.</p>

#### [ Reid Barton (Nov 05 2018 at 00:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175893):
<p>I also just proved that equalizers are monomorphisms, since that was the other sorry</p>

#### [ Reid Barton (Nov 05 2018 at 00:46)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175939):
<p>and the lemma I needed to prove it (<code>is_limit.hom_eq</code>; maybe not a very good name? but it's hard to think of different names for all the different aspects of the universal property) is something that I used extensively in my homotopy theory library</p>

#### [ Scott Morrison (Nov 05 2018 at 00:47)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175949):
<p>Ah, thanks!</p>

#### [ Reid Barton (Nov 05 2018 at 00:48)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137175995):
<p>I tend to think of it as a general "extensionality" property for limits, since it generalizes funext/prod.ext</p>

#### [ Scott Morrison (Nov 05 2018 at 00:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176009):
<p>It's a close relative of</p>
<div class="codehilite"><pre><span></span>@[extensionality] lemma limit.hom_ext {F : J ‚•§ C} [has_limit F] {X : C}
  {f g : X ‚ü∂ limit F}
  (w : ‚àÄ j, f ‚â´ limit.œÄ F j = g ‚â´ limit.œÄ F j) : f = g :=
</pre></div>

#### [ Scott Morrison (Nov 05 2018 at 00:50)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176055):
<p>I wonder if we should unify them.</p>

#### [ Reid Barton (Nov 05 2018 at 00:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176066):
<p>Oh yeah. Isn't it the same thing?</p>

#### [ Reid Barton (Nov 05 2018 at 00:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176067):
<p>I think you should never prove anything about <code>limit</code>, always <code>is_limit</code></p>

#### [ Reid Barton (Nov 05 2018 at 00:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176068):
<p>and then provide a wrapper for <code>limit</code> if that seems useful</p>

#### [ Reid Barton (Nov 05 2018 at 00:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176108):
<p>because there are lots of ways you could get your hands on a limit cone, only one of which is from the category's chosen limits (if it even has them)</p>

#### [ Reid Barton (Nov 05 2018 at 00:53)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176114):
<p>I also did this for <code>is_equalizer.mono</code></p>

#### [ Scott Morrison (Nov 05 2018 at 00:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176162):
<p>Hmm, I'm on the fence here.</p>

#### [ Scott Morrison (Nov 05 2018 at 00:55)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176178):
<p>One can of course, with some hassle, use theorems stated in terms of <code>limit</code> in situations where you just have an <code>is_limit</code>, by using <code>is_limit.ext</code> to prove that your <code>is_limit</code> is actually equal to the one <code>limit</code> thinks it's using.</p>

#### [ Reid Barton (Nov 05 2018 at 00:56)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176217):
<blockquote>
<p>2. Is there something we can learn from this having been hard??</p>
</blockquote>
<p>I wondered about this too. My initial feeling was that there were too many definitions built up (<code>cones</code>/<code>representable</code>) with too little supporting theory, but upon reflection this didn't really seem to stand up, considering the eventually successful proof was to think hard about the actual fact which was needed, and then have Lean observe that it was enough.</p>

#### [ Reid Barton (Nov 05 2018 at 00:57)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176238):
<p>In lean-homotopy-theory I have many, many applications of facts like "a pushout of a pushout is a pushout" and I work in a setting where the category is not assumed to have pushouts</p>

#### [ Reid Barton (Nov 05 2018 at 00:58)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176282):
<p>So that's one obstruction to rewriting things in terms of chosen <code>limit</code>s</p>

#### [ Reid Barton (Nov 05 2018 at 01:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176346):
<p>But it is actually also just more practical in general, because it saves you from transporting the relevant facts across an isomorphism, and dealing with isomorphisms is disproportionately difficult in Lean</p>

#### [ Scott Morrison (Nov 05 2018 at 01:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176403):
<p>okay --- so the question is: how much of the stuff I currently have written in terms of <code>limit</code> should we:<br>
1) remove (for now)<br>
2) rewrite in terms of <code>is_limit</code>, possible re-adding wrappers<br>
3) leave as is?</p>

#### [ Reid Barton (Nov 05 2018 at 01:04)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176450):
<p>Well, I suggest 3, with 2 as needed</p>

#### [ Reid Barton (Nov 05 2018 at 01:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176467):
<p>Some things, like "<code>limit F</code> is functorial in <code>F</code>", really need <code>limit</code></p>

#### [ Reid Barton (Nov 05 2018 at 01:10)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176649):
<p>Some other things like <code>limit.pre</code> and <code>limit.pre_pre</code> which involve multiple limit cones are in a sort of middle area. I'm fine with just leaving them how they are until someone wants an <code>is_limit</code> version.</p>

#### [ Reid Barton (Nov 05 2018 at 01:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176713):
<p>Oh, I guess I missed that these functions only require limits of the specific diagrams which appear now. That means you can also use them as their <code>is_limit</code> equivalents, at least in principle...</p>

#### [ Reid Barton (Nov 05 2018 at 01:14)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176758):
<p>Still, I don't see any particular advantage to defining, say, <code>instance : mono (equalizer.Œπ f g)</code> directly over the way that I did it.</p>

#### [ Scott Morrison (Nov 05 2018 at 01:14)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176763):
<p>I agree there. I think this was my mistake, being over-eager to prove things in the <code>limit</code> variation.</p>

#### [ Reid Barton (Nov 05 2018 at 01:16)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176824):
<p>Now I remember that I actually considered a design like this at one point in lean-homotopy-theory, where you have a specific class <code>coproduct a b</code> which provides a chosen coproduct of two specific objects. I never tried it out though</p>

#### [ Scott Morrison (Nov 05 2018 at 01:16)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176827):
<p>I guess my hesitation is that switching to <code>is_limit</code> for, for example:</p>
<div class="codehilite"><pre><span></span>def limit.pre (F : J ‚•§ C) [has_limit F] (E : K ‚•§ J) [has_limit (E ‚ãô F)] : limit F ‚ü∂ limit (E ‚ãô F) :=
limit.lift (E ‚ãô F)
{ X := limit F,
  œÄ := { app := Œª k, limit.œÄ F (E k) } }
</pre></div>


<p>involves more variables.</p>

#### [ Scott Morrison (Nov 05 2018 at 01:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176833):
<p>The <code>has_limit</code> typeclasses each have to turn into a <code>cone</code> and an <code>is_limit</code>.</p>

#### [ Scott Morrison (Nov 05 2018 at 01:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176836):
<p>A somewhat scary option is to make <code>is_limit</code> a typeclass again, and make <code>has_limit</code> be inferrable from it...</p>

#### [ Scott Morrison (Nov 05 2018 at 01:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176894):
<p>It would be nice if the "typeclass inferred wasn't the one expected" class of errors were all solved by appropriate <code>subsingleton</code> instances...</p>

#### [ Reid Barton (Nov 05 2018 at 01:19)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137176941):
<p>Right, so there are just two differences really: whether or not <code>cone</code> and <code>is_limit</code> are bundled together, and whether or not the pair is a type class argument</p>

#### [ Reid Barton (Nov 05 2018 at 01:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177013):
<p>Well, <code>has_limit</code> is not even a subsingleton, unfortunately :)</p>

#### [ Scott Morrison (Nov 05 2018 at 01:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177065):
<p>yeah, so at the moment we're in the upside situation: the typeclass is not a singleton, the non-typeclass is...</p>

#### [ Scott Morrison (Nov 05 2018 at 01:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177066):
<p>yuck! :-)</p>

#### [ Reid Barton (Nov 05 2018 at 01:24)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177141):
<p>Well anyways, this just makes me even more want to leave all the <code>limit.*</code> functions alone (besides <code>limit.hom_ext</code> I guess) and just wait and see, in practice, how necessary it is to do "cone-based reasoning" vs "limit-based reasoning", for lack of better terms, and how inconvenient it is to feed the limit cones you want into <code>limit.*</code></p>

#### [ Scott Morrison (Nov 05 2018 at 01:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177222):
<p>okay, great :-)</p>

#### [ Reid Barton (Nov 05 2018 at 01:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177288):
<p>Hmm, does using <code>limit.hom_ext</code> as an <code>[extensionality]</code> lemma really work?</p>

#### [ Reid Barton (Nov 05 2018 at 01:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137177398):
<p>I guess it might. I wasn't brave enough to try to make <code>is_limit.hom_ext</code> one too, that seems like it would be bad since it would match basically everything.</p>

#### [ Scott Morrison (Nov 05 2018 at 03:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/137180007):
<p><code>@[extensionality] lemma limit.hom_ext</code> seems to work great!</p>

#### [ Johan Commelin (Nov 05 2018 at 08:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146043773):
<p>I really need a lot of <code>coblah</code> at the moment. Which approach are we going to take? I advocate putting every <code>costatement</code> right after <code>statement</code>. So the highest level of interleaving that is possible.<br>
I think every other approach will lead to things going hopelessly out of sync.</p>

#### [ Scott Morrison (Nov 05 2018 at 10:50)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785601):
<p>Hmm, I have been keeping them pretty separate. :-(</p>

#### [ Scott Morrison (Nov 05 2018 at 10:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785615):
<p>Mostly so that I can work on limits, and then once it has settled down doing a bunch of copy-paste.</p>

#### [ Scott Morrison (Nov 05 2018 at 10:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785670):
<p>Which bits of <code>coblah</code> have you been needing?</p>

#### [ Scott Morrison (Nov 05 2018 at 10:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785676):
<p>(Are you guys all at Freiburg?)</p>

#### [ Johan Commelin (Nov 05 2018 at 10:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785682):
<p>Mostly coequalizers</p>

#### [ Johan Commelin (Nov 05 2018 at 10:53)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785704):
<p>There is Kenny, Johannes, Rob, Tobias, Cyril, Patrick, Michael, and me</p>

#### [ Scott Morrison (Nov 05 2018 at 10:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785747):
<p>Did you do it yet?</p>

#### [ Scott Morrison (Nov 05 2018 at 10:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785753):
<p>It looks like I could dualize everything in equalizers.lean on short notice.</p>

#### [ Johan Commelin (Nov 05 2018 at 10:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785764):
<p>No, I got stuck somewhere.</p>

#### [ Scott Morrison (Nov 05 2018 at 10:55)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785772):
<p>(I have been synchronizing the two halves of things using a split window editor, and going line by line.)</p>

#### [ Scott Morrison (Nov 05 2018 at 10:55)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785774):
<p>Is it okay if I do that now?</p>

#### [ Johan Commelin (Nov 05 2018 at 10:55)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146785785):
<p>Yeah cool. Then I'll try to do some sheaves stuff again.</p>

#### [ Scott Morrison (Nov 05 2018 at 11:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146786592):
<p>ok, done!</p>

#### [ Scott Morrison (Nov 05 2018 at 11:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146786598):
<p>(with one sorry, that I'm very confused about. we may have to ask Reid about it)</p>

#### [ Kenny Lau (Nov 05 2018 at 11:15)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146786702):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> do you want to skype with us?</p>

#### [ Johan Commelin (Nov 05 2018 at 11:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146787331):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Thanks for adding coequalizers!</p>

#### [ Johan Commelin (Nov 05 2018 at 11:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146787480):
<p>Hmmm, I'm also needing coproducts. But I don't want to overload you...</p>

#### [ Scott Morrison (Nov 05 2018 at 11:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146787754):
<p>Didn't I do those earlier this evening? Maybe you need to fetch. :-)</p>

#### [ Reid Barton (Nov 05 2018 at 14:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146794617):
<blockquote>
<p>(with one sorry, that I'm very confused about. we may have to ask Reid about it)</p>
</blockquote>
<p>I fixed it.</p>

#### [ Reid Barton (Nov 05 2018 at 15:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146796842):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> do you mind if at some point I merge mathlib master into the limits branch?</p>

#### [ Scott Morrison (Nov 05 2018 at 19:48)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146815058):
<p>Thanks for the fix! No problem, merge with master whenever you like.</p>

#### [ Scott Morrison (Nov 05 2018 at 19:48)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146815085):
<p>Sorry that my git hygiene has been so poor on this branch. We should also rebase and do some squashing.</p>

#### [ Johan Commelin (Nov 05 2018 at 19:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146815263):
<p>No, please don't do that on public branches.</p>

#### [ Johan Commelin (Nov 05 2018 at 19:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146815271):
<p>I think we should only squash when merging into mathlib.</p>

#### [ Johan Commelin (Nov 05 2018 at 19:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146815314):
<p>Not when multiple people are working on it.</p>

#### [ Scott Morrison (Nov 06 2018 at 09:03)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146851248):
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>, two questions/suggestions:<br>
1) don't you think we should do "easy" sheaves _first_, before the ones with sites and coverages?<br>
2) for your definition <code>def sieve : presheaf X (Type v) :=</code>, I think it's much easier if you start off working in tactic mode, and <code>have</code> each of the four maps you're building, so that it's easy to inspect their types. Once everything works you can obfuscate everything into term mode if you prefer. :-)</p>

#### [ Johan Commelin (Nov 06 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146851810):
<p>Thanks for the feedback.<br>
1) It might be a good idea. But I really want sheaves on a basis. And a basis is a site... And I think I'm almost there.<br>
2) This sounds like a very good plan!</p>

#### [ Scott Morrison (Nov 06 2018 at 11:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856102):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span>, <span class="user-mention" data-user-id="112680">@Johan Commelin</span>,  I'm close to "sticking a fork in it and saying it's done" on the new limits branch. It's certainly not exhaustively complete, but I want to leave it for a while. Do you think I should re-PR it?</p>

#### [ Scott Morrison (Nov 06 2018 at 11:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856103):
<p>It all compiles, and the only sorries are inside comments. :-)</p>

#### [ Johan Commelin (Nov 06 2018 at 11:10)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856168):
<p>Cool! We are making some progress with sheaves. Maybe let's wait for a couple hours and see what happens there?</p>

#### [ Scott Morrison (Nov 06 2018 at 11:11)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856173):
<p>Of course, it's still conspicuously missing examples!</p>

#### [ Scott Morrison (Nov 06 2018 at 11:11)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856184):
<p>Really I'd like to see all the limits and filtered colimits for CommRing in place...</p>

#### [ Johan Commelin (Nov 06 2018 at 11:25)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856745):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Would it be an idea to use <code>coproduct</code> instead of <code>limits.sigma</code>? I think that is just as readable, and less confusing with the existing <code>sigma</code>?</p>

#### [ Scott Morrison (Nov 06 2018 at 11:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856807):
<p>I'm open. If we change, we should change <code>prod</code> to <code>binary_product</code>, <code>sum</code> to <code>binary_coproduct</code>, <code>pi</code> to <code>product</code> and <code>sigma</code> to <code>coproduct</code>.</p>

#### [ Scott Morrison (Nov 06 2018 at 11:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856822):
<p>I actually find calling it sigma helpful, at this point. :-)</p>

#### [ Scott Morrison (Nov 06 2018 at 11:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856885):
<p>(because it's just the same as the built-in sigma, just for arbitrary categories, not just Type)</p>

#### [ Johan Commelin (Nov 06 2018 at 11:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856886):
<p>Well, we were writing <code>sigma.map</code> and it took a while to figure out that we actually wanted <code>limits.sigma.map</code>.</p>

#### [ Scott Morrison (Nov 06 2018 at 11:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856892):
<p>Yeah, okay, I've done that too.</p>

#### [ Johan Commelin (Nov 06 2018 at 11:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856908):
<p>Another point, this <code>sigma.map</code> could be a bit more general. The domains of <code>f</code> and <code>g</code> could differ. (In our case we have <code>c √ó c</code> and <code>c</code>, and they are related via the projections.</p>

#### [ Johan Commelin (Nov 06 2018 at 11:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856910):
<p>Does it make sense what I'm saying?</p>

#### [ Johan Commelin (Nov 06 2018 at 11:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146856966):
<p>We would need a map <code>h : beta ‚Üí beta'</code> such that <code>g \circ h = f</code> or something like that.</p>

#### [ Reid Barton (Nov 06 2018 at 17:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146873856):
<p>Perhaps it would be worthwhile to make a list of remaining category theory ingredients needed for schemes and perfectoid spaces?</p>

#### [ Kevin Buzzard (Nov 06 2018 at 17:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146874029):
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> My student <span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> wants sheaves on a basis. Is there a way he can look at your code?</p>

#### [ Patrick Massot (Nov 06 2018 at 17:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146874319):
<p>Johan and Johannes are currently working hard on this, the situation will probably be rather different in 24 hours.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:12)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146874572):
<p>Yes, look at the <code>sheaf</code> branch on community mathlib.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:12)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146874581):
<p>We are pretty close to a definition for sheaves of types on a basis.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146874608):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> We are collecting holes in the api in the <code>sheaf.lean</code> file on the sheaf branch.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876335):
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> So I think we can have sheaves of types on a basis rather soon. Generalising to sheaves of groups/rings shouldn't be hard. (We will need to prove that the respective categories have pullbacks and equalizers and such... but I think that should be doable. If <span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> wants, he could also look into that.)<br>
The bigger problem is extending sheaves on a basis to sheaves on the topology. Defining the functor on presheaves is not hard (I already did that a while ago); but proving that it preserves sheaves (it is even an equivalence!) seems to be harder.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876360):
<p>At least it will be hard if I want to use the general machinery of morphisms of sites.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876453):
<p>Maybe this special case is easier... it might help that it is an equivalence.</p>

#### [ Kevin Buzzard (Nov 06 2018 at 17:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876492):
<p>So what does this currently look like in Lean? I've not been following developments in category theory since term started.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876513):
<p>Look at the <code>sheaf</code> branch on community-mathlib.</p>

#### [ Johan Commelin (Nov 06 2018 at 17:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876627):
<p>Most of the proofs stay really close to the level that we as mathematicians would use. Sometimes you have to go into gory details, which means we didn't set up enough rules for <code>obviously</code>. But that should be easy to improve.</p>

#### [ Kevin Buzzard (Nov 06 2018 at 17:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876636):
<p>no, I mean what does the definition of a sheaf look like?</p>

#### [ Kevin Buzzard (Nov 06 2018 at 17:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876645):
<p>Oh I see, sorry, I missed the first message</p>

#### [ Johan Commelin (Nov 06 2018 at 17:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876649):
<p>On the <code>sheaf</code> branch, you want to look at <code>category_theory/sheaf.lean</code></p>

#### [ Johan Commelin (Nov 06 2018 at 17:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876678):
<p>I still need to prove a fundamental lemma, which reduces the sheaf condition to the usual thing in the case of topological spaces.</p>

#### [ Kevin Buzzard (Nov 06 2018 at 17:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146876758):
<p>great thanks, this is all we needed to know right now. Thanks a lot!</p>

#### [ Johan Commelin (Nov 06 2018 at 19:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146884999):
<p>This is throwing up type class issues again:</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">X</span><span class="o">]</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_limits</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cone</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="bp">_</span> <span class="n">F</span><span class="o">,</span> <span class="c1">-- now I have two instances of small_category J -- HELP</span>
  <span class="o">{</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">infi</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span><span class="o">,</span>
    <span class="n">œÄ</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">},</span>
  <span class="n">is_limit</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">}</span>

<span class="kn">end</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span>
</pre></div>

#### [ Reid Barton (Nov 06 2018 at 20:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146885724):
<p>I think the problem is actually that you have 0 instances</p>

#### [ Reid Barton (Nov 06 2018 at 20:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146885766):
<p>I put <code>by exactI</code> before <code>infi</code>, and now at least that line is accepted.</p>

#### [ Reid Barton (Nov 06 2018 at 20:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146885785):
<p>(Or, possibly you have some different imports/mathlib commit than I do.)</p>

#### [ Reid Barton (Nov 06 2018 at 20:03)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146885922):
<p>If you want to avoid <code>by exactI</code> tricks then you could probably define the limits of <code>X</code> in a separate top-level definition, taking care to put the arguments in the correct order for <code>has_limits</code>, and also to put the <code>[small_category J]</code> bit to the left of the colon</p>

#### [ Reid Barton (Nov 06 2018 at 20:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146886039):
<p>By the way, <span class="user-mention" data-user-id="110087">@Scott Morrison</span>, is there a particular reason for the duplication between <code>has_limits_of</code>, <code>has_limits_of_shapes</code>, <code>has_limits</code>? Why isn't for example <code>has_limits C = Œ† {J : Type v} [small_category J], has_limits_of_shape J C</code>?</p>

#### [ Johan Commelin (Nov 06 2018 at 20:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146886288):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Let me see if I understand what you are suggesting...</p>

#### [ Reid Barton (Nov 06 2018 at 20:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146886291):
<p>(Obviously it can't make that big a difference, I just intuitively feel that this duplication will lead to unpacking/repacking down the line. But maybe it's actually more convenient to use for some other reason.)</p>

#### [ Reid Barton (Nov 06 2018 at 20:11)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146886416):
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Actually <code>limits/types.lean</code> is already written in the style I was suggesting, so you can use that as an example.</p>

#### [ Johan Commelin (Nov 06 2018 at 20:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888196):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> It's working quite well! Thanks! Now I'm left fighting <code>plift</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">X</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">small_category</span> <span class="n">J</span><span class="o">]</span>

<span class="n">def</span> <span class="n">limit</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">cone</span> <span class="n">F</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">infi</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span><span class="o">,</span>
  <span class="n">œÄ</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">j</span><span class="o">,</span> <span class="bp">‚ü®</span><span class="n">plift</span><span class="bp">.</span><span class="n">up</span> <span class="o">(</span><span class="n">infi_le</span> <span class="bp">_</span> <span class="n">j</span><span class="o">)</span><span class="bp">‚ü©</span> <span class="o">}</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">limit_is_limit</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="n">limit</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">lift</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">s</span><span class="o">,</span> <span class="bp">‚ü®</span><span class="n">plift</span><span class="bp">.</span><span class="n">up</span> <span class="err">$</span> <span class="n">le_infi</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">i</span><span class="o">,</span> <span class="n">plift</span><span class="bp">.</span><span class="n">down</span> <span class="err">$</span> <span class="n">s</span><span class="bp">.</span><span class="n">œÄ</span> <span class="n">i</span><span class="o">)</span><span class="bp">‚ü©</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_limits</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cone</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span><span class="o">,</span> <span class="bp">@</span><span class="n">limit</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">is_limit</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span><span class="o">,</span> <span class="bp">@</span><span class="n">limit_is_limit</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_pullbacks</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">has_pullbacks_of_has_limits</span> <span class="bp">_</span>

<span class="kn">end</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span>
</pre></div>

#### [ Johan Commelin (Nov 06 2018 at 20:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888229):
<p><code>limit_is_limit</code> is still broken. The <code>plift.down</code> is illegal.</p>

#### [ Reid Barton (Nov 06 2018 at 20:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888373):
<p>Probably because there is <code>ulift</code> involved too? I wonder why your <code>limit</code> was accepted?</p>

#### [ Reid Barton (Nov 06 2018 at 20:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888402):
<p>oh, I didn't notice the angle brackets!</p>

#### [ Johan Commelin (Nov 06 2018 at 20:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888502):
<p>I think the other problem has to do with the constant functor etc... I have to look into it...</p>

#### [ Reid Barton (Nov 06 2018 at 20:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888509):
<p>I need to do something about my terminal font. or maybe set up emacs to display them in different colors</p>

#### [ Reid Barton (Nov 06 2018 at 20:41)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888543):
<p>For <code>has_pullbacks</code>? Deleting <code>_</code> worked for me</p>

#### [ Reid Barton (Nov 06 2018 at 20:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888676):
<p>(If using angle brackets for <code>ulift.up</code>, why not also for <code>plift.up</code>?)</p>

#### [ Johan Commelin (Nov 06 2018 at 20:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146888721):
<p>Yes, maybe I should do that...</p>

#### [ Johan Commelin (Nov 06 2018 at 20:55)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146889619):
<p>Done:</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">X</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">small_category</span> <span class="n">J</span><span class="o">]</span>

<span class="n">def</span> <span class="n">limit</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">cone</span> <span class="n">F</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">infi</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span><span class="o">,</span>
  <span class="n">œÄ</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">j</span><span class="o">,</span> <span class="bp">‚ü®‚ü®</span><span class="n">infi_le</span> <span class="bp">_</span> <span class="n">j</span><span class="bp">‚ü©‚ü©</span> <span class="o">}</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">limit_is_limit</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="n">limit</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">lift</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">s</span><span class="o">,</span> <span class="bp">‚ü®‚ü®</span><span class="n">le_infi</span> <span class="o">(</span><span class="bp">Œª</span> <span class="n">i</span><span class="o">,</span> <span class="n">plift</span><span class="bp">.</span><span class="n">down</span> <span class="err">$</span> <span class="n">ulift</span><span class="bp">.</span><span class="n">down</span> <span class="err">$</span> <span class="n">s</span><span class="bp">.</span><span class="n">œÄ</span> <span class="n">i</span><span class="o">)</span><span class="bp">‚ü©‚ü©</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_limits</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cone</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span><span class="o">,</span> <span class="bp">@</span><span class="n">limit</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">is_limit</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span><span class="o">,</span> <span class="bp">@</span><span class="n">limit_is_limit</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">J</span> <span class="n">hJ</span> <span class="n">F</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_pullbacks</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">has_pullbacks_of_has_limits</span> <span class="bp">_</span>

<span class="kn">end</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span>
</pre></div>

#### [ Scott Morrison (Nov 06 2018 at 22:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146896116):
<blockquote>
<p>By the way, <span class="user-mention" data-user-id="110087">@Scott Morrison</span>, is there a particular reason for the duplication between <code>has_limits_of</code>, <code>has_limits_of_shapes</code>, <code>has_limits</code>? Why isn't for example <code>has_limits C = Œ† {J : Type v} [small_category J], has_limits_of_shape J C</code>?</p>
</blockquote>
<p>Oh, it didn't occur to me that this could be possible. I've only recently realised that you can put Pi types in typeclass arguments sometimes.<br>
It sounds like a good idea.</p>

#### [ Scott Morrison (Nov 07 2018 at 12:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146933791):
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> please don't rely on 'theorems' like your</p>
<div class="codehilite"><pre><span></span>lemma cone.ext&#39; {F : J ‚•§ C} :
  ‚àÄ{x y : cone F} (eq : x.X = y.X), x.œÄ == y.œÄ ‚Üí x = y ...
</pre></div>

#### [ Scott Morrison (Nov 07 2018 at 12:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146933795):
<p>it will lead to tears.</p>

#### [ Scott Morrison (Nov 07 2018 at 12:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146933802):
<p>If you replace the equalities with isos, it's fine.</p>

#### [ Scott Morrison (Nov 07 2018 at 12:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146933848):
<p>(and the <code>==</code> with an appropriate composition)</p>

#### [ Scott Morrison (Nov 07 2018 at 12:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146933965):
<p>It looks like you've made lots of progress on sheaves!!</p>

#### [ Scott Morrison (Nov 07 2018 at 12:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146933990):
<p>ah, it seems you don't actually use <code>cone.ext'</code> anywhere, so I shouldn't get too upset about it. :-)</p>

#### [ Johannes H√∂lzl (Nov 07 2018 at 13:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146936058):
<p>yes, I removed to prove which used it afterwards, I couldn't apply it. so in the end I unfolded the proof in <code>pullback.lift_id</code>.</p>

#### [ Scott Morrison (Nov 07 2018 at 13:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146936569):
<p>I've just pushed some work on <code>sheaf.lean</code>.</p>

#### [ Scott Morrison (Nov 07 2018 at 13:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146936612):
<p>I moved a bunch of the API stuff you guys added to the limits branch, and then fixed the errors in <code>comap</code>.</p>

#### [ Johan Commelin (Nov 07 2018 at 13:56)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146937583):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Thanks a lot!</p>

#### [ Johan Commelin (Nov 07 2018 at 15:58)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/146963725):
<p>Is <code>preorder (over U)</code> going to create diamond issues? Here <code>U : opens X</code> and <code>X</code> is a type with a topology.</p>

#### [ Johan Commelin (Nov 07 2018 at 20:24)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147248600):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I saw that in the stuff on over categories you added <code>right := punit.star</code> a couple of times. Why is this necessary? I thought <code>obviously</code> was handling it. As a user I was very happy that I could ignore <code>right</code> when it was so trivial that you would like to think it didn't even exist.</p>

#### [ Johan Commelin (Nov 07 2018 at 20:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147250830):
<p>Does mathlib have the indiscrete (codiscrete?) topology, and if so, what is its name?</p>

#### [ Johan Commelin (Nov 07 2018 at 20:55)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147250863):
<p><code>git grep</code> didn't find either of those...</p>

#### [ Johannes H√∂lzl (Nov 07 2018 at 21:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147251441):
<p><code>‚ä•</code></p>

#### [ Johannes H√∂lzl (Nov 07 2018 at 21:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147251491):
<p>this is the indiscrete topology</p>

#### [ Johan Commelin (Nov 07 2018 at 21:07)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147251832):
<p>Ok, but it doesn't have a name, I guess?</p>

#### [ Johan Commelin (Nov 07 2018 at 21:07)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147251840):
<p>I have now pushed <code>site.trivial</code> and <code>site.discrete</code>.</p>

#### [ Johan Commelin (Nov 07 2018 at 21:07)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147251856):
<p>They are the only sorry-free examples of sites we have so far.</p>

#### [ Scott Morrison (Nov 07 2018 at 21:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252430):
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>, regarding <code>right := punit.star</code>. I did remove this, but I think only temporarily. The problem is that every field with an <code>autoparam</code> should be restated, otherwise the auto_param garbage clutters up the goal view, and sometimes gets in the way of elaboration.  I want to restore <code>obviously</code> to <code>left</code> and <code>right</code>, but it will involve restating <code>hom</code> by hand, and I didn't want to do that on the spot.</p>

#### [ Scott Morrison (Nov 07 2018 at 21:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252459):
<p>btw, <code>comap</code> is awesome, I'm really glad it's achievable with the current setup, and hopefully the proofs can even be trimmed down further.</p>

#### [ Johan Commelin (Nov 07 2018 at 21:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252713):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> If you have a couple of minutes. Would you mind taking a look at the bottom of the current version of the sheaf file? There is a very ugly mixing of category theory, lattices and topological stuff.</p>

#### [ Johan Commelin (Nov 07 2018 at 21:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252724):
<p>Probably I need to layer things better. But I currently don't see exactly how.</p>

#### [ Johan Commelin (Nov 07 2018 at 21:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252776):
<p>Especially the case for a <code>basis</code>.</p>

#### [ Johan Commelin (Nov 07 2018 at 21:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252788):
<p>That one is pretty important, it is math-trivial, and it is getting very ugly.</p>

#### [ Johannes H√∂lzl (Nov 07 2018 at 21:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147252981):
<p>the name of <code>‚ä•</code> is <code>bot</code>. I guess the concrete structure is something like <code>topological_space.has_bot</code>? But you can just use <code>‚ä•</code>  whenever you need the indiscrete topology</p>

#### [ Johan Commelin (Nov 07 2018 at 21:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147253052):
<p>Ok, I was just looking for a name to give to <code>site.trivial</code>. But maybe <code>site.trivial</code> is fine as it is...</p>

#### [ Johan Commelin (Nov 07 2018 at 21:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147253056):
<p>Or is this going to be <code>site.has_bot</code> at some point <span class="emoji emoji-1f606" title="lol">:lol:</span>?</p>

#### [ Johan Commelin (Nov 07 2018 at 21:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147253162):
<p>Anyway...</p>

#### [ Johan Commelin (Nov 07 2018 at 21:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147253179):
<p>I'm feeling like <code>basis.site</code> needs choice somewhere...</p>

#### [ Johan Commelin (Nov 07 2018 at 21:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147254105):
<p>Aah, progress has been made and pushed. It's not done yet, but I need sleep. And now it looks a lot better.</p>

#### [ Johan Commelin (Nov 07 2018 at 21:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147254123):
<p>Anyone who wants to step in: please go ahead!</p>

#### [ Scott Morrison (Nov 07 2018 at 21:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147254218):
<p>okay, I've just been having a look, but it's going to take me a while to get up to speed here. :-(</p>

#### [ Scott Morrison (Nov 07 2018 at 21:48)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147254452):
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>, I'm starting to doubt using <code>def over (X : C) := comma (functor.id C) (functor.of_obj X)</code></p>

#### [ Scott Morrison (Nov 07 2018 at 21:48)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147254481):
<p>It means the <code>comma_morphism.w</code> field is a bit unusable, because it has lurking <code>functor.id</code>s in it that we have to dsimp and then <code>rw category.id_comp</code> to get out of the way.</p>

#### [ Scott Morrison (Nov 07 2018 at 21:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147254513):
<p>At very least we should not use <code>g.w</code> for <code>g</code> a morphisms of <code>over</code>s, but write a cleaner lemma.</p>

#### [ Scott Morrison (Nov 07 2018 at 22:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147255822):
<p>Okay, I've fixed that issue, and cleaned up proofs a little. I don't yet have any help for your sorries, however .:-)</p>

#### [ Johan Commelin (Nov 08 2018 at 05:19)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147276527):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Thanks for your help! I didn't think <code>over</code> was creating too many problems yet. And I would hope that they would be fixable by API otherwise...</p>

#### [ Scott Morrison (Nov 08 2018 at 05:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147276772):
<p>I think I solved the over issue; the simp lemma <code>cone_morphism.over_w</code> is all we needed.</p>

#### [ Scott Morrison (Nov 08 2018 at 05:46)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147277421):
<p>Ugh.. I just sat down to clean some things up in the limits branch, and within minutes I was dealing with something that wouldn't be a problem if we didn't use coercions... <span class="emoji emoji-1f4a9" title="pile of poo">:pile_of_poo:</span></p>

#### [ Johan Commelin (Nov 08 2018 at 06:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147278698):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110294">@Johannes H√∂lzl</span> <span class="emoji emoji-2b06" title="up">:up:</span></p>

#### [ Johannes H√∂lzl (Nov 08 2018 at 09:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147285969):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> when you cleanup the limits branch, take care that no line is longer than 100 chars, also don't indent like</p>
<div class="codehilite"><pre><span></span><span class="o">{</span> <span class="n">long_field_name</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">g</span> <span class="o">:=</span> <span class="bp">...</span><span class="o">,</span>
                         <span class="bp">...</span> <span class="o">}</span> <span class="o">}</span>
</pre></div>


<p>but</p>
<div class="codehilite"><pre><span></span><span class="o">{</span> <span class="n">long_field_name</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="bp">...</span>
  <span class="o">}</span> <span class="o">}</span>
</pre></div>

#### [ Scott Morrison (Nov 08 2018 at 09:53)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147285982):
<p>Yep, I've been doing this. I'm now in cleanup mode, and will check everything before the PR. :-)</p>

#### [ Scott Morrison (Nov 08 2018 at 10:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147287542):
<p>Oof, I just realised you said 100 characters, I thought I'd got away with 120 before. I'll trim some more. :-)</p>

#### [ Johannes H√∂lzl (Nov 08 2018 at 10:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147287766):
<p>I'm personally fine with 120 but most people say they cannot read my laptop screen as my resolution is too high... So I think 100 is the better solution. And I get the feeling Mario would prefer 60 :-)</p>

#### [ Scott Morrison (Nov 08 2018 at 10:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147287904):
<p>No worries, I'm going for 100 for now. :-)</p>

#### [ Reid Barton (Nov 13 2018 at 19:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147616558):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> is it intentional that <code>category_theory.limits.types</code> and <code>category_theory.limits.functor_category</code> aren't imported from <code>category_theory.limits.default</code>?</p>

#### [ Scott Morrison (Nov 13 2018 at 21:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147624385):
<p>I wasn't sure. My inclination is always to import less by default, but I don't really mind.</p>

#### [ Johan Commelin (Nov 13 2018 at 22:07)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147625430):
<p>Would it make sense to add filtered limits to this PR?</p>

#### [ Reid Barton (Nov 13 2018 at 22:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147626278):
<p>I have a bunch of stuff related to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Œ∫</mi></mrow><annotation encoding="application/x-tex">\kappa</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">Œ∫</span></span></span></span>-filtered colimits somewhere</p>

#### [ Johan Commelin (Nov 14 2018 at 12:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147661810):
<p>The file <code>preserves.lean</code> is not fully dualised. For example, there is no <code>preserved_colimit</code>.</p>

#### [ Johan Commelin (Nov 14 2018 at 20:15)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692070):
<p>Comma categories come with two natural forgetful functors: on this page <a href="https://ncatlab.org/nlab/show/comma+category#InComponents" target="_blank" title="https://ncatlab.org/nlab/show/comma+category#InComponents">https://ncatlab.org/nlab/show/comma+category#InComponents</a> they are called <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>C</mi></msub></mrow><annotation encoding="application/x-tex">H_C</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>D</mi></msub></mrow><annotation encoding="application/x-tex">H_D</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.02778em;">D</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>.<br>
See <a href="https://github.com/leanprover-community/mathlib/blob/limits/category_theory/commas.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/limits/category_theory/commas.lean">https://github.com/leanprover-community/mathlib/blob/limits/category_theory/commas.lean</a> for what we have in the current limits PR. What would be good names for these forgetful functors in Lean?</p>

#### [ Johan Commelin (Nov 14 2018 at 20:15)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692082):
<p>This is not just hypothetical, I want to use them in my sheaves project now...</p>

#### [ Johan Commelin (Nov 14 2018 at 20:16)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692133):
<p><code>forget_left</code> could mean that we forget <em>towards</em> the left... or that we forget the left component, and keep the right...</p>

#### [ Johan Commelin (Nov 14 2018 at 20:16)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692145):
<p>So, should we go with <code>to_left</code> or <code>forget_to_left</code>?</p>

#### [ Scott Morrison (Nov 14 2018 at 20:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692229):
<p>How about just <code>fst</code> and <code>snd</code>?</p>

#### [ Scott Morrison (Nov 14 2018 at 20:19)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692260):
<p>These are the usual names for the projections on a pair-like object.</p>

#### [ Johan Commelin (Nov 14 2018 at 20:19)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692287):
<p>Ok, fine with me.</p>

#### [ Johan Commelin (Nov 14 2018 at 20:24)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692646):
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">comma</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">L</span><span class="o">)</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span>

<span class="n">def</span> <span class="n">fst</span> <span class="o">:</span> <span class="n">comma</span> <span class="n">L</span> <span class="n">R</span> <span class="err">‚•§</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">X</span><span class="o">,</span> <span class="n">X</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">f</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">left</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">snd</span> <span class="o">:</span> <span class="n">comma</span> <span class="n">L</span> <span class="n">R</span> <span class="err">‚•§</span> <span class="n">B</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">X</span><span class="o">,</span> <span class="n">X</span><span class="bp">.</span><span class="n">right</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">f</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">right</span> <span class="o">}</span>

<span class="kn">end</span> <span class="n">comma</span>
</pre></div>

#### [ Johan Commelin (Nov 14 2018 at 20:24)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692669):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Should I push this to <code>limits</code>?</p>

#### [ Scott Morrison (Nov 14 2018 at 20:25)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692711):
<p>yes, thanks</p>

#### [ Scott Morrison (Nov 14 2018 at 20:25)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692756):
<p>While you're at it, how about we even rename the fields of commas and comma morphisms to <code>fst</code> and <code>snd</code>?</p>

#### [ Johan Commelin (Nov 14 2018 at 20:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692972):
<p>Aah, hmm. I pushed already.</p>

#### [ Johan Commelin (Nov 14 2018 at 20:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692981):
<p>But yes, that might be a good idea.</p>

#### [ Johan Commelin (Nov 14 2018 at 20:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147692990):
<p>But doesn't that lead to conflicts?</p>

#### [ Johan Commelin (Nov 14 2018 at 20:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147693020):
<p>As in, we are defining a structure <code>comma</code> with fields <code>fst</code> and <code>snd</code>, and then in the <code>comma</code> namespace we also want to define <code>fst</code> and <code>snd</code>...</p>

#### [ Johan Commelin (Nov 14 2018 at 20:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147693187):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Is this one of the reasons you sometimes add <code>'</code> to names?</p>

#### [ Scott Morrison (Nov 14 2018 at 23:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147704970):
<p>No, that's not why I sometimes add <code>'</code>. That's purely so we can give restated, <code>dsimp</code>ed (or coercioned, back in the bad old days)) versions of the structure fields.</p>

#### [ Scott Morrison (Nov 14 2018 at 23:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147704994):
<p>Not sure how to deal with that name conflict....</p>

#### [ Johan Commelin (Nov 15 2018 at 06:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722024):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> So, what is the common way to resolve naming conflicts like this? The general question is this: what do we do with structures that have a field <code>foo</code> and the projection on <code>foo</code> happens to be a functor... Would this have been easier if functors were a class?</p>

#### [ Mario Carneiro (Nov 15 2018 at 06:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722030):
<p>I've been using one letter prefixes in a few places</p>

#### [ Mario Carneiro (Nov 15 2018 at 06:31)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722042):
<p>like <code>linear_map.comp</code> is composition of linear maps, and <code>linear_map.lcomp</code> is a linear composition function</p>

#### [ Mario Carneiro (Nov 15 2018 at 06:31)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722051):
<p>and <code>llcomp</code> is linear in a really high order type</p>

#### [ Johan Commelin (Nov 15 2018 at 06:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722092):
<p>So in this case you would propose <code>ffst</code> and <code>fsnd</code>?</p>

#### [ Mario Carneiro (Nov 15 2018 at 06:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722110):
<p>yeah... you might also want to ask <span class="user-mention" data-user-id="110087">@Scott Morrison</span> in case he has already found a naming convention for this</p>

#### [ Johan Commelin (Nov 15 2018 at 06:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722113):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Have you documented somewhere why functors are not a class?</p>

#### [ Scott Morrison (Nov 15 2018 at 06:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722117):
<p>You mean a typeclass on the underlying function of objects?</p>

#### [ Scott Morrison (Nov 15 2018 at 06:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722129):
<p>It's a good question, which I've been meaning to try to remember the answer to. :-)</p>

#### [ Johan Commelin (Nov 15 2018 at 06:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722158):
<p>Because if we could just write <code>instance : functor (fst)</code> then someone could write <code>X.fst</code> and get functorial behaviour out of that...</p>

#### [ Johan Commelin (Nov 15 2018 at 06:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722161):
<p>Or am I dreaming?</p>

#### [ Johan Commelin (Nov 15 2018 at 06:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722168):
<p>Because now I have a bunch of code containing <code>X.fst</code> which will probably have to be written as the defeq <code>ffst.obj X</code> just to make sure that it plays nice with later constructions.</p>

#### [ Scott Morrison (Nov 15 2018 at 06:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722265):
<p>At some point in the past I had a strong opinion about this (against the typeclass version), but it's worth revisiting.</p>

#### [ Scott Morrison (Nov 15 2018 at 06:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722270):
<p>My opinion may have been based on trying to refactor everything to this form and it being miserable. :-)</p>

#### [ Scott Morrison (Nov 15 2018 at 06:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722280):
<p>ah,</p>

#### [ Scott Morrison (Nov 15 2018 at 06:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722287):
<p>So you do quickly want the bundled version as well, to talk about the category of functors and natural transformations</p>

#### [ Scott Morrison (Nov 15 2018 at 06:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722312):
<p>But that's not an obstacle in itself.</p>

#### [ Scott Morrison (Nov 15 2018 at 06:41)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722341):
<p>When you want to write <code>yoneda : C \func (C^op \func Type)</code>, what would we do? Just write <code>yoneda : C \to (C^op \to Type)</code></p>

#### [ Scott Morrison (Nov 15 2018 at 06:41)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722345):
<p>and then separate instances <code>functorial (yoneda X)</code>, and ...?</p>

#### [ Scott Morrison (Nov 15 2018 at 06:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722385):
<p>the problem is you can't write <code>functorial yoneda</code></p>

#### [ Scott Morrison (Nov 15 2018 at 06:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722389):
<p>because we would need a category structure on <code>C^op \to Type</code></p>

#### [ Scott Morrison (Nov 15 2018 at 06:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722391):
<p>and where would that come from?</p>

#### [ Scott Morrison (Nov 15 2018 at 06:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722398):
<p>the category structure is only on the bundled functors</p>

#### [ Scott Morrison (Nov 15 2018 at 06:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722453):
<p>so.... you define <code>yoneda_2 : C \to (C^op \func Type)</code>, and prove that its underlying functions are the same as <code>yoneda</code>, and then construct <code>functorial yoneda_2</code>?</p>

#### [ Scott Morrison (Nov 15 2018 at 06:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722454):
<p>Seems a bit gross.</p>

#### [ Johan Commelin (Nov 15 2018 at 06:57)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722852):
<p>I see, those are good points. Thanks for pointing them out! Otoh it might be consistent with what we have been doing so far? (Having both an unbundled and a bundled version.)</p>

#### [ Johan Commelin (Nov 15 2018 at 06:58)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722857):
<p>I hope that with the unbundled version a lot of other code might become cleaner...</p>

#### [ Johan Commelin (Nov 15 2018 at 06:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147722914):
<p>Another reason against unbundling is if we can cook up a plethora of examples where functors have the same underlying function on objects... But can only cook up pathological examples at the moment.</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724188):
<p>it is worth mentioning that this is basically the opposite direction to the one I took in the module refactor</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724192):
<p>with bundling linear maps</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724254):
<p>I'm not saying it's a bad idea per se, but the reasons that apply to one equally apply to the other</p>

#### [ Johan Commelin (Nov 15 2018 at 07:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724263):
<p>I was also very surprised that you did that <span class="emoji emoji-1f600" title="grinning">:grinning:</span> <br>
I remember that about half a year ago you told me that bundling comes with quite some drawbacks, and that a lot of stuff should be dealt with in an unbundled setting first...</p>

#### [ Johan Commelin (Nov 15 2018 at 07:41)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724281):
<p>As a recent example, the bundled version <code>open_set (X : Top)</code> was changed into the unbundled <code>opens (X : Type) [topological_space X]</code></p>

#### [ Mario Carneiro (Nov 15 2018 at 07:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724327):
<p>not only there are drawbacks in every direction, some are innate and some are artifacts of lean 3 implementation</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724332):
<p>but I stand by that last one</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724342):
<p>The point is that <code>opens</code> is not a functor, it is a function on a fixed topological space</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724347):
<p>er, actually I think it is a functor from the preorder category, but you get the idea</p>

#### [ Johan Commelin (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724389):
<p>It is a <code>functor</code> from <code>Top</code> to <code>Type</code></p>

#### [ Mario Carneiro (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724392):
<p>it's not, though</p>

#### [ Johan Commelin (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724393):
<p>contravariant</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724395):
<p>like not literally</p>

#### [ Johan Commelin (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724396):
<p>???</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724397):
<p>this is what <code>fopens</code> would be for</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724398):
<p>you take the function and bundle it up into a functor</p>

#### [ Johan Commelin (Nov 15 2018 at 07:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724409):
<p>Ok, so I want <code>instance : functorial opens</code></p>

#### [ Mario Carneiro (Nov 15 2018 at 07:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724413):
<p>this is also what scott is talking about with <code>yoneda_2</code></p>

#### [ Mario Carneiro (Nov 15 2018 at 07:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724427):
<p>that's not going to help if you need a functor though</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724428):
<p>it's still unbundled</p>

#### [ Johan Commelin (Nov 15 2018 at 07:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724429):
<p>Or maybe we rename the current <code>functor</code> to <code>Functor</code>, and then have <code>functor</code> for the unbundled version.</p>

#### [ Mario Carneiro (Nov 15 2018 at 07:46)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724431):
<p>like if you need to inhabit a functor category like scott said</p>

#### [ Johan Commelin (Nov 15 2018 at 07:46)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147724472):
<p>Anyway, my train is calling me. See you in 45min.</p>

#### [ Johan Commelin (Nov 15 2018 at 08:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726032):
<p>Ok, so what is the verdict? Would it make sense to introduce an unbundled version of <code>functor</code> or should I go for the prefix naming scheme? Or is  this something that isn't clear, and deserves more experimentation?</p>

#### [ Johan Commelin (Nov 15 2018 at 08:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726036):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Also, which parts exactly do you think a br0xen because of Lean 3? And which parts are inherent drawbacks?</p>

#### [ Mario Carneiro (Nov 15 2018 at 08:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726115):
<p>the stuff about coercions is broken because of lean 3</p>

#### [ Mario Carneiro (Nov 15 2018 at 08:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726174):
<p>some of the stuff about using bundled classes for <code>Group</code>, <code>Top</code> etc could be solved but only with significant changes to how elaboration works (i.e. unification hints)</p>

#### [ Mario Carneiro (Nov 15 2018 at 08:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726220):
<p>I think you shouldn't bother making an unbundled version of functor. This already exists, and it's called <code>functor</code></p>

#### [ Johan Commelin (Nov 15 2018 at 08:44)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726353):
<p>I don't follow</p>

#### [ Johan Commelin (Nov 15 2018 at 08:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147726369):
<p>If <code>functor</code> is unbundled, what would be a bundled functor?</p>

#### [ Mario Carneiro (Nov 15 2018 at 09:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727014):
<p><code>_root_.functor</code></p>

#### [ Johan Commelin (Nov 15 2018 at 09:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727117):
<p>What? That is not even in the category theory library...</p>

#### [ Johan Commelin (Nov 15 2018 at 09:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727119):
<p>Also, it isn't bundling the function on objects. So I would call this an unbundled endofunctor of <code>Type</code></p>

#### [ Johan Commelin (Nov 15 2018 at 09:06)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727158):
<p>Maybe I'm just very confused about terminology.</p>

#### [ Johan Commelin (Nov 15 2018 at 09:11)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727294):
<p>What we have now is</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">functor</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">u‚ÇÅ</span> <span class="n">v‚ÇÅ</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">(</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÇ</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">u‚ÇÇ</span> <span class="n">v‚ÇÇ</span><span class="o">}</span> <span class="n">D</span><span class="o">]</span> <span class="o">:</span>
  <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u‚ÇÅ</span> <span class="n">v‚ÇÅ</span> <span class="n">u‚ÇÇ</span> <span class="n">v‚ÇÇ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">obj</span>       <span class="o">:</span> <span class="n">C</span> <span class="bp">‚Üí</span> <span class="n">D</span><span class="o">)</span>
<span class="o">(</span><span class="n">map</span>       <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">C</span><span class="o">},</span> <span class="o">(</span><span class="n">X</span> <span class="err">‚ü∂</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">((</span><span class="n">obj</span> <span class="n">X</span><span class="o">)</span> <span class="err">‚ü∂</span> <span class="o">(</span><span class="n">obj</span> <span class="n">Y</span><span class="o">)))</span>
<span class="o">(</span><span class="n">map_id&#39;</span>   <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">map</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">ùüô</span> <span class="o">(</span><span class="n">obj</span> <span class="n">X</span><span class="o">)</span> <span class="bp">.</span> <span class="n">obviously</span><span class="o">)</span>
<span class="o">(</span><span class="n">map_comp&#39;</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">‚ü∂</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">‚ü∂</span> <span class="n">Z</span><span class="o">),</span> <span class="n">map</span> <span class="o">(</span><span class="n">f</span> <span class="err">‚â´</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="n">f</span><span class="o">)</span> <span class="err">‚â´</span> <span class="o">(</span><span class="n">map</span> <span class="n">g</span><span class="o">)</span> <span class="bp">.</span> <span class="n">obviously</span><span class="o">)</span>
</pre></div>


<p>And I'm asking whether it makes sense to also have</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">functor</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÅ</span><span class="o">}</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">u‚ÇÅ</span> <span class="n">v‚ÇÅ</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">{</span><span class="n">D</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u‚ÇÇ</span><span class="o">}</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">u‚ÇÇ</span> <span class="n">v‚ÇÇ</span><span class="o">}</span> <span class="n">D</span><span class="o">]</span> <span class="o">(</span><span class="n">obj</span> <span class="o">:</span> <span class="n">C</span> <span class="bp">‚Üí</span> <span class="n">D</span><span class="o">)</span> <span class="o">:</span>
  <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u‚ÇÅ</span> <span class="n">v‚ÇÅ</span> <span class="n">u‚ÇÇ</span> <span class="n">v‚ÇÇ</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span>       <span class="o">:</span> <span class="bp">Œ†</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="o">:</span> <span class="n">C</span><span class="o">},</span> <span class="o">(</span><span class="n">X</span> <span class="err">‚ü∂</span> <span class="n">Y</span><span class="o">)</span> <span class="bp">‚Üí</span> <span class="o">((</span><span class="n">obj</span> <span class="n">X</span><span class="o">)</span> <span class="err">‚ü∂</span> <span class="o">(</span><span class="n">obj</span> <span class="n">Y</span><span class="o">)))</span>
<span class="o">(</span><span class="n">map_id&#39;</span>   <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">map</span> <span class="o">(</span><span class="mi">ùüô</span> <span class="n">X</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">ùüô</span> <span class="o">(</span><span class="n">obj</span> <span class="n">X</span><span class="o">)</span> <span class="bp">.</span> <span class="n">obviously</span><span class="o">)</span>
<span class="o">(</span><span class="n">map_comp&#39;</span> <span class="o">:</span> <span class="bp">‚àÄ</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">‚ü∂</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">‚ü∂</span> <span class="n">Z</span><span class="o">),</span> <span class="n">map</span> <span class="o">(</span><span class="n">f</span> <span class="err">‚â´</span> <span class="n">g</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">map</span> <span class="n">f</span><span class="o">)</span> <span class="err">‚â´</span> <span class="o">(</span><span class="n">map</span> <span class="n">g</span><span class="o">)</span> <span class="bp">.</span> <span class="n">obviously</span><span class="o">)</span>
</pre></div>

#### [ Mario Carneiro (Nov 15 2018 at 09:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727698):
<p>possibly... in particular it may work better with notations, just like the <code>&lt;$&gt;</code> notation in <code>_root_.functor</code></p>

#### [ Mario Carneiro (Nov 15 2018 at 09:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727703):
<p>which is not necessarily an endofunctor btw</p>

#### [ Mario Carneiro (Nov 15 2018 at 09:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727713):
<p>I was saying that <code>_root_.functor</code> is unbundled</p>

#### [ Mario Carneiro (Nov 15 2018 at 09:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727832):
<p>but I think it doesn't work well with identity and composition of functors</p>

#### [ Mario Carneiro (Nov 15 2018 at 09:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727843):
<p>I recall Simon had to do some workaround stuff to define the composition of <code>_root_.functor</code>s</p>

#### [ Mario Carneiro (Nov 15 2018 at 09:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727858):
<p>It is best when all the functors are "atomic", i.e. <code>F A : D</code> if <code>A : C</code>, and <code>F</code> is a variable or constant here</p>

#### [ Mario Carneiro (Nov 15 2018 at 09:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147727905):
<p>when you have things like <code>(F o G) A = F (G A)</code> it gets hard for lean</p>

#### [ Johan Commelin (Nov 15 2018 at 09:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147728150):
<p>Ok, I don't understand all the issues, but I'll believe you (-;</p>

#### [ Johan Commelin (Nov 15 2018 at 09:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147728206):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> The <code>f</code> in <code>_root_.functor f</code> goes from <code>Type u</code> to <code>Type v</code>, so up to universes it is an endofunctor, right?</p>

#### [ Johannes H√∂lzl (Nov 15 2018 at 10:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729217):
<p>Yes, <code>_root_.functor</code> is an endofunctor in the <code>Type</code> category (as you said, up to universes)</p>

#### [ Johannes H√∂lzl (Nov 15 2018 at 10:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729225):
<p>I guess you meant also <code>class functor {C : Type u‚ÇÅ} [category.{u‚ÇÅ v‚ÇÅ} C] {D : Type u‚ÇÇ} [category.{u‚ÇÇ v‚ÇÇ} D] (obj : C ‚Üí D) : ...</code> (<code>class</code> instead of <code>structure</code>)?</p>

#### [ Johan Commelin (Nov 15 2018 at 10:03)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729239):
<p>Aah sure, that was an "edito"</p>

#### [ Johannes H√∂lzl (Nov 15 2018 at 10:06)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729410):
<p>The problem with classes is that the <code>.func_in_namespace</code> syntax doesn't work. So while you can add a specific function (like <code>fst</code>) <code>map</code> needs to be named <code>fmap</code> or we need to introduce a infix operator. Similar with the theorem names.</p>

#### [ Johan Commelin (Nov 15 2018 at 10:07)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729444):
<p>I see, that makes sense.</p>

#### [ Johannes H√∂lzl (Nov 15 2018 at 10:10)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729580):
<p>This is a hard decision. I think there is no clear answer (at least not in Lean 3)</p>

#### [ Johan Commelin (Nov 15 2018 at 10:10)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147729597):
<p>The correct solution in this case is probably that we should define <code>comma</code> as a 2-categorical pullback. That would instantly make <code>fst</code> and <code>snd</code> into functors (√† la Scott).</p>

#### [ Johan Commelin (Nov 15 2018 at 12:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147734668):
<p>Next naming question: given a natural transformation <code>R‚ÇÅ \nattrans R‚ÇÇ</code> you get a functor <code>comma L R‚ÇÅ ‚Üí comma L R‚ÇÇ</code>. How should we call this gadget? Would this be <code>map_right</code>, and the corresponding thing for <code>L‚ÇÅ</code> and <code>L‚ÇÇ</code> would be <code>map_left</code>?</p>

#### [ Johan Commelin (Nov 15 2018 at 12:24)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147735408):
<p><span class="user-mention" data-user-id="110294">@Johannes H√∂lzl</span> Is it safe to add <code>@[simp]</code> in the following way?</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">def</span> <span class="n">fst</span> <span class="o">:</span> <span class="n">comma</span> <span class="n">L</span> <span class="n">R</span> <span class="err">‚•§</span> <span class="n">A</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">X</span><span class="o">,</span> <span class="n">X</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">f</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="n">left</span> <span class="o">}</span>
</pre></div>

#### [ Johannes H√∂lzl (Nov 15 2018 at 12:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147735458):
<p>It is safe, but would be annoying. I think you only want to unfold <code>fst</code> under a projection (i.e. <code>obj (fst _) = _</code> and <code>map (fst _) = _</code>) or some other operation</p>

#### [ Johan Commelin (Nov 15 2018 at 12:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147735554):
<p>Ok, so I should write my own explicit simp-lemmas</p>

#### [ Johan Commelin (Nov 15 2018 at 12:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147736369):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I just pushed <code>map_left</code> and <code>map_right</code> to <code>limits</code>. I don't know if you like that, but I think they are pretty useful. Maybe I shouldn't be touching this branch too much. I can keep further stuff in the <code>sheaf</code> branch.</p>

#### [ Johan Commelin (Nov 15 2018 at 12:50)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147736431):
<p>Also, I didn't have the <code>-- obviously says</code> comments. Maybe that is bad, because then you won't find this code for future clean-ups??</p>

#### [ Scott Morrison (Nov 15 2018 at 20:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147769051):
<p>No, it's fine. I think my point that <code>rewrite_search</code> is awesome but for now slow has been made, and we can drop those comments. :-)</p>

#### [ Johan Commelin (Nov 15 2018 at 21:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147769663):
<p>Well, maybe you put the comments there so that you could easily clean up those blocks once mathlib has a fast <code>rewrite_search</code>...</p>

#### [ Reid Barton (Nov 16 2018 at 17:47)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147829089):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> do you have an opinion about this change?</p>
<div class="codehilite"><pre><span></span><span class="gh">diff --git a/category_theory/limits/cones.lean b/category_theory/limits/cones.lean</span>
<span class="gh">index 6d68844..7fce15c 100644</span>
<span class="gd">--- a/category_theory/limits/cones.lean</span>
<span class="gi">+++ b/category_theory/limits/cones.lean</span>
<span class="gu">@@ -228,16 +228,17 @@ include ùíü</span>

 @[simp] def functoriality (F : J ‚•§ C) (G : C ‚•§ D) : (cocone F) ‚•§ (cocone (F ‚ãô G)) :=
 { obj := Œª A,
<span class="gd">-  { X  := G.obj A.X,</span>
<span class="gd">-    Œπ  :=  whisker_right A.Œπ G ‚äü (functor.const_compose _ _ _).inv },</span>
<span class="gi">+  { X := G.obj A.X,</span>
<span class="gi">+    Œπ :=</span>
<span class="gi">+    { app := Œª j, G.map (A.Œπ.app j), naturality&#39; := by intros; erw ‚ÜêG.map_comp; tidy } },</span>
   map := Œª _ _ f,
   { hom := G.map f.hom,
     w&#39;  :=
     begin
       intros, dsimp,
<span class="gd">-      erw [category.comp_id, ‚Üêfunctor.map_comp, cocone_morphism.w, category.comp_id],</span>
<span class="gi">+      erw [‚Üêfunctor.map_comp, cocone_morphism.w],</span>
     end } }
 end
 end cocones

 end category_theory.limits
<span class="gu">@@ -257,6 +261,6 @@ def map_cocone_morphism (H : C ‚•§ D) {c c&#39; : cocone F} (f : cocone_morphism c c</span>
 @[simp] lemma map_cone_œÄ (H : C ‚•§ D) (c : cone F) (j : J) :
   (map_cone H c).œÄ.app j = ((functor.const_compose _ _ _).hom ‚äü whisker_right c.œÄ H).app j := rfl
 @[simp] lemma map_cocone_Œπ (H : C ‚•§ D) (c : cocone F) (j : J) :
<span class="gd">-  (map_cocone H c).Œπ.app j = (whisker_right c.Œπ H ‚äü (functor.const_compose _ _ _).inv).app j := rfl</span>
<span class="gi">+  (map_cocone H c).Œπ.app j = H.map (c.Œπ.app j) := rfl</span>

 end category_theory.functor
</pre></div>

#### [ Scott Morrison (Nov 16 2018 at 22:45)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/147848336):
<p>Looks fine.</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:03)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148053105):
<div class="codehilite"><pre><span></span><span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">0</span><span class="o">]</span> <span class="n">classical</span><span class="bp">.</span><span class="n">prop_decidable</span>
<span class="n">noncomputable</span> <span class="kn">instance</span> <span class="o">:</span> <span class="n">has_colimits</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span> <span class="n">v</span><span class="o">}</span> <span class="n">CommRing</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cocone</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">HJ</span> <span class="n">F</span><span class="o">,</span> <span class="o">{</span>
    <span class="n">X</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">letI</span> <span class="o">:=</span> <span class="n">HJ</span><span class="bp">;</span> <span class="n">exact</span>
         <span class="k">let</span> <span class="n">poly_vars</span> <span class="o">:=</span> <span class="err">Œ£</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J</span><span class="o">),</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="n">j</span> <span class="k">in</span>
         <span class="k">let</span> <span class="n">R</span> <span class="o">:=</span> <span class="n">mv_polynomial</span> <span class="n">poly_vars</span> <span class="bp">‚Ñ§</span> <span class="k">in</span>
         <span class="k">by</span> <span class="n">letI</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span> <span class="o">:=</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">to_comm_ring</span><span class="bp">;</span> <span class="n">exact</span>
         <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span> <span class="o">:=</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">span</span> <span class="o">(</span><span class="err">‚àÖ</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="o">)</span> <span class="k">in</span>
         <span class="o">{</span><span class="n">Œ±</span> <span class="o">:=</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">},</span><span class="bp">...</span>
</pre></div>


<p>Why do I have to put all these <code>letI</code>'s in? Is this expected? I'm trying to construct the colimit of a diagram of commutative rings. The ideal is currently wrong. </p>
<p>Oh -- I also made this change to mathlib:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">bundled</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="bp">‚Üí</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="o">(</span><span class="n">str</span> <span class="o">:</span> <span class="n">c</span> <span class="n">Œ±</span> <span class="bp">.</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span><span class="bp">.</span><span class="n">apply_instance</span><span class="o">)</span>
</pre></div>


<p>Is that crazy?</p>

#### [ Patrick Massot (Nov 20 2018 at 18:04)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148053183):
<p>A much more trivial remark is that, as far as I understand, nested <code>let</code> can be flattened</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148053208):
<p>the <code>letI</code>'s can't though and they are interspersed with the lets :-/</p>

#### [ Patrick Massot (Nov 20 2018 at 18:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148053215):
<p>not for <code>poly_vars</code> and <code>R</code></p>

#### [ Reid Barton (Nov 20 2018 at 18:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054778):
<p>The first <code>letI</code> is expected; or you can use <code>by exactI ...</code></p>

#### [ Reid Barton (Nov 20 2018 at 18:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054889):
<p>I don't know why you would need the second one though</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054916):
<p>We don't need it! Thanks! We needed it at some point -- maybe I was confused by another error.</p>

#### [ Reid Barton (Nov 20 2018 at 18:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054921):
<p>For making objects of <code>bundled</code>, the intent was to use <code>mk_ob</code> in the situation where the instance is one that will be provided by type class inference</p>

#### [ Reid Barton (Nov 20 2018 at 18:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054972):
<p>though I'm not sure whether it really works... it worked great in <code>lean-homotopy-theory</code>, where the category <code>Top</code> was fixed, but I'm not sure it works as well with <code>c</code> variable</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054974):
<div class="codehilite"><pre><span></span><span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">0</span><span class="o">]</span> <span class="n">classical</span><span class="bp">.</span><span class="n">prop_decidable</span>
<span class="n">noncomputable</span> <span class="kn">instance</span> <span class="o">:</span> <span class="n">has_colimits</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span> <span class="n">v</span><span class="o">}</span> <span class="n">CommRing</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cocone</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">HJ</span> <span class="n">F</span><span class="o">,</span> <span class="o">{</span>
    <span class="n">X</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">exactI</span>
         <span class="k">let</span> <span class="n">poly_vars</span> <span class="o">:=</span> <span class="err">Œ£</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J</span><span class="o">),</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="n">j</span><span class="o">,</span>
         <span class="n">R</span> <span class="o">:=</span> <span class="n">mv_polynomial</span> <span class="n">poly_vars</span> <span class="bp">‚Ñ§</span> <span class="k">in</span>
         <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span> <span class="o">:=</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">span</span> <span class="o">(</span><span class="err">‚àÖ</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="o">)</span> <span class="k">in</span>
         <span class="o">{</span><span class="n">Œ±</span> <span class="o">:=</span> <span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">,</span> <span class="n">str</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span><span class="o">},</span>
    <span class="n">Œπ</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">j</span><span class="o">,</span> <span class="bp">‚ü®Œª</span> <span class="n">r</span><span class="o">,</span><span class="k">begin</span> <span class="n">sorry</span> <span class="kn">end</span><span class="o">,</span> <span class="k">begin</span> <span class="n">sorry</span> <span class="kn">end</span><span class="bp">‚ü©</span><span class="o">,</span> <span class="n">naturality&#39;</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">}</span>
    <span class="o">},</span>
  <span class="n">is_colimit</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
</pre></div>


<p>I have a student making colimits -- this is how far we are.</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148054991):
<p>I see, I didn't know about <code>mk_ob</code></p>

#### [ Reid Barton (Nov 20 2018 at 18:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055005):
<p>however, I also found making the <code>str</code> field into a <code>()</code> field more convenient, for the case where you want to provide it explicitly</p>

#### [ Reid Barton (Nov 20 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055050):
<p>using <code>\&lt;_, _\&gt;</code></p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055055):
<div class="codehilite"><pre><span></span><span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">,</span> <span class="n">priority</span> <span class="mi">0</span><span class="o">]</span> <span class="n">classical</span><span class="bp">.</span><span class="n">prop_decidable</span>
<span class="n">noncomputable</span> <span class="kn">instance</span> <span class="o">:</span> <span class="n">has_colimits</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span> <span class="n">v</span><span class="o">}</span> <span class="n">CommRing</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cocone</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">J</span> <span class="n">HJ</span> <span class="n">F</span><span class="o">,</span> <span class="o">{</span>
    <span class="n">X</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">exactI</span>
         <span class="k">let</span> <span class="n">poly_vars</span> <span class="o">:=</span> <span class="err">Œ£</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">J</span><span class="o">),</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="n">j</span><span class="o">,</span>
         <span class="n">R</span> <span class="o">:=</span> <span class="n">mv_polynomial</span> <span class="n">poly_vars</span> <span class="bp">‚Ñ§</span> <span class="k">in</span>
         <span class="k">let</span> <span class="n">I</span> <span class="o">:</span> <span class="n">ideal</span> <span class="n">R</span> <span class="o">:=</span> <span class="n">ideal</span><span class="bp">.</span><span class="n">span</span> <span class="o">(</span><span class="err">‚àÖ</span> <span class="o">:</span> <span class="n">set</span> <span class="n">R</span><span class="o">)</span> <span class="k">in</span>
         <span class="n">category_theory</span><span class="bp">.</span><span class="n">mk_ob</span> <span class="o">(</span><span class="n">I</span><span class="bp">.</span><span class="n">quotient</span><span class="o">),</span>
    <span class="n">Œπ</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">j</span><span class="o">,</span> <span class="bp">‚ü®Œª</span> <span class="n">r</span><span class="o">,</span><span class="k">begin</span> <span class="n">sorry</span> <span class="kn">end</span><span class="o">,</span> <span class="k">begin</span> <span class="n">sorry</span> <span class="kn">end</span><span class="bp">‚ü©</span><span class="o">,</span> <span class="n">naturality&#39;</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">}</span>
    <span class="o">},</span>
  <span class="n">is_colimit</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="o">}</span>
</pre></div>


<p><code>mk_ob</code> added</p>

#### [ Reid Barton (Nov 20 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055059):
<p>Yes, looks like a good start</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055063):
<p>I have never used this library before, I didn't know about <code>mk_ob</code>. Are there any docs or basic worked examples?</p>

#### [ Kevin Buzzard (Nov 20 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055068):
<p>Maybe I'm writing it :-)</p>

#### [ Reid Barton (Nov 20 2018 at 18:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148055078):
<p>I think possibly nobody has used it before</p>

#### [ Johan Commelin (Nov 27 2018 at 15:04)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148639534):
<p>I think something like this might be useful, and I couldn't find it elsewhere:</p>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span>
<span class="kn">open</span> <span class="n">category_theory</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">K</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="err">ùíû</span> <span class="o">:</span> <span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="err">ùí¶</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">K</span><span class="o">]</span> <span class="o">[</span><span class="n">small_category</span> <span class="n">J</span><span class="o">]</span>
<span class="n">include</span> <span class="n">C</span> <span class="err">ùíû</span> <span class="n">K</span> <span class="err">ùí¶</span>

<span class="kn">lemma</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">pre_map</span>
  <span class="o">[</span><span class="n">has_colimits_of_shape</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">J</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">has_colimits_of_shape</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">K</span> <span class="n">C</span><span class="o">]</span>
  <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">C</span><span class="o">}</span> <span class="o">{</span><span class="n">E‚ÇÅ</span> <span class="n">E‚ÇÇ</span> <span class="o">:</span> <span class="n">K</span> <span class="err">‚•§</span> <span class="n">J</span><span class="o">}</span> <span class="o">(</span><span class="n">Œ±</span> <span class="o">:</span> <span class="n">E‚ÇÅ</span> <span class="err">‚üπ</span> <span class="n">E‚ÇÇ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">colimit</span><span class="bp">.</span><span class="n">pre</span> <span class="n">F</span> <span class="n">E‚ÇÅ</span> <span class="bp">=</span> <span class="n">colim</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">whisker_right</span> <span class="n">Œ±</span> <span class="n">F</span><span class="o">)</span> <span class="err">‚â´</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">pre</span> <span class="n">F</span> <span class="n">E‚ÇÇ</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext1</span><span class="o">,</span> <span class="n">dsimp</span><span class="o">,</span>
  <span class="n">conv</span> <span class="o">{</span><span class="n">to_rhs</span><span class="o">,</span> <span class="n">rw</span> <span class="err">‚Üê</span><span class="n">category</span><span class="bp">.</span><span class="n">assoc</span><span class="o">},</span>
  <span class="n">simp</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span>
</pre></div>

#### [ Johan Commelin (Nov 29 2018 at 17:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148796377):
<p>I don't have time to finish this atm, but I think we want lemmas like</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">coyoneda</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">C</span><span class="o">}</span> <span class="o">[</span><span class="n">has_colimit</span> <span class="n">F</span><span class="o">]</span> <span class="o">:</span> <span class="n">coyoneda</span><span class="bp">.</span><span class="n">obj</span> <span class="o">(</span><span class="n">colimit</span> <span class="n">F</span><span class="o">)</span> <span class="err">‚âÖ</span> <span class="n">F</span><span class="bp">.</span><span class="n">cocones</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">hom</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">P</span> <span class="n">f</span><span class="o">,</span> <span class="n">cocones_of_cocone</span> <span class="o">((</span><span class="n">colimit</span><span class="bp">.</span><span class="n">cocone</span> <span class="n">F</span><span class="o">)</span><span class="bp">.</span><span class="n">extend</span> <span class="n">f</span><span class="o">),</span>
    <span class="n">naturality&#39;</span> <span class="o">:=</span>
    <span class="k">begin</span>
      <span class="n">tidy</span> <span class="o">{</span><span class="n">trace_result</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">},</span>
      <span class="n">sorry</span>
    <span class="kn">end</span> <span class="o">},</span>
  <span class="n">inv</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">P</span> <span class="n">c</span><span class="o">,</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">desc</span> <span class="n">F</span> <span class="o">(</span><span class="n">cocone_of_cocones</span> <span class="n">c</span><span class="o">),</span>
    <span class="n">naturality&#39;</span> <span class="o">:=</span>
    <span class="k">begin</span>
      <span class="n">tidy</span> <span class="o">{</span><span class="n">trace_result</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">},</span>
      <span class="n">sorry</span>
    <span class="kn">end</span> <span class="o">}</span> <span class="o">}</span>
</pre></div>

#### [ Johan Commelin (Nov 29 2018 at 17:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148796397):
<p>This generalises</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">J</span> <span class="err">‚•§</span> <span class="n">C</span><span class="o">}</span> <span class="o">[</span><span class="n">has_colimit</span> <span class="n">F</span><span class="o">]</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">colimit</span> <span class="n">F</span> <span class="err">‚ü∂</span> <span class="n">P</span><span class="o">)</span> <span class="err">‚âÖ</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">cocones</span><span class="bp">.</span><span class="n">obj</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">hom</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">f</span><span class="o">,</span> <span class="n">cocones_of_cocone</span> <span class="o">((</span><span class="n">colimit</span><span class="bp">.</span><span class="n">cocone</span> <span class="n">F</span><span class="o">)</span><span class="bp">.</span><span class="n">extend</span> <span class="n">f</span><span class="o">),</span>
  <span class="n">inv</span> <span class="o">:=</span> <span class="bp">Œª</span> <span class="n">c</span><span class="o">,</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">desc</span> <span class="n">F</span> <span class="o">(</span><span class="n">cocone_of_cocones</span> <span class="n">c</span><span class="o">)</span> <span class="o">}</span>
</pre></div>

#### [ Reid Barton (Nov 29 2018 at 17:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148797402):
<p>Yes, probably. But this one is kind of automatic, I think. You might have an easier time constructing it with <code>nat_iso.of_components</code>.</p>

#### [ Reid Barton (Nov 29 2018 at 17:14)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148797474):
<p>The more crucial one is that the isomorphism is also natural in F</p>

#### [ Reid Barton (Nov 29 2018 at 17:20)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148797932):
<p>And I guess we should state these simultaneously somehow</p>

#### [ Johan Commelin (Nov 29 2018 at 18:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148801479):
<p>Yes, I realised that while I was on the train. I'm not general enough...</p>

#### [ Johan Commelin (Nov 29 2018 at 18:14)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148801571):
<p>So <code>cocones</code> has to be turned into a functor, and then <code>colim &gt;&gt;&gt; coyoneda</code> should be naturally isomorphic to it, I guess.</p>

#### [ Johan Commelin (Nov 29 2018 at 18:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148802040):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Do you think it makes sense to do this before the <code>limits-2</code> branch is merged?</p>

#### [ Reid Barton (Nov 29 2018 at 18:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148802171):
<p>No</p>

#### [ Reid Barton (Nov 29 2018 at 18:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148802173):
<p>No adding things!</p>

#### [ Johan Commelin (Nov 29 2018 at 18:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/148802390):
<p>Sure... I'll create a <code>limits-2.epsilon</code> after this one is merged <span class="emoji emoji-1f609" title="wink">:wink:</span></p>

#### [ Reid Barton (Dec 03 2018 at 05:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150749766):
<p>This business with special shapes of limits is more subtle than I expected</p>

#### [ Reid Barton (Dec 03 2018 at 05:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150749768):
<p>Nothing is defeq to anything...</p>

#### [ Reid Barton (Dec 03 2018 at 05:43)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150750517):
<p>Maybe we should just not do anything here?</p>

#### [ Johan Commelin (Dec 03 2018 at 06:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150751753):
<p>What does "not do anything" mean?</p>

#### [ Johan Commelin (Dec 03 2018 at 06:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150751764):
<p>Do you mean to not have these special cases at all? Or do you mean that you don't want to change anything of what Scott did?</p>

#### [ Reid Barton (Dec 03 2018 at 17:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150782044):
<p>I mean not to have these special cases, or more precisely, still provide the functions for building functors and cones out of discrete categories, for example, but don't use the word "product" anywhere</p>

#### [ Johan Commelin (Dec 03 2018 at 17:53)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150783206):
<p>Ok, I would have to see that in action. I guess it would be useful if it increases the defeqness (defeqtitude?) of the library.</p>

#### [ Johan Commelin (Dec 03 2018 at 19:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150788548):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Are you currently testing this out? Could you show what it would look like for (binary) products?</p>

#### [ Reid Barton (Dec 03 2018 at 19:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150789492):
<p>I haven't tried to put this into practice yet (hopefully I will be able to do so over the next few days) but you can approximate it by just ignoring the existence of files like <code>limits/products.lean</code>.</p>

#### [ Reid Barton (Dec 03 2018 at 19:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150789525):
<p>The definition of <code>pi</code> there for example is essentially just <code>pi f := limit (functor.of_function f)</code>--I'm suggesting you work with the right-hand side directly</p>

#### [ Johan Commelin (Dec 03 2018 at 19:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150789803):
<p>Hmm, but it is surprising that that would increase defeqness, right?</p>

#### [ Reid Barton (Dec 03 2018 at 19:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150789813):
<p>I'm "increasing defeqness" by removing all the parts of the library which have defeq issues</p>

#### [ Reid Barton (Dec 03 2018 at 19:33)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150789817):
<p>it's a right adjoint</p>

#### [ Reid Barton (Dec 03 2018 at 19:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150789918):
<p>Here is an example: <code>limit.post : G.obj (limit F) ‚ü∂ limit (F ‚ãô G)</code><br>
The products version should look like <code>pi.post : G.obj (limits.pi f) ‚ü∂ (limits.pi (G.obj ‚àò f))</code> where <code>limits.pi f = limit (functor.of_function f)</code></p>

#### [ Reid Barton (Dec 03 2018 at 19:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790016):
<p>Unfortunately <code>functor.of_function (G.obj ‚àò f)</code> is not definitionally equal to <code>functor.of_function f ‚ãô G</code></p>

#### [ Reid Barton (Dec 03 2018 at 19:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790029):
<p>so <code>pi.post</code> is not a special case of <code>limit.post</code></p>

#### [ Reid Barton (Dec 03 2018 at 19:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790062):
<p>So. my current feeling is that I have no idea how to solve this kind of issue clearly in the library, and so I would rather not even try, and let the user deal with it instead.</p>

#### [ Johan Commelin (Dec 03 2018 at 19:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790136):
<p>Hmm... I see. So what kind of functions would you still provide?</p>

#### [ Reid Barton (Dec 03 2018 at 19:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790153):
<p><code>functor.of_function</code> and similar things</p>

#### [ Reid Barton (Dec 03 2018 at 19:41)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790344):
<p>Anything which lets you build a functor, natural transformation, cone, etc. out of one of these special indexing categories from simpler data. That amount clearly seems to be required, since building those manually is a big pain.</p>

#### [ Reid Barton (Dec 03 2018 at 19:42)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150790414):
<p>I want to make the overall API of size O(N+M) where N is the number of facts I know about limits and M is the number of special cases of limits I care about, not O(N*M)</p>

#### [ Johan Commelin (Dec 03 2018 at 19:58)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150791572):
<p>I wouldn't mind having nice binder notation for <code>limit (functor.of_function f)</code>, but I guess we need to use a weird <code>\Pi</code>, because the other one is stolen...</p>

#### [ Johan Commelin (Dec 03 2018 at 19:59)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150791631):
<p>And writing <code>limit (functor.of_pair X Y)</code> seems pretty verbose. But we'll see. For now I think it is a good idea to at least make a PR with all the special shapes.</p>

#### [ Scott Morrison (Dec 04 2018 at 08:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150828818):
<p><code>limit (functor.of_pair X Y)</code> feels pretty lame to me. I agree the interface size is an issue, but we should set aside the pain of producing it, and decide whether the <code>N+M</code> or <code>N*M</code> interface is actually more usable.</p>

#### [ Scott Morrison (Dec 04 2018 at 08:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150828865):
<p>I worry that all the things you're proposing to leave out because they suffer from defeq issues are exactly putting the pain of dealing with those defeq issues on the user of the library.</p>

#### [ Scott Morrison (Dec 04 2018 at 08:29)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150828882):
<p>I mean, this is why I wrote everything out again in each special shape --- precisely because you can't just use the general one (or rather, if you do, you get a clumsier statement).</p>

#### [ Scott Morrison (Dec 04 2018 at 08:31)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150828966):
<p>That said, I absolutely appreciate the horror of an N*M size library.</p>

#### [ Johan Commelin (Dec 04 2018 at 08:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150829264):
<p>I would really have to see how this works out in practice.</p>

#### [ Reid Barton (Dec 04 2018 at 15:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150848260):
<blockquote>
<p>I worry that all the things you're proposing to leave out because they suffer from defeq issues are exactly putting the pain of dealing with those defeq issues on the user of the library.</p>
</blockquote>
<p>Yes, this is exactly the plan.</p>

#### [ Reid Barton (Dec 04 2018 at 15:10)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150849330):
<p>Note that the example <code>pi.post</code> where things start to go wrong is again a <em>definition</em>. That means it will appear in the statement of theorems about limits. It will not be possible to specialize these theorems to facts about <code>pi.post</code> if the latter is defined in a way unrelated to <code>limit.post</code>.</p>

#### [ Reid Barton (Dec 04 2018 at 15:20)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150850056):
<p>Basically my claim is that we don't actually how to address these issues (yet?) and I would rather not make O(N*M) guesses about the best way to proceed.</p>

#### [ Reid Barton (Dec 04 2018 at 15:20)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150850070):
<p>In my mind M and especially N are not fixed, but variable. So it's not just a matter of "write out all the N*M things, and then you're done"</p>

#### [ Johan Commelin (Dec 04 2018 at 15:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150850190):
<p>I think I agree with both of you.</p>

#### [ Johan Commelin (Dec 04 2018 at 15:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150850229):
<p>For the short-term future, I would follow Reid, but in the long-term I wouldn't mind having a really slick and polished library the way that Scott envisions it.</p>

#### [ Reid Barton (Dec 04 2018 at 15:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150850248):
<p>I do think we could define <code>product X Y := limit (functor.of_pair X Y)</code> and maybe 2-3 minor conveniences per limit type.</p>

#### [ Johan Commelin (Dec 04 2018 at 15:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150850250):
<p>Anyway, we've had an O(N) chunk merged. Next up seems to be an O(M) chunk. (-;</p>

#### [ Johan Commelin (Dec 04 2018 at 17:25)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150859092):
<p>So, how about the classes <code>has_products</code>, <code>has_pullbacks</code>, <code>has_equalizers</code>, etc... will they remain? Or do we just write <code>has_limits_of_shape walking_pair</code>?</p>

#### [ Reid Barton (Dec 04 2018 at 18:32)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150863424):
<p>I was planning on getting rid of those as well, though for a different reason, namely that the class system doesn't seem to deal with them well</p>

#### [ Scott Morrison (Dec 04 2018 at 20:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870290):
<p>I'm really pretty dubious. We know that in many categories, there should be separate implementations of, say, binary_products and general limits. How will this be achieved in the minimal API?</p>

#### [ Reid Barton (Dec 04 2018 at 20:12)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870609):
<p>No, don't do that</p>

#### [ Reid Barton (Dec 04 2018 at 20:13)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870639):
<p>Better: provide specialized ways to construct <code>is_limit</code> cones</p>

#### [ Scott Morrison (Dec 04 2018 at 20:14)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870808):
<p>I'm confused. What will it look like when someone needs to compare the carrier type of <code>limit (functor.of_pair X Y)</code> with the Lean built-in product of the carrier types of <code>X</code> and <code>Y</code>?</p>

#### [ Scott Morrison (Dec 04 2018 at 20:15)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870833):
<p>(supposing we're in an algebraic category)</p>

#### [ Reid Barton (Dec 04 2018 at 20:15)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870858):
<p>I think you should not do that either, if by "compare" you mean expect them to be defeq</p>

#### [ Reid Barton (Dec 04 2018 at 20:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150870959):
<p>But you can use the <code>is_limit</code> for the cone for the product type to get an isomorphism to the <code>limit</code></p>

#### [ Scott Morrison (Dec 04 2018 at 20:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150871011):
<p>So, will we provide the natural isomorphism between the two functors <code>C x C -&gt; Type</code> at some point?</p>

#### [ Reid Barton (Dec 04 2018 at 20:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150871051):
<p>Or if you're feeling lucky, you can locally set the product type one as an instance</p>

#### [ Reid Barton (Dec 04 2018 at 20:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150871087):
<p>What two functors?</p>

#### [ Reid Barton (Dec 04 2018 at 20:20)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150871213):
<p>Do you mean Type x Type -&gt; Type?</p>

#### [ Reid Barton (Dec 04 2018 at 20:24)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150871525):
<p>There's going to be a difference between the underlying type of a limit over a discrete diagram that comes from <code>limit</code> and the Pi type in any case.</p>

#### [ Reid Barton (Dec 04 2018 at 20:25)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150871574):
<p>I'd rather have this difference out in the open where I can deal with it explicitly, than buried inside some implicit parameter to a class instance</p>

#### [ Johan Commelin (Dec 04 2018 at 20:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150872073):
<p>I'm afraid I'm too much of an ITP-newbie to contribute meaningfully to this discussion. But for what it's worth, I'dd love to use sheaves as a testing ground of what <span class="user-mention" data-user-id="110032">@Reid Barton</span> is suggesting.</p>

#### [ Reid Barton (Dec 04 2018 at 20:31)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150872086):
<p>Recall Johan's issue <a href="#narrow/stream/116395-maths/subject/sheaves.20and.20sites/near/148024839" title="#narrow/stream/116395-maths/subject/sheaves.20and.20sites/near/148024839">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/subject/sheaves.20and.20sites/near/148024839</a>. It took me a long time to even understand how the two sides could be different</p>

#### [ Scott Morrison (Dec 04 2018 at 21:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150878374):
<p>Okay, I'm definitely happy with the plan to just provide the bare minimum (e.g. functor.of_function and its friends), and then see if we can rebase the sheaf branch onto that.</p>

#### [ Scott Morrison (Dec 04 2018 at 21:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150878380):
<p>And learn what we need from that development.</p>

#### [ Scott Morrison (Dec 04 2018 at 21:54)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150878403):
<p>I agree it's hard to know how bad leaving things out is going to be, in the abstract.</p>

#### [ Scott Morrison (Dec 05 2018 at 06:46)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150905894):
<p>As mentioned elsewhere, I've rebased what remains of my limits PR into two pieces: some assorted stuff that can be merged, and the remaining remaining stuff, about special shapes, that shouldn't (yet) be.</p>

#### [ Scott Morrison (Dec 05 2018 at 06:47)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/150905922):
<p>I did, in the special shapes part, remove a few very naughty <code>[instance]</code> attributes that really shouldn't have been there. I will, sometime, investigate whether their removal has helped.</p>

#### [ Johan Commelin (Dec 09 2018 at 18:47)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151229767):
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Any news about the next stage? Can you use any help?</p>

#### [ Reid Barton (Dec 09 2018 at 21:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151235379):
<p>I've been focusing on other Lean projects recently but actually the next thing I was going to do was PR a version of discrete categories, which Scott has already done in the meantime.</p>

#### [ Reid Barton (Dec 09 2018 at 21:39)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151235463):
<p>I'm going to be needing some of the other shapes before too long as well</p>

#### [ Reid Barton (Dec 12 2018 at 22:51)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151566382):
<p>I need to prove that <code>cocone.whisker</code>ing with an equivalence preserves <code>is_colimit</code>. <span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="112680">@Johan Commelin</span> I don't suppose either of you has already done this?</p>

#### [ Kevin Buzzard (Dec 12 2018 at 23:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151567210):
<p>What does whisker mean?</p>

#### [ Kevin Buzzard (Dec 12 2018 at 23:05)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151567222):
<p>I know what a cocone is.</p>

#### [ Scott Morrison (Dec 12 2018 at 23:09)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151567445):
<p>No, sorry, haven't done this.</p>

#### [ Scott Morrison (Dec 12 2018 at 23:14)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151567712):
<p>A cocone on F is a natural transformation from F : J \func C to a constant functor X. Whiskering means whiskering this natural transformation by a functor (i.e. horizontal composition with the identity natural transformation on a functor) (but we still need to work out if we mean by a functor J' \func J or by a functor C \func C'). Looking up <code>category_theory/limits/cones.lean</code>, it seems we have <code>def whisker {K : Type v} [small_category K] (E : K ‚•§ J) (c : cocone F) : cocone (E ‚ãô F)</code>,  so it's whiskering on the left.</p>

#### [ Reid Barton (Dec 12 2018 at 23:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151567877):
<p>I kind of want to rename <code>whisker</code> to <code>whisker_left</code> and make it a functor and rename <code>functoriality</code> to <code>whisker_right</code></p>

#### [ Reid Barton (Dec 12 2018 at 23:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151567938):
<p>I think the definition you originally wrote made the relationship to <code>whisker_right</code> more obvious</p>

#### [ Scott Morrison (Dec 12 2018 at 23:31)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151568636):
<p>I agree, these would be good changes.</p>

#### [ Johan Commelin (Dec 13 2018 at 06:52)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151587223):
<p>Only seeing this now, but sounds good to me.</p>

#### [ Johan Commelin (Dec 15 2018 at 11:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151831861):
<p>I would like to get more access to specialised shapes. But I don't have a good feeling which for which direction we want to go now. If we can get one example into a PR-ready form, then I could work on the others myself. <span class="user-mention" data-user-id="110032">@Reid Barton</span> <span class="user-mention" data-user-id="110087">@Scott Morrison</span> Do you think you have time to work on (say) products, this week?</p>

#### [ Johan Commelin (Dec 15 2018 at 11:21)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151831870):
<p>For example, I want to connect binary (co)products to <code>sup</code> and <code>inf</code> for lattices.</p>

#### [ Reid Barton (Dec 15 2018 at 17:12)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151842125):
<p>I'm going to take a look at special shapes again today. However, I'm not entirely sure how to proceed, both in terms of what we want the API to look like, and also in view of the fact that there is already an outstanding PR which adds discrete categories.</p>

#### [ Johan Commelin (Dec 15 2018 at 18:07)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844141):
<p>Ok, cool. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Would you have some time to take care of the outstanding PR's? Then we could start moving forward again. It seems to be blocking some work... (But I understand completely if you have other deadlines that are more important.)</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844146):
<p>Any advice on where to focus?</p>

#### [ Johan Commelin (Dec 15 2018 at 18:16)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844468):
<p>(eg <a href="https://github.com/leanprover/mathlib/issues/503" target="_blank" title="https://github.com/leanprover/mathlib/issues/503">#503</a>, <a href="https://github.com/leanprover/mathlib/issues/505" target="_blank" title="https://github.com/leanprover/mathlib/issues/505">#505</a>)</p>

#### [ Reid Barton (Dec 15 2018 at 18:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844534):
<p><a href="https://github.com/leanprover/mathlib/issues/512" target="_blank" title="https://github.com/leanprover/mathlib/issues/512">#512</a> has discrete categories which I think are the least problematic of the "special shapes"</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:26)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844795):
<p>I commented on that PR, but it looks like there are still some outstanding comments of yours as well</p>

#### [ Reid Barton (Dec 15 2018 at 18:27)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844812):
<p>Indeed</p>

#### [ Johan Commelin (Dec 15 2018 at 18:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151844959):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> While you are at it, would you mind taking a look at my other PR's? I think they are all pretty straight-forward. Just adding little tidbits to the category lib</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:34)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845078):
<p>I'm not sure about the <code>op</code> thing though</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845089):
<p>I thought there was a reason it was a type synonym rather than a wrapper</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:35)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845094):
<p>I agree that if it is irreducible it may as well just be a separate inductive type</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:36)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845140):
<p>although with up and down functions you won't get <code>up (down x) = x</code> and <code>down (up x) = x</code> both being rfl</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845149):
<p>maybe this doesn't matter because these are object equalities...?</p>

#### [ Reid Barton (Dec 15 2018 at 18:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845151):
<p>Oh yeah, that could be annoying...</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845195):
<p>with irreducible you will get strange things not being refl, like with real</p>

#### [ Mario Carneiro (Dec 15 2018 at 18:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845198):
<p>I tend to shy away from it for that reason</p>

#### [ Reid Barton (Dec 15 2018 at 18:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845258):
<p>I notice that PR doesn't build currently anyways</p>

#### [ Reid Barton (Dec 15 2018 at 18:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845509):
<p>With the <code>irreducible</code> definition, would the elaborator treat both <code>unop (op x) = x</code> and <code>op (unop x) = x</code> as definitional equalities?</p>

#### [ Johan Commelin (Dec 15 2018 at 18:49)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845511):
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Thanks for the merges!</p>

#### [ Reid Barton (Dec 15 2018 at 18:50)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151845566):
<p>I guess I should just experiment... but this particular PR hasn't been a high priority for me</p>

#### [ Reid Barton (Dec 15 2018 at 19:08)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151846091):
<p>I think these being questions about equalities between objects makes it more important whether the equalities are definitional, not less</p>

#### [ Mario Carneiro (Dec 15 2018 at 19:28)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151846670):
<p>with the irreducible definition I think they would both not be defeq</p>

#### [ Mario Carneiro (Dec 15 2018 at 19:31)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151846738):
<p>I stand corrected:</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="kn">irreducible</span><span class="o">]</span> <span class="n">def</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">nat</span>

<span class="n">def</span> <span class="n">to_nat</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">‚Üí</span> <span class="n">nat</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">delta</span> <span class="n">A</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">id</span>
<span class="n">def</span> <span class="n">of_nat</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">‚Üí</span> <span class="n">A</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">delta</span> <span class="n">A</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">id</span>

<span class="kn">theorem</span> <span class="n">to_of</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">to_nat</span> <span class="o">(</span><span class="n">of_nat</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">--ok</span>
<span class="kn">theorem</span> <span class="n">of_to</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">of_nat</span> <span class="o">(</span><span class="n">to_nat</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">--ok</span>
</pre></div>

#### [ Johan Commelin (Dec 15 2018 at 19:37)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151846902):
<p>What the heck is <code>delta</code>? I've never seen it before...</p>

#### [ Patrick Massot (Dec 15 2018 at 19:38)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151846950):
<p>it's a variation on <code>dunfold</code></p>

#### [ Patrick Massot (Dec 15 2018 at 19:40)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847009):
<p>I've never used it</p>

#### [ Mario Carneiro (Dec 15 2018 at 19:56)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847488):
<p>it's a very low level definition unfolding tactic</p>

#### [ Mario Carneiro (Dec 15 2018 at 19:57)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847490):
<p>it's good for cases when the elaborator doesn't want it to unfold</p>

#### [ Mario Carneiro (Dec 15 2018 at 19:57)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847497):
<p>although I guess in this case <code>dunfold</code> suffices</p>

#### [ Mario Carneiro (Dec 15 2018 at 20:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847602):
<p>I used <code>delta</code> also in the <code>hidden</code> thread, to unfold <code>nat.add</code> into its underlying recursor</p>

#### [ Mario Carneiro (Dec 15 2018 at 20:00)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847608):
<p><code>dunfold</code> and its friends refuse to use the definition, they only use equation lemmas</p>

#### [ Patrick Massot (Dec 15 2018 at 20:01)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151847627):
<p>I knew I saw it not a long time ago!</p>

#### [ Kevin Buzzard (Dec 15 2018 at 20:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/151848133):
<p>It was when I was writing a blog post about equality (a post which is still in the queue of jobs).</p>

#### [ Scott Morrison (Dec 20 2018 at 13:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152253229):
<p>Hi <span class="user-mention" data-user-id="110032">@Reid Barton</span>, <span class="user-mention" data-user-id="112680">@Johan Commelin</span>, I just separated out what remains of my limits PR into two branches. <code>limits-shapes</code> just provides convenience methods for dealing with cones of special shapes, but doesn't attempt to introduce <code>has_products</code> or any similar gadgets.</p>

#### [ Scott Morrison (Dec 20 2018 at 13:30)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152253241):
<p>There's also <code>limits-other</code> which still has everything (the O(M*N) approach...) rebased onto this.</p>

#### [ Johan Commelin (Dec 21 2018 at 04:02)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152304748):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Does this also mean that you are planning to split <a href="https://github.com/leanprover/mathlib/issues/512" target="_blank" title="https://github.com/leanprover/mathlib/issues/512">#512</a> into two pieces?</p>

#### [ Scott Morrison (Dec 21 2018 at 04:22)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152305601):
<p>I guess I was hoping to just get <a href="https://github.com/leanprover/mathlib/issues/512" target="_blank" title="https://github.com/leanprover/mathlib/issues/512">#512</a> merged.</p>

#### [ Scott Morrison (Dec 21 2018 at 04:23)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152305618):
<p>It's such a grab bag it's not obvious to me where a split would go.</p>

#### [ Johan Commelin (Dec 21 2018 at 09:17)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152315453):
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> The merge of <a href="https://github.com/leanprover/mathlib/issues/512" target="_blank" title="https://github.com/leanprover/mathlib/issues/512">#512</a> introduced some regressions.</p>

#### [ Mario Carneiro (Dec 21 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152315459):
<p>okay, then progress it</p>

#### [ Johan Commelin (Dec 21 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152315464):
<p>At least <a href="https://github.com/leanprover/mathlib/pull/512/files#diff-c997371393c06bacaf4074ef43915f3e" target="_blank" title="https://github.com/leanprover/mathlib/pull/512/files#diff-c997371393c06bacaf4074ef43915f3e">https://github.com/leanprover/mathlib/pull/512/files#diff-c997371393c06bacaf4074ef43915f3e</a></p>

#### [ Johan Commelin (Dec 21 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152315502):
<p>I think the rest is fine.</p>

#### [ Mario Carneiro (Dec 21 2018 at 09:18)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152315512):
<p>I will leave it to you and scott to figure out what needs fixing</p>

#### [ Johan Commelin (Dec 21 2018 at 10:04)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152317406):
<p>Done (finally): <a href="https://github.com/leanprover/mathlib/issues/550" target="_blank" title="https://github.com/leanprover/mathlib/issues/550">#550</a></p>

#### [ Scott Morrison (Dec 21 2018 at 11:15)](https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/limits%202.0/near/152320743):
<p>Thanks <span class="user-mention" data-user-id="112680">@Johan Commelin</span>.</p>


{% endraw %}
