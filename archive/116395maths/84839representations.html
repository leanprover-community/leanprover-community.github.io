---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/84839representations.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html">representations</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="165253263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253263" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253263">Johan Commelin (May 09 2019 at 13:43)</a>:</h4>
<p>What is going on here? I was playing around with representations together with <span class="user-mention" data-user-id="220718">@Ben McDonnell</span> <br>
After importing <code>linear_algebra.basic</code> a silly lemma broke at the bottom of the quoted code:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">module</span>
<span class="kn">import</span> <span class="n">group_theory</span><span class="bp">.</span><span class="n">group_action</span>
<span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">basic</span> <span class="c1">-- this import breaks the commented lines at the end of the file</span>

<span class="n">class</span> <span class="n">group_module</span> <span class="o">(</span><span class="n">G</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">mul_action</span> <span class="n">G</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">smul_add</span>  <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">m₁</span> <span class="n">m₂</span> <span class="o">:</span> <span class="n">M</span><span class="o">),</span> <span class="n">g</span> <span class="err">•</span> <span class="o">(</span><span class="n">m₁</span> <span class="bp">+</span> <span class="n">m₂</span><span class="o">)</span> <span class="bp">=</span> <span class="n">g</span> <span class="err">•</span> <span class="n">m₁</span> <span class="bp">+</span> <span class="n">g</span> <span class="err">•</span> <span class="n">m₂</span><span class="o">)</span>

<span class="n">attribute</span> <span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="n">group_module</span><span class="bp">.</span><span class="n">smul_add</span>

<span class="kn">namespace</span> <span class="n">fixed_points</span>
<span class="kn">open</span> <span class="n">mul_action</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span>
<span class="kn">variable</span> <span class="o">[</span><span class="n">group_module</span> <span class="n">G</span> <span class="n">M</span><span class="o">]</span>

<span class="kn">lemma</span> <span class="n">add_mem</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hx</span> <span class="o">:</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">fixed_points</span> <span class="n">G</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hy</span> <span class="o">:</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">fixed_points</span> <span class="n">G</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="err">∈</span> <span class="n">fixed_points</span> <span class="n">G</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">g</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_stabilizer_iff</span><span class="o">,</span> <span class="n">group_module</span><span class="bp">.</span><span class="n">smul_add</span><span class="o">,</span> <span class="n">mem_fixed_points</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">hx</span><span class="o">,</span> <span class="n">hy</span><span class="o">],</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">fixed_points</span>

<span class="n">class</span> <span class="n">representation</span> <span class="o">(</span><span class="n">G</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">group_module</span> <span class="n">G</span> <span class="n">M</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">smul_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">),</span> <span class="n">g</span> <span class="err">•</span> <span class="o">(</span><span class="n">r</span> <span class="err">•</span> <span class="n">m</span><span class="o">)</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="o">(</span><span class="n">g</span> <span class="err">•</span> <span class="n">m</span><span class="o">))</span>

<span class="kn">namespace</span> <span class="n">representation</span>
<span class="kn">open</span> <span class="n">mul_action</span> <span class="n">linear_map</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">G</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>
<span class="kn">variables</span> <span class="o">[</span><span class="n">group</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">representation</span> <span class="n">G</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>

<span class="c1">-- set_option trace.class_instances true</span>

<span class="c1">-- lemma smul_mem_fixed_points (r : R) (m : M) (hm : m ∈ fixed_points G M) :</span>
<span class="c1">--   r • m ∈ fixed_points G M :=</span>
<span class="c1">-- begin</span>
<span class="c1">--   simp only [mem_fixed_points] at *,</span>
<span class="c1">--   intro g,</span>
<span class="c1">--   rw [smul_comm, hm],</span>
<span class="c1">-- end</span>
<span class="kn">end</span> <span class="n">representation</span>
</pre></div>

<a name="165253299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253299" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253299">Johan Commelin (May 09 2019 at 13:43)</a>:</h4>
<p>Without the import the code runs fine. With the import it reports maximum type class error.</p>

<a name="165253368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253368" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253368">Mario Carneiro (May 09 2019 at 13:44)</a>:</h4>
<p>increase depth?</p>

<a name="165253374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253374">Johan Commelin (May 09 2019 at 13:44)</a>:</h4>
<p>I couldn't figure out which type class it is even searching for. It performs a <code>has_mul</code> search and a <code>mul_action</code> search, and it finds those two instantly.</p>

<a name="165253387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253387" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253387">Johan Commelin (May 09 2019 at 13:44)</a>:</h4>
<p>Bumping the depth to <code>100</code> didn't solve it.</p>

<a name="165253550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253550" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253550">Johan Commelin (May 09 2019 at 13:46)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Any other ideas?</p>

<a name="165253601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165253601" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165253601">Johan Commelin (May 09 2019 at 13:47)</a>:</h4>
<p>Modules work a lot better than half a year ago. But they are still pretty fragile, at least that's my impression...</p>

<a name="165257337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257337" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257337">Chris Hughes (May 09 2019 at 14:28)</a>:</h4>
<p>Putting some brackets in lets you see the failing search. It's for <code>has_scalar R M</code></p>

<a name="165257347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257347">Chris Hughes (May 09 2019 at 14:28)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">smul_mem_fixed_points</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">hm</span> <span class="o">:</span> <span class="n">m</span> <span class="err">∈</span> <span class="n">fixed_points</span> <span class="n">G</span> <span class="n">M</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">r</span> <span class="err">•</span> <span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="err">∈</span> <span class="n">fixed_points</span> <span class="n">G</span> <span class="n">M</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">mem_fixed_points</span><span class="o">]</span> <span class="n">at</span> <span class="bp">*</span><span class="o">,</span>
  <span class="n">intro</span> <span class="n">g</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">smul_comm</span><span class="o">,</span> <span class="n">hm</span><span class="o">],</span>
<span class="kn">end</span>
</pre></div>

<a name="165257413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257413" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257413">Johan Commelin (May 09 2019 at 14:29)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="110044">@Chris Hughes</span></p>

<a name="165257425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257425">Johan Commelin (May 09 2019 at 14:29)</a>:</h4>
<p>Now the question is... why does that import bork the class search</p>

<a name="165257710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257710" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257710">Mario Carneiro (May 09 2019 at 14:32)</a>:</h4>
<p>is <code>R</code>a discrete field?</p>

<a name="165257717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257717">Mario Carneiro (May 09 2019 at 14:32)</a>:</h4>
<p>the tc looks for that a lot</p>

<a name="165257719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257719" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257719">Johan Commelin (May 09 2019 at 14:32)</a>:</h4>
<p>Just any ring</p>

<a name="165257749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257749" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257749">Mario Carneiro (May 09 2019 at 14:33)</a>:</h4>
<p>not exactly sure why... I mean it's directly looking for it</p>

<a name="165257791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257791" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257791">Johan Commelin (May 09 2019 at 14:33)</a>:</h4>
<p>There is a <code>module R M</code> staring it in the face</p>

<a name="165257811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257811" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257811">Johan Commelin (May 09 2019 at 14:33)</a>:</h4>
<p>Shouldn't be too hard to get a <code>has_scalar R M</code> from that.</p>

<a name="165257821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257821" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257821">Mario Carneiro (May 09 2019 at 14:33)</a>:</h4>
<p>that's not all it's searching for</p>

<a name="165257985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165257985" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165257985">Mario Carneiro (May 09 2019 at 14:35)</a>:</h4>
<p>it looks for <code>has_scalar R M</code> a bunch, <code>discrete_field R</code> a bunch more, and also <code>discrete_field (M →ₗ[R] M)</code></p>

<a name="165258010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258010" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258010">Johan Commelin (May 09 2019 at 14:35)</a>:</h4>
<p>That last one is obviously stupid...</p>

<a name="165258080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258080">Mario Carneiro (May 09 2019 at 14:36)</a>:</h4>
<p>You misunderstand. This is not a garden path it's looking for, it's the initial problem</p>

<a name="165258205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258205">Johan Commelin (May 09 2019 at 14:37)</a>:</h4>
<p>Hmmm... so how do we fix this?</p>

<a name="165258256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258256">Johan Commelin (May 09 2019 at 14:38)</a>:</h4>
<p>Are we just hitting limitations of tc search?</p>

<a name="165258274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258274" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258274">Mario Carneiro (May 09 2019 at 14:38)</a>:</h4>
<p>no, this is worse</p>

<a name="165258293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258293" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258293">Johan Commelin (May 09 2019 at 14:38)</a>:</h4>
<p>Wow, ok. I still don't understand the problem</p>

<a name="165258297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258297" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258297">Mario Carneiro (May 09 2019 at 14:38)</a>:</h4>
<p>it's searching for things that don't make any sense</p>

<a name="165258323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258323">Mario Carneiro (May 09 2019 at 14:38)</a>:</h4>
<p>it needs <code>has_scalar</code> so that's all it should be looking for</p>

<a name="165258349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258349" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258349">Mario Carneiro (May 09 2019 at 14:39)</a>:</h4>
<p>I don't know why these discrete_field problems are coming up</p>

<a name="165258517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258517" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258517">Mario Carneiro (May 09 2019 at 14:41)</a>:</h4>
<p>oh! I started deleting your definitions beforehand and <code>representation</code> causes the problem</p>

<a name="165258561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258561" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258561">Mario Carneiro (May 09 2019 at 14:41)</a>:</h4>
<p>of course, <code>representation</code> is a bad class</p>

<a name="165258604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258604">Johan Commelin (May 09 2019 at 14:42)</a>:</h4>
<p>Huh, what's wrong with it?</p>

<a name="165258688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258688" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258688">Mario Carneiro (May 09 2019 at 14:42)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">representation</span> <span class="o">(</span><span class="n">G</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">group_module</span> <span class="n">G</span> <span class="n">M</span>
</pre></div>


<p>This creates an instance <code>group_module G M &lt;= representation G ?R M</code> and lean gets lost at <code>ring ?R</code></p>

<a name="165258752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258752">Mario Carneiro (May 09 2019 at 14:43)</a>:</h4>
<p>you shouldn't extend something with fewer explicit type parameters</p>

<a name="165258769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258769" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258769">Johan Commelin (May 09 2019 at 14:44)</a>:</h4>
<p>Oh boy... that's really bad.</p>

<a name="165258918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258918">Mario Carneiro (May 09 2019 at 14:45)</a>:</h4>
<p>it's pretty easy to fix:</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">representation</span> <span class="o">(</span><span class="n">G</span> <span class="n">R</span> <span class="n">M</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">monoid</span> <span class="n">G</span><span class="o">]</span> <span class="o">[</span><span class="n">ring</span> <span class="n">R</span><span class="o">]</span>
  <span class="o">[</span><span class="n">add_comm_group</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">module</span> <span class="n">R</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">group_module</span> <span class="n">G</span> <span class="n">M</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">smul_comm</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">M</span><span class="o">),</span> <span class="n">g</span> <span class="err">•</span> <span class="o">(</span><span class="n">r</span> <span class="err">•</span> <span class="n">m</span><span class="o">)</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="o">(</span><span class="n">g</span> <span class="err">•</span> <span class="n">m</span><span class="o">))</span>
</pre></div>

<a name="165258951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165258951" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165258951">Johan Commelin (May 09 2019 at 14:46)</a>:</h4>
<p>You know what this means, though</p>

<a name="165259033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259033" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259033">Johan Commelin (May 09 2019 at 14:46)</a>:</h4>
<p>When a mathematician says: Let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">G</span></span></span></span> be a finite group, and let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span> be a representation over a field <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07153em;">K</span></span></span></span>.</p>

<a name="165259041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259041">Johan Commelin (May 09 2019 at 14:46)</a>:</h4>
<p>That all fits nicely on one line.</p>

<a name="165259084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259084" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259084">Johan Commelin (May 09 2019 at 14:47)</a>:</h4>
<p>To turn that line into Lean, we all of a sudden need 25 type class assumptions. And only 3 or 4 of them are actually interesting.</p>

<a name="165259128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259128" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259128">Johan Commelin (May 09 2019 at 14:47)</a>:</h4>
<p>Can we have <code>extends'</code>?</p>

<a name="165259130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259130" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259130">Mario Carneiro (May 09 2019 at 14:48)</a>:</h4>
<p>If you need the totality of representations, then you should bundle M, or R or something</p>

<a name="165259183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259183">Johan Commelin (May 09 2019 at 14:48)</a>:</h4>
<p>Sure, but I don't want that category, yet.</p>

<a name="165259219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259219" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259219">Mario Carneiro (May 09 2019 at 14:48)</a>:</h4>
<p>well, with the parameters pulled out <code>representation</code> is a prop</p>

<a name="165259226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259226" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259226">Mario Carneiro (May 09 2019 at 14:49)</a>:</h4>
<p>it's not quite saying the same thing as your one line</p>

<a name="165259243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259243" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259243">Johan Commelin (May 09 2019 at 14:49)</a>:</h4>
<p>I want <code>extends'</code> that signals to Lean: "Hey, if someone writes <code>variable [representation G R M]</code>, please add <code>[add_comm_group M] [module R M] [group_module G M]</code> yourself."</p>

<a name="165259250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259250" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259250">Reid Barton (May 09 2019 at 14:49)</a>:</h4>
<p>you need <code>lean'</code> for <code>extends'</code></p>

<a name="165259278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165259278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165259278">Mario Carneiro (May 09 2019 at 14:49)</a>:</h4>
<p>sebastian proposed that back in the stone age, I don't know what happened to that proposal</p>

<a name="165260009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260009" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260009">Johan Commelin (May 09 2019 at 14:56)</a>:</h4>
<p>Hmmz... I'm really not so happy with stacking all these assumptions on top of each other.</p>

<a name="165260121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260121" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260121">Johan Commelin (May 09 2019 at 14:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you see another solution, except for bundling?</p>

<a name="165260122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260122">Mario Carneiro (May 09 2019 at 14:57)</a>:</h4>
<p>the problem is that if you describe your structure as data shared between objects then you potentially need one for every subset of objects in the context</p>

<a name="165260325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260325" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260325">Mario Carneiro (May 09 2019 at 14:59)</a>:</h4>
<p>make fewer classes?</p>

<a name="165260326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260326" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260326">Johan Commelin (May 09 2019 at 14:59)</a>:</h4>
<p><code>group_module</code> is not just some random definition. They are pretty useful gadgets in their own right.</p>

<a name="165260440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260440" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260440">Mario Carneiro (May 09 2019 at 15:00)</a>:</h4>
<p>okay but do you care about them right now?</p>

<a name="165260480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260480">Johan Commelin (May 09 2019 at 15:00)</a>:</h4>
<p>Not exactly right now</p>

<a name="165260514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260514">Johan Commelin (May 09 2019 at 15:01)</a>:</h4>
<p>But I somehow thought that refactoring it in later only made things harder</p>

<a name="165260540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260540">Mario Carneiro (May 09 2019 at 15:01)</a>:</h4>
<p>on the contrary, I think it's best to refactor when you know what you want</p>

<a name="165260633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260633" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260633">Johan Commelin (May 09 2019 at 15:02)</a>:</h4>
<p>Well, I do know that I want every representation to also be a G-module</p>

<a name="165260735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260735" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260735">Johan Commelin (May 09 2019 at 15:03)</a>:</h4>
<p>Kevin has a student who is working on G-modules.</p>

<a name="165260758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260758" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260758">Johan Commelin (May 09 2019 at 15:03)</a>:</h4>
<p>Ben wants to work on representation theory</p>

<a name="165260778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260778" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260778">Johan Commelin (May 09 2019 at 15:03)</a>:</h4>
<p>It would be nice if their work was somewhat compatible at the end of the day...</p>

<a name="165260943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260943">Mario Carneiro (May 09 2019 at 15:05)</a>:</h4>
<p>I assure you that having written down the definition <code>group_module</code> is nowhere near enough to ensure everyone's work is compatible at the end of the day</p>

<a name="165260968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165260968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165260968">Johan Commelin (May 09 2019 at 15:05)</a>:</h4>
<p>Ooh, I believe that.</p>

<a name="165261040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165261040" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165261040">Johan Commelin (May 09 2019 at 15:06)</a>:</h4>
<p>I was just surprised that having written down two def's and two lemmas already brought the system to its knees</p>

<a name="165261051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165261051" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165261051">Johan Commelin (May 09 2019 at 15:06)</a>:</h4>
<p>I now understand the error</p>

<a name="165261055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165261055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165261055">Johan Commelin (May 09 2019 at 15:06)</a>:</h4>
<p>I don't yet see a nice solution.</p>

<a name="165261097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165261097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165261097">Mario Carneiro (May 09 2019 at 15:06)</a>:</h4>
<p>the too many classes thing is a slow problem that won't get in your way in the immediate future, so I suggest you go with it for now</p>

<a name="165455649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165455649" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165455649">Sebastien Gouezel (May 12 2019 at 08:54)</a>:</h4>
<blockquote>
<p>you shouldn't extend something with fewer explicit type parameters</p>
</blockquote>
<p>What about the existing</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">normed_space</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">normed_field</span> <span class="n">α</span><span class="o">]</span>
  <span class="kn">extends</span> <span class="n">normed_group</span> <span class="n">β</span><span class="o">,</span> <span class="n">vector_space</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">norm_smul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">α</span><span class="o">)</span> <span class="n">b</span><span class="o">,</span> <span class="n">norm</span> <span class="o">(</span><span class="n">a</span> <span class="err">•</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">has_norm</span><span class="bp">.</span><span class="n">norm</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">norm</span> <span class="n">b</span><span class="o">)</span>
</pre></div>


<p>which seems to work pretty well?</p>

<a name="165457091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457091" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457091">Mario Carneiro (May 12 2019 at 09:36)</a>:</h4>
<p>I am pretty sure you can also use that to cook up a bad typeclass search</p>

<a name="165457094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457094" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457094">Mario Carneiro (May 12 2019 at 09:36)</a>:</h4>
<p>it's possible we just haven't run across it by accident yet</p>

<a name="165457391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457391">Mario Carneiro (May 12 2019 at 09:46)</a>:</h4>
<p>Here's a bad typeclass search example:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">normed_space</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>

<span class="n">def</span> <span class="n">normify</span> <span class="o">:</span> <span class="kt">Type</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="kn">instance</span> <span class="o">[</span><span class="n">field</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">normed_field</span> <span class="o">(</span><span class="n">normify</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="bp">#</span><span class="kn">check</span> <span class="bp">-</span><span class="n">a</span>
</pre></div>


<p>The reason we haven't come across this yet is because <code>normed_field</code> is pretty high in the hierarchy so there aren't many ways to get lower down yet. Here I've made up a perfectly normal instance for some made up <code>normify</code> operator that, in conjunction with <code>normed_space</code>, causes a loop that causes basically every typeclass search to overflow (like <code>has_neg A</code> here)</p>

<a name="165457852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457852" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457852">Patrick Massot (May 12 2019 at 10:00)</a>:</h4>
<p>Mario, do you see a way to modify how type class search works that would solve this issue? Or is it the concept of type class itself that is irremediably broken and we should switch everything to unification hints?</p>

<a name="165457913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457913">Mario Carneiro (May 12 2019 at 10:02)</a>:</h4>
<p>not typeclass search per se, but "prolog-like" needs some tweaking to make it not quite so stupid in some cases, i.e. loop detection and some forward inference</p>

<a name="165457929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457929" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457929">Patrick Massot (May 12 2019 at 10:03)</a>:</h4>
<p>Is this something you could play with in the fork?</p>

<a name="165457979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457979">Patrick Massot (May 12 2019 at 10:04)</a>:</h4>
<p>It's such a fundamental part of Lean that, to me, it looks much more important to fix than VM override or FFI or pretty much anything else</p>

<a name="165457982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165457982" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165457982">Mario Carneiro (May 12 2019 at 10:04)</a>:</h4>
<p>possibly... It's a really hard problem in general though, and lots and lots of words have been spent on it, months of peoples' work can gone into proposals and alterations and no one has found that silver bullet yet</p>

<a name="165458002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458002">Patrick Massot (May 12 2019 at 10:05)</a>:</h4>
<p>But prolog itself isn't so dumb, right? Why can't we look at what they do there?</p>

<a name="165458003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458003" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458003">Mario Carneiro (May 12 2019 at 10:06)</a>:</h4>
<blockquote>
<p>It's such a fundamental part of Lean that, to me, it looks much more important to fix</p>
</blockquote>
<p>the problem with fixing fundamental things is that everything else has to adapt</p>

<a name="165458055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458055">Mario Carneiro (May 12 2019 at 10:06)</a>:</h4>
<p>there is a high cost of switching and only a vague promise of something better on the other end</p>

<a name="165458072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458072" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458072">Patrick Massot (May 12 2019 at 10:07)</a>:</h4>
<p>also it looks like this is not something that is currently worked on in the Lean 4 repository, so maybe there is hope to contribute some battle tested idea in this direction. Whereas things related to programming are clearly worked on by Leo and Sebastian, so everything done in the fork will be erased</p>

<a name="165458074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458074">Mario Carneiro (May 12 2019 at 10:07)</a>:</h4>
<p>Prolog gives more mechanisms for being able to control how the search goes. For example you can say "no backtracking past this point"</p>

<a name="165458123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458123" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458123">Mario Carneiro (May 12 2019 at 10:08)</a>:</h4>
<p>typeclasses are essential to lean. If you think you can sneak a change to it past leo I think you are mistaken</p>

<a name="165458124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458124" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458124">Patrick Massot (May 12 2019 at 10:08)</a>:</h4>
<p>Who said "sneak"? Of course you don't want to sneak anything</p>

<a name="165458136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458136" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458136">Mario Carneiro (May 12 2019 at 10:09)</a>:</h4>
<p>Meaning, you have to be working in conjunction with leo on the stuff</p>

<a name="165458137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458137" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458137">Patrick Massot (May 12 2019 at 10:09)</a>:</h4>
<p>I wrote "contribute a battle tested idea"</p>

<a name="165458142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458142" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458142">Mario Carneiro (May 12 2019 at 10:09)</a>:</h4>
<p>so unless he's interested in such a collaboration there's no chance of it happening in lean 4</p>

<a name="165458145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458145" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458145">Mario Carneiro (May 12 2019 at 10:09)</a>:</h4>
<p>or if he does something himself</p>

<a name="165458249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458249" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458249">Mario Carneiro (May 12 2019 at 10:12)</a>:</h4>
<p>also, nothing in the fork will be erased. I'm not sure exactly what will happen, but there is no way I am going to accept a regression like that</p>

<a name="165458265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458265">Mario Carneiro (May 12 2019 at 10:13)</a>:</h4>
<p>"replaced with something better" is okay, "deleted with no alternatives" is not</p>

<a name="165458318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458318" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458318">Patrick Massot (May 12 2019 at 10:14)</a>:</h4>
<p>Sure, you'll be able to continue using the fork if you want. But I guess most users will switch to Lean 4. And when I write "erased", I mean from the point of view of users. Nothing will be erased in the sense that the repository will still be there.</p>

<a name="165458347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458347">Patrick Massot (May 12 2019 at 10:15)</a>:</h4>
<p>Leo doesn't have to care about that fork, he won't have to "delete" anything, he can simply and rightfully ignore it</p>

<a name="165458403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458403">Mario Carneiro (May 12 2019 at 10:16)</a>:</h4>
<p>we still have to deal with integrating lean 4 and mathlib. That's not an easy task, and by the end of it we will probably know what the answer to this is</p>

<a name="165458580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458580">Mario Carneiro (May 12 2019 at 10:20)</a>:</h4>
<p>Lean 4 promises to put a lot more into lean code that we can modify. If all the stuff in the fork is now in lean, then the contents of it can simply move to mathlib</p>

<a name="165458664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458664" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458664">Patrick Massot (May 12 2019 at 10:22)</a>:</h4>
<p>I guess type class inference will stay C++ forever, it's a performance critical mission</p>

<a name="165458675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458675" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458675">Mario Carneiro (May 12 2019 at 10:23)</a>:</h4>
<p>possibly</p>

<a name="165458678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458678" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458678">Mario Carneiro (May 12 2019 at 10:23)</a>:</h4>
<p>lean is compiled now, maybe it can be made to work</p>

<a name="165458726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458726" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458726">Mario Carneiro (May 12 2019 at 10:24)</a>:</h4>
<p>I don't know if Lean 4 will ever be "open for business" as in accepting issues or PRs. It's really hard to tell if that was just a phase of lean 3 during the transition, or if that's the new normal</p>

<a name="165458730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165458730" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165458730">Mario Carneiro (May 12 2019 at 10:24)</a>:</h4>
<p>but I think the fork has a reason to exist at least until that day</p>

<a name="165462286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/representations/near/165462286" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/84839representations.html#165462286">Kevin Buzzard (May 12 2019 at 12:10)</a>:</h4>
<p>Leo told me</p>
<blockquote>
<p>Sebastian and I have a few ideas on how to improve the typeclass inference procedure, but we didn't get there yet. We are currently working on the new compiler, parser and expander. </p>
</blockquote>
<p>From what Mario says, the whole thing sounds extremely delicate.</p>


{% endraw %}

{% include archive_update.html %}