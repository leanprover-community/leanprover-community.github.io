---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/19282normcastquestions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/19282normcastquestions.html">norm_cast questions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="180574476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/norm_cast%20questions/near/180574476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/19282normcastquestions.html#180574476">Kevin Buzzard (Nov 12 2019 at 23:47)</a>:</h4>
<p>Talking through a sqrt(2) irrational proof with <span class="user-mention" data-user-id="243312">@Jason KY.</span> I realise I can't do these efficiently:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="bp">*</span> <span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">n</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="o">((</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">))</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="c1">-- one tactic?</span>
  <span class="n">sorry</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">d</span> <span class="bp">*</span> <span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="c1">-- one tactic?</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</pre></div>


<p>I am just naively typing <code>norm_cast</code> and that's the only trick I know. Can these be done quickly? They are two goals we ended up with when trying to reduce an irrationality of sqrt(2) proof to an assertion about the only solutions in integers to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>=</mo><mn>2</mn><msup><mi>b</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">a^2=2b^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> being the obvious ones.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">rat</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">open</span> <span class="n">rat</span>

<span class="kn">example</span> <span class="o">:</span> <span class="bp">¬</span> <span class="o">(</span><span class="bp">∃</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">,</span> <span class="n">q</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="c1">-- intro</span>
  <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">q</span><span class="o">,</span> <span class="n">hq</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="c1">-- notation for num and denom</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">q</span><span class="bp">.</span><span class="n">pos</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">pow_two</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- q*q easier than q^2</span>
  <span class="n">rw</span> <span class="err">←</span><span class="bp">@</span><span class="n">num_denom</span> <span class="n">q</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mul_def</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- otherwise you get (a/b)*(a/b) and I want to tidy denominators</span>
  <span class="n">rw</span> <span class="n">mk_eq_div</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- finally there</span>
  <span class="n">replace</span> <span class="n">hq</span> <span class="o">:=</span> <span class="n">hq</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span> <span class="c1">-- `symmetry&#39; at hq` should work here but I have an old mathlib apparently</span>
  <span class="n">rw</span> <span class="n">eq_div_iff_mul_eq</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span>
  <span class="c1">-- now pick up some of the pieces</span>
  <span class="n">swap</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_ne_zero_iff_pos</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">swap</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_ne_zero_iff_pos</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">sorry</span><span class="o">,</span> <span class="n">sorry</span> <span class="c1">-- what&#39;s left is the above</span>
<span class="kn">end</span>
</pre></div>


<div class="codehilite"><pre><span></span>
</pre></div>

<a name="180575451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/norm_cast%20questions/near/180575451" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/19282normcastquestions.html#180575451">Kevin Buzzard (Nov 13 2019 at 00:00)</a>:</h4>
<p>I'm still struggling to do the rational bit of sqrt(2) being irrational. I always hope that some day it will just look like the maths proof :-/</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">rat</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">open</span> <span class="n">rat</span>

<span class="kn">theorem</span> <span class="n">T1</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="bp">*</span> <span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">=</span> <span class="o">((</span><span class="n">n</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">))</span> <span class="o">:</span>
  <span class="mi">2</span> <span class="bp">*</span> <span class="o">((</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">))</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="c1">-- one tactic?</span>
  <span class="n">sorry</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">T2</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">d</span> <span class="bp">*</span> <span class="n">d</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="c1">-- one tactic?</span>
  <span class="n">sorry</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">,</span> <span class="mi">2</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">¬</span> <span class="o">(</span><span class="bp">∃</span> <span class="n">q</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">,</span> <span class="n">q</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="c1">-- intro</span>
  <span class="n">rintro</span> <span class="n">h0</span> <span class="bp">⟨</span><span class="n">q</span><span class="o">,</span> <span class="n">hq</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="c1">-- notation for num and denom</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">q</span><span class="bp">.</span><span class="n">pos</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">pow_two</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- q*q easier than q^2</span>
  <span class="n">rw</span> <span class="err">←</span><span class="bp">@</span><span class="n">num_denom</span> <span class="n">q</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">mul_def</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- otherwise you get (a/b)*(a/b) and I want to tidy denominators</span>
  <span class="n">rw</span> <span class="n">mk_eq_div</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span> <span class="c1">-- finally there</span>
  <span class="n">replace</span> <span class="n">hq</span> <span class="o">:=</span> <span class="n">hq</span><span class="bp">.</span><span class="n">symm</span><span class="o">,</span> <span class="c1">-- `symmetry&#39; at hq` should work here but I have an old mathlib apparently</span>
  <span class="n">rw</span> <span class="n">eq_div_iff_mul_eq</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">swap</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_ne_zero_iff_pos</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">swap</span> <span class="mi">3</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_ne_zero_iff_pos</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">replace</span> <span class="n">hq</span> <span class="o">:=</span> <span class="n">T1</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">replace</span> <span class="n">hq</span> <span class="o">:=</span> <span class="n">h0</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">norm_cast</span> <span class="n">at</span> <span class="n">hq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">hq</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">T2</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">nat</span><span class="bp">.</span><span class="n">mul_ne_zero</span><span class="o">,</span>
  <span class="n">repeat</span> <span class="o">{</span><span class="n">intro</span> <span class="n">h2</span><span class="o">,</span> <span class="n">rw</span> <span class="n">h2</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span><span class="o">},</span>
<span class="kn">end</span>
</pre></div>

<a name="180577555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/norm_cast%20questions/near/180577555" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/19282normcastquestions.html#180577555">Alex J. Best (Nov 13 2019 at 00:37)</a>:</h4>
<p>After <code>import data.rat.cast</code> both <code>T1</code> and <code>T2</code> are <code>  exact_mod_cast h,</code></p>


{% endraw %}

{% include archive_update.html %}