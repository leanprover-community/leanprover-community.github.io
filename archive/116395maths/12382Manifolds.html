---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/116395maths/12382Manifolds.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html">Manifolds</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="165394519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165394519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165394519">Hoang Le Truong (May 11 2019 at 05:41)</a>:</h4>
<p>I have the definition of manifold over a normed field in Lean. You can see it in the following link<br>
<a href="https://github.com/truonghoangle/manifolds" target="_blank" title="https://github.com/truonghoangle/manifolds">https://github.com/truonghoangle/manifolds</a><br>
If you do not mind, please can you give me advice about it, special name of function or section and approach way to the definition of tangent bundle.</p>

<a name="165394777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165394777" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165394777">Johan Commelin (May 11 2019 at 05:47)</a>:</h4>
<p>Are you aware of the fact that <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> is also working on manifolds? Did you coordinate with him?</p>

<a name="165395019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165395019" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165395019">Hoang Le Truong (May 11 2019 at 05:54)</a>:</h4>
<p>When I began with manifold, I did not known <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span>  is also working on manifolds. Now I will contact him.</p>

<a name="165395088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165395088" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165395088">Johan Commelin (May 11 2019 at 05:56)</a>:</h4>
<p>Here is one discussion: <a href="#narrow/stream/116395-maths/topic/Multiple.20differentiability" title="#narrow/stream/116395-maths/topic/Multiple.20differentiability">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Multiple.20differentiability</a></p>

<a name="165395103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165395103" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165395103">Johan Commelin (May 11 2019 at 05:57)</a>:</h4>
<p>Here is another one that might be relevant: <a href="#narrow/stream/113488-general/topic/out_param" title="#narrow/stream/113488-general/topic/out_param">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/out_param</a></p>

<a name="165395192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165395192" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165395192">Johan Commelin (May 11 2019 at 06:00)</a>:</h4>
<p><span class="user-mention" data-user-id="116065">@Hoang Le Truong</span> Here is another attempt by Patrick: <a href="https://github.com/PatrickMassot/lean-differential-topology" target="_blank" title="https://github.com/PatrickMassot/lean-differential-topology">https://github.com/PatrickMassot/lean-differential-topology</a></p>

<a name="165395262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165395262" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165395262">Hoang Le Truong (May 11 2019 at 06:00)</a>:</h4>
<p>Thank <span class="user-mention" data-user-id="112680">@Johan Commelin</span> for your information</p>

<a name="165398498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165398498" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165398498">Sebastien Gouezel (May 11 2019 at 07:33)</a>:</h4>
<p>The current state of thingsI have done on manifolds is in <a href="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/basic.lean" target="_blank" title="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/basic.lean">https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/basic.lean</a>. I am going for a more general approach, that would also encompass manifolds with boundaries, or manifolds with corners, or Thurston's (G,X) structures, but essentially the basic definitions are the same as yours, i.e., an atlas such that the changes of charts belong to some class of maps (called a groupoid, as in the fundamental textbook of Kobayashi and Nomizu). What I have done so far:</p>
<ul>
<li>extended the material on derivatives, to get access to a convenient API (PRed in <a href="https://github.com/leanprover-community/mathlib/issues/966" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/966">#966</a>)</li>
<li>defined local equivalences, just like you do except I use genuine functions instead of pfuns, to avoid defining yet another notion of derivatives (and I don't care what the functions do outside of their domains and codomains), and defined a basic interface for them (in <a href="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/local_equiv.lean" target="_blank" title="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/local_equiv.lean">https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/local_equiv.lean</a>). The fact that this is a good choice has been questioned by several people on Zulip, who encouraged me to use pfuns as you do, but for now it seems to go rather smoothly -- I need to develop the library further to see what the advantages and drawbacks are.</li>
<li>defined C^n functions, and proved basic properties (invariance under addition, composition, and so on), in <a href="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/times_cont_diff.lean" target="_blank" title="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/times_cont_diff.lean">https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/times_cont_diff.lean</a></li>
<li>defined general manifolds based on groupoids. As well as diffeomorphisms (for the groupoid structure), and proved that the inverse or the composition of two diffeomorphisms is a diffeomorphism (this is not so obvious) in <a href="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/basic.lean" target="_blank" title="https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/basic.lean">https://github.com/sgouezel/mathlib/blob/manifold4/src/geometry/manifolds/basic.lean</a>. Specialized to smooth manifolds, for which I am now defining the tangent space.</li>
</ul>
<p>My goal would be to go up to the Whitney embedding theorem (any smooth real manifold embeds in R^N for large enough N), which is a non-trivial theorem, to stress-test the definitions and the interface.</p>

<a name="165398847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165398847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165398847">Sebastien Gouezel (May 11 2019 at 07:44)</a>:</h4>
<p>One important point in library-building, I think, is that writing down definitions is not enough: you need to prove theorems, to see how definitions work out well or not, and what interface you need for the proofs. For instance, the first statement I settled to prove is that the composition of diffeomorphisms is a diffeomorphism. This showed me that I needed to implement a serious interface to local equivs, that now takes over 800 lines. And now defining the tangent space shows me gaps in this interface, that I will have to fill.</p>

<a name="165399819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165399819" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165399819">Hoang Le Truong (May 11 2019 at 08:11)</a>:</h4>
<p>My goal would be to go up to the Hodge theorem. I also think that the definition is right through the proof of the theorems. For instance about tangent bundle, we have three ways to give the definition.  Moreover, for complex manifold, we have three tangent bundle.  I am struggling between approachable approach on complex, real number and general ways.</p>

<a name="165400014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165400014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165400014">Johan Commelin (May 11 2019 at 08:17)</a>:</h4>
<p>Do you want to state the Hodge theorem or also prove it?</p>

<a name="165400015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165400015" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165400015">Johan Commelin (May 11 2019 at 08:17)</a>:</h4>
<p>Either of them would be fantastic!</p>

<a name="165400502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165400502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165400502">Sebastien Gouezel (May 11 2019 at 08:30)</a>:</h4>
<p>I am going for a general way (over any field), as follows: let <code>charts x</code> be the set of all charts around <code>x</code>. If <code>e</code> and <code>e'</code> are such charts, they yield a linear map from <code>E</code> to <code>E</code>, the derivative of <code>e' o e^{-1}</code>. Take the quotient of <code>(charts x) √ó E</code> under these identifications, this gives the tangent space. Hopefully, this should be easily generalizable to define exterior or symmetric products of the tangent bundle, opening the way to Riemannian metrics and to differential forms. But before doing the general case, I will stick to tangent spaces for now.</p>

<a name="165400611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165400611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165400611">Sebastien Gouezel (May 11 2019 at 08:32)</a>:</h4>
<p>Another definition would be to choose one chart around each point, and only use this one to define the tangent space. This avoid taking a quotient, but it is less canonical. I will have to do it at some point, though, because I will want the derivative of a map to be a bounded linear map between tangent spaces, and for this I need a normed space structure on the tangent space, for which there is no canonical choice.</p>

<a name="165400701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165400701" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165400701">Patrick Massot (May 11 2019 at 08:33)</a>:</h4>
<p>I think there will be painful points in any case, the only question is whether the API will be able to hide them</p>

<a name="165401048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165401048" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165401048">Sebastien Gouezel (May 11 2019 at 08:40)</a>:</h4>
<p>Yes, it is definitely going to be nontrivial.</p>

<a name="165403659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165403659" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165403659">Hoang Le Truong (May 11 2019 at 09:47)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>  I want to prove it but first step is to give the statement of the Hodge theorem</p>

<a name="165404064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165404064" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165404064">Hoang Le Truong (May 11 2019 at 09:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> are you think how definition of tangent space via derivations is good</p>

<a name="165404136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165404136" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165404136">Hoang Le Truong (May 11 2019 at 09:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> can you explain detaily about whether the API will be able to hide them</p>

<a name="165404286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165404286" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165404286">Sebastien Gouezel (May 11 2019 at 10:03)</a>:</h4>
<p>Definition of tangent space via derivations is very nice, but as far as I remember proofs that it behaves well require localizing functions around the point, and while this works well over R this creates problems over C where you don't have partitions of unity. And this construction is really specific to tangent spaces, while the stupid approach using equivalence classes of vectors should be generalizable to other vector bundles.</p>

<a name="165404699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165404699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165404699">Kevin Buzzard (May 11 2019 at 10:15)</a>:</h4>
<blockquote>
<p>One important point in library-building, I think, is that writing down definitions is not enough: you need to prove theorems, to see how definitions work out well or not, and what interface you need for the proofs.</p>
</blockquote>
<p>Tom Hales' project does not need proofs, so for this project one <em>might</em> find that writing down definitions is in many cases enough. If the goal is just to formalise statements of theorems then this might provide far fewer demands on the definition-builder.</p>

<a name="165405061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165405061" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165405061">Hoang Le Truong (May 11 2019 at 10:26)</a>:</h4>
<p>With complex maifold we have real tangent bundle, complexified tangent bundle and holomorphic tangent bundle. In fact, we begin with real tangent bundle. So I don't understand what the problems over C is.</p>

<a name="165407103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165407103" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165407103">Sebastien Gouezel (May 11 2019 at 11:22)</a>:</h4>
<p>You don't need to separate the real case and the complex case: there is a definition which works for both at the same time. So, to minimize work, it is probably better to use this one.</p>

<a name="165883850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/165883850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#165883850">Hoang Le Truong (May 17 2019 at 09:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> I read carefully the definition of very general manifold. It is very nice. I have question:What is the definition of submanifold? Is the definition of submanifold dependent on model space?</p>

<a name="166246445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166246445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166246445">Neil Strickland (May 22 2019 at 08:17)</a>:</h4>
<p>Can you comment on why your <code>local_equiv Œ±  Œ≤</code> actually involves maps defined on all of <code>Œ±</code> and  <code>Œ≤</code>, rather than just the indicated subsets?   This seems to be asking for trouble later.  Among other things, it means that an empty type cannot have a local equivalence with a nonempty one, which is a problem if <code>Œ±</code> and  <code>Œ≤</code> arise naturally as subtypes of something else.  Can you not use maps <code>Œ± ‚Üí roption Œ≤</code> and <code>Œ≤ ‚Üí roption Œ±</code> or something like that?  That way, the <code>eq_on_source</code> thing would become unnecessary.</p>

<a name="166259295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166259295" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166259295">Sebastien Gouezel (May 22 2019 at 11:35)</a>:</h4>
<p>There are pros and cons to both approaches, i.e. (1): functions defined everywhere, but you don't care about the values outside of the source, and (2): roption, i.e., really kill the values outside of source.</p>
<p>In (1), if functions are equal on the source but different outside, then they are not equal, while you want to think of them as the same function. That's the role of <code>eq_on_source</code>, which is definitely an annoyance.</p>
<p>In (2), your function does not take values in the right space, and this calls for trouble. For instance, if you want to define the derivative of a function <code>f : M -&gt; M' </code> where <code>M</code> and <code>M'</code> are manifolds, what you do is write <code>f</code> in charts, i.e., consider <code>e' o f o e^{-1}</code> where <code>e</code> and <code>e'</code> are charts around <code>x</code>and <code>f x</code>, and then you differentiate. With the roption approach, what you get is a function from <code>E</code> to <code>roption E'</code>, so you can not define the derivative as the limit of <code>(f(x+hv)-f(x))/h</code> when <code>h</code>tends to <code>0</code> (or an equivalent definition using small o) as it does not make sense to subtract elements of <code>roption E'</code>, or to divide them by a scalar. So, you would need to extend many algebraic definitions to <code>roption</code>, or to restrict your function to some suitable set and play some nontrivial dance there. </p>
<p>I have the feeling that (2) will create many more concrete problems than (1). Most of the time, we don't care at all about equality of charts, we just use one given chart and that's it. While having to reproject your function back to <code>E</code>to do some algebraic manipulation happens all the time. That's why I went for (1). But you are not the first person to voice concerns about this choice.</p>

<a name="166260363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166260363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166260363">Mario Carneiro (May 22 2019 at 11:53)</a>:</h4>
<p>You can define the derivative when the function is defined on an open set around the target point</p>

<a name="166260436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166260436" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166260436">Mario Carneiro (May 22 2019 at 11:54)</a>:</h4>
<p>the little o definition with a filter for roption functions actually makes this pretty painless</p>

<a name="166260450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166260450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166260450">Mario Carneiro (May 22 2019 at 11:54)</a>:</h4>
<p>Jeremy and I worked it out a while ago</p>

<a name="166260990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166260990" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166260990">Sebastien Gouezel (May 22 2019 at 12:04)</a>:</h4>
<p>You can definitely work it out. The same for continuity: there is already an API for continuity of partial functions, crafted by Jeremy. Except that it is some amount of work. Then when you want to talk about C^k functions, or analytic functions, or Besov functions, or whatever, and even if you have already done it for functions you will need to spend some time to define again the same notions for partial functions (with a well developed API if you want these notions to be usable). This is completely avoided by the approach (1), at the expense of the mild annoyance that equality between charts (which is essentially never used) is not the right notion.</p>

<a name="166261014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261014">Mario Carneiro (May 22 2019 at 12:04)</a>:</h4>
<p>You don't want to lift every algebraic operation to roption exactly; you use the monad structure for that</p>

<a name="166261063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261063">Mario Carneiro (May 22 2019 at 12:05)</a>:</h4>
<p>I'm not sure it's true to say it's completely avoided; instead you have to build an API for <code>eq_on_bla</code> and <code>local_equiv</code> and such. It's moving the work elsewhere</p>

<a name="166261246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261246" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261246">Sebastien Gouezel (May 22 2019 at 12:08)</a>:</h4>
<p>I think in any case you will need to build an API for <code>local_equiv</code>. Even with partial functions, you will need to bundle two partial functions which are inverse to each other on their respective domains, and see how they compose and so on.</p>

<a name="166261374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261374">Mario Carneiro (May 22 2019 at 12:10)</a>:</h4>
<p>no, that's equiv of subtypes</p>

<a name="166261712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261712">Sebastien Gouezel (May 22 2019 at 12:16)</a>:</h4>
<p>Not really, because you want to be able to compose them even when when the target of the first one is not the source of the second one, by automatically taking the intersection of the domains. Composition of roption-valued functions does that automatically, but composition of equivs of subtypes does not.</p>

<a name="166261828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261828" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261828">Mario Carneiro (May 22 2019 at 12:18)</a>:</h4>
<p>that's true. I guess you need to forget about the domains in the types in your case</p>

<a name="166261884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166261884" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166261884">Mario Carneiro (May 22 2019 at 12:19)</a>:</h4>
<p>still I like the fact that using subtypes gives you topology for free... can roption do the same?</p>

<a name="166262151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166262151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166262151">Hoang Le Truong (May 22 2019 at 12:24)</a>:</h4>
<p>2) With the roption approach, I change a function <code>E ‚Üí roption E</code> to function <code> E ‚Üí E</code> by <br>
<code>def ext_by_zero(f : Œ≤ ‚Üí. Œ±) (z:Œ≤) : Œ± := 
if  h:z ‚àà  f.dom    then f.fn z h else 0</code><br>
When we only work on <code>x ‚àà f.dom</code></p>

<a name="166262200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166262200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166262200">Hoang Le Truong (May 22 2019 at 12:25)</a>:</h4>
<p>Fisrt I work only with complex field and   definition of <code>manifold ‚ÑÇ Œ≤</code> <code>local_equiv Œ±  Œ≤</code> also work only funtions <code>Œ± ‚Üí Œ≤</code>.  But we can change ‚ÑÇ to any field <code>k</code>.  When we work on field <code>ùîΩ‚ÇÅ</code> then empty function joint theory as absorbing element.  Therefore I choose <code>local_equiv Œ±  Œ≤</code> include empty function</p>

<a name="166262206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166262206" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166262206">Mario Carneiro (May 22 2019 at 12:25)</a>:</h4>
<p>I think the natural topology on roption A is the one-point compactification</p>

<a name="166262394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166262394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166262394">Mario Carneiro (May 22 2019 at 12:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110294">@Johannes H√∂lzl</span> Do you know a way to do the topology of <code>roption A</code> with filters?</p>

<a name="166270560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/Manifolds/near/166270560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/12382Manifolds.html#166270560">Sebastien Gouezel (May 22 2019 at 14:07)</a>:</h4>
<p>I am still puzzled by my question that started this thread: how come a <code>simp</code>invocation can create a ghost duplication of some objects, that disappears if one adds a <code>rw</code> just before, in <a href="https://github.com/sgouezel/mathlib/blob/f6d6492e7a8b892b4a22fb010fb12d1a4695d38a/src/geometry/manifolds/mderiv.lean#L604" target="_blank" title="https://github.com/sgouezel/mathlib/blob/f6d6492e7a8b892b4a22fb010fb12d1a4695d38a/src/geometry/manifolds/mderiv.lean#L604">https://github.com/sgouezel/mathlib/blob/f6d6492e7a8b892b4a22fb010fb12d1a4695d38a/src/geometry/manifolds/mderiv.lean#L604</a>. Any hint on what is going on would be welcome.</p>


{% endraw %}
