---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/44395sheavesandsites.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html">sheaves and sites</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="147299236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147299236" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147299236">Johan Commelin (Nov 08 2018 at 13:34)</a>:</h4>
<p>Lol, I'm quite sure that the definition of <code>coverage</code> is wrong. I should demand that the collection of covers contains the singletons <code>{id : U ⟶ U}</code> for every <code>U : X</code>.</p>

<a name="147299259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147299259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147299259">Johan Commelin (Nov 08 2018 at 13:35)</a>:</h4>
<p>If I'm right, this is also missing on nLab.</p>

<a name="147532006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147532006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147532006">Johan Commelin (Nov 12 2018 at 15:28)</a>:</h4>
<p>I retract this. There is a comment on nLab pointing out that you don't need to demand that identity morphisms cover. It doesn't change your category of sheaves.</p>

<a name="147532080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147532080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147532080">Kenny Lau (Nov 12 2018 at 15:29)</a>:</h4>
<p>did you say nlab...</p>

<a name="147532144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147532144" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147532144">Kenny Lau (Nov 12 2018 at 15:30)</a>:</h4>
<p>man you've gone too far...</p>

<a name="147545193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147545193" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147545193">Johan Commelin (Nov 12 2018 at 19:11)</a>:</h4>
<p><code>opens X</code> is now a site!<br>
<a href="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/sheaf.lean#L245" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/sheaf.lean#L245">https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/sheaf.lean#L245</a></p>

<a name="147545202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147545202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147545202">Johan Commelin (Nov 12 2018 at 19:11)</a>:</h4>
<p>This is one of the ugliest proofs I've written in a long time.</p>

<a name="147545468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147545468" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147545468">Johan Commelin (Nov 12 2018 at 19:17)</a>:</h4>
<p>Also, I would like to get some feedback on the definition of the <code>covers</code> for <code>opens X</code>. This is the actual data that goes into a <code>site</code>. The rest doesn't matter, because it's only proofs. (They should of course be faster then what I have now.)<br>
Basically, there are at least three (equivalent) ways to specify the data of <code>covers</code>:<br>
1) <code>covers := λ U Us, U.val = ⨆u∈Us, (u:over _).left.val</code> — take the union in <code>set X</code><br>
2) <code>covers := λ U Us, U = ⨆u∈Us, (u:over _).left</code> — take the "union" in <code>opens X</code><br>
3) <code>covers := λ U Us, U = limits.sigma (λ u∈Us, (u:over _))</code> — take the "union" as a colimit in the category <code>over U</code><br>
Do people already see reasons to choose/discard one of these options?</p>

<a name="147545537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147545537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147545537">Johan Commelin (Nov 12 2018 at 19:18)</a>:</h4>
<p>I currently have option (2). But maybe option (3) is actually better, even though it is high-brow; because it would tie in better to all the facts that we (will) have about functors/limits/etc...</p>

<a name="147547765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147547765" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147547765">Reid Barton (Nov 12 2018 at 19:57)</a>:</h4>
<p>I wonder whether using actual families (instead of <code>set</code> everywhere) would make your life easier</p>

<a name="147547907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147547907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147547907">Reid Barton (Nov 12 2018 at 20:00)</a>:</h4>
<p>Maybe this isn't actually causing any difficulty</p>

<a name="147548610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147548610" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147548610">Johan Commelin (Nov 12 2018 at 20:14)</a>:</h4>
<p>Hmm, I had that before, and it actually became harder... also, you run into more universe issues, I think.</p>

<a name="147576521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576521">Johan Commelin (Nov 13 2018 at 08:09)</a>:</h4>
<p><code>sheaf.lean</code> is now <code>sorry</code>-free. In particular, I have defined the site on a basis of a topology.</p>

<a name="147576576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576576" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576576">Kevin Buzzard (Nov 13 2018 at 08:10)</a>:</h4>
<p><span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> you might be interested in this. <span class="user-mention" data-user-id="112680">@Johan Commelin</span> where is this work? Is it on github?</p>

<a name="147576586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576586">Johan Commelin (Nov 13 2018 at 08:10)</a>:</h4>
<p>My todo-list:</p>
<ul>
<li>Clean up the proofs</li>
<li>Prove that continuous functions to some space <code>T</code> form a sheaf on <code>X</code></li>
<li>Generalise to sheaves with values in <code>C</code> (e.g., <code>C = CommRing</code> or <code>Ab</code>)</li>
<li>Define stalks</li>
<li>Build an API around everything</li>
</ul>

<a name="147576593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576593">Johan Commelin (Nov 13 2018 at 08:11)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/sheaf.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/sheaf.lean">https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/sheaf.lean</a></p>

<a name="147576745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576745">Johan Commelin (Nov 13 2018 at 08:15)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Would you mind testing your most powerful version of <code>obviously</code> on (parts) of the proofs at the bottom of <code>sheaf.lean</code>? As you can see I'm mostly doing what <code>tidy</code> would do, except that I sprinkle an occasional <code>rw</code> into the mix.</p>

<a name="147576748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576748" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576748">Johan Commelin (Nov 13 2018 at 08:15)</a>:</h4>
<p>(If you have time for this...)</p>

<a name="147576890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576890" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576890">Scott Morrison (Nov 13 2018 at 08:19)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="112680">@Johan Commelin</span> , we should combine/adapt the stuff I wrote on bundled presheaves at some point, with a category structure based on:</p>
<div class="codehilite"><pre><span></span>structure Presheaf :=
(X : Top.{v})
(𝒪 : (opens X)ᵒᵖ ⥤ C)

structure Presheaf_hom (F G : Presheaf.{u v} C) :=
(f : F.X ⟶ G.X)
(c : G.𝒪 ⟹ ((opens.map f).op ⋙ F.𝒪))
</pre></div>

<a name="147576895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576895">Scott Morrison (Nov 13 2018 at 08:19)</a>:</h4>
<p>Am I right that you haven't got this yet?</p>

<a name="147576897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147576897" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147576897">Scott Morrison (Nov 13 2018 at 08:19)</a>:</h4>
<p>I think most of the other stuff I'd done previously on sheaves is all obsolete by your recent progress.</p>

<a name="147577022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147577022" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147577022">Johan Commelin (Nov 13 2018 at 08:22)</a>:</h4>
<p>(I don't have stalks yet <span class="emoji emoji-1f606" title="lol">:lol:</span>)</p>

<a name="147577025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147577025" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147577025">Johan Commelin (Nov 13 2018 at 08:22)</a>:</h4>
<p>Why would you want the bundled presheaves?</p>

<a name="147577047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147577047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147577047">Johan Commelin (Nov 13 2018 at 08:23)</a>:</h4>
<p>To define morphisms of ringed spaces?</p>

<a name="147577051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147577051" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147577051">Johan Commelin (Nov 13 2018 at 08:23)</a>:</h4>
<p>I think I would first do that unbundled.</p>

<a name="147577899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147577899" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147577899">Johan Commelin (Nov 13 2018 at 08:48)</a>:</h4>
<p>Hmmm, I just realised that I don't even know what it means to be a sheaf with values in <code>C</code> when working on an arbitrary site.<br>
I can make sense of it</p>
<ul>
<li>if the site has pullbacks, or</li>
<li>if <code>C</code> is <em>concrete</em> in the sense that it comes with a forgetful functor to <code>Type</code>.</li>
</ul>

<a name="147578584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147578584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147578584">Johan Commelin (Nov 13 2018 at 09:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you have any tips on what the right "go-for-it" route would be in this case?</p>

<a name="147578592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147578592" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147578592">Johan Commelin (Nov 13 2018 at 09:03)</a>:</h4>
<p>We want sheaves of rings.<br>
There are 23 definitions that are all math-equivalent.</p>

<a name="147580288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580288">Harry Gindi (Nov 13 2018 at 09:46)</a>:</h4>
<p>There's no way to do it as a ring object in sheaves?</p>

<a name="147580305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580305">Johan Commelin (Nov 13 2018 at 09:47)</a>:</h4>
<p>That is one of the 23 possibilities (-;</p>

<a name="147580313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580313" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580313">Johan Commelin (Nov 13 2018 at 09:47)</a>:</h4>
<p>But then you need to connect it to all the useful things that we know already about rings.</p>

<a name="147580320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580320" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580320">Johan Commelin (Nov 13 2018 at 09:47)</a>:</h4>
<p>This is math-trivial, of course</p>

<a name="147580363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580363">Harry Gindi (Nov 13 2018 at 09:48)</a>:</h4>
<p>A lot of them aren't true for sheafy rings</p>

<a name="147580367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580367" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580367">Johan Commelin (Nov 13 2018 at 09:48)</a>:</h4>
<p>But now you actually need to justify it to a computer.</p>

<a name="147580381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580381">Johan Commelin (Nov 13 2018 at 09:48)</a>:</h4>
<p>Sure, but there is an extremely large bunch of trivialities that are true</p>

<a name="147580399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580399">Harry Gindi (Nov 13 2018 at 09:49)</a>:</h4>
<p>Is there any way to work with sheaves directly as nonclassical types?</p>

<a name="147580463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580463" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580463">Harry Gindi (Nov 13 2018 at 09:50)</a>:</h4>
<p>so that all of the theorems for rings that don't use classical assertions hold?</p>

<a name="147580575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580575">Johan Commelin (Nov 13 2018 at 09:52)</a>:</h4>
<p>What exactly do you mean?</p>

<a name="147580580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580580">Johan Commelin (Nov 13 2018 at 09:52)</a>:</h4>
<p>Working internally in some topos?</p>

<a name="147580598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580598" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580598">Johan Commelin (Nov 13 2018 at 09:53)</a>:</h4>
<p>Or you want to lift all constructive results into every topos?</p>

<a name="147580615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580615" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580615">Johan Commelin (Nov 13 2018 at 09:53)</a>:</h4>
<p>Nothing like that currently exists. And pulling it off would be quite a non-trivial project.</p>

<a name="147580710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580710" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580710">Harry Gindi (Nov 13 2018 at 09:55)</a>:</h4>
<p>Yeah, I agree</p>

<a name="147580756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580756" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580756">Johan Commelin (Nov 13 2018 at 09:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Do you think the current definition of <code>sheaf</code> is ok?</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">sheaf</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="err">𝒳</span> <span class="o">:</span> <span class="n">site</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">X</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="bp">//</span> <span class="n">nonempty</span> <span class="o">(</span><span class="n">site</span><span class="bp">.</span><span class="n">sheaf_condition</span> <span class="n">F</span><span class="o">)</span> <span class="o">}</span>
</pre></div>


<p>I need the ugly <code>nonempty</code> because <code>is.iso</code> is not a <code>Prop</code>. What is the correct Lean-idiom for this?</p>

<a name="147580770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580770" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580770">Scott Morrison (Nov 13 2018 at 09:57)</a>:</h4>
<p>Why not just use a sigma type?</p>

<a name="147580779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580779" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580779">Scott Morrison (Nov 13 2018 at 09:57)</a>:</h4>
<p>The category of presheaves will not care about the evidence you provide</p>

<a name="147580780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580780" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580780">Johan Commelin (Nov 13 2018 at 09:57)</a>:</h4>
<p>I want to use <code>full_subcategory</code></p>

<a name="147580787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580787" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580787">Johan Commelin (Nov 13 2018 at 09:57)</a>:</h4>
<p>But maybe I shouldn't?</p>

<a name="147580792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580792" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580792">Scott Morrison (Nov 13 2018 at 09:57)</a>:</h4>
<p>so use <code>sigma_category</code>, which I think hasn't landed in mathlib</p>

<a name="147580795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580795" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580795">Scott Morrison (Nov 13 2018 at 09:57)</a>:</h4>
<p>but is the same idea, it just ignores the extra data</p>

<a name="147580839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580839">Scott Morrison (Nov 13 2018 at 09:58)</a>:</h4>
<p>If you think about it, this is a perfectly sensible thing to do categorically:</p>

<a name="147580842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580842">Johan Commelin (Nov 13 2018 at 09:58)</a>:</h4>
<p>Ok... I see. Which branch do I need to merge into <code>sheaf</code> to do that?</p>

<a name="147580848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580848" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580848">Johan Commelin (Nov 13 2018 at 09:58)</a>:</h4>
<p>Yeah, the idea is obvious. I just didn't want to roll my own tooling.</p>

<a name="147580850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580850">Scott Morrison (Nov 13 2018 at 09:58)</a>:</h4>
<p>you can have something that acts as a full subcategory, but actually makes many copies of the objects that you're keeping, according to the different ways to witness that you want them ...</p>

<a name="147580854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580854" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580854">Johan Commelin (Nov 13 2018 at 09:58)</a>:</h4>
<p>/me is lazy...</p>

<a name="147580860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580860" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580860">Scott Morrison (Nov 13 2018 at 09:58)</a>:</h4>
<p>I think it's only in <code>lean-category-theory</code></p>

<a name="147580862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580862" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580862">Scott Morrison (Nov 13 2018 at 09:59)</a>:</h4>
<p>so it's not just merging a branch</p>

<a name="147580876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580876" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580876">Johan Commelin (Nov 13 2018 at 09:59)</a>:</h4>
<p>Aaah, then I'll leave a TODO above the current definition.</p>

<a name="147580886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580886">Harry Gindi (Nov 13 2018 at 09:59)</a>:</h4>
<p>Is there documentation for what a sigma-category is?</p>

<a name="147580896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580896">Scott Morrison (Nov 13 2018 at 09:59)</a>:</h4>
<p>Copy and paste</p>
<div class="codehilite"><pre><span></span>instance sigma_category (Z : C → Type w₁) : category.{(max u₁ w₁) v₁} (Σ X : C, Z X) :=
{ hom  := λ X Y, X.1 ⟶ Y.1,
  id   := λ X, 𝟙 X.1,
  comp := λ _ _ _ f g, f ≫ g }

def sigma_category_inclusion (Z : C → Type u₁) : (Σ X : C, Z X) ⥤ C :=
{ obj := λ X, X.1,
  map&#39; := λ _ _ f, f }

instance full_σ        (Z : C → Type u₁) : full    (sigma_category_inclusion Z)    := by obviously
instance faithful_σ    (Z : C → Type u₁) : faithful (sigma_category_inclusion Z)   := by obviously
</pre></div>

<a name="147580925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580925" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580925">Scott Morrison (Nov 13 2018 at 10:00)</a>:</h4>
<p>into full_subcategory.lean?</p>

<a name="147580958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147580958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147580958">Harry Gindi (Nov 13 2018 at 10:00)</a>:</h4>
<p>does it have a non-type-theoretic analogue?</p>

<a name="147581050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581050">Johan Commelin (Nov 13 2018 at 10:01)</a>:</h4>
<p>Sure, but I don't know if it actually occurs.</p>

<a name="147581091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581091" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581091">Scott Morrison (Nov 13 2018 at 10:02)</a>:</h4>
<p>Sure. Say you have a set of objects C, and a function f : C \to Set. Make a new category with objects (X, Y), where Y is in f(X), and whose morphisms (X, Y) to (X', Y') are just the C-morphisms from X to X'.</p>

<a name="147581094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581094" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581094">Johan Commelin (Nov 13 2018 at 10:02)</a>:</h4>
<p>It would be like taking the category of groups with all functions as morphisms</p>

<a name="147581095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581095" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581095">Scott Morrison (Nov 13 2018 at 10:02)</a>:</h4>
<p>Does it have a name?</p>

<a name="147581105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581105" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581105">Scott Morrison (Nov 13 2018 at 10:02)</a>:</h4>
<p>It just makes f(X) many copies of the object X.</p>

<a name="147581171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581171">Harry Gindi (Nov 13 2018 at 10:04)</a>:</h4>
<p>it looks like it's related to the 'anafunctor' version of a subcategory?</p>

<a name="147581204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581204">Johan Commelin (Nov 13 2018 at 10:05)</a>:</h4>
<p><span class="user-mention" data-user-id="137844">@Harry Gindi</span> Here is a math question that I don't know the answer to. In what generality do people speak of sheaves on a site <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> with values in a category <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span>?<br>
What assumptions do I need to make on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> and/or <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span>? Is there some grand theory that unifies everything?</p>

<a name="147581290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581290">Harry Gindi (Nov 13 2018 at 10:07)</a>:</h4>
<p>people sometimes say "sheaves of X" in all kinds of cases, but it only makes sense when X is a subcategory of algebras for some algebraic theory rel set</p>

<a name="147581304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581304" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581304">Johan Commelin (Nov 13 2018 at 10:07)</a>:</h4>
<p>Well, if the site <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> has pullbacks, then I guess the sheaf condition makes sense in every category <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07153em;">C</span></span></span></span> with equalizers, right?</p>

<a name="147581351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581351">Harry Gindi (Nov 13 2018 at 10:08)</a>:</h4>
<p>yes, but it is usually the wrong thing</p>

<a name="147581356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581356">Johan Commelin (Nov 13 2018 at 10:08)</a>:</h4>
<p>Ok, so it works but is useless.</p>

<a name="147581368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581368" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581368">Harry Gindi (Nov 13 2018 at 10:09)</a>:</h4>
<p>I think so, yes</p>

<a name="147581438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581438">Johan Commelin (Nov 13 2018 at 10:10)</a>:</h4>
<p>Ok, I'll have to think a bit about how to move this forward. I'm not sure if I'm ready for defining all the stuff related to algebraic theories.</p>

<a name="147581522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581522" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581522">Harry Gindi (Nov 13 2018 at 10:12)</a>:</h4>
<p>It might make more sense if you could relativize algebraic stuff to like parameterized types?</p>

<a name="147581530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581530">Harry Gindi (Nov 13 2018 at 10:12)</a>:</h4>
<p>I don't know, it's really alien to me</p>

<a name="147581550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581550" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581550">Harry Gindi (Nov 13 2018 at 10:13)</a>:</h4>
<p>probably the easiest way is as you said</p>

<a name="147581604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581604">Harry Gindi (Nov 13 2018 at 10:14)</a>:</h4>
<p>when the category is concrete, being a sheaf with values in C is the same thing as asking that the underlying sheaf of sets is a sheaf</p>

<a name="147581646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581646">Harry Gindi (Nov 13 2018 at 10:15)</a>:</h4>
<p>I don't know how well that works with e.g. a sheaf of complexes</p>

<a name="147581741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581741" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581741">Harry Gindi (Nov 13 2018 at 10:16)</a>:</h4>
<p>which is like the most important application of sheafy stuff in alg. geom, I think</p>

<a name="147581744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581744" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581744">Scott Morrison (Nov 13 2018 at 10:16)</a>:</h4>
<p>You have to be pretty careful with this statement. It's not just "concrete" (e.g. topological rings have a faithful functor to Set) You also need that the forgetful functor is continuous and reflects isos.</p>

<a name="147581830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581830" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581830">Scott Morrison (Nov 13 2018 at 10:18)</a>:</h4>
<p>At some point I wrote down the statement, but never attempted to prove it:</p>
<div class="codehilite"><pre><span></span>variables {V : Type (u+1)} [𝒱 : large_category V] [has_products.{u+1 u} V] (ℱ : V ⥤ (Type u))
          [faithful ℱ] [category_theory.limits.preserves_limits ℱ] [reflects_isos ℱ]
include 𝒱

-- This is a good project!
def sheaf.of_sheaf_of_types
  (presheaf : (opens X)ᵒᵖ ⥤ V)
  (underlying_is_sheaf : is_sheaf (presheaf ⋙ ℱ)) : is_sheaf presheaf := sorry
</pre></div>

<a name="147581858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581858" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581858">Scott Morrison (Nov 13 2018 at 10:19)</a>:</h4>
<p>(This won't be compatible with Johan's version of presheaves and sheaves, of course.)</p>

<a name="147581877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581877" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581877">Harry Gindi (Nov 13 2018 at 10:19)</a>:</h4>
<p>I wonder if a good way to do this is with internal objects in a topos after all</p>

<a name="147581886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581886">Harry Gindi (Nov 13 2018 at 10:19)</a>:</h4>
<p>then you could try to follow Hakim's thesis</p>

<a name="147581986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581986" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581986">Johan Commelin (Nov 13 2018 at 10:21)</a>:</h4>
<p>I challenge you to try it <span class="emoji emoji-1f603" title="smiley">:smiley:</span></p>

<a name="147581991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147581991" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147581991">Harry Gindi (Nov 13 2018 at 10:21)</a>:</h4>
<p>I don't understand how you can say something like categories of nonclassical types satisfyinf Giraud's axioms are categories of sheaves on a site</p>

<a name="147582038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582038" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582038">Johan Commelin (Nov 13 2018 at 10:22)</a>:</h4>
<p>What do you mean?</p>

<a name="147582050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582050">Harry Gindi (Nov 13 2018 at 10:22)</a>:</h4>
<p>like, we might want to work internally to some Grothendieck topos</p>

<a name="147582065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582065" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582065">Harry Gindi (Nov 13 2018 at 10:23)</a>:</h4>
<p>and the objects there would hopefully be of type "type"</p>

<a name="147582066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582066" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582066">Johan Commelin (Nov 13 2018 at 10:23)</a>:</h4>
<p>Sure. And <code>Type</code> is equivalent to sheaves on <code>unit</code></p>

<a name="147582076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582076" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582076">Johan Commelin (Nov 13 2018 at 10:23)</a>:</h4>
<p>No, for an arbitrary topos the type of the objects wouldn't be <code>Type</code></p>

<a name="147582123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582123" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582123">Johan Commelin (Nov 13 2018 at 10:24)</a>:</h4>
<p>They would be of type <code>X</code>, where <code>X</code> is your topos.</p>

<a name="147582126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582126" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582126">Harry Gindi (Nov 13 2018 at 10:24)</a>:</h4>
<p>then how can you transfer results from type type to type sheafy type</p>

<a name="147582129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582129">Johan Commelin (Nov 13 2018 at 10:24)</a>:</h4>
<p>And so you have to develop all of type theory internal to topoi. And this hasn't been done yet in Lean. And I don't think it has been done in any theorem prover.</p>

<a name="147582142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582142" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582142">Johan Commelin (Nov 13 2018 at 10:25)</a>:</h4>
<p>To do that "transfer" you would have to build quite a bit of machinery.</p>

<a name="147582145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582145" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582145">Harry Gindi (Nov 13 2018 at 10:25)</a>:</h4>
<p>exactly, it looks daunting</p>

<a name="147582151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582151">Johan Commelin (Nov 13 2018 at 10:25)</a>:</h4>
<p>Very daunting</p>

<a name="147582160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582160">Johan Commelin (Nov 13 2018 at 10:25)</a>:</h4>
<p>It would take Mario a whole summer, I'm afraid.</p>

<a name="147582218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582218" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582218">Harry Gindi (Nov 13 2018 at 10:26)</a>:</h4>
<p>one way to do it, maybe, would be to try to prove that any nonclassical theorem in type type holds when you substitute type X for type type when X is a topos?</p>

<a name="147582233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582233" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582233">Harry Gindi (Nov 13 2018 at 10:27)</a>:</h4>
<p>it's not easy</p>

<a name="147582320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582320" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582320">Harry Gindi (Nov 13 2018 at 10:29)</a>:</h4>
<p>It would probably be highly rewarding in terms of work saved</p>

<a name="147582598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147582598" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147582598">Harry Gindi (Nov 13 2018 at 10:34)</a>:</h4>
<p>I should probably look in e.g. the elephant to see if there is a statement of such a theorem</p>

<a name="147583484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583484" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583484">Mario Carneiro (Nov 13 2018 at 10:51)</a>:</h4>
<p>I'm afraid I have no idea about the math in this area</p>

<a name="147583499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583499" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583499">Mario Carneiro (Nov 13 2018 at 10:51)</a>:</h4>
<p>I'm not sure how much of it is important to the modeling question</p>

<a name="147583644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583644" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583644">Mario Carneiro (Nov 13 2018 at 10:54)</a>:</h4>
<blockquote>
<p>Hmmm, I just realised that I don't even know what it means to be a sheaf with values in <code>C</code> when working on an arbitrary site.<br>
I can make sense of it<br>
* if the site has pullbacks, or<br>
* if <code>C</code> is <em>concrete</em> in the sense that it comes with a forgetful functor to <code>Type</code>.</p>
</blockquote>
<p>Are these two definitions related to each other? Harry says this is not the right notion in some categories?</p>

<a name="147583678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583678" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583678">Mario Carneiro (Nov 13 2018 at 10:55)</a>:</h4>
<p>If there is a reasonable categorical interpretation of the sheaf operations or what not then that seems like a good place to start</p>

<a name="147583745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583745">Mario Carneiro (Nov 13 2018 at 10:56)</a>:</h4>
<p>but it sounds like a "sheaf of rings" is not a sheaf over <code>Ring</code> as I would hope, but rather a ring object in sheaves... unfortunately I don't know any way of relating rings and ring objects in a suitably algorithmic way</p>

<a name="147583842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583842">Mario Carneiro (Nov 13 2018 at 10:58)</a>:</h4>
<p>that is, you can define a group object, ring object etc but nothing about these definitions will connect them to the usual algebraic classes, and there won't be a general procedure for inputting a universal algebra and getting a predicate in category theory language</p>

<a name="147583872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147583872" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147583872">Mario Carneiro (Nov 13 2018 at 10:59)</a>:</h4>
<p>and "internalization" is not something we can currently do in a nice way, although maybe a tactic could do it in the future</p>

<a name="147585448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147585448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147585448">Johan Commelin (Nov 13 2018 at 11:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Thanks for your input. I think Harry is saying that it would be best to go for the option with <em>concrete</em> categories, and Scott already gave a mockup of the statement.</p>

<a name="147585465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147585465" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147585465">Johan Commelin (Nov 13 2018 at 11:37)</a>:</h4>
<p>You are right that a sheaf of rings is a ring object in sheaves. (At least that is one way to define it.)</p>

<a name="147585780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147585780" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147585780">Harry Gindi (Nov 13 2018 at 11:45)</a>:</h4>
<p>I asked a colleague of mine who specializes in topos theory (and has lots of experience with Lean, but the HOTT branch)</p>

<a name="147585838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147585838" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147585838">Harry Gindi (Nov 13 2018 at 11:46)</a>:</h4>
<p>oh yeah, he's here, Jonas</p>

<a name="147585865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147585865" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147585865">Harry Gindi (Nov 13 2018 at 11:47)</a>:</h4>
<p><span class="user-mention" data-user-id="114636">@Jonas Frey</span></p>

<a name="147586499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147586499" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147586499">Johan Commelin (Nov 13 2018 at 12:01)</a>:</h4>
<p>I imagine that a bunch of these problems would go away when using HoTT + univalence</p>

<a name="147589162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589162">Harry Gindi (Nov 13 2018 at 13:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I was saying that the notion of a sheaf with values in a category that isn't 'algebraic' in some sense is bad</p>

<a name="147589170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589170" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589170">Mario Carneiro (Nov 13 2018 at 13:00)</a>:</h4>
<p>so what does "algebraic" mean here?</p>

<a name="147589185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589185" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589185">Harry Gindi (Nov 13 2018 at 13:01)</a>:</h4>
<p>admits a finite limit sketch over set, I believe</p>

<a name="147589194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589194">Mario Carneiro (Nov 13 2018 at 13:01)</a>:</h4>
<p>like what are some simple examples?</p>

<a name="147589196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589196">Harry Gindi (Nov 13 2018 at 13:01)</a>:</h4>
<p>sheaves of categories are bad, for example</p>

<a name="147589202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589202">Mario Carneiro (Nov 13 2018 at 13:01)</a>:</h4>
<p>I'm not really sure what the applications are here, what kinds of sheaves are good?</p>

<a name="147589247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589247" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589247">Harry Gindi (Nov 13 2018 at 13:02)</a>:</h4>
<p>the right notion for a sheaf of categories has additional coherence conditions (cocycle conditions) that make them stacks</p>

<a name="147589258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589258">Mario Carneiro (Nov 13 2018 at 13:02)</a>:</h4>
<p>but I presume these don't come up in the usual cases for some reason?</p>

<a name="147589259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589259">Harry Gindi (Nov 13 2018 at 13:02)</a>:</h4>
<p>good categories for sheaves: groups, rings, abgroups, things of that nature</p>

<a name="147589270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589270">Harry Gindi (Nov 13 2018 at 13:03)</a>:</h4>
<p>yeah, basically</p>

<a name="147589330"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589330" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589330">Mario Carneiro (Nov 13 2018 at 13:04)</a>:</h4>
<p>So is the "data" of a sheaf all present in an arbitrary category?</p>

<a name="147589340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589340" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589340">Mario Carneiro (Nov 13 2018 at 13:04)</a>:</h4>
<p>or does pullbacks suffice?</p>

<a name="147589364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589364" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589364">Mario Carneiro (Nov 13 2018 at 13:05)</a>:</h4>
<p>and somehow in a "good" category these operations have additional properties that make it work</p>

<a name="147589374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589374">Harry Gindi (Nov 13 2018 at 13:05)</a>:</h4>
<p>(deleted)</p>

<a name="147589430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589430">Harry Gindi (Nov 13 2018 at 13:06)</a>:</h4>
<p>sorry, all products</p>

<a name="147589438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589438">Harry Gindi (Nov 13 2018 at 13:07)</a>:</h4>
<p>because you can have infinite covering families</p>

<a name="147589448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589448">Mario Carneiro (Nov 13 2018 at 13:07)</a>:</h4>
<p>I think the easy route would be to define what a sheaf is in an arbitrary category with the constructions needed in the definition itself, and then add appropriate regularity conditions for the theorems (or just prove the theorems in particular categories when needed)</p>

<a name="147589497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589497">Mario Carneiro (Nov 13 2018 at 13:08)</a>:</h4>
<p>I would imagine that it will be easy to retrofit the theorems with more generality as needed</p>

<a name="147589498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589498" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589498">Harry Gindi (Nov 13 2018 at 13:08)</a>:</h4>
<p>Scott's version works better than that</p>

<a name="147589514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589514">Harry Gindi (Nov 13 2018 at 13:08)</a>:</h4>
<p>it hits all of the ones we care about</p>

<a name="147589516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589516" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589516">Mario Carneiro (Nov 13 2018 at 13:08)</a>:</h4>
<p>I'm not sure how well "concrete categories" in the literal sense of functors to Type work in lean</p>

<a name="147589536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589536" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589536">Mario Carneiro (Nov 13 2018 at 13:09)</a>:</h4>
<p>Scott can say better than me</p>

<a name="147589604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589604">Harry Gindi (Nov 13 2018 at 13:10)</a>:</h4>
<p>the key feature of sheaves and presheaves is exactly that they are set-valued and the sheaf condition says something about sets</p>

<a name="147589691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589691" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589691">Harry Gindi (Nov 13 2018 at 13:12)</a>:</h4>
<p>having a continuous conservative functor to sets is always satisfied when the category is monadic over sets</p>

<a name="147589726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589726" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589726">Kevin Buzzard (Nov 13 2018 at 13:13)</a>:</h4>
<p>In the perfectoid project we need sheaves of topological rings</p>

<a name="147589741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589741" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589741">Harry Gindi (Nov 13 2018 at 13:13)</a>:</h4>
<p>hmm, how are those even defined?</p>

<a name="147589793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589793">Harry Gindi (Nov 13 2018 at 13:14)</a>:</h4>
<p>that was exactly the example Scott said would be problematic (topological groups)</p>

<a name="147589800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589800" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589800">Kevin Buzzard (Nov 13 2018 at 13:14)</a>:</h4>
<p>well we only need them on topological spaces, so I think there are no technical issues...</p>

<a name="147589829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589829" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589829">Harry Gindi (Nov 13 2018 at 13:15)</a>:</h4>
<p>Are they pro-rings like completions?</p>

<a name="147589933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589933" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589933">Harry Gindi (Nov 13 2018 at 13:17)</a>:</h4>
<p>Can I see where these are defined in ordinary mathematical language?</p>

<a name="147589942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147589942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147589942">Kevin Buzzard (Nov 13 2018 at 13:17)</a>:</h4>
<p>Actually there might be some topological issue. Wait a minute, I'll dig up a reference</p>

<a name="147590004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590004">Kevin Buzzard (Nov 13 2018 at 13:18)</a>:</h4>
<p><a href="https://www2.math.uni-paderborn.de/fileadmin/Mathematik/People/wedhorn/Lehre/AdicSpaces.pdf" target="_blank" title="https://www2.math.uni-paderborn.de/fileadmin/Mathematik/People/wedhorn/Lehre/AdicSpaces.pdf">https://www2.math.uni-paderborn.de/fileadmin/Mathematik/People/wedhorn/Lehre/AdicSpaces.pdf</a>  remark 8.19 on p80</p>

<a name="147590030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590030">Kevin Buzzard (Nov 13 2018 at 13:19)</a>:</h4>
<p>The map from F(U) to the stuff in prod_i F(U_i) which agree on overlaps needs to be a homeo rather than just continuous</p>

<a name="147590087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590087">Kevin Buzzard (Nov 13 2018 at 13:20)</a>:</h4>
<p>I think that this is probably exactly the sheaf axiom for top rings</p>

<a name="147590088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590088" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590088">Harry Gindi (Nov 13 2018 at 13:20)</a>:</h4>
<p>Yeah, I think you could get away with this because they're adic rings</p>

<a name="147590092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590092" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590092">Kevin Buzzard (Nov 13 2018 at 13:20)</a>:</h4>
<p>I am not sure this has anything to do with it</p>

<a name="147590112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590112" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590112">Kevin Buzzard (Nov 13 2018 at 13:21)</a>:</h4>
<p>I think that the point is that to check that a presheaf of top rings is a sheaf, it does not suffice to check that the underlying presheaf of rings is a sheaf</p>

<a name="147590123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590123" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590123">Kevin Buzzard (Nov 13 2018 at 13:21)</a>:</h4>
<p>there is epsilon more to it than this.</p>

<a name="147590125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590125" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590125">Harry Gindi (Nov 13 2018 at 13:21)</a>:</h4>
<p>well, continuous maps between adic rings are the natural transformations between pro-objects</p>

<a name="147590130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590130" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590130">Kevin Buzzard (Nov 13 2018 at 13:22)</a>:</h4>
<p>These rings are not adic rings in general</p>

<a name="147590170"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590170" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590170">Harry Gindi (Nov 13 2018 at 13:22)</a>:</h4>
<p>ah</p>

<a name="147590189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590189" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590189">Kevin Buzzard (Nov 13 2018 at 13:22)</a>:</h4>
<p>They are what used to be called "f-adic", which is _not_ "adic + ...", it's "has a subring which is adic + ..."</p>

<a name="147590197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590197" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590197">Harry Gindi (Nov 13 2018 at 13:22)</a>:</h4>
<p>mhm</p>

<a name="147590202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590202">Kevin Buzzard (Nov 13 2018 at 13:23)</a>:</h4>
<p>They're now called Huber rings</p>

<a name="147590220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590220" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590220">Kevin Buzzard (Nov 13 2018 at 13:23)</a>:</h4>
<p>(terminology due to Scholze)</p>

<a name="147590238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590238">Mario Carneiro (Nov 13 2018 at 13:23)</a>:</h4>
<p>When I said concrete categories in the literal sense I was comparing to categories that are built on actual sets and functions</p>

<a name="147590242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590242" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590242">Harry Gindi (Nov 13 2018 at 13:23)</a>:</h4>
<p>yeah, this looks like a special situation that isn't usually covered in the classical theory, I think</p>

<a name="147590282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590282" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590282">Mario Carneiro (Nov 13 2018 at 13:24)</a>:</h4>
<p>in which case the forgetful functor is implicit</p>

<a name="147590317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590317">Mario Carneiro (Nov 13 2018 at 13:24)</a>:</h4>
<p>there is quite a lot you can do with concrete categories built like this</p>

<a name="147590355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590355">Harry Gindi (Nov 13 2018 at 13:25)</a>:</h4>
<p>in that case, Kevin, maybe the answer is to do a common generalization that covers the usual situation and the one for perfectoid spaces.</p>

<a name="147590421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590421">Harry Gindi (Nov 13 2018 at 13:26)</a>:</h4>
<p>There are also simplicial sheaves, which have a separate homotopy-theoretic component</p>

<a name="147590456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590456" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590456">Harry Gindi (Nov 13 2018 at 13:27)</a>:</h4>
<p>but that way lies madness</p>

<a name="147590545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147590545" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147590545">Harry Gindi (Nov 13 2018 at 13:29)</a>:</h4>
<p>and you'd end up trying to do everything in this article: <a href="https://ncatlab.org/nlab/show/model+structure+on+simplicial+presheaves#injectiveprojective__localglobal__presheavessheaves" target="_blank" title="https://ncatlab.org/nlab/show/model+structure+on+simplicial+presheaves#injectiveprojective__localglobal__presheavessheaves">https://ncatlab.org/nlab/show/model+structure+on+simplicial+presheaves#injectiveprojective__localglobal__presheavessheaves</a></p>

<a name="147591580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591580">Johan Commelin (Nov 13 2018 at 13:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I hope the following code is parseable</p>
<div class="codehilite"><pre><span></span><span class="n">T</span> <span class="o">:</span> <span class="n">Top</span><span class="o">,</span>
<span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">,</span>
<span class="n">Us</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">,</span>
<span class="n">this</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">),</span> <span class="n">u</span> <span class="err">∈</span> <span class="n">Us</span> <span class="bp">→</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">to_Top</span><span class="bp">.</span><span class="n">obj</span> <span class="o">(</span><span class="n">u</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="err">⟶</span> <span class="n">T</span><span class="o">)</span>
<span class="err">⊢</span> <span class="n">opens</span><span class="bp">.</span><span class="n">to_Top</span><span class="bp">.</span><span class="n">obj</span> <span class="o">(</span><span class="err">⨆</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">u</span> <span class="err">∈</span> <span class="n">Us</span><span class="o">),</span> <span class="n">u</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="err">⟶</span> <span class="n">T</span>
</pre></div>


<p>Do you know if we have any stuff in topology that would help here?</p>

<a name="147591673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591673" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591673">Johan Commelin (Nov 13 2018 at 13:50)</a>:</h4>
<p>What this is saying is: I have a bunch of functions to <code>T</code> defined on <code>u</code>s that cover <code>U</code>. Now I want to build a function <code>U</code> to <code>T</code>.</p>

<a name="147591691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591691" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591691">Johan Commelin (Nov 13 2018 at 13:51)</a>:</h4>
<p>Of course we need that they agree on overlaps. This is hidden in my context, but it looks ugly, so I didn't paste it.</p>

<a name="147591712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591712">Johan Commelin (Nov 13 2018 at 13:51)</a>:</h4>
<p>Ok, so here is a more precise question: how do I check continuity locally?</p>

<a name="147591776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591776" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591776">Mario Carneiro (Nov 13 2018 at 13:52)</a>:</h4>
<p>as with opens, I think you want a covering_family U to be a type</p>

<a name="147591791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591791" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591791">Harry Gindi (Nov 13 2018 at 13:52)</a>:</h4>
<p>Can sieves make life easier?</p>

<a name="147591847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591847">Harry Gindi (Nov 13 2018 at 13:54)</a>:</h4>
<p>because then you might just prove that every covering family determines a sieve</p>

<a name="147591941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591941" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591941">Mario Carneiro (Nov 13 2018 at 13:55)</a>:</h4>
<p>why do sheaf and sieve and stack and site all sound so similar? the alliteration is killing me</p>

<a name="147591998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147591998" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147591998">Johan Commelin (Nov 13 2018 at 13:56)</a>:</h4>
<blockquote>
<p>because then you might just prove that every covering family determines a sieve</p>
</blockquote>
<p>I am already using sieves.</p>

<a name="147592041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592041">Harry Gindi (Nov 13 2018 at 13:57)</a>:</h4>
<p>ah, I see, that's good. Much easier to state the sheaf condition that way!</p>

<a name="147592046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592046" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592046">Johan Commelin (Nov 13 2018 at 13:57)</a>:</h4>
<p>Mario, I was quite happy with <code>covering_family</code> being a set. But maybe it should be a type.</p>

<a name="147592069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592069">Johan Commelin (Nov 13 2018 at 13:57)</a>:</h4>
<blockquote>
<p>ah, I see, that's good. Much easier to state the sheaf condition that way!</p>
</blockquote>
<p>Sure, but now I need to actually prove that something is a sheaf <span class="emoji emoji-1f631" title="scream">:scream:</span></p>

<a name="147592196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592196">Mario Carneiro (Nov 13 2018 at 13:59)</a>:</h4>
<p>that statement parses, but it isn't provable without stuff about compatibility</p>

<a name="147592207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592207" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592207">Harry Gindi (Nov 13 2018 at 13:59)</a>:</h4>
<p>test case: Every representable is a sheaf wrt the topology generated by universal epimorphic families?</p>

<a name="147592302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592302" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592302">Johan Commelin (Nov 13 2018 at 14:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Hence my more precise question...</p>

<a name="147592369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592369" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592369">Johan Commelin (Nov 13 2018 at 14:01)</a>:</h4>
<p><span class="user-mention" data-user-id="137844">@Harry Gindi</span> Indeed. I'm proving that continuous functions <code>X → T</code> form a sheaf on <code>X</code>, for a given <code>T</code>.</p>

<a name="147592388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592388" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592388">Johan Commelin (Nov 13 2018 at 14:01)</a>:</h4>
<p>So it is not as general as your test case.</p>

<a name="147592452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592452" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592452">Harry Gindi (Nov 13 2018 at 14:02)</a>:</h4>
<p>I guess then you'd first have to define universal epimorphic families <span class="emoji emoji-1f61b" title="mischievous">:mischievous:</span></p>

<a name="147592469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592469">Johan Commelin (Nov 13 2018 at 14:03)</a>:</h4>
<p>Feel free to join in <span class="emoji emoji-1f639" title="joy cat">:joy_cat:</span></p>

<a name="147592486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592486">Harry Gindi (Nov 13 2018 at 14:03)</a>:</h4>
<p>Talk is cheap, that's why I do it so often</p>

<a name="147592586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592586">Kenny Lau (Nov 13 2018 at 14:04)</a>:</h4>
<p>let's just define the spectrum of a ring fist</p>

<a name="147592590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592590" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592590">Kenny Lau (Nov 13 2018 at 14:04)</a>:</h4>
<p>(sorry, I'm a more concrete guy)</p>

<a name="147592607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592607">Johan Commelin (Nov 13 2018 at 14:05)</a>:</h4>
<p>I'm working on it Kenny. I'm trying to define ringed spaces.</p>

<a name="147592667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592667">Harry Gindi (Nov 13 2018 at 14:06)</a>:</h4>
<p>Hom_CRing(R, -): Ring-&gt;Set; where's my big novelty check</p>

<a name="147592724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592724" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592724">Johan Commelin (Nov 13 2018 at 14:07)</a>:</h4>
<p>Harry, one of the first things you learn when working with provers is that there are lots of definitions that are math-trivially equivalent. But proving that they are equivalent in Lean is often very hard.</p>

<a name="147592742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592742" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592742">Johan Commelin (Nov 13 2018 at 14:07)</a>:</h4>
<p>I'm quite sure that there is value in defining a functor from <code>Ring^op</code> to <code>LRS</code>.</p>

<a name="147592797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147592797" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147592797">Harry Gindi (Nov 13 2018 at 14:08)</a>:</h4>
<p>I know, I'm being silly. This definition I just gave is meaningless even outside a theorem prover</p>

<a name="147593491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147593491" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147593491">Harry Gindi (Nov 13 2018 at 14:18)</a>:</h4>
<p>Just saw this on MathOverflow, could be a useful guide: <a href="https://rawgit.com/iblech/internal-methods/master/notes.pdf" target="_blank" title="https://rawgit.com/iblech/internal-methods/master/notes.pdf">https://rawgit.com/iblech/internal-methods/master/notes.pdf</a></p>

<a name="147593526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147593526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147593526">Harry Gindi (Nov 13 2018 at 14:18)</a>:</h4>
<p>especially if you decide to go down the internal logic route</p>

<a name="147594050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594050">Reid Barton (Nov 13 2018 at 14:25)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>, not sure how much progress you made on your gluing continuous functions question, but step 1 is to just construct the glued function even as a function, i.e., disregarding the topology of X, and then check that the glued function actually restricts to the original guys</p>

<a name="147594103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594103" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594103">Reid Barton (Nov 13 2018 at 14:26)</a>:</h4>
<p>then step 2 would be to check continuity, possibly you can use <code>continuous_subtype_nhds_cover</code> for this</p>

<a name="147594119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594119">Reid Barton (Nov 13 2018 at 14:26)</a>:</h4>
<p>You might find <a href="https://github.com/rwbarton/lean-homotopy-theory/blob/lean-3.4.1/src/homotopy_theory/topological_spaces/inter_union.lean" target="_blank" title="https://github.com/rwbarton/lean-homotopy-theory/blob/lean-3.4.1/src/homotopy_theory/topological_spaces/inter_union.lean">https://github.com/rwbarton/lean-homotopy-theory/blob/lean-3.4.1/src/homotopy_theory/topological_spaces/inter_union.lean</a> a useful guide though there I was only interested in the case of two (closed) subsets</p>

<a name="147594216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594216" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594216">Johan Commelin (Nov 13 2018 at 14:28)</a>:</h4>
<p>Ok, thanks for the tips.</p>

<a name="147594217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594217" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594217">Reid Barton (Nov 13 2018 at 14:28)</a>:</h4>
<p>Step 1 will require <code>choice</code></p>

<a name="147594225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594225" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594225">Johan Commelin (Nov 13 2018 at 14:28)</a>:</h4>
<p>I'm currently trying to build a function.</p>

<a name="147594238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594238">Johan Commelin (Nov 13 2018 at 14:28)</a>:</h4>
<p>And I haven't come to the point yet where I need choice. But I think I'm close</p>

<a name="147594245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594245" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594245">Patrick Massot (Nov 13 2018 at 14:28)</a>:</h4>
<p>I think this was already discussed here, with a student of Kevin</p>

<a name="147594486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594486">Patrick Massot (Nov 13 2018 at 14:31)</a>:</h4>
<p><a href="#narrow/stream/116395-maths/subject/Topology.20-.20Beginner/near/130051069" title="#narrow/stream/116395-maths/subject/Topology.20-.20Beginner/near/130051069">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/subject/Topology.20-.20Beginner/near/130051069</a></p>

<a name="147594545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594545" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594545">Kevin Buzzard (Nov 13 2018 at 14:32)</a>:</h4>
<p><span class="user-mention" data-user-id="120726">@Luca Gerolla</span>  wanted to define a continuous function on a closed interval [0,1] by glueing continuous functions on [0,1/2] and [1/2,1]</p>

<a name="147594557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594557" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594557">Patrick Massot (Nov 13 2018 at 14:32)</a>:</h4>
<p>exactly</p>

<a name="147594564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594564" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594564">Patrick Massot (Nov 13 2018 at 14:32)</a>:</h4>
<p>hopefully this is what I linked to</p>

<a name="147594583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594583" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594583">Harry Gindi (Nov 13 2018 at 14:32)</a>:</h4>
<p>I can't get that link to work on mobile</p>

<a name="147594681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594681" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594681">Johan Commelin (Nov 13 2018 at 14:34)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="110031">@Patrick Massot</span>, your memory is better than mine.</p>

<a name="147594772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594772">Reid Barton (Nov 13 2018 at 14:35)</a>:</h4>
<p>I realize that maybe it's not very obvious what the module I linked to is doing--it's showing that for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">A_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> closed subsets of a space X, there is a pushout square in Top involving <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub><mo>∩</mo><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A_0 \cap A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∩</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">A_0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub><mo>∪</mo><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A_0 \cup A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∪</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>. For open subsets you would use the other lemma from topology I mentioned, and then it's the same as checking the sheaf condition I guess.</p>

<a name="147594850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594850">Harry Gindi (Nov 13 2018 at 14:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> you have to use AC to construct glued maps?</p>

<a name="147594873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594873">Harry Gindi (Nov 13 2018 at 14:36)</a>:</h4>
<p>that's surprising to me</p>

<a name="147594918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594918">Harry Gindi (Nov 13 2018 at 14:37)</a>:</h4>
<p>or is this "choice" different from the axiom of choice?</p>

<a name="147594921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594921" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594921">Reid Barton (Nov 13 2018 at 14:37)</a>:</h4>
<p>You could construct a glued map on the quotient type (the disjoint union of the subsets) modulo (points with the same image in X) without choice</p>

<a name="147594980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594980">Reid Barton (Nov 13 2018 at 14:38)</a>:</h4>
<p>Ah, it is a bit different from the axiom of choice</p>

<a name="147594988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147594988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147594988">Reid Barton (Nov 13 2018 at 14:38)</a>:</h4>
<p>In Lean, basically, <code>choice</code> = nonconstructive</p>

<a name="147595010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595010" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595010">Harry Gindi (Nov 13 2018 at 14:38)</a>:</h4>
<p>so how do intuitionists glue maps?</p>

<a name="147595116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595116" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595116">Reid Barton (Nov 13 2018 at 14:40)</a>:</h4>
<p>You need <code>choice</code> to go from "for each x there exists a y such that ..." to a function mapping x to the corresponding y, even if you know that the corresponding y is also unique. So in that sense it's not exactly analogous to the axiom of choice in ZFC</p>

<a name="147595178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595178" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595178">Reid Barton (Nov 13 2018 at 14:41)</a>:</h4>
<p>I don't know. I guess you could try to replace "subset of X" by "map to X whose fibers are subsingletons", but I don't know how far you would get with that.</p>

<a name="147595313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595313" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595313">Johan Commelin (Nov 13 2018 at 14:43)</a>:</h4>
<p>I think I want my covers to be defined as <code>U = colimit u \in Us</code>. Then this sort of problems would go away.</p>

<a name="147595319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595319" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595319">Reid Barton (Nov 13 2018 at 14:43)</a>:</h4>
<p>I have this picture in my mind of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub><mo>×</mo><mo>{</mo><mn>0</mn><mo>}</mo><mo>∪</mo><mo>(</mo><msub><mi>A</mi><mn>0</mn></msub><mo>∩</mo><msub><mi>A</mi><mn>1</mn></msub><mo>)</mo><mo>×</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo><mo>∪</mo><msub><mi>A</mi><mn>1</mn></msub><mo>×</mo><mo>{</mo><mn>1</mn><mo>}</mo></mrow><annotation encoding="application/x-tex">A_0 \times \{0\} \cup (A_0 \cap A_1) \times [0, 1] \cup A_1 \times \{1\}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">×</span><span class="mopen">{</span><span class="mord mathrm">0</span><span class="mclose">}</span><span class="mbin">∪</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∩</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mclose">)</span><span class="mbin">×</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mbin">∪</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">×</span><span class="mopen">{</span><span class="mord mathrm">1</span><span class="mclose">}</span></span></span></span> projecting to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub><mo>∪</mo><msub><mi>A</mi><mn>1</mn></msub><mo>⊂</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">A_0 \cup A_1 \subset X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∪</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mrel">⊂</span><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>, and not admitting a continuous section over <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mn>0</mn></msub><mo>∪</mo><msub><mi>A</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">A_0 \cup A_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∪</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>. Don't know if it means anything though.</p>

<a name="147595430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595430">Mario Carneiro (Nov 13 2018 at 14:44)</a>:</h4>
<p>I think I gave a proof that gluing in arbitrary topological spaces requires choice using roughly that example</p>

<a name="147595436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595436" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595436">Reid Barton (Nov 13 2018 at 14:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> had a nice example arguing that you really need something noncomputable to glue functions which is ... right.</p>

<a name="147595494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595494">Mario Carneiro (Nov 13 2018 at 14:45)</a>:</h4>
<p>where by "choice" I mean unique choice</p>

<a name="147595558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595558" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595558">Mario Carneiro (Nov 13 2018 at 14:46)</a>:</h4>
<p>lean doesn't really distinguish between AC, unique choice and LEM</p>

<a name="147595575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595575">Mario Carneiro (Nov 13 2018 at 14:46)</a>:</h4>
<p>they all follow from the same axiom</p>

<a name="147595737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147595737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147595737">Harry Gindi (Nov 13 2018 at 14:49)</a>:</h4>
<p>Can you glue maps of locales without choice?</p>

<a name="147596063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596063">Ramon Fernandez Mir (Nov 13 2018 at 14:54)</a>:</h4>
<p>I've actually been looking into it. It's in the sheaf branch on the community mathlib.</p>

<a name="147596097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596097">Johan Commelin (Nov 13 2018 at 14:55)</a>:</h4>
<p>So now I have this goal:</p>
<div class="codehilite"><pre><span></span><span class="o">(</span><span class="err">⨆</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">Us</span><span class="o">}),</span> <span class="o">(</span><span class="n">u</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="bp">=</span> <span class="err">⨆</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">u</span> <span class="err">∈</span> <span class="n">Us</span><span class="o">),</span> <span class="n">u</span><span class="bp">.</span><span class="n">left</span>
</pre></div>


<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> will say: "I told you that <code>covering_family U</code> should be a type." But it's not (at the moment). How do I solve silly goals like this?</p>

<a name="147596117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596117" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596117">Johan Commelin (Nov 13 2018 at 14:55)</a>:</h4>
<p><span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> Good to see you!</p>

<a name="147596119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596119">Mario Carneiro (Nov 13 2018 at 14:55)</a>:</h4>
<p>There is a rewrite rule for this</p>

<a name="147596132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596132">Johan Commelin (Nov 13 2018 at 14:55)</a>:</h4>
<p>I want <code>rewrite_search</code>...</p>

<a name="147596236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596236" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596236">Mario Carneiro (Nov 13 2018 at 14:57)</a>:</h4>
<p><code>supr_subtype</code></p>

<a name="147596268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596268">Luca Gerolla (Nov 13 2018 at 14:57)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="120726">@Luca Gerolla</span>  wanted to define a continuous function on a closed interval [0,1] by glueing continuous functions on [0,1/2] and [1/2,1]</p>
</blockquote>
<p>Indeed, I was dealing with continuous functions on two closed sets <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mo separator="true">,</mo><mi>U</mi></mrow><annotation encoding="application/x-tex"> V, U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> (where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi><mo separator="true">,</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">U, V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span> cover the overall domain <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>) agreeing on their intersection <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi><mo>∩</mo><mi>V</mi></mrow><annotation encoding="application/x-tex"> U \cap  V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mbin">∩</span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span>  and I needed to construct a continuous function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi><mo>→</mo><mi>Y</mi></mrow><annotation encoding="application/x-tex"> X \to Y </annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mrel">→</span><span class="mord mathit" style="margin-right:0.22222em;">Y</span></span></span></span>. The code (mainly done by Mario and Kevin) is at <a href="https://github.com/ImperialCollegeLondon/xena-UROP-2018/blob/master/src/Topology/Material/pasting_lemma.lean" target="_blank" title="https://github.com/ImperialCollegeLondon/xena-UROP-2018/blob/master/src/Topology/Material/pasting_lemma.lean">https://github.com/ImperialCollegeLondon/xena-UROP-2018/blob/master/src/Topology/Material/pasting_lemma.lean</a>. <br>
Although dealing with a general covering I don't know if it can be of any help.</p>

<a name="147596340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596340" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596340">Kenny Lau (Nov 13 2018 at 14:58)</a>:</h4>
<p><span class="user-mention" data-user-id="120726">@Luca Gerolla</span> wrong thread?</p>

<a name="147596355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596355">Mario Carneiro (Nov 13 2018 at 14:58)</a>:</h4>
<p>I don't think so</p>

<a name="147596373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596373">Kenny Lau (Nov 13 2018 at 14:59)</a>:</h4>
<p>what's Luca doing on an nlab thread...</p>

<a name="147596381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596381">Johan Commelin (Nov 13 2018 at 14:59)</a>:</h4>
<p>He's on a thread about gluing functions.</p>

<a name="147596382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596382" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596382">Kenny Lau (Nov 13 2018 at 14:59)</a>:</h4>
<p><code>\cap</code> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>∩</mo></mrow><annotation encoding="application/x-tex">\cap</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.55556em;"></span><span class="strut bottom" style="height:0.55556em;vertical-align:0em;"></span><span class="base"><span class="mord">∩</span></span></span></span></p>

<a name="147596387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596387" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596387">Johan Commelin (Nov 13 2018 at 14:59)</a>:</h4>
<p>His post is about gluing functions.</p>

<a name="147596829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147596829" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147596829">Luca Gerolla (Nov 13 2018 at 15:05)</a>:</h4>
<p>Also continous_if (from mathlib - topology.continuity) turned out  very useful when I had just and ite function. <br>
Look forward to seeing the solution to this more general pasting :)</p>

<a name="147598973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147598973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147598973">Johan Commelin (Nov 13 2018 at 15:39)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Here is something that I find a bit annoying to do. I'm trying to prove that the following functor preserves colimits:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">to_Top</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span> <span class="err">⥤</span> <span class="n">Top</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span><span class="o">,</span>
          <span class="o">{</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">U</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
            <span class="n">str</span> <span class="o">:=</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">topological_space</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">i</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="n">x</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="o">(</span><span class="n">plift</span><span class="bp">.</span><span class="n">down</span> <span class="o">(</span><span class="n">ulift</span><span class="bp">.</span><span class="n">down</span> <span class="n">i</span><span class="o">))</span> <span class="n">x</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="o">(</span><span class="n">embedding</span><span class="bp">.</span><span class="n">continuous_iff</span> <span class="n">embedding_subtype_val</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">continuous_subtype_val</span> <span class="bp">⟩</span> <span class="o">}</span>
</pre></div>


<p>Here is what I have so far:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">to_Top</span><span class="bp">.</span><span class="n">preserves_colimits</span> <span class="o">:</span> <span class="n">preserves_colimits</span> <span class="o">(</span><span class="bp">@</span><span class="n">to_Top</span> <span class="n">X</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">preserves</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">J</span> <span class="bp">_</span> <span class="n">K</span> <span class="n">c</span> <span class="n">hc</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">desc</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">s</span><span class="o">,</span> <span class="bp">_</span> <span class="o">}</span> <span class="o">}</span>
</pre></div>


<p>The local context is now:</p>
<div class="codehilite"><pre><span></span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">X</span><span class="o">,</span>
<span class="n">J</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">J</span><span class="o">,</span>
<span class="n">K</span> <span class="o">:</span> <span class="n">J</span> <span class="err">⥤</span> <span class="n">opens</span> <span class="n">X</span><span class="o">,</span>
<span class="n">c</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">cocone</span> <span class="n">K</span><span class="o">,</span>
<span class="n">hc</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">is_colimit</span> <span class="n">c</span><span class="o">,</span>
<span class="n">s</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">cocone</span> <span class="o">(</span><span class="n">K</span> <span class="err">⋙</span> <span class="n">to_Top</span><span class="o">)</span>
<span class="err">⊢</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">map_cocone</span> <span class="n">to_Top</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">X</span> <span class="err">⟶</span> <span class="n">s</span><span class="bp">.</span><span class="n">X</span>
</pre></div>


<p>The annoying thing is the pair <code>c, hc</code>. I would much rather work with <code>hc : has_colimit K</code> and <code>c : colimit K</code>. Because then I can use facts about how this colimit is defined. Of course I can build a unique isomorphism between the <code>c</code> that I got from Lean and the one that I'm interested in. But I wonder if it would make sense to change the setup a bit...</p>

<a name="147599173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599173" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599173">Johan Commelin (Nov 13 2018 at 15:42)</a>:</h4>
<p>I've pushed all that I have so far. Now I need to start packing to catch a train.</p>

<a name="147599192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599192" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599192">Johan Commelin (Nov 13 2018 at 15:42)</a>:</h4>
<p>If anyone has good ideas, or wants to refactor this, please go ahead!</p>

<a name="147599215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599215" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599215">Johan Commelin (Nov 13 2018 at 15:43)</a>:</h4>
<p>I'm just trying to push this category stuff to the limit (no pun intended)</p>

<a name="147599555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599555" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599555">Reid Barton (Nov 13 2018 at 15:47)</a>:</h4>
<p>I think we can just add a lemma for that.<br>
You're saying you want to prove: if F : C -&gt; D and C already <code>has_colimits</code>, then to prove F preserves colimits it suffices to consider the ones provided by the <code>has_colimits</code> instance.</p>

<a name="147599626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599626" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599626">Johan Commelin (Nov 13 2018 at 15:48)</a>:</h4>
<p>Yes, but why not just always condider the one provided by <code>has_colimit K</code>, where <code>K</code> is a diagram.</p>

<a name="147599634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599634" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599634">Patrick Massot (Nov 13 2018 at 15:48)</a>:</h4>
<blockquote>
<p>I'm just trying to push this category stuff to the limit (no pun intended)</p>
</blockquote>
<p>When we'll have that <code>to_dual</code> tactic, you'll be able to pull this category stuff to the colimit without any extra effort!</p>

<a name="147599670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599670" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599670">Reid Barton (Nov 13 2018 at 15:49)</a>:</h4>
<p>Because the concept of preserving colimits doesn't depend on a choice of colimits</p>

<a name="147599690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599690" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599690">Johan Commelin (Nov 13 2018 at 15:49)</a>:</h4>
<p>I see... you're probably right. I don't yet fully grasp the details of the API</p>

<a name="147599771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147599771" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147599771">Johan Commelin (Nov 13 2018 at 15:50)</a>:</h4>
<p>But your suggested lemma would also fix this problem.</p>

<a name="147601888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147601888" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147601888">Kevin Buzzard (Nov 13 2018 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> <span class="user-mention" data-user-id="110064">@Kenny Lau</span> -- <span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> asks me exactly what you are going to be doing regarding Spec of a ring. Ramon is supposed to be completely refactoring the scheme project as part of his MSc thesis; I got him to look at locally ringed spaces but now these are done modulo the assertion that the category of rings has all colimits. Then Kenny mentioned Spec -- I think it would just be less nervy for us if we knew exactly what you guys were planning on doing and what Ramon can do (he has written thousands of lines of Coq code but is new to Lean). Currently we need that colimits exist in the category of commutative rings, and that the spectrum of a ring is a locally ringed space (which of course is a lot of work, even though it's in some sense done already). The first step towards this is that the spectrum of a ring has a presheaf of rings on the basis of open sets <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mo>(</mo><mi>f</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">D(f)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span></span>. Shall I tell him to do this or will someone else do it by the weekend? It would be good if we could work together on this (although of course there is plenty plenty to do -- e.g. this Gamma Spec adjointness is a goal I have in mind for Ramon, something Johan suggested months ago -- and products of schemes is another thing).</p>

<a name="147602049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147602049" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147602049">Kevin Buzzard (Nov 13 2018 at 16:24)</a>:</h4>
<p>Of course I know all of this is already done in the schemes project -- the point is that we want to do it as a test of the category theory stuff; in the past we did it all "by hand".</p>

<a name="147604152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147604152" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147604152">Kevin Buzzard (Nov 13 2018 at 16:54)</a>:</h4>
<p>I think I know how to prove that colimits exist in the category of commutative rings -- can I get Ramon to do this or <span class="user-mention" data-user-id="110064">@Kenny Lau</span> are you likely do just randomly do this at some point in the next few days?</p>

<a name="147604211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147604211" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147604211">Kevin Buzzard (Nov 13 2018 at 16:55)</a>:</h4>
<p>It will be quite a good stress test of Johannes' multivariable polynomial work I think.</p>

<a name="147611121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611121" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611121">Johan Commelin (Nov 13 2018 at 17:37)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Yes, collaboration is good. I have no intention to "mow away the grass" before Ramon's feet.<br>
Here is a question for you: do you intend to make things mathlib-ready? Is the endgoal a PR to mathlib?</p>
<p>My goal is to get a theory of sheaves that is ready for the perfectoid project.</p>

<a name="147611202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611202">Johan Commelin (Nov 13 2018 at 17:38)</a>:</h4>
<p>Concerning colimits in CommRing: do all of them exist? Or only the directed ones?</p>

<a name="147611234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611234">Kevin Buzzard (Nov 13 2018 at 17:38)</a>:</h4>
<p>I convinced myself this afternoon that they all existed</p>

<a name="147611284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611284" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611284">Johan Commelin (Nov 13 2018 at 17:39)</a>:</h4>
<p>Sheaves of rings seems to be a bit of an issue. I'm not yet sure how to define them. Once we have those, I'll leave it up to Ramon to define LRS. I will not touch <code>Spec</code> or anything close to it (-;</p>

<a name="147611297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611297" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611297">Reid Barton (Nov 13 2018 at 17:39)</a>:</h4>
<p>They do all exist</p>

<a name="147611305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611305">Johan Commelin (Nov 13 2018 at 17:39)</a>:</h4>
<p>I do intend to define stalks. So I might get close to LRS...</p>

<a name="147611313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611313" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611313">Kevin Buzzard (Nov 13 2018 at 17:39)</a>:</h4>
<p>via some big standard universal construction -- given a diagram in CommRing, let T0 be the polynomial ring over Z with variables the disjoint union of all the rings in the diagram, and then quotient out by the relations making all of the canonical maps ring homs</p>

<a name="147611342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611342">Johan Commelin (Nov 13 2018 at 17:40)</a>:</h4>
<p>I would not mind at all if Ramon works on a branch of community mathlib and regularly pull and pushes to the <code>sheaf</code> branch.</p>

<a name="147611388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611388" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611388">Kevin Buzzard (Nov 13 2018 at 17:40)</a>:</h4>
<p>The "bad" news is that this all seems to be some special case of some big theory due to Lawvere and we could spend forever formalising that instead</p>

<a name="147611425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611425">Kevin Buzzard (Nov 13 2018 at 17:40)</a>:</h4>
<p>(existence of limits and colimits in some big gneerality for some algebraic categories or something)</p>

<a name="147611521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611521">Johan Commelin (Nov 13 2018 at 17:42)</a>:</h4>
<p>Right. So we just do rings by hand first. Like you did schemes by hand first. This seems to be what Mario would tell us to do anyway.</p>

<a name="147611540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611540">Kevin Buzzard (Nov 13 2018 at 17:42)</a>:</h4>
<p>Right -- so <span class="user-mention" data-user-id="110064">@Kenny Lau</span> are you happy if <span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> proves existence of colimits in the category of commutative rings?</p>

<a name="147611550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611550" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611550">Kevin Buzzard (Nov 13 2018 at 17:42)</a>:</h4>
<p>In a relatively "hands-on" way, not using Lawvere anything</p>

<a name="147611586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611586">Johan Commelin (Nov 13 2018 at 17:43)</a>:</h4>
<p>Be aware that Scott already has some general machinery in this direction. I guess you only need coproducts and coequalisers.</p>

<a name="147611712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611712">Kevin Buzzard (Nov 13 2018 at 17:45)</a>:</h4>
<p>I am not 100% sure whether this makes life any easier in this case</p>

<a name="147611817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611817" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611817">Kevin Buzzard (Nov 13 2018 at 17:46)</a>:</h4>
<p>in the sense that now instead of making one gigantic commutative polynomial ring in a huge set of variables and quotienting out by an ideal generated by terms of two types and then proving something about it, you'll have to build two such rings and prove something about each of them.</p>

<a name="147611967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147611967" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147611967">Johan Commelin (Nov 13 2018 at 17:49)</a>:</h4>
<p>It would be useful to know that coproducts are defeq to tensor products, I assume...</p>

<a name="147612367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147612367" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147612367">Kevin Buzzard (Nov 13 2018 at 17:55)</a>:</h4>
<p>funny isn't it. For products and subobjects you feel like you've made progress. But colimits are quotients so it's always going to be a pain I think. I don't even really understand what the coproduct of an arbitrary set of rings looks like -- it seems to be some sort of direct limit of finite tensor products -- but of course we haven't built direct limits yet so there's a danger of going round in circles here.</p>

<a name="147612491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147612491" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147612491">Kevin Buzzard (Nov 13 2018 at 17:57)</a>:</h4>
<blockquote>
<p>Here is a question for you: do you intend to make things mathlib-ready? Is the endgoal a PR to mathlib?</p>
</blockquote>
<p>I don't even know if Mario would be interested in hosting schemes (and I've not asked) -- my goal is to take the crappy code which I wrote so I could learn how to write Lean code, and replace it with code which is sufficiently respectable to get a publication. I've not thought about mathlib at all.</p>

<a name="147613037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613037">Johan Commelin (Nov 13 2018 at 18:05)</a>:</h4>
<p>I think there are two options:</p>
<ul>
<li>either stuff like this goes into mathlib,</li>
<li>or the Lean community comes up with a good strategy to have decentralised libraries that work together nicely as dependencies of other projects.</li>
</ul>

<a name="147613059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613059" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613059">Mario Carneiro (Nov 13 2018 at 18:06)</a>:</h4>
<p>The construction you sketched is clearly a composition of two constructions, why not formalize that?</p>

<a name="147613110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613110" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613110">Johan Commelin (Nov 13 2018 at 18:06)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you want schemes in mathlib?</p>

<a name="147613114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613114" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613114">Mario Carneiro (Nov 13 2018 at 18:06)</a>:</h4>
<p>I want polished code in mathlib</p>

<a name="147613127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613127" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613127">Johan Commelin (Nov 13 2018 at 18:06)</a>:</h4>
<p>Do you want polished schemes in mathlib?</p>

<a name="147613141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613141" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613141">Mario Carneiro (Nov 13 2018 at 18:07)</a>:</h4>
<p>sure, if that interests yous</p>

<a name="147613160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613160">Mario Carneiro (Nov 13 2018 at 18:07)</a>:</h4>
<p>there seem to be a lot of intermediate steps though</p>

<a name="147613162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613162">Johan Commelin (Nov 13 2018 at 18:07)</a>:</h4>
<p>It interests mes and about 65% of all Field medalists.</p>

<a name="147613239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613239">Johan Commelin (Nov 13 2018 at 18:09)</a>:</h4>
<p>There's a lot of intermediate steps because I'm trying to write reusable code.</p>

<a name="147613596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147613596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147613596">Reid Barton (Nov 13 2018 at 18:14)</a>:</h4>
<p>I'm not sure which construction Mario is referring to</p>

<a name="147615817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147615817" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147615817">Mario Carneiro (Nov 13 2018 at 18:44)</a>:</h4>
<blockquote>
<p>via some big standard universal construction -- given a diagram in CommRing, let T0 be the polynomial ring over Z with variables the disjoint union of all the rings in the diagram, and then quotient out by the relations making all of the canonical maps ring homs</p>
</blockquote>

<a name="147615855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147615855" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147615855">Mario Carneiro (Nov 13 2018 at 18:45)</a>:</h4>
<p>we already have the first part, and the second part should generalize to "given a bunch of functions(?) make them all ring homs"</p>

<a name="147624123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147624123" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147624123">Scott Morrison (Nov 13 2018 at 20:47)</a>:</h4>
<p>I think, unfortunately, that eventually we will want to do all the varieties of colimits in CommRing separately.</p>

<a name="147624194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147624194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147624194">Scott Morrison (Nov 13 2018 at 20:48)</a>:</h4>
<p>We should do the general colimit, we should also do the filtered colimit (which is much easier), we should do coproducts, we should do binary coproducts. General nonsense says you don't need to prove any comparison theorems relating these, happily.</p>

<a name="147624227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147624227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147624227">Scott Morrison (Nov 13 2018 at 20:49)</a>:</h4>
<p>Later, various bits of general machinery about algebraic categories will give us the filtered colimits "for free"</p>

<a name="147624240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147624240" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147624240">Scott Morrison (Nov 13 2018 at 20:49)</a>:</h4>
<p>but someone should do the construction in CommRing first as a warmup.</p>

<a name="147624259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147624259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147624259">Scott Morrison (Nov 13 2018 at 20:49)</a>:</h4>
<p>I don't know the Lawvere stuff; maybe later there's some generality that gives us all colimits in CommRing too?</p>

<a name="147625299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147625299" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147625299">Kevin Buzzard (Nov 13 2018 at 21:05)</a>:</h4>
<p>Ok so Ramon and I will take on the task of general colimits. I'm a bit unsure about whether working in this generality will actually cause problems when we want to prove that the stalks for an affine scheme are local, but let's wait and see!</p>

<a name="147629404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147629404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147629404">Scott Morrison (Nov 13 2018 at 22:12)</a>:</h4>
<p>Are you sure you don't want to do filtered colimits first, <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>? They are both easier to construct, and more useful! (Because they're all that's needed for stalks, and will make arguments about stalks easier.)</p>

<a name="147630367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630367" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630367">Kevin Buzzard (Nov 13 2018 at 22:31)</a>:</h4>
<p>The way Johan or you had set up locally ringed spaces relied on the fact that CommRing had colimits</p>

<a name="147630421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630421">Kevin Buzzard (Nov 13 2018 at 22:32)</a>:</h4>
<p>I don't know what a filtered colimit is. I know what a directed set is. Is it sort-of the same thing?</p>

<a name="147630462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630462" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630462">Kevin Buzzard (Nov 13 2018 at 22:33)</a>:</h4>
<p>aah I now know that a filtered colimit is a categorification of a directed set</p>

<a name="147630538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630538">Kevin Buzzard (Nov 13 2018 at 22:34)</a>:</h4>
<p>So I guess I don't know where to stop here. Why not just do colimits over a directed partial order? They are both easier to construct, and more useful! (Because they're all that's needed for stalks, and will make arguments about stalks easier.)</p>

<a name="147630555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630555" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630555">Kevin Buzzard (Nov 13 2018 at 22:35)</a>:</h4>
<p>And Kenny did them already :P</p>

<a name="147630640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630640" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630640">Reid Barton (Nov 13 2018 at 22:36)</a>:</h4>
<p>Well, filtered is the right level of generality for the fact that you can compute the colimit in Set</p>

<a name="147630661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630661" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630661">Kevin Buzzard (Nov 13 2018 at 22:37)</a>:</h4>
<p>but colimits in Set are completely different to colimits in CommRing</p>

<a name="147630669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630669" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630669">Kevin Buzzard (Nov 13 2018 at 22:37)</a>:</h4>
<p>or am I misunderstanding? (presumably)</p>

<a name="147630680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630680">Reid Barton (Nov 13 2018 at 22:37)</a>:</h4>
<p>General ones are, but filtered ones are not</p>

<a name="147630685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630685" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630685">Kevin Buzzard (Nov 13 2018 at 22:38)</a>:</h4>
<p>Oh I see!</p>

<a name="147630803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630803">Scott Morrison (Nov 13 2018 at 22:40)</a>:</h4>
<p>I will add filtered colimits (in the simplest sense, not Reid's kappa-filtered ones) to the limits branch shortly. (Just the definition!)</p>

<a name="147630858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630858" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630858">Scott Morrison (Nov 13 2018 at 22:40)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>, Johannes asked me to rebase the limits branch; prepare for trouble. :-)</p>

<a name="147630866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630866" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630866">Kevin Buzzard (Nov 13 2018 at 22:40)</a>:</h4>
<p>So <span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> would be interested in this. People seem to be suggesting that the definition here <a href="https://github.com/semorrison/lean-category-theory/blob/master/src/category_theory/presheaves/locally_ringed.lean" target="_blank" title="https://github.com/semorrison/lean-category-theory/blob/master/src/category_theory/presheaves/locally_ringed.lean">https://github.com/semorrison/lean-category-theory/blob/master/src/category_theory/presheaves/locally_ringed.lean</a> which uses arbitrary colimits is not wise?</p>

<a name="147630872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630872" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630872">Scott Morrison (Nov 13 2018 at 22:40)</a>:</h4>
<p>Yes</p>

<a name="147630878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630878" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630878">Scott Morrison (Nov 13 2018 at 22:40)</a>:</h4>
<p>That isn't wise. :-)</p>

<a name="147630892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630892">Kevin Buzzard (Nov 13 2018 at 22:41)</a>:</h4>
<p>and instead of <code>stalk_at</code> one should use something else?</p>

<a name="147630907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630907">Scott Morrison (Nov 13 2018 at 22:41)</a>:</h4>
<p>I think <code>stalk_at</code> will be exactly the same</p>

<a name="147630960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630960">Scott Morrison (Nov 13 2018 at 22:42)</a>:</h4>
<p>We'll just change the typeclass provided, from <code>has_colimits</code> to <code>has_filtered_colimits</code></p>

<a name="147630966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630966" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630966">Kevin Buzzard (Nov 13 2018 at 22:42)</a>:</h4>
<p>I see. And that doesn't break anything else?</p>

<a name="147630973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630973">Kevin Buzzard (Nov 13 2018 at 22:42)</a>:</h4>
<p>When teaching is finished I'm going to be cloning this repo finally</p>

<a name="147630980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630980">Scott Morrison (Nov 13 2018 at 22:42)</a>:</h4>
<p>Magic will then notice that the category of open sets containing x is filtered, and so use the <code>has_filtered_colimits</code> instance,</p>

<a name="147630984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147630984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147630984">Kevin Buzzard (Nov 13 2018 at 22:42)</a>:</h4>
<p>at the minute cloning it would lead me astray</p>

<a name="147631004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631004">Scott Morrison (Nov 13 2018 at 22:43)</a>:</h4>
<p>which will provide an nice construction of the colimit (as a quotient of a disjoint union, just like in Set), rather than the huge one in terms of tensor products.</p>

<a name="147631007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631007">Kevin Buzzard (Nov 13 2018 at 22:43)</a>:</h4>
<p>Would magic work for sheaves on a basis? For sheaves on a site?</p>

<a name="147631014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631014">Scott Morrison (Nov 13 2018 at 22:43)</a>:</h4>
<p>That I don't know.</p>

<a name="147631032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631032" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631032">Kevin Buzzard (Nov 13 2018 at 22:43)</a>:</h4>
<p>I had never seen the construction of a colimit in CommRing until today, when I figured it out for myself. I did not use tensor products. What trick did I miss?</p>

<a name="147631053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631053" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631053">Kevin Buzzard (Nov 13 2018 at 22:43)</a>:</h4>
<p>I just made a polynomial ring over Z with variables the disjoint union of all the rings in the diagram</p>

<a name="147631056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631056" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631056">Kevin Buzzard (Nov 13 2018 at 22:44)</a>:</h4>
<p>and then quotiented</p>

<a name="147631112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631112" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631112">Kevin Buzzard (Nov 13 2018 at 22:44)</a>:</h4>
<p>I understand that for two rings a coproduct is the tensor product</p>

<a name="147631119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631119">Kevin Buzzard (Nov 13 2018 at 22:44)</a>:</h4>
<p>but I couldn't see how this generalised to infinitely many rings</p>

<a name="147631132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631132">Kevin Buzzard (Nov 13 2018 at 22:45)</a>:</h4>
<p>it seemed to be a direct limit of tensor produts, but to make direct limits you  want to take coproducts again</p>

<a name="147631157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631157" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631157">Scott Morrison (Nov 13 2018 at 22:45)</a>:</h4>
<p>oh, okay, maybe I didn't think very hard about the infinite diagram case, either :-)</p>

<a name="147631173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631173" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631173">Scott Morrison (Nov 13 2018 at 22:45)</a>:</h4>
<p>(I had never thought about any of this (nor knew what a site was, etc) until Lean came along. :-)</p>

<a name="147631237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631237" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631237">Reid Barton (Nov 13 2018 at 22:46)</a>:</h4>
<p>Well... it's the filtered colimit of all the ways to take a coproduct of finitely many of the rings</p>

<a name="147631238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631238">Reid Barton (Nov 13 2018 at 22:46)</a>:</h4>
<p>and filtered colimits are easy</p>

<a name="147631245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631245" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631245">Kevin Buzzard (Nov 13 2018 at 22:46)</a>:</h4>
<p>Is there a general story?</p>

<a name="147631246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631246" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631246">Reid Barton (Nov 13 2018 at 22:46)</a>:</h4>
<p>That said, the construction you gave is the simplest one and it has essentially nothing to do with rings in particular</p>

<a name="147631256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631256">Kevin Buzzard (Nov 13 2018 at 22:47)</a>:</h4>
<p>Reducing a general colimit to a filtered colimit?</p>

<a name="147631348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631348">Kevin Buzzard (Nov 13 2018 at 22:49)</a>:</h4>
<p>I still don't know whether we should just stick to filtered (0,1)-categories</p>

<a name="147631363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631363">Kevin Buzzard (Nov 13 2018 at 22:49)</a>:</h4>
<p>i.e. directed sets (I should stop looking at nlab)</p>

<a name="147631372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631372" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631372">Kevin Buzzard (Nov 13 2018 at 22:49)</a>:</h4>
<p>Oh, Reid's argument perhaps resolves this -- if it works over set then take it</p>

<a name="147631433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631433">Reid Barton (Nov 13 2018 at 22:50)</a>:</h4>
<p>Directed colimits will be somewhat easier notationally and you don't need them unless you want stalks for some site which is not itself a poset. I think.</p>

<a name="147631440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631440" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631440">Kevin Buzzard (Nov 13 2018 at 22:50)</a>:</h4>
<p>I think the etale site is the simplest example of this that I know</p>

<a name="147631441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631441" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631441">Reid Barton (Nov 13 2018 at 22:50)</a>:</h4>
<p>Er, don't need filtered colimits unless ..., of course.</p>

<a name="147631458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631458">Kevin Buzzard (Nov 13 2018 at 22:51)</a>:</h4>
<p>and next year when we're doing etale cohomology we'll need etale sites</p>

<a name="147631469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631469">Reid Barton (Nov 13 2018 at 22:51)</a>:</h4>
<p>I think it is safe to assume that by the time we want to do etale cohomology we will have filtered colimits of rings</p>

<a name="147631531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147631531" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147631531">Reid Barton (Nov 13 2018 at 22:52)</a>:</h4>
<p>You can actually build filtered colimits from directed ones, so it doesn't lose any great generality to work with directed ones for some purposes</p>

<a name="147633659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147633659" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147633659">Kevin Buzzard (Nov 13 2018 at 23:34)</a>:</h4>
<blockquote>
<p>Magic will then notice that the category of open sets containing x is filtered, and so use the <code>has_filtered_colimits</code> instance,</p>
</blockquote>
<p>There's something I can't get to add up here. Say there's a <code>has_colimits</code> instance and also a simpler <code>has_filtered_colimits</code> instance. Now let's say I'm trying to take a colimit and it happens to be filtered. If Lean uses the <code>has_colimits</code> instance then the colimit will be constructed in one way, but if Magic notices that the colimit is filtered then it could construct it using the simpler filtered colimit construction. The two constructions will give canonically isomorphic, but probably not defeq, objects, and doesn't this give rise to a diamond?</p>

<a name="147638007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147638007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147638007">Scott Morrison (Nov 14 2018 at 01:10)</a>:</h4>
<p>I have to admit I don't know how bad a problem this is going to be!</p>

<a name="147638987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147638987" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147638987">Reid Barton (Nov 14 2018 at 01:34)</a>:</h4>
<p>You also don't necessarily <em>have</em> to put your filtered colimits into the type class system. You can just define and use them directly.</p>

<a name="147640447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640447">Harry Gindi (Nov 14 2018 at 02:08)</a>:</h4>
<p>the general statement comes from the theory of locally presentable categories</p>

<a name="147640571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640571" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640571">Harry Gindi (Nov 14 2018 at 02:12)</a>:</h4>
<p>every object can be given as a filtered colimit of finite pushouts of compact (i.e. finitely (resp Kappa)-presentable) objects, iirc the statement correctly</p>

<a name="147640591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640591" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640591">Harry Gindi (Nov 14 2018 at 02:12)</a>:</h4>
<p>and iirc CRing has only a single generator, Z[x]</p>

<a name="147640677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640677" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640677">Harry Gindi (Nov 14 2018 at 02:15)</a>:</h4>
<p>You don't need to work with Lawvere theories to do this stuff, you might be fine doing the locPres machinery and then proving algebraic categories you care about are LocPres</p>

<a name="147640684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640684" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640684">Harry Gindi (Nov 14 2018 at 02:15)</a>:</h4>
<p>standard reference is Adamek-Rosicky</p>

<a name="147640760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640760" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640760">Harry Gindi (Nov 14 2018 at 02:17)</a>:</h4>
<p>It seems a lot less complicated than doing Lawvere theories generally</p>

<a name="147640896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640896">Harry Gindi (Nov 14 2018 at 02:21)</a>:</h4>
<p>The general argument is useful in other places, iirc. Grothendieck first used this style of argument in the Tohoku paper</p>

<a name="147640956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147640956" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147640956">Harry Gindi (Nov 14 2018 at 02:22)</a>:</h4>
<p>proving that the category of abelian sheaves has enough injectives, but I forget the details</p>

<a name="147649975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147649975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147649975">Johan Commelin (Nov 14 2018 at 06:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Maybe we should change the definition of <code>stalk</code> a tiny little bit, and write <code>filtered_colimit</code> instead of <code>colimit</code>. That would take care of your issue, I think.</p>

<a name="147650968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147650968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147650968">Kevin Buzzard (Nov 14 2018 at 07:06)</a>:</h4>
<p>This is a diamond-like issue but one level up. With diamonds you might end up with two objects which are equal but the proof isn't rfl. Here the objects are not even equal, merely canonically isomorphic</p>

<a name="147652970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147652970" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147652970">Johan Commelin (Nov 14 2018 at 08:05)</a>:</h4>
<p>I see what you mean. And I think this is showing that the current type class system might not be a good fit for categorical stuff (wait till we want to do higher-categorical stuff...). But maybe we can just ignore the issue for now, and hope  that Lean 4 will solve this issue before we hit serious problems.</p>

<a name="147739873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147739873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147739873">Johan Commelin (Nov 15 2018 at 13:11)</a>:</h4>
<p>This is pretty ugly:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">extend</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span><span class="o">,</span> <span class="n">limit</span> <span class="o">((</span><span class="n">comma</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">full_subcategory_inclusion</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">of_obj</span> <span class="n">U</span><span class="o">))</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">),</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">i</span><span class="o">,</span>
    <span class="k">show</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">op</span> <span class="o">(</span><span class="n">comma</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">full_subcategory_inclusion</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">of_obj</span> <span class="n">U</span><span class="o">))</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">)</span> <span class="err">⟶</span>
        <span class="n">limits</span><span class="bp">.</span><span class="n">limit</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">op</span> <span class="o">(</span><span class="n">comma</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">full_subcategory_inclusion</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">of_obj</span> <span class="n">V</span><span class="o">))</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">)),</span>
    <span class="k">begin</span>
      <span class="k">have</span> <span class="n">foo</span> <span class="o">:=</span> <span class="n">limit</span><span class="bp">.</span><span class="n">pre</span> <span class="o">((</span><span class="n">comma</span><span class="bp">.</span><span class="n">fst</span> <span class="o">(</span><span class="n">full_subcategory_inclusion</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">of_obj</span> <span class="n">U</span><span class="o">))</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">extend</span><span class="bp">.</span><span class="n">aux</span> <span class="n">i</span><span class="o">),</span>
      <span class="n">dsimp</span> <span class="o">[</span><span class="n">extend</span><span class="bp">.</span><span class="n">aux</span><span class="o">]</span> <span class="n">at</span> <span class="n">foo</span><span class="o">,</span>
      <span class="n">convert</span> <span class="n">foo</span><span class="o">,</span>
      <span class="n">swap</span> <span class="mi">3</span><span class="o">,</span> <span class="n">assumption</span>
    <span class="kn">end</span> <span class="o">}</span>
</pre></div>

<a name="147740652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147740652" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147740652">Reid Barton (Nov 15 2018 at 13:24)</a>:</h4>
<p>Why isn't the <code>map</code> field just an application of <code>limit.pre</code>?</p>

<a name="147740706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147740706" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147740706">Reid Barton (Nov 15 2018 at 13:25)</a>:</h4>
<p>what goal is the last line solving?</p>

<a name="147741081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147741081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147741081">Reid Barton (Nov 15 2018 at 13:31)</a>:</h4>
<p>My guess is that representing slice categories as comma categories is actually not a good idea in Lean, because the isomorphism (punit -&gt; a) = a is not enough of an equality</p>

<a name="147741481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147741481" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147741481">Reid Barton (Nov 15 2018 at 13:39)</a>:</h4>
<p>Did you actually manage to prove the map_id and map_comp fields?</p>

<a name="147741721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147741721" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147741721">Johan Commelin (Nov 15 2018 at 13:44)</a>:</h4>
<p>Not yet, still working on it.</p>

<a name="147741761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147741761" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147741761">Johan Commelin (Nov 15 2018 at 13:45)</a>:</h4>
<p>Note that I'm not taking a slice category, although it almost is.</p>

<a name="147741857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147741857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147741857">Johan Commelin (Nov 15 2018 at 13:46)</a>:</h4>
<p>This is opens in <code>B</code> that are contained in <code>U</code>, but <code>U</code> is not in <code>B</code>.</p>

<a name="147742182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742182">Reid Barton (Nov 15 2018 at 13:52)</a>:</h4>
<p>Oh, I see</p>

<a name="147742355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742355">Reid Barton (Nov 15 2018 at 13:55)</a>:</h4>
<p>If these are presheaves of sets, then there's an easier way to write the formula</p>

<a name="147742375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742375" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742375">Reid Barton (Nov 15 2018 at 13:55)</a>:</h4>
<p>it's the same as the right Kan extension, right?</p>

<a name="147742424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742424">Johan Commelin (Nov 15 2018 at 13:56)</a>:</h4>
<p>Hmmm... I think so.</p>

<a name="147742430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742430">Johan Commelin (Nov 15 2018 at 13:56)</a>:</h4>
<p>If you want to help, please do so.</p>

<a name="147742437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742437" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742437">Johan Commelin (Nov 15 2018 at 13:56)</a>:</h4>
<p>Lean is fighting back hard (-;</p>

<a name="147742454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742454" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742454">Johan Commelin (Nov 15 2018 at 13:57)</a>:</h4>
<p>Maybe we should do it for a general map between sites, in that case.</p>

<a name="147742530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742530">Reid Barton (Nov 15 2018 at 13:58)</a>:</h4>
<p>If E is the extended presheaf then we should have E(U) = Hom(yU, E) = Hom(R(yU), F) where R is the restriction of a presheaf on C to a presheaf on B</p>

<a name="147742547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742547" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742547">Reid Barton (Nov 15 2018 at 13:58)</a>:</h4>
<p>so E is the composition y, then R, then Hom(-, F)</p>

<a name="147742567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742567" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742567">Reid Barton (Nov 15 2018 at 13:59)</a>:</h4>
<p>Yes, that might help as well... at least for clarity</p>

<a name="147742652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742652" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742652">Johan Commelin (Nov 15 2018 at 14:00)</a>:</h4>
<p>Ok, I think this is a nice way to do it!</p>

<a name="147742680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742680">Johan Commelin (Nov 15 2018 at 14:00)</a>:</h4>
<p>I don't yet see why it is the same thing as in my special case</p>

<a name="147742806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147742806" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147742806">Johan Commelin (Nov 15 2018 at 14:02)</a>:</h4>
<p>Aah, <code>U</code> is the colimit of all the <code>Ui ∈ B</code> that are contained in <code>U</code>. Now pull this through <code>Hom(_, F)</code> and you get a limit.</p>

<a name="147743096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743096" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743096">Reid Barton (Nov 15 2018 at 14:06)</a>:</h4>
<p>You might find it useful to borrow <a href="https://github.com/leanprover-community/mathlib/blob/adjunctions/category_theory/presheaf.lean#L85" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/adjunctions/category_theory/presheaf.lean#L85">https://github.com/leanprover-community/mathlib/blob/adjunctions/category_theory/presheaf.lean#L85</a></p>

<a name="147743119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743119">Reid Barton (Nov 15 2018 at 14:06)</a>:</h4>
<p>I think you will want to apply it twice</p>

<a name="147743129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743129">Reid Barton (Nov 15 2018 at 14:06)</a>:</h4>
<p>In your setup you have a functor B -&gt; C, right?</p>

<a name="147743202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743202">Johan Commelin (Nov 15 2018 at 14:07)</a>:</h4>
<p>What do you mean?</p>

<a name="147743262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743262" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743262">Johan Commelin (Nov 15 2018 at 14:08)</a>:</h4>
<p><code>B</code> is a basis, and it has an inclusion into <code>opens X</code>.</p>

<a name="147743276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743276" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743276">Johan Commelin (Nov 15 2018 at 14:08)</a>:</h4>
<p>I have a presheaf on <code>B</code></p>

<a name="147743300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743300" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743300">Reid Barton (Nov 15 2018 at 14:08)</a>:</h4>
<p>Okay so let's call <code>opens X</code> <code>C</code> for now</p>

<a name="147743339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743339">Johan Commelin (Nov 15 2018 at 14:09)</a>:</h4>
<p>Aaah, <code>C</code> was my category of coefficients so far</p>

<a name="147743342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743342">Reid Barton (Nov 15 2018 at 14:09)</a>:</h4>
<p>ah</p>

<a name="147743355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743355">Johan Commelin (Nov 15 2018 at 14:09)</a>:</h4>
<p>But maybe I should stop worrying about coefficients, and only focus on <code>Type</code>.</p>

<a name="147743373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743373">Reid Barton (Nov 15 2018 at 14:09)</a>:</h4>
<p>Well this formula won't work unless the values are in Type</p>

<a name="147743496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743496">Johan Commelin (Nov 15 2018 at 14:10)</a>:</h4>
<p>Right, so I should forget about <code>C</code></p>

<a name="147743523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743523" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743523">Johan Commelin (Nov 15 2018 at 14:10)</a>:</h4>
<p>And sheaves of rings will require some extra thought</p>

<a name="147743525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743525" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743525">Reid Barton (Nov 15 2018 at 14:10)</a>:</h4>
<p>Okay, in that case let me just use the names from the thing I linked above, so you have a functor C -&gt; D</p>

<a name="147743544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743544" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743544">Reid Barton (Nov 15 2018 at 14:11)</a>:</h4>
<p>If you apply <code>restricted_yoneda</code> to it, you get a functor D -&gt; Set^C^op</p>

<a name="147743555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743555" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743555">Reid Barton (Nov 15 2018 at 14:11)</a>:</h4>
<p>and if you apply <code>restricted_yoneda</code> to that, you get a functor Set^C^op -&gt; Set^D^op</p>

<a name="147743559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743559" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743559">Reid Barton (Nov 15 2018 at 14:11)</a>:</h4>
<p>and that should be the right Kan extension along the original functor</p>

<a name="147743982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743982" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743982">Reid Barton (Nov 15 2018 at 14:17)</a>:</h4>
<p>the thing I called "Ry" earlier is another, possibly better way to write <code>restricted_yoneda</code></p>

<a name="147743992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147743992" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147743992">Johan Commelin (Nov 15 2018 at 14:17)</a>:</h4>
<p>Sorry, as student entered my office. So I have to wait a while with this thing.</p>

<a name="147746533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147746533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147746533">Johan Commelin (Nov 15 2018 at 14:51)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Hmmm... morphisms of sites seem to be non-trivial. I don't think I want to do them now, unless you want to join in. We would need to explain Lean this definition <a href="https://ncatlab.org/nlab/show/flat+functor#SiteValuedFunctors" target="_blank" title="https://ncatlab.org/nlab/show/flat+functor#SiteValuedFunctors">https://ncatlab.org/nlab/show/flat+functor#SiteValuedFunctors</a></p>

<a name="147747568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147747568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147747568">Reid Barton (Nov 15 2018 at 15:02)</a>:</h4>
<p>Right... so concretely I guess your actual goal is to show that the extended presheaf is actually a sheaf?</p>

<a name="147747732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147747732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147747732">Reid Barton (Nov 15 2018 at 15:04)</a>:</h4>
<p>You might want to pick a fact to prove, and work backwards from there</p>

<a name="147747750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147747750" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147747750">Reid Barton (Nov 15 2018 at 15:04)</a>:</h4>
<p>Otherwise you can enter a swamp of things you could formalize and choices of definitions you could make</p>

<a name="147751358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147751358" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147751358">Johan Commelin (Nov 15 2018 at 15:52)</a>:</h4>
<p>Right. I want to get an equivalence of categories between <code>sheaf B</code> and <code>sheaf X</code>. That is a concrete goal that I definitely want to reach.</p>

<a name="147753284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147753284" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147753284">Johan Commelin (Nov 15 2018 at 16:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> So which approach would you suggest now? Maybe the one with Kan extensions is best? Because it will generalise later on?</p>

<a name="147753315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147753315" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147753315">Johan Commelin (Nov 15 2018 at 16:16)</a>:</h4>
<p>Hmmm, I'm being called for an early dinner. See you later.</p>

<a name="147762987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147762987" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147762987">Johan Commelin (Nov 15 2018 at 18:41)</a>:</h4>
<p><span class="emoji emoji-1f923" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span> This error is hilarious:</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">set</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">over</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">U</span><span class="o">)</span>
<span class="n">term</span>
  <span class="n">over</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">U</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="n">u</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="n">u</span>
</pre></div>

<a name="147767061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147767061" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147767061">Johan Commelin (Nov 15 2018 at 19:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> How does this look?</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">restrict</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="err">⥤</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span> <span class="n">B</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span><span class="o">,</span> <span class="o">(</span><span class="n">full_subcategory_inclusion</span> <span class="n">B</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">f</span><span class="o">,</span> <span class="n">whisker_left</span> <span class="bp">_</span> <span class="n">f</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">extend</span> <span class="o">:</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">presheaf</span> <span class="n">B</span> <span class="err">⥤</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span><span class="o">,</span> <span class="n">yoneda</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">restrict</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">yoneda</span><span class="bp">.</span><span class="n">obj</span> <span class="n">F</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span> <span class="n">G</span> <span class="n">f</span><span class="o">,</span> <span class="n">whisker_left</span> <span class="bp">_</span> <span class="err">$</span> <span class="n">whisker_left</span> <span class="bp">_</span> <span class="err">$</span> <span class="n">yoneda</span><span class="bp">.</span><span class="n">map</span> <span class="n">f</span> <span class="o">}</span>
</pre></div>


<p>I think you gave a very good suggestion!</p>

<a name="147767734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147767734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147767734">Johan Commelin (Nov 15 2018 at 19:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> I think it makes sense to merge your <code>presheaf.lean</code> with parts of my <code>sheaf.lean</code>. What would be the best approach? Should I merge your branch into mine?</p>

<a name="147767788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147767788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147767788">Johan Commelin (Nov 15 2018 at 19:42)</a>:</h4>
<p>I would like to prove that <code>restrict</code> and <code>extend</code> form an adjunction anyway.</p>

<a name="147783569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/147783569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#147783569">Reid Barton (Nov 15 2018 at 23:55)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Feel free to merge my branch into yours of course, though I will note that I intend to try out a redesign of adjunctions at some point</p>

<a name="148024110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024110" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024110">Johan Commelin (Nov 20 2018 at 08:21)</a>:</h4>
<p>I'm not sure if I'm using things in the right way. I'm trying to write</p>
<div class="codehilite"><pre><span></span><span class="k">let</span> <span class="n">G1</span> <span class="o">:=</span> <span class="o">(</span><span class="n">equiv_of_iso</span> <span class="n">D</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">equiv</span><span class="bp">.</span><span class="n">subtype_equiv_of_subtype</span><span class="bp">.</span><span class="o">{(</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">)}</span> <span class="n">Eeq</span><span class="o">),</span>
</pre></div>


<p>where <code>D : F.obj ≅ {p // horrible p}</code> is isomorphisms between a type and a subtype in the category <code>Type u</code> which I turn into an equiv.<br>
I then want to replace the horrible right hand side with a subtype of something else, so I thought, lets use transitivity of <code>equiv</code> and feed it <code>Eeq</code>, which is:</p>
<div class="codehilite"><pre><span></span><span class="n">Eeq</span> <span class="o">:</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">sigma</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">Ui</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">c</span><span class="o">}),</span> <span class="n">yoneda</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span><span class="bp">.</span><span class="n">obj</span> <span class="o">((</span><span class="n">Ui</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">))</span> <span class="err">⟶</span> <span class="n">F</span><span class="o">)</span> <span class="err">≃</span>
  <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">c</span><span class="o">}),</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="o">((</span><span class="n">a</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">equiv</span><span class="bp">.</span><span class="n">trans</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="o">(</span><span class="n">equiv_of_iso</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">E</span><span class="o">)</span>
    <span class="o">(</span><span class="n">equiv</span><span class="bp">.</span><span class="n">Pi_congr_right</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span>
       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">Ui</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">c</span><span class="o">}),</span>
          <span class="n">equiv_of_iso</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span>
            <span class="o">(</span><span class="n">nat_iso</span><span class="bp">.</span><span class="n">app</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">yoneda_lemma</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span><span class="o">)</span> <span class="o">((</span><span class="n">Ui</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span> <span class="n">F</span><span class="o">)</span> <span class="err">≪≫</span>
               <span class="n">ulift_trivial</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">((</span><span class="n">evaluation_uncurried</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span> <span class="n">X</span><span class="err">ᵒᵖ</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">))</span><span class="bp">.</span><span class="n">obj</span> <span class="o">((</span><span class="n">Ui</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span> <span class="n">F</span><span class="o">))))),</span>
</pre></div>


<p>The left hand side of <code>Eeq</code> should be exactly the type of the <code>p</code> in <code>{p // horrible p}</code>.</p>
<p>I get the following error:</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">equiv</span><span class="bp">.</span><span class="n">subtype_equiv_of_subtype</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">Eeq</span>
<span class="n">term</span>
  <span class="n">Eeq</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">sigma</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">Ui</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">c</span><span class="o">}),</span> <span class="n">yoneda</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span><span class="bp">.</span><span class="n">obj</span> <span class="o">((</span><span class="n">Ui</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">))</span> <span class="err">⟶</span> <span class="n">F</span><span class="o">)</span> <span class="err">≃</span>
    <span class="bp">Π</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">c</span><span class="o">}),</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="o">((</span><span class="n">a</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">sigma</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">Ui</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="bp">//</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">c</span><span class="o">}),</span> <span class="n">yoneda</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span><span class="o">}</span><span class="bp">.</span><span class="n">obj</span> <span class="o">((</span><span class="n">Ui</span><span class="bp">.</span><span class="n">val</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">))</span> <span class="err">⟶</span> <span class="n">F</span><span class="o">)</span> <span class="err">≃</span> <span class="err">?</span><span class="n">m_1</span>
</pre></div>


<p>I have tried looking at universes. I have enable <code>pp.all</code>. And I'm clueless. Any suggestions?</p>

<a name="148024274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024274" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024274">Kevin Buzzard (Nov 20 2018 at 08:24)</a>:</h4>
<p>Is it a typeclass issue? That sometimes causes errors that look like that. Lean can't infer a typeclass and so gives up and prints an unhelpful error message</p>

<a name="148024298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024298" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024298">Kevin Buzzard (Nov 20 2018 at 08:25)</a>:</h4>
<p>I mean equiv.subtype_equiv_of_subtype -- does it have some secret inputs that it can't find?</p>

<a name="148024334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024334" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024334">Johan Commelin (Nov 20 2018 at 08:26)</a>:</h4>
<p>Also, why is <code>p</code> not an explicit argument in</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">subtype_equiv_of_subtype</span> <span class="o">{</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">α</span> <span class="err">≃</span> <span class="n">β</span><span class="o">),</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">//</span> <span class="n">p</span> <span class="n">a</span><span class="o">}</span> <span class="err">≃</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">//</span> <span class="n">p</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">symm</span> <span class="n">b</span><span class="o">)}</span>
<span class="bp">|</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">g</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="bp">⟩</span> <span class="o">:=</span>
  <span class="bp">⟨</span><span class="n">subtype</span><span class="bp">.</span><span class="n">map</span> <span class="n">f</span> <span class="err">$</span> <span class="k">assume</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="k">show</span> <span class="n">p</span> <span class="o">(</span><span class="n">g</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">)),</span> <span class="k">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">l</span><span class="o">],</span>
   <span class="n">subtype</span><span class="bp">.</span><span class="n">map</span> <span class="n">g</span> <span class="err">$</span> <span class="k">assume</span> <span class="n">a</span> <span class="n">ha</span><span class="o">,</span> <span class="n">ha</span><span class="o">,</span>
   <span class="k">assume</span> <span class="n">p</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">map_comp</span><span class="o">,</span> <span class="n">l</span><span class="bp">.</span><span class="n">comp_eq_id</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">map_id</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span><span class="o">,</span>
   <span class="k">assume</span> <span class="n">p</span><span class="o">,</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">map_comp</span><span class="o">,</span> <span class="n">r</span><span class="bp">.</span><span class="n">comp_eq_id</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">map_id</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span><span class="bp">⟩</span>
</pre></div>

<a name="148024344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024344">Johan Commelin (Nov 20 2018 at 08:26)</a>:</h4>
<p>Well, in general it can't infer that <code>p</code>.</p>

<a name="148024349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024349" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024349">Kevin Buzzard (Nov 20 2018 at 08:26)</a>:</h4>
<p>I'm explicitly talking about typeclasses</p>

<a name="148024351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024351">Chris Hughes (Nov 20 2018 at 08:26)</a>:</h4>
<p>What universe is <code>?m_1</code> expected to be in?</p>

<a name="148024354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024354" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024354">Johan Commelin (Nov 20 2018 at 08:26)</a>:</h4>
<p><code>Type u</code></p>

<a name="148024361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024361">Mario Carneiro (Nov 20 2018 at 08:27)</a>:</h4>
<p>I think Johannes has a bad habit of making lots of things implicit that can't be inferred when used directly</p>

<a name="148024384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024384" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024384">Mario Carneiro (Nov 20 2018 at 08:27)</a>:</h4>
<p>I guess that <code>p</code> is inferrable if you use it as a rewrite, or apply it to something</p>

<a name="148024389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024389" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024389">Johan Commelin (Nov 20 2018 at 08:27)</a>:</h4>
<p>But in my case a smart elaborator should even be able to infer it, because I'm composing with another equiv.</p>

<a name="148024429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024429" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024429">Johan Commelin (Nov 20 2018 at 08:28)</a>:</h4>
<p>Can I rewrite along <code>equiv</code>s?</p>

<a name="148024432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024432">Mario Carneiro (Nov 20 2018 at 08:28)</a>:</h4>
<p>I think? <code>calc</code> for sure</p>

<a name="148024442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024442" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024442">Chris Hughes (Nov 20 2018 at 08:28)</a>:</h4>
<p>Isn't <code>Π (a : {x // x ∈ c}), F.obj ((a.val).left)</code> Type (u + 1). If I'm not mistaken?</p>

<a name="148024445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024445">Johan Commelin (Nov 20 2018 at 08:28)</a>:</h4>
<p>Hmmm, it says <code>rewrite tactic failed, lemma is not an equality nor a iff</code></p>

<a name="148024474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024474" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024474">Mario Carneiro (Nov 20 2018 at 08:29)</a>:</h4>
<p>hm, I guess that is probably a <code>// TODO(Leo)</code> somewhere</p>

<a name="148024531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024531" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024531">Mario Carneiro (Nov 20 2018 at 08:30)</a>:</h4>
<p>obviously it's not high on the list of priorities</p>

<a name="148024534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024534">Johan Commelin (Nov 20 2018 at 08:30)</a>:</h4>
<p>The <code>F.obj ((a.val).left)</code> is <code>Type u</code>, and the product is over <code>c : set (over U)</code> where <code>U : X</code> and <code>X : Type u</code></p>

<a name="148024540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024540">Johan Commelin (Nov 20 2018 at 08:30)</a>:</h4>
<p>I hope that doesn't bump up universes...</p>

<a name="148024545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024545" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024545">Mario Carneiro (Nov 20 2018 at 08:31)</a>:</h4>
<p>that sounds fine</p>

<a name="148024550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024550" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024550">Mario Carneiro (Nov 20 2018 at 08:31)</a>:</h4>
<p>you can just check, of course</p>

<a name="148024567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024567" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024567">Chris Hughes (Nov 20 2018 at 08:31)</a>:</h4>
<p>If <code>F.obj ((a.val).left</code> is Type u, then <code>Π (a : {x // x ∈ c}), F.obj ((a.val).left)</code> is Type (u + 1) right?</p>

<a name="148024608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024608" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024608">Chris Hughes (Nov 20 2018 at 08:32)</a>:</h4>
<p>No it isn't</p>

<a name="148024687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024687" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024687">Mario Carneiro (Nov 20 2018 at 08:34)</a>:</h4>
<p>another trick you can try is <code>by convert</code> at the type mismatch</p>

<a name="148024697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024697" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024697">Mario Carneiro (Nov 20 2018 at 08:34)</a>:</h4>
<p>it should home in on the mismatched part</p>

<a name="148024711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024711" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024711">Johan Commelin (Nov 20 2018 at 08:35)</a>:</h4>
<p>How exactly should I do that?</p>

<a name="148024771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024771" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024771">Mario Carneiro (Nov 20 2018 at 08:36)</a>:</h4>
<p>something like <code>subtype_equiv_of_subtype (by convert Eeq)</code> or <code>refine subtype_equiv_of_subtype _, convert Eeq</code></p>

<a name="148024839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024839">Johan Commelin (Nov 20 2018 at 08:38)</a>:</h4>
<p>Cool! That finds the following unsolved goal:</p>
<div class="codehilite"><pre><span></span><span class="err">⊢</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span><span class="bp">.</span><span class="n">has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="bp">=</span> <span class="n">limits</span><span class="bp">.</span><span class="n">functor_category_has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span>
</pre></div>

<a name="148024841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024841">Johan Commelin (Nov 20 2018 at 08:38)</a>:</h4>
<p>That's progress at least.</p>

<a name="148024861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148024861" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148024861">Kevin Buzzard (Nov 20 2018 at 08:39)</a>:</h4>
<p>I am loving <code>convert</code>. I use it a lot when doing basic UG maths -- "this is basically the answer, now let's see what pieces we have to pick up"</p>

<a name="148027986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148027986" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148027986">Johannes Hölzl (Nov 20 2018 at 09:47)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>  <code>rw</code> only work with <code>=</code> (maybe also <code>==</code>, and <code>&lt;-&gt;</code> only works due to <code>propext</code>). Rewriting with <code>equiv</code> is hard, one needs to prove that the motive (i.e. context in which the right-hand side appears) can be transported along the <code>equiv</code>. Even ignoring dependencies, parametricity is necessary as it shows that there is no <code>choice</code> involved.</p>

<a name="148028093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028093" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028093">Johan Commelin (Nov 20 2018 at 09:49)</a>:</h4>
<p>Right. That is about what I expected.</p>

<a name="148028181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028181" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028181">Johannes Hölzl (Nov 20 2018 at 09:51)</a>:</h4>
<p>To rewrite along a <code>equiv</code> we could use the <code>param</code>-branch <a href="https://github.com/leanprover-community/mathlib/commits/param" target="_blank" title="https://github.com/leanprover-community/mathlib/commits/param">https://github.com/leanprover-community/mathlib/commits/param</a> and <code>transfer</code>.</p>

<a name="148028325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028325" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028325">Johannes Hölzl (Nov 20 2018 at 09:54)</a>:</h4>
<p>One example why it is a problem is:</p>
<p>We want to rewrite <code>e : α ≃ β</code> in <code>{a : α // p a}</code>, but what would be the goal? We get something like<code>{b : β // p (f⁻¹ b)}</code>. But in many cases <code>p</code> itself is also parametric, i.e. we have actually <code>{b : β // @p α (f⁻¹ b)}</code> (not really, as <code>p</code> is describing a term and not a constant, but I hope you get the idea) Now when we can try to adopt the structure of <code>p</code> s.t. <code>α</code> is completely replaced by <code>β</code>, and then <code>f</code> isn't occurring anymore</p>

<a name="148028348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028348">Johannes Hölzl (Nov 20 2018 at 09:55)</a>:</h4>
<p>This adoption mechanism is the kind of rewrite <code>transfer</code> is intended to do</p>

<a name="148028353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028353" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028353">Johannes Hölzl (Nov 20 2018 at 09:55)</a>:</h4>
<p>and <code>param</code> provides us with the necessary relations</p>

<a name="148028487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028487" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028487">Johan Commelin (Nov 20 2018 at 09:58)</a>:</h4>
<p>I see. But I suspect that <code>param</code> isn't yet ready for prime time.</p>

<a name="148028596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028596">Patrick Massot (Nov 20 2018 at 10:01)</a>:</h4>
<p>You need to ask <span class="user-mention" data-user-id="110193">@Cyril Cohen</span> about this</p>

<a name="148028937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148028937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148028937">Cyril Cohen (Nov 20 2018 at 10:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> <span class="user-mention" data-user-id="112680">@Johan Commelin</span> <span class="user-mention" data-user-id="110031">@Patrick Massot</span> <code>param</code> is not ready yet, the translation of recursors was not as straightforward as I thought.</p>

<a name="148039894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148039894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148039894">Johan Commelin (Nov 20 2018 at 13:47)</a>:</h4>
<p>What do you do when Lean doesn't want to plug a morphism in the category <code>C</code> into your contravariant functor <code>F : Cᵒᵖ  ⥤ Type u</code>?<br>
You use <code>convert</code>, and let <code>tidy</code> clean up the mess! <span class="emoji emoji-1f389" title="tada">:tada:</span></p>
<div class="codehilite"><pre><span></span><span class="n">functor</span><span class="bp">.</span><span class="n">map</span> <span class="n">F</span> <span class="o">(</span><span class="k">by</span> <span class="n">convert</span> <span class="n">Ui</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">hom</span><span class="bp">;</span> <span class="n">tidy</span><span class="o">)</span>
</pre></div>

<a name="148041125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148041125" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148041125">Johan Commelin (Nov 20 2018 at 14:05)</a>:</h4>
<p>What's up, <span class="user-mention" data-user-id="110064">@Kenny Lau</span>?</p>

<a name="148046156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046156">Reid Barton (Nov 20 2018 at 15:24)</a>:</h4>
<blockquote>
<p>Cool! That finds the following unsolved goal:</p>
<div class="codehilite"><pre><span></span><span class="err">⊢</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span><span class="bp">.</span><span class="n">has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="bp">=</span> <span class="n">limits</span><span class="bp">.</span><span class="n">functor_category_has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span>
</pre></div>


</blockquote>
<p>This is probably true by <code>refl</code></p>

<a name="148046302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046302" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046302">Johan Commelin (Nov 20 2018 at 15:26)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">invalid</span> <span class="n">apply</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">unify</span>
  <span class="n">presheaf</span><span class="bp">.</span><span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span><span class="bp">.</span><span class="n">has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="bp">=</span> <span class="n">limits</span><span class="bp">.</span><span class="n">functor_category_has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span> <span class="n">u</span><span class="o">}</span>
<span class="k">with</span>
  <span class="err">?</span><span class="n">m_3</span> <span class="bp">=</span> <span class="err">?</span><span class="n">m_3</span>
</pre></div>

<a name="148046325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046325" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046325">Johan Commelin (Nov 20 2018 at 15:26)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coproducts</span><span class="bp">.</span><span class="o">{(</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">presheaf</span> <span class="n">X</span><span class="o">)</span> <span class="o">:=</span> <span class="n">limits</span><span class="bp">.</span><span class="n">has_coproducts_of_has_colimits</span>
</pre></div>

<a name="148046374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046374">Johan Commelin (Nov 20 2018 at 15:27)</a>:</h4>
<p>So, I changed that instance, and now I get</p>
<div class="codehilite"><pre><span></span><span class="n">tactic</span> <span class="n">failed</span><span class="o">,</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">goals</span> <span class="n">to</span> <span class="n">be</span> <span class="n">solved</span>
<span class="n">state</span><span class="o">:</span>
<span class="n">no</span> <span class="n">goals</span>
</pre></div>

<a name="148046438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046438">Johan Commelin (Nov 20 2018 at 15:28)</a>:</h4>
<p>Aaah, lol, that is because I should now remove the <code>refl</code>.</p>

<a name="148046447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046447">Reid Barton (Nov 20 2018 at 15:28)</a>:</h4>
<p>Oh, I didn't notice "coproducts" rather than "colimits". Still I'm confused. What are the two instances which are not defeq, but equal by tidy?</p>

<a name="148046463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046463" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046463">Johan Commelin (Nov 20 2018 at 15:28)</a>:</h4>
<p>No, they aren't equal by <code>tidy</code> either</p>

<a name="148046499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046499" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046499">Reid Barton (Nov 20 2018 at 15:29)</a>:</h4>
<p>Or rather, what did you change that instance to?</p>

<a name="148046576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046576" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046576">Reid Barton (Nov 20 2018 at 15:30)</a>:</h4>
<p>well, the right hand side of that goal I guess</p>

<a name="148046590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046590" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046590">Johan Commelin (Nov 20 2018 at 15:30)</a>:</h4>
<p>Exactly</p>

<a name="148046604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046604">Reid Barton (Nov 20 2018 at 15:30)</a>:</h4>
<p>But I see</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">functor_category_has_coproducts</span> <span class="o">[</span><span class="n">has_coproducts</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_coproducts</span><span class="bp">.</span><span class="o">{(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">K</span> <span class="err">⥤</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">limits</span><span class="bp">.</span><span class="n">has_coproducts_of_has_colimits</span>
</pre></div>

<a name="148046754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046754" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046754">Reid Barton (Nov 20 2018 at 15:32)</a>:</h4>
<p>... I'm really confused now</p>

<a name="148046922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148046922" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148046922">Reid Barton (Nov 20 2018 at 15:35)</a>:</h4>
<p>Ohh, maybe I get what is going on. I think all this duplication between colimit classes is biting you</p>

<a name="148047035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047035">Reid Barton (Nov 20 2018 at 15:36)</a>:</h4>
<p>Well, I'm still not sure why that would be a problem either really</p>

<a name="148047048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047048" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047048">Reid Barton (Nov 20 2018 at 15:36)</a>:</h4>
<p>But I still think the duplication is silly anyways</p>

<a name="148047066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047066" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047066">Johan Commelin (Nov 20 2018 at 15:37)</a>:</h4>
<p>Which duplication do you mean exactly?</p>

<a name="148047140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047140" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047140">Reid Barton (Nov 20 2018 at 15:38)</a>:</h4>
<p>Good question</p>

<a name="148047155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047155" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047155">Reid Barton (Nov 20 2018 at 15:38)</a>:</h4>
<p>I was thinking of <code>has_colimits_of_shape</code> and <code>has_colimits</code> being unrelated</p>

<a name="148047165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047165" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047165">Reid Barton (Nov 20 2018 at 15:39)</a>:</h4>
<p>But now I see there's also <code>has_colimits</code> which is also unrelated</p>

<a name="148047176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047176" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047176">Reid Barton (Nov 20 2018 at 15:39)</a>:</h4>
<p>Gah, <code>has_coproducts</code></p>

<a name="148047441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047441" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047441">Reid Barton (Nov 20 2018 at 15:43)</a>:</h4>
<p>Anyways, I'm still confused by the original fact that you replaced an instance by, as far as I can tell, its definition and it changed the behavior of <code>refl</code></p>

<a name="148047568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047568">Johan Commelin (Nov 20 2018 at 15:44)</a>:</h4>
<p>Well, I didn't even need <code>refl</code> anymore. <code>convert</code> now took care of everything.</p>

<a name="148047657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047657" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047657">Reid Barton (Nov 20 2018 at 15:45)</a>:</h4>
<p>because <code>congr</code>, which <code>convert</code> uses, will try closing goals with <code>refl</code> for you</p>

<a name="148047663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047663" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047663">Johan Commelin (Nov 20 2018 at 15:45)</a>:</h4>
<p>Currently I'm trying to prove the equivalence of different formulations of the sheaf condition. Math-proof: apply Yoneda; QED. Lean-proof: <span class="emoji emoji-1f631" title="scream">:scream:</span> <span class="emoji emoji-1f631" title="scream">:scream:</span> <span class="emoji emoji-1f4a5" title="boom">:boom:</span></p>

<a name="148047717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047717">Reid Barton (Nov 20 2018 at 15:46)</a>:</h4>
<p><code>by convert x</code> should be the same as <code>by exact x</code></p>

<a name="148047745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148047745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148047745">Johan Commelin (Nov 20 2018 at 15:46)</a>:</h4>
<p>which apparently is not the same as <code>x</code></p>

<a name="148055915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148055915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148055915">Reid Barton (Nov 20 2018 at 17:56)</a>:</h4>
<p>OK, I got to the same place where you were before changing the instance.</p>

<a name="148055953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148055953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148055953">Reid Barton (Nov 20 2018 at 17:58)</a>:</h4>
<p>It's kind of hard to understand what's going on because all the <code>has_blah</code> things are classes, which means they aren't printed except with <code>pp.implicit</code>, which also prints a bunch of other stuff I don't care about...</p>

<a name="148056108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148056108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148056108">Reid Barton (Nov 20 2018 at 18:00)</a>:</h4>
<p>I wish you could jump from names in the goal window to their definitions...</p>

<a name="148056614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148056614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148056614">Johan Commelin (Nov 20 2018 at 18:11)</a>:</h4>
<p>Right, we should but the "interactive" back in the goal window <span class="emoji emoji-1f600" title="grinning">:grinning:</span></p>

<a name="148056956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148056956" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148056956">Reid Barton (Nov 20 2018 at 18:16)</a>:</h4>
<p>My conclusion is that I don't know what is wrong exactly, but all these different <code>has_*</code> need to be rethought (probably there should be far fewer of them)</p>

<a name="148057011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148057011" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148057011">Reid Barton (Nov 20 2018 at 18:17)</a>:</h4>
<p>Apparently your instances which were not the same reduce to something like the following</p>

<a name="148057077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148057077" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148057077">Reid Barton (Nov 20 2018 at 18:18)</a>:</h4>
<p>On one side, we have the colimit of a functor on a discrete category defined using the instance that says the category of types has colimits</p>

<a name="148057109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148057109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148057109">Reid Barton (Nov 20 2018 at 18:19)</a>:</h4>
<p>On the other side, we're doing something like building a colimit cone from a coproduct thing, which in turn is built from the original colimit somehow</p>

<a name="148057118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148057118" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148057118">Reid Barton (Nov 20 2018 at 18:19)</a>:</h4>
<p>both of these constructions being nontrivial</p>

<a name="148057189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148057189" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148057189">Reid Barton (Nov 20 2018 at 18:20)</a>:</h4>
<p>so that they don't just cancel out</p>

<a name="148057227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148057227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148057227">Reid Barton (Nov 20 2018 at 18:21)</a>:</h4>
<p>I haven't even seen this file <code>limits/products.lean</code> before</p>

<a name="148065294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148065294" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148065294">Johan Commelin (Nov 20 2018 at 20:25)</a>:</h4>
<p>Thanks for looking into this! Apparently it's trickier than I thought...</p>

<a name="148065317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148065317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148065317">Reid Barton (Nov 20 2018 at 20:25)</a>:</h4>
<p>There are so many instances and it's hard to tell which ones are used where.</p>

<a name="148065430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148065430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148065430">Reid Barton (Nov 20 2018 at 20:26)</a>:</h4>
<p>for example, <code>functor_category_has_coproducts</code> uses <code>limits.has_coproducts_of_has_colimits</code> which needs a <code>limits.has_colimits_of_shape.{u v} (discrete β)</code> instance. Does it come from <code>has_colimits_of_shape_of_has_coproducts_of_shape</code> or <code>functor_category_has_colimits_of_shape</code>?</p>

<a name="148065635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148065635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148065635">Reid Barton (Nov 20 2018 at 20:29)</a>:</h4>
<p>either way, it will eventually end up at <code>has_coproducts_of_shape</code> for the original category which comes from <code>has_coproducts_of_shape_of_has_coproducts</code> which uses <code>has_coproducts</code> which comes from an unnamed instance with definition <code>has_coproducts_of_has_colimits</code> which finally comes from the one true <code>has_colimits</code> instance for Type. I think.</p>

<a name="148065696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148065696" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148065696">Reid Barton (Nov 20 2018 at 20:30)</a>:</h4>
<p>So that's how you end up with the <code>has_colimits</code> -&gt; <code>has_coproducts</code> -&gt; <code>has_colimits</code> double translation, which is not <code>refl</code></p>

<a name="148640522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640522" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640522">Johan Commelin (Nov 27 2018 at 14:22)</a>:</h4>
<p>It's really quite stupid, but I only realised yesterday that all the time I've been working with the wrong <code>map f : presheaf X \functor presheaf Y</code>.</p>

<a name="148640569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640569">Johan Commelin (Nov 27 2018 at 14:23)</a>:</h4>
<p>We want something like this:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">map&#39;</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span> <span class="err">⥤</span> <span class="n">presheaf</span> <span class="n">Y</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">F</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span><span class="o">,</span> <span class="n">colimit</span> <span class="o">((</span><span class="n">comma</span><span class="bp">.</span><span class="n">snd</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span> <span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">of_obj</span> <span class="n">V</span><span class="o">)</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">),</span>
    <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V₁</span> <span class="n">V₂</span> <span class="n">j</span><span class="o">,</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">pre</span> <span class="o">((</span><span class="n">comma</span><span class="bp">.</span><span class="n">snd</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">u</span> <span class="n">u</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">functor</span><span class="bp">.</span><span class="n">of_obj</span> <span class="n">V₂</span><span class="o">)</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span> <span class="err">⋙</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">comma</span><span class="bp">.</span><span class="n">map_left</span> <span class="n">f</span> <span class="err">$</span> <span class="n">functor</span><span class="bp">.</span><span class="n">of_map</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">op</span><span class="o">,</span>
    <span class="n">map_id&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span><span class="o">,</span>
    <span class="k">begin</span>
      <span class="n">erw</span> <span class="n">functor</span><span class="bp">.</span><span class="n">of_map_id</span><span class="o">,</span>
      <span class="n">erw</span> <span class="n">colimit</span><span class="bp">.</span><span class="n">pre_map</span><span class="o">,</span>
      <span class="n">tidy</span><span class="o">,</span>
    <span class="kn">end</span> <span class="o">},</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>


<p>but I find it impossible to get this sorry-free.</p>

<a name="148640594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640594" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640594">Reid Barton (Nov 27 2018 at 14:23)</a>:</h4>
<p>This is what I implemented in the <code>adjunctions</code> branch, I think?</p>

<a name="148640600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640600">Johan Commelin (Nov 27 2018 at 14:23)</a>:</h4>
<p>This is what will give us the pullback of (pre)sheaves.</p>

<a name="148640608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640608" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640608">Johan Commelin (Nov 27 2018 at 14:24)</a>:</h4>
<p>Aaah, did you?</p>

<a name="148640664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640664" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640664">Johan Commelin (Nov 27 2018 at 14:24)</a>:</h4>
<p>I didn't look far enough, I'm afraid.</p>

<a name="148640670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640670" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640670">Reid Barton (Nov 27 2018 at 14:24)</a>:</h4>
<p>I think it is <code>yoneda_extension (F.comp yoneda)</code>?</p>

<a name="148640698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640698" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640698">Reid Barton (Nov 27 2018 at 14:24)</a>:</h4>
<p>at least, it seems to involve many of the same ingredients :)</p>

<a name="148640743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640743" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640743">Johan Commelin (Nov 27 2018 at 14:25)</a>:</h4>
<p>In which file?</p>

<a name="148640747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640747">Reid Barton (Nov 27 2018 at 14:25)</a>:</h4>
<p>another construction which I am not very happy about, though...</p>

<a name="148640751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640751" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640751">Reid Barton (Nov 27 2018 at 14:25)</a>:</h4>
<p><code>presheaf.lean</code></p>

<a name="148640850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640850">Johan Commelin (Nov 27 2018 at 14:27)</a>:</h4>
<p>Aaah, I see. Seems pretty non-trivial...</p>

<a name="148640875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640875" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640875">Johan Commelin (Nov 27 2018 at 14:27)</a>:</h4>
<p>Also, why do you work with <code>≃</code> instead of <code>≅</code>. Isn't that just as "bad"?</p>

<a name="148640886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640886">Reid Barton (Nov 27 2018 at 14:27)</a>:</h4>
<p>Yeah, I did it in a round-about way, in retrospect</p>

<a name="148640953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640953">Reid Barton (Nov 27 2018 at 14:28)</a>:</h4>
<p>In general I use <code>equiv</code> because it actually has useful lemmas and also it can relate different universes</p>

<a name="148640961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640961" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640961">Reid Barton (Nov 27 2018 at 14:28)</a>:</h4>
<p>though I added a couple more lemmas for <code>iso</code> in the limits PR</p>

<a name="148640996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148640996" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148640996">Johan Commelin (Nov 27 2018 at 14:29)</a>:</h4>
<p>Hmm, I feel like we should merge your <code>presheaf.lean</code> and my <code>sheaf.lean</code>. Or at least deduplicate.</p>

<a name="148641237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148641237" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148641237">Reid Barton (Nov 27 2018 at 14:33)</a>:</h4>
<p>I intend to take a second stab at all the adjunctions and presheaf stuff at some point, but I'm not actively working on it at the moment</p>

<a name="148641294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148641294" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148641294">Johan Commelin (Nov 27 2018 at 14:34)</a>:</h4>
<p>Ok, I'll move some stuff from my file to yours. So that <code>sheaf.lean</code> is only about sheaves.</p>

<a name="148641306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148641306" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148641306">Johan Commelin (Nov 27 2018 at 14:34)</a>:</h4>
<p>If you start working on it again, please make sure to take a look at the <code>sheaf</code> branch version of your file.</p>

<a name="148641624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148641624" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148641624">Reid Barton (Nov 27 2018 at 14:40)</a>:</h4>
<p>FWIW, my conclusion from my first attempt was that it's probably better to do all the constructions in a manifestly natural way, like Scott did in <code>yoneda.lean</code> for example, even though the result is probably pretty unreadable. Then you can add a simp lemma that explains what is actually happening on the level of objects</p>

<a name="148642150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148642150" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148642150">Reid Barton (Nov 27 2018 at 14:47)</a>:</h4>
<p>Or at least, don't have a bunch of isomorphisms with the naturality conditions stated separately. That was a big mess</p>

<a name="148642474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148642474" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148642474">Johan Commelin (Nov 27 2018 at 14:53)</a>:</h4>
<p>I see. That's what I've been trying to do. But I also got stuck.</p>

<a name="148642576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148642576" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148642576">Johan Commelin (Nov 27 2018 at 14:54)</a>:</h4>
<p>The problem with doing things in a "manifestly natural way" is that you get sucked into ever deeper/wider/higher abstractions...</p>

<a name="148642695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148642695" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148642695">Reid Barton (Nov 27 2018 at 14:56)</a>:</h4>
<p>it's true</p>

<a name="148643278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148643278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148643278">Reid Barton (Nov 27 2018 at 15:05)</a>:</h4>
<p>And that's sort of why I backed off from my previous comment. It's not obvious how to do this "category of elements" construction functorially</p>

<a name="148643384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148643384" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148643384">Reid Barton (Nov 27 2018 at 15:07)</a>:</h4>
<p>The key is to somehow give these things usable and complete instances, so that the way to prove things about them is not to <code>dsimp</code> 100 things</p>

<a name="148643417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148643417" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148643417">Reid Barton (Nov 27 2018 at 15:07)</a>:</h4>
<p>and that's where my current version of <code>presheaf.lean</code> sort of fell apart</p>

<a name="148643508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148643508" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148643508">Reid Barton (Nov 27 2018 at 15:08)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/adjunctions/category_theory/presheaf.lean#L310" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/adjunctions/category_theory/presheaf.lean#L310">https://github.com/leanprover-community/mathlib/blob/adjunctions/category_theory/presheaf.lean#L310</a></p>

<a name="148644814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148644814" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148644814">Johan Commelin (Nov 27 2018 at 15:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Does this mean that you think we should avoid <code>adjunction.left_adjoint_of_equiv</code>?</p>

<a name="148766980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148766980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148766980">Johan Commelin (Nov 29 2018 at 05:39)</a>:</h4>
<p>Yuchai! This is now sorry-free: <a href="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/presheaf.lean#L59" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/presheaf.lean#L59">https://github.com/leanprover-community/mathlib/blob/sheaf/category_theory/presheaf.lean#L59</a><br>
But it is slower than slow! Not sure how to speed it up though. I'm chaining a bunch of rewrites. Are there strategies for speeding this up?</p>

<a name="148767231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767231" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767231">Scott Morrison (Nov 29 2018 at 05:47)</a>:</h4>
<p>One thing that I find often works is to work out why the <code>erw</code> are necessary. This is sometimes unrewarding, but often it is because hidden inside implicit arguments there are things that should <code>dsimp</code>, but you forgot to write the appropriate <code>rfl</code> lemmas.  Sometimes you get really lucky, and after diagnosing a problem like this you can not only change the <code>erw</code> to <code>rw</code>, but even to <code>dsimp</code>!</p>

<a name="148767295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767295" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767295">Johan Commelin (Nov 29 2018 at 05:49)</a>:</h4>
<p>I see. (I've stopped using <code>rw</code>, because <code>erw</code> has more powerful magic (-;)</p>

<a name="148767296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767296" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767296">Johan Commelin (Nov 29 2018 at 05:49)</a>:</h4>
<p>Is <code>dsimp</code> faster than <code>erw</code>?</p>

<a name="148767299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767299" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767299">Scott Morrison (Nov 29 2018 at 05:49)</a>:</h4>
<p>Yes.</p>

<a name="148767305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767305">Scott Morrison (Nov 29 2018 at 05:50)</a>:</h4>
<p>And <code>erw</code> can be slower than <code>rw</code>, in places where either work. (I think?)</p>

<a name="148767352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767352">Scott Morrison (Nov 29 2018 at 05:50)</a>:</h4>
<p>Well, <code>dsimp</code> can be either faster or slower than <code>erw</code>. :-) But _usually_ it seems to be faster to avoid using <code>erw</code>.</p>

<a name="148767491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767491" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767491">Johan Commelin (Nov 29 2018 at 05:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Do you think we could have a <code>[derive rfl-lemmas]</code>?</p>

<a name="148767960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148767960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148767960">Scott Morrison (Nov 29 2018 at 06:10)</a>:</h4>
<p>I've just had a quick look at that proof, Johan, and I don't seem to be able to make much improvement. :-( There does seem to be a small problem changing between <code>colimit</code> and <code>colim.obj</code>.</p>

<a name="148770849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148770849" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148770849">Johan Commelin (Nov 29 2018 at 07:42)</a>:</h4>
<p>So here is what I imagine <code>derive rflsimp</code> (or whatever) should do: it looks at the current definition, and (as far as I thought this through, which is not that far) it does two checks:</p>
<ul>
<li>the definition is an "abbreviation" (like <code>def presheaf C := C \functor Type v</code>. In this case it looks up all the rflsimp lemmas that it derived for <code>C \functor D</code> and defines copies in the <code>presheaf</code> namespace.</li>
<li>the definition <code>X</code> is a structure. In this case it looks up all the fields. For a field <code>foo</code> it checks whether this is a Pi-type (?) and how many arguments the Pi takes. So if <code>foo := λ a b c, bar(a,b,c)</code> then it will create the appropriate simp-lemma (proved by <code>rfl</code>) that</li>
</ul>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">X</span><span class="bp">.</span><span class="n">foo</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">some_type</span><span class="o">)</span> <span class="o">:</span>  <span class="n">x</span><span class="bp">.</span><span class="n">foo</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">bar</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">c</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>


<p>Of course I don't know how to write <code>meta</code>-code. And of course this is probably a very simplified picture. But I think something like this should be possible, and I think it would result in three things:</p>
<ul>
<li>less boilerplate (especially in the category library!)</li>
<li>less broken proofs, where <code>tidy</code> doesn't work, because somewhere someone forgot to state the obvious <code>rfl</code>-simp-lemma.</li>
<li>less wasted time in hunting down the brokenness of the preceding point.</li>
</ul>

<a name="148771232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148771232" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148771232">Johan Commelin (Nov 29 2018 at 07:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Thanks for looking into speeding things up. I added a rflsimp-lemma for <code>colim.obj</code>. Do you have any clue why the first line in that proof (with the comment) didn't simplify?</p>

<a name="148777570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148777570" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148777570">Scott Morrison (Nov 29 2018 at 10:24)</a>:</h4>
<p>Nope, I couldn't work it out. The next "usual suspect" for simp not working is that the thing that needs to be <code>simp</code>ed is inside a function that looks superficially dependent but actually isn't when you think about it a bit. <code>simp</code>, which needs to build congruence lemmas to do "rewriting", can't work out what do to, but <code>rw</code> can. This is a "known problem" with <code>simp</code>, apparently.</p>

<a name="148777585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148777585" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148777585">Scott Morrison (Nov 29 2018 at 10:24)</a>:</h4>
<p>You know how to use <code>rewrite_search</code>, don't you? :-)</p>

<a name="148778422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148778422" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148778422">Keeley Hoek (Nov 29 2018 at 10:41)</a>:</h4>
<p>At some point Johan I made a thing which did this<br>
It was a command called <code>rfl_lemma</code> I think. If you have access to rewrite_search you have access to it, too</p>

<a name="148778431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148778431" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148778431">Keeley Hoek (Nov 29 2018 at 10:41)</a>:</h4>
<p>It only worked for structures though</p>

<a name="148779294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148779294" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148779294">Johan Commelin (Nov 29 2018 at 10:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110111">@Keeley Hoek</span> I don't have <code>rewrite_search</code>. Do you think it is ready to be tested by others? If so, what do I need to do to get started?</p>

<a name="148782650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148782650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148782650">Keeley Hoek (Nov 29 2018 at 12:13)</a>:</h4>
<p>You could always try it out! My understanding is that all you should have to do is add</p>
<div class="codehilite"><pre><span></span>lean-tidy = {git = &quot;https://github.com/semorrison/lean-tidy&quot;, rev = &quot;3a69d6241207f0c0758468dce666858027c54909&quot;}
</pre></div>


<p>to your <code>leanpkg.toml</code> and run <code>leanpkg configure</code>. (I'm slightly worried though because <code>lean-tidy</code> obviously imports from <code>mathlib</code>, which you are working on... but I suspect it will work find (I think this is what Scott does to get his proofs using it).</p>

<a name="148782717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148782717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148782717">Keeley Hoek (Nov 29 2018 at 12:14)</a>:</h4>
<p>Then import <code>tactic.rewrite_search</code>. You can try to discharge goals with the <code>rewrite_search</code> tactic, but make sure you tag lemmas it is allowed to use with <code>@[search]</code>. There is much more complicated stuff you can do (including more specific tagging), but that's a start!</p>

<a name="148783201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148783201" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148783201">Johan Commelin (Nov 29 2018 at 12:23)</a>:</h4>
<p>Thanks for the explanation!</p>

<a name="148783722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148783722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148783722">Scott Morrison (Nov 29 2018 at 12:34)</a>:</h4>
<p>I've actually never used it inside mathlib, I'm very curious if it works.</p>

<a name="148783729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148783729" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148783729">Keeley Hoek (Nov 29 2018 at 12:34)</a>:</h4>
<p>ooh<br>
Maybe it won't then</p>

<a name="148783739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148783739" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148783739">Keeley Hoek (Nov 29 2018 at 12:35)</a>:</h4>
<p>something about "ambiguous import xxxx"</p>

<a name="148784745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148784745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148784745">Johan Commelin (Nov 29 2018 at 12:59)</a>:</h4>
<p>How far are we from a merge request of a (preliminary) version of <code>rewrite_search</code>?</p>

<a name="148785350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148785350" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148785350">Johan Commelin (Nov 29 2018 at 13:10)</a>:</h4>
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> <span class="user-mention" data-user-id="110087">@Scott Morrison</span> I followed the instructions and then ran <code>leanpkg build</code>. I'm getting tons of errors <span class="emoji emoji-1f61c" title="stuck out tongue wink">:stuck_out_tongue_wink:</span></p>

<a name="148785538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148785538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148785538">Keeley Hoek (Nov 29 2018 at 13:14)</a>:</h4>
<p>:D</p>

<a name="148785563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148785563" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148785563">Keeley Hoek (Nov 29 2018 at 13:15)</a>:</h4>
<p>yeah, sorry<br>
I think what you actually have to do is copy paste the lean-tidy repo over mathlib<br>
but probably don't do that it will mess your history</p>

<a name="148857277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/148857277" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#148857277">Johan Commelin (Nov 30 2018 at 12:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110111">@Keeley Hoek</span> I can report that adding that Lean <em>does not</em> outright refuse that repo as a dependency of mathlib. However... there's tons and tons of errors. So it's not really usable in a sense.</p>

<a name="152638060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638060" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638060">Johan Commelin (Dec 28 2018 at 05:55)</a>:</h4>
<p>After a long period of being distracted by other work, I've returned to the sheaves and sites project. Stuff is now happening on the <code>sheaf-2</code> branch, which has less dependencies than <code>sheaf</code>.<br>
I am currently struggling with defining a pretty non-constructive map. I have a gadget <code>s</code> which comes with a proof that I can perform a certain construction after some choice, and the result of the construction does not depend on the choice. But how do I actually do this?</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span>
<span class="o">(</span><span class="n">matching_sections</span> <span class="n">c</span> <span class="n">F</span><span class="o">)</span> <span class="err">⟶</span> <span class="o">(</span><span class="n">matching_sections</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">s</span> <span class="o">:</span> <span class="n">matching_sections</span> <span class="n">c</span> <span class="n">F</span><span class="o">,</span> <span class="k">show</span> <span class="n">matching_sections</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span> <span class="n">F</span><span class="o">,</span> <span class="k">from</span>
<span class="o">{</span> <span class="n">val</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">delta</span> <span class="n">matching_sections</span> <span class="n">at</span> <span class="n">s</span><span class="o">,</span>
    <span class="n">choose</span> <span class="n">Ui</span> <span class="n">H</span> <span class="n">f</span> <span class="kn">using</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">_</span> <span class="n">H</span><span class="o">),</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">property</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>


<p>Here is what my goal window looks like</p>
<div class="codehilite"><pre><span></span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">X</span><span class="o">,</span>
<span class="n">U</span> <span class="o">:</span> <span class="n">X</span><span class="o">,</span>
<span class="n">c</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">,</span>
<span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">,</span>
<span class="n">s</span> <span class="o">:</span>
  <span class="o">{</span><span class="n">s</span> <span class="bp">//</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">Ui</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">Ui</span> <span class="err">∈</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">Uj</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">H_1</span> <span class="o">:</span> <span class="n">Uj</span> <span class="err">∈</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">Ui</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">Uj</span><span class="o">),</span>
     <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">Ui</span> <span class="n">H</span><span class="o">)</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">g</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">Uj</span> <span class="n">H_1</span><span class="o">)},</span>
<span class="n">Ui</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">,</span>
<span class="n">H</span> <span class="o">:</span> <span class="n">Ui</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span>
<span class="n">f</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="o">(</span><span class="n">V</span> <span class="err">⟶</span> <span class="n">Ui</span><span class="o">)</span>
<span class="err">⊢</span> <span class="n">Ui</span><span class="bp">.</span><span class="n">left</span> <span class="err">⟶</span> <span class="n">V</span><span class="bp">.</span><span class="n">left</span>
</pre></div>


<p>What I need to do is extract some hom <code>f</code> from <code>V</code> to <code>Ui</code> out of the current <code>f : nonempty (_)</code>. I should then be able to close the goal with <code>exact f.left</code>. But I can only eliminate into <code>Prop</code> from <code>nonempty</code>. So how should I set things up?<br>
All of this is at <a href="https://github.com/leanprover-community/mathlib/blob/sheaf-2/category_theory/sheaf.lean#L190-L199" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/sheaf-2/category_theory/sheaf.lean#L190-L199">https://github.com/leanprover-community/mathlib/blob/sheaf-2/category_theory/sheaf.lean#L190-L199</a></p>

<a name="152638676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638676" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638676">Reid Barton (Dec 28 2018 at 06:14)</a>:</h4>
<p>Are you going to need to prove the resulting construction is independent of the choice?</p>

<a name="152638688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638688" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638688">Reid Barton (Dec 28 2018 at 06:15)</a>:</h4>
<p>The simple answer is to use choice again, in the form of <code>classical.choice</code></p>

<a name="152638738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638738" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638738">Reid Barton (Dec 28 2018 at 06:16)</a>:</h4>
<p>maybe the <code>choose</code> tactic could do this when the final Prop is a <code>nonempty</code></p>

<a name="152638740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638740" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638740">Reid Barton (Dec 28 2018 at 06:16)</a>:</h4>
<p>or you could use that <code>\exists blah, blah, blah, true</code> encoding</p>

<a name="152638796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638796">Johan Commelin (Dec 28 2018 at 06:18)</a>:</h4>
<p>So <code>nonempty blah</code> is not Lean-equivalent to the <code>\exists blah, blah, blah, true</code> encoding?</p>

<a name="152638804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638804" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638804">Johan Commelin (Dec 28 2018 at 06:19)</a>:</h4>
<p>The <code>choose</code> tactic doesn't help... <span class="emoji emoji-2639" title="sad">:sad:</span></p>

<a name="152638807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638807" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638807">Reid Barton (Dec 28 2018 at 06:19)</a>:</h4>
<p>it's not definitionally equivalent, much as <code>p /\ true</code> isn't definitionally equivalent to <code>p</code></p>

<a name="152638882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638882" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638882">Johan Commelin (Dec 28 2018 at 06:21)</a>:</h4>
<p><code>nonempty_of_exists</code> is not an iff...</p>

<a name="152638940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638940" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638940">Reid Barton (Dec 28 2018 at 06:22)</a>:</h4>
<p>You can just use <code>choice f</code></p>

<a name="152638952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638952" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638952">Johan Commelin (Dec 28 2018 at 06:23)</a>:</h4>
<p>Ok, I'll try that. Too bad that <code>choose f</code> does not work.</p>

<a name="152638953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152638953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152638953">Reid Barton (Dec 28 2018 at 06:23)</a>:</h4>
<p>Sometimes when there is going to be a lot of "can only eliminate into Prop" nonsense in a proof, I just put an <code>apply choice</code> at the start</p>

<a name="152639001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152639001" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152639001">Reid Barton (Dec 28 2018 at 06:24)</a>:</h4>
<p>or not necessarily at the start of the whole argument, but at the start of some subargument to satisfy some lemma which wants to take an actual map rather than just an existence statement</p>

<a name="152642729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152642729" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152642729">Johan Commelin (Dec 28 2018 at 08:22)</a>:</h4>
<p>Ok, that worked. But I still wonder why <code>choose f</code> didn't work. <span class="user-mention" data-user-id="110031">@Patrick Massot</span> Any ideas why <code>choose</code> doesn't work on <code>nonempty</code>?<br>
Here's the proof that I have now</p>
<div class="codehilite"><pre><span></span><span class="n">noncomputable</span> <span class="n">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span>
<span class="o">(</span><span class="n">matching_sections</span> <span class="n">c</span> <span class="n">F</span><span class="o">)</span> <span class="err">⟶</span> <span class="o">(</span><span class="n">matching_sections</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">s</span> <span class="o">:</span> <span class="n">matching_sections</span> <span class="n">c</span> <span class="n">F</span><span class="o">,</span> <span class="k">show</span> <span class="n">matching_sections</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span> <span class="n">F</span><span class="o">,</span> <span class="k">from</span>
<span class="o">{</span> <span class="n">val</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">delta</span> <span class="n">matching_sections</span> <span class="n">at</span> <span class="n">s</span><span class="o">,</span>
    <span class="n">choose</span> <span class="n">Ui</span> <span class="n">H</span> <span class="n">f</span> <span class="kn">using</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">_</span> <span class="n">H</span><span class="o">),</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">classical</span><span class="bp">.</span><span class="n">choice</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">property</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>

<a name="152642813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152642813" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152642813">Kenny Lau (Dec 28 2018 at 08:25)</a>:</h4>
<p>because <code>choose</code> is skolemization?</p>

<a name="152643079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152643079" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152643079">Johan Commelin (Dec 28 2018 at 08:32)</a>:</h4>
<p>I don't know what that means.</p>

<a name="152643597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152643597" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152643597">Johan Commelin (Dec 28 2018 at 08:47)</a>:</h4>
<p>I love the marvellous power of the underscore:</p>
<div class="codehilite"><pre><span></span><span class="n">noncomputable</span> <span class="n">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span>
<span class="o">(</span><span class="n">matching_sections</span> <span class="n">c</span> <span class="n">F</span><span class="o">)</span> <span class="err">⟶</span> <span class="o">(</span><span class="n">matching_sections</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span> <span class="n">F</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">s</span> <span class="o">:</span> <span class="n">matching_sections</span> <span class="n">c</span> <span class="n">F</span><span class="o">,</span> <span class="k">show</span> <span class="n">matching_sections</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span> <span class="n">F</span><span class="o">,</span> <span class="k">from</span>
<span class="o">{</span> <span class="n">val</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">choose</span> <span class="n">Ui</span> <span class="n">H</span> <span class="n">f</span> <span class="kn">using</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">refine</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">_</span> <span class="n">H</span><span class="o">),</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">classical</span><span class="bp">.</span><span class="n">choice</span> <span class="n">f</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">property</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">intros</span><span class="o">,</span>
    <span class="k">show</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">=</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">repeat</span> <span class="o">{</span><span class="n">rw</span> <span class="err">←</span> <span class="n">F</span><span class="bp">.</span><span class="n">map_comp</span><span class="o">},</span>
    <span class="n">exact</span> <span class="n">s</span><span class="bp">.</span><span class="n">property</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">_</span> <span class="err">≫</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">_</span> <span class="err">≫</span> <span class="bp">_</span><span class="o">)</span>
  <span class="kn">end</span> <span class="o">}</span>
</pre></div>

<a name="152667001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/152667001" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#152667001">Johan Commelin (Dec 28 2018 at 18:53)</a>:</h4>
<p>I'm hitting a nasty error again (probably I'm being bitten by <code>choice</code>).<br>
Here is the error (code follows below):</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="bp">⟨</span><span class="n">s_val</span><span class="o">,</span> <span class="n">s_property</span><span class="bp">⟩.</span><span class="n">val</span> <span class="n">Ui</span> <span class="n">H</span>
<span class="n">term</span>
  <span class="n">H</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">Ui_1</span> <span class="err">∈</span> <span class="n">c_1</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">Ui</span> <span class="err">∈</span> <span class="n">c</span>
<span class="n">types</span> <span class="n">contain</span> <span class="n">aliased</span> <span class="n">name</span><span class="o">(</span><span class="n">s</span><span class="o">):</span> <span class="n">Ui</span> <span class="n">U</span> <span class="n">c</span>
<span class="n">remark</span><span class="o">:</span> <span class="n">the</span> <span class="n">tactic</span> <span class="bp">`</span><span class="n">dedup</span><span class="bp">`</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">rename</span> <span class="n">aliases</span>
</pre></div>


<p>Code:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">quux</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
<span class="n">c</span><span class="bp">.</span><span class="n">matching_sections</span> <span class="err">≅</span> <span class="n">c</span><span class="bp">.</span><span class="n">generate_sieve</span><span class="bp">.</span><span class="n">val</span><span class="bp">.</span><span class="n">matching_sections</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">hom</span> <span class="o">:=</span> <span class="n">foo</span> <span class="n">c</span><span class="o">,</span>
  <span class="n">inv</span> <span class="o">:=</span> <span class="n">bar</span> <span class="n">c</span><span class="o">,</span>
  <span class="n">hom_inv_id&#39;</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">ext1</span> <span class="n">F</span><span class="o">,</span>
    <span class="n">ext1</span> <span class="n">s</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">ext</span><span class="bp">.</span><span class="n">mpr</span><span class="o">,</span>
    <span class="n">funext</span><span class="o">,</span>
    <span class="n">convert</span> <span class="n">s</span><span class="bp">.</span><span class="n">property</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="bp">_</span><span class="o">),</span>
    <span class="n">tidy</span> <span class="o">{</span><span class="n">trace_result</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">}</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">inv_hom_id&#39;</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">ext1</span> <span class="n">F</span><span class="o">,</span>
    <span class="n">ext1</span> <span class="n">s</span><span class="o">,</span>
    <span class="n">apply</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">ext</span><span class="bp">.</span><span class="n">mpr</span><span class="o">,</span>
    <span class="n">funext</span><span class="o">,</span>
    <span class="n">dsimp</span> <span class="o">[</span><span class="n">foo</span><span class="o">,</span> <span class="n">bar</span><span class="o">],</span>
    <span class="n">convert</span> <span class="n">s</span><span class="bp">.</span><span class="n">property</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="bp">_</span><span class="o">),</span> <span class="c1">-- This line fails</span>
    <span class="n">tidy</span> <span class="o">{</span><span class="n">trace_result</span> <span class="o">:=</span> <span class="n">tt</span><span class="o">},</span>
  <span class="kn">end</span> <span class="o">}</span>
</pre></div>


<p>Context, just before the <code>convert</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">X</span><span class="o">,</span>
<span class="n">U</span> <span class="o">:</span> <span class="n">X</span><span class="o">,</span>
<span class="n">c</span> <span class="o">:</span> <span class="n">covering_family</span> <span class="n">U</span><span class="o">,</span>
<span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">X</span><span class="o">,</span>
<span class="n">s</span> <span class="o">:</span> <span class="o">(</span><span class="n">matching_sections</span> <span class="o">((</span><span class="n">generate_sieve</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">val</span><span class="o">))</span><span class="bp">.</span><span class="n">obj</span> <span class="n">F</span><span class="o">,</span>
<span class="n">V</span> <span class="o">:</span> <span class="n">over</span> <span class="n">U</span><span class="o">,</span>
<span class="n">H</span> <span class="o">:</span> <span class="n">V</span> <span class="err">∈</span> <span class="o">(</span><span class="n">generate_sieve</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">val</span>
<span class="err">⊢</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="o">((</span><span class="n">classical</span><span class="bp">.</span><span class="n">choice</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">left</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="n">classical</span><span class="bp">.</span><span class="n">some</span> <span class="n">H</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">=</span> <span class="n">s</span><span class="bp">.</span><span class="n">val</span> <span class="n">V</span> <span class="n">H</span>
</pre></div>

<a name="156493474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/156493474" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#156493474">Johan Commelin (Jan 20 2019 at 19:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Replying to <a href="#narrow/stream/116395-maths/topic/What's.20new.20in.20Lean.20maths.3F/near/156491890" title="#narrow/stream/116395-maths/topic/What's.20new.20in.20Lean.20maths.3F/near/156491890">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/What's.20new.20in.20Lean.20maths.3F/near/156491890</a> in this thread.<br>
To be precise: I have no trouble at all extending a presheaf from a basis to the whole space. The problem is checking that it sends sheaves to sheaves. The difficulty is probably due to the fact that I do not have a usable API around the sheaf condition.<br>
And I guess my sheaf condition is hard to work with right now because I'm trying to be quite general, doing sheaves on an arbitrary site.</p>

<a name="156495585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/156495585" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#156495585">Kevin Buzzard (Jan 20 2019 at 20:02)</a>:</h4>
<p>Oh -- the proof involves some argument on stalks which for a general site is complicated? Are there universe issues or do you only work with small sites?</p>

<a name="157127004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127004">Kevin Buzzard (Jan 29 2019 at 18:39)</a>:</h4>
<p>OK so I just spent 2 hours with Ramon going through this proof (sheaf on a basis extends to sheaf on site) again in the case of topological spaces. The ideas are all fresh in my mind at the minute so let me note them down in case there's anything helpful here.</p>
<p>Aah -- I now realise that actually I don't know how you're extending the presheaf at all. The way Ramon and I do it is that given a presheaf <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.13889em;">F</span></span></span></span> on a basis we can define the stalk <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>F</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">F_x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> at a point <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> via a direct limit construction, and then we define a presheaf <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:0.771331em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> on the space by saying that its values on an open <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> are a subtype of a big Pi type sending <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>∈</mo><mi>U</mi></mrow><annotation encoding="application/x-tex">x\in U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">∈</span><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> to an element of the stalk <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>F</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">F_x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>; it's the subtype consisting of functions which are locally a section of the presheaf-on-a-basis.</p>
<p>What both he and I did next was then immediately embarked on a proof that if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.13889em;">F</span></span></span></span> is a sheaf on a basis then this extension is a sheaf. This gets really hairy. Say I have a bunch of local sections <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> on opens <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, which agree on overlaps. I want to glue them together to get a section <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:0.771331em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>. Well, a section of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:0.771331em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> is just a subtype of a pi type, so we know how to define it. But the technicality is that to define this function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span> we want to say <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><msub><mi>s</mi><mi>i</mi></msub><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">S(x)=s_i(x)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span class="mord mathit">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> where we choose some <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">i</span></span></span></span> such that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>∈</mo><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x\in U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">∈</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>. As mathematicians we know that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">S(x)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> is independent of the choice, but in computer science this is some <code>classical.indefinite_description</code> blah blah noncomputable crap and we're forced to deal with this. Ramon had written 0 API so at the end of it our goals had all these <code>classical.indefinite_description</code> terms in. He was able to battle past the first few, but checking that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span></span> restricted to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> was really difficult, for a reason which I am only now beginning to understand properly. </p>
<p>The issue was that we didn't have the right API for this construction of extending a presheaf-on-a-basis to a presheaf on the space. A general presheaf on a space, when evaluated at some open <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span>, is just some random type. But for a presheaf coming from a presheaf-on-a-basis this is far from being true -- the sections are subtypes of pi types, and the restriction maps are literally restrictions. This is all wrapped up in the definition of the construction of a presheaf from a presheaf-on-a-basis. I realised that if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:0.771331em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> is a presheaf coming from a presheaf-on-a-basis then for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>∈</mo><mi>U</mi><mo>⊆</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">x\in U\subseteq X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">∈</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mrel">⊆</span><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mo>∈</mo><msup><mi>F</mi><mo>+</mo></msup><mo>(</mo><mi>X</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">s\in F^+(X)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:1.021331em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit">s</span><span class="mrel">∈</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span> a function, the fact that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>r</mi><mi>e</mi><msub><mi>s</mi><mi>U</mi></msub><mi>s</mi><mo>)</mo><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>s</mi><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(res_U s)(x)=s(x)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord"><span class="mord mathit">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.10903em;">U</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord mathit">s</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit">s</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span> seemed to be true by definition, but Lean would not definitionally unfold the restriction map from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup><mo>(</mo><mi>X</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">F^+(X)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:1.021331em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup><mo>(</mo><mi>U</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">F^+(U)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:1.021331em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mclose">)</span></span></span></span> as a restriction of functions. I had to explicitly push Lean in the right direction with lines like <code>dunfold presheaf_on_basis_to_presheaf, dsimp</code>; I was really surprised that this could make progress when a simple <code>dsimp</code> could not.</p>
<p>But we shouldn't have been doing this anyway. It seems to me that the correct thing to do is:</p>
<p>1) Define the construction <code>presheaf_on_basis_to_presheaf</code><br>
2) Define also the actual noncomputable function space, i.e. given <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.13889em;">F</span></span></span></span> a presheaf on a basis, and an open set $$U$ (not necc in the basis), define the space of functions sending an element <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> to an element of the stalk <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>F</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">F_x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, and have some coercion from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup><mo>(</mo><mi>U</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">F^+(U)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:1.021331em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mclose">)</span></span></span></span> to this space of functions.<br>
3) Crucially, prove (by rfl) that the restriction map on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>F</mi><mo>+</mo></msup></mrow><annotation encoding="application/x-tex">F^+</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:0.771331em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span> really is just restriction of functions. This is some key lemma which if you don't explicitly say it, can get buried. Prove it for values too -- prove that if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>∈</mo><msup><mi>F</mi><mo>+</mo></msup><mo>(</mo><mi>U</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">S\in F^+(U)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.771331em;"></span><span class="strut bottom" style="height:1.021331em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mrel">∈</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mo>⊆</mo><mi>U</mi></mrow><annotation encoding="application/x-tex">V\subseteq U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mrel">⊆</span><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">x\in V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">∈</span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span> then <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mi>r</mi><mi>e</mi><mi>s</mi><mo>(</mo><mi>S</mi><mo>)</mo><mo>(</mo><mi>x</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">S(x)=res(S)(x)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">s</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span></span></span></span>. This is how you will eliminate <code>res</code> in practice. We were having to eliminate it using <code>dunfold</code> and then <code>dsimp</code>.<br>
4) Also crucially, you should hide the <code>classical.indefinite_description</code>s. Given local sections <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> which agree on overlaps, there's a non-computable function on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> which agrees with each <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, but to define it at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">x</span></span></span></span> you have to choose <br>
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">i</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>∈</mo><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">x\in U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord mathit">x</span><span class="mrel">∈</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>. It's a theorem that the resulting function is independent of all choices. Define the noncomputable function and prove the theorem -- you will need it later!</p>
<p>We'd done none of this, and it was only when struggling through the proof that I began to understand what was missing. </p>
<p>I know you (Johan) are working in a far more complicated situation, but somehow these are the things which seem to me to be necessary to make things work smoothly. Ramon arrived in my office with a goal that had three <code>classical.indefinite_description</code>s on one side of an equality, and these are horrible to work with. The idea which Patrick showed so convincingly in his Nantes talk -- hide the nonconstructive stuff with a <code>choose</code> tactic and immediately go to the noncomputable function and the proof that it has the key property you want -- is a really important trick for getting things to run smoothly.</p>

<a name="157127474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127474" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127474">Johan Commelin (Jan 29 2019 at 18:45)</a>:</h4>
<p>Thanks for these detailed comments! They will probably be helpful when I pick up my work on sheaves again in a couple of days!</p>

<a name="157127497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127497">Kevin Buzzard (Jan 29 2019 at 18:45)</a>:</h4>
<p>How do you extend the presheaf on a basis in your generality?</p>

<a name="157127506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127506" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127506">Kevin Buzzard (Jan 29 2019 at 18:45)</a>:</h4>
<p>Is it still a stalk-valued function?</p>

<a name="157127610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127610" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127610">Johan Commelin (Jan 29 2019 at 18:47)</a>:</h4>
<p>You can take a limit over all basic opens contained in <code>U</code>.</p>

<a name="157127633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127633" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127633">Kevin Buzzard (Jan 29 2019 at 18:47)</a>:</h4>
<p>Does that work for sites?</p>

<a name="157127653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127653" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127653">Johan Commelin (Jan 29 2019 at 18:47)</a>:</h4>
<p>Yes, extending the presheaf is not too hard. What I'm missing is a good API for the sheaf condition.</p>

<a name="157127736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127736" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127736">Kevin Buzzard (Jan 29 2019 at 18:48)</a>:</h4>
<p>What I learnt today was that there are special extra lemmas for presheaves which have come from a presheaf-on-a-basis, and those are what we needed to prove that sheaves go to sheaves.</p>

<a name="157127754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127754" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127754">Johan Commelin (Jan 29 2019 at 18:49)</a>:</h4>
<p>Because it needs to work with abstract sites (where you don't know anything about the opens in your category) and then it should also work for concrete things like the open sets in a concrete topological space (and your presheaf has some concrete interpretation as functions)... somehow these two things don't play nicely together yet.</p>

<a name="157127787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157127787" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157127787">Kevin Buzzard (Jan 29 2019 at 18:49)</a>:</h4>
<p>But your limit is different. You're taking a subset of a product perhaps.</p>

<a name="157128038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157128038" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157128038">Kevin Buzzard (Jan 29 2019 at 18:52)</a>:</h4>
<p>Hmm. Maybe the ideas are still the same. I'm perhaps suggesting that you spend some time proving lemmas (by rfl) about the function sending an open U to the product of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo>(</mo><msub><mi>U</mi><mi>i</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">F(U_i)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mclose">)</span></span></span></span> where the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> range over the basis elements that are part of a cover. Then prove that if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span> is a subset of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> then the restriction map is something like "restrict to the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> which map to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span>". Or something.</p>

<a name="157128445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157128445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157128445">Johan Commelin (Jan 29 2019 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> <span class="user-mention" data-user-id="132858">@Ramon Fernandez Mir</span> Does this mean that you are now rapidly approaching a cleaned up version of schemes? When will there be code that we can look at?</p>

<a name="157129667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157129667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157129667">Mario Carneiro (Jan 29 2019 at 19:15)</a>:</h4>
<p>I would also like to see some code, I might be able to give some tips. I think you should define the glue construction  for functions, i.e. if you have a bunch of functions that agree on overlaps then you get a function on the union. You can put your choices here and never see them again</p>

<a name="157134234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157134234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157134234">Kevin Buzzard (Jan 29 2019 at 20:13)</a>:</h4>
<p><a href="https://github.com/ramonfmir/lean-scheme" target="_blank" title="https://github.com/ramonfmir/lean-scheme">https://github.com/ramonfmir/lean-scheme</a></p>

<a name="157134245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/157134245" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#157134245">Kevin Buzzard (Jan 29 2019 at 20:13)</a>:</h4>
<p>We've only just started really, but we're moving along nicely.</p>

<a name="168787052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168787052" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168787052">Kenny Lau (Jun 23 2019 at 09:44)</a>:</h4>
<p>do we have sheaves on sites yet? how far are we away from it?</p>

<a name="168811346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168811346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168811346">Kenny Lau (Jun 23 2019 at 22:53)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span><span class="bp">.</span><span class="n">limits</span>

<span class="n">universes</span> <span class="n">v</span> <span class="n">w</span> <span class="n">u</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kn">inductive</span> <span class="n">pullback_diagram</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span>
<span class="bp">|</span> <span class="n">base_left</span> <span class="bp">|</span> <span class="n">base_right</span> <span class="bp">|</span> <span class="n">target</span>

<span class="kn">namespace</span> <span class="n">pullback_diagram</span>

<span class="kn">inductive</span> <span class="n">hom</span> <span class="o">:</span> <span class="n">pullback_diagram</span> <span class="bp">→</span> <span class="n">pullback_diagram</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span>
<span class="bp">|</span> <span class="n">id_base_left</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">base_left</span> <span class="n">base_left</span>
<span class="bp">|</span> <span class="n">id_base_right</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">base_right</span> <span class="n">base_right</span>
<span class="bp">|</span> <span class="n">id_target</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">target</span> <span class="n">target</span>
<span class="bp">|</span> <span class="n">to_target_left</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">base_left</span> <span class="n">target</span>
<span class="bp">|</span> <span class="n">to_target_right</span> <span class="o">:</span> <span class="n">hom</span> <span class="n">base_right</span> <span class="n">target</span>

<span class="n">def</span> <span class="n">id</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">X</span> <span class="o">:</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">},</span> <span class="n">hom</span> <span class="n">X</span> <span class="n">X</span>
<span class="bp">|</span> <span class="n">base_left</span>  <span class="o">:=</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_base_left</span>
<span class="bp">|</span> <span class="n">base_right</span> <span class="o">:=</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_base_right</span>
<span class="bp">|</span> <span class="n">target</span>     <span class="o">:=</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_target</span>

<span class="n">def</span> <span class="n">comp</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">},</span> <span class="n">hom</span> <span class="n">X</span> <span class="n">Y</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">Y</span> <span class="n">Z</span> <span class="bp">→</span> <span class="n">hom</span> <span class="n">X</span> <span class="n">Z</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_base_left</span>    <span class="n">g</span>             <span class="o">:=</span> <span class="n">g</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_base_right</span>   <span class="n">g</span>             <span class="o">:=</span> <span class="n">g</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_target</span>       <span class="n">g</span>             <span class="o">:=</span> <span class="n">g</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hom</span><span class="bp">.</span><span class="n">to_target_left</span>  <span class="n">hom</span><span class="bp">.</span><span class="n">id_target</span> <span class="o">:=</span> <span class="n">hom</span><span class="bp">.</span><span class="n">to_target_left</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">hom</span><span class="bp">.</span><span class="n">to_target_right</span> <span class="n">hom</span><span class="bp">.</span><span class="n">id_target</span> <span class="o">:=</span> <span class="n">hom</span><span class="bp">.</span><span class="n">to_target_right</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">small_category</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">hom</span> <span class="o">:=</span> <span class="n">hom</span><span class="o">,</span>
  <span class="n">id</span> <span class="o">:=</span> <span class="n">id</span><span class="o">,</span>
  <span class="n">comp</span> <span class="o">:=</span> <span class="n">comp</span><span class="o">,</span>
  <span class="n">comp_id&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">f</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">refl</span><span class="o">,</span>
  <span class="n">id_comp&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">f</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">refl</span><span class="o">,</span>
  <span class="n">assoc&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">W</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="n">f</span> <span class="n">g</span> <span class="n">h</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">g</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h</span><span class="bp">;</span> <span class="n">refl</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">to_category</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="err">𝒞</span> <span class="o">:</span> <span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">pullback_diagram</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="err">⥤</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">obj</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">p</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">,</span>
  <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span> <span class="n">h</span><span class="o">,</span> <span class="bp">@</span><span class="n">hom</span><span class="bp">.</span><span class="n">rec_on</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">p&#39;</span> <span class="n">q&#39;</span> <span class="n">h&#39;</span><span class="o">,</span> <span class="o">(</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">p&#39;</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="err">⟶</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">q&#39;</span> <span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span><span class="o">)</span> <span class="n">p</span> <span class="n">q</span> <span class="n">h</span>
    <span class="o">(</span><span class="mi">𝟙</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">Z</span><span class="o">)</span> <span class="n">f</span> <span class="n">g</span><span class="o">,</span>
  <span class="n">map_id&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">p</span><span class="bp">;</span> <span class="n">refl</span><span class="o">,</span>
  <span class="n">map_comp&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span> <span class="n">r</span> <span class="n">h1</span> <span class="n">h2</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">h1</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h2</span><span class="bp">;</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category_struct</span><span class="bp">.</span><span class="n">comp</span><span class="o">,</span> <span class="n">comp</span><span class="o">]</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="n">comp_id</span><span class="o">,</span> <span class="n">category</span><span class="bp">.</span><span class="n">id_comp</span><span class="o">]</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">to_category_cone</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="err">𝒞</span> <span class="o">:</span> <span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">f&#39;</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">g&#39;</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">f&#39;</span> <span class="err">≫</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">g&#39;</span> <span class="err">≫</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">limits</span><span class="bp">.</span><span class="n">cone</span> <span class="o">(</span><span class="n">to_category</span> <span class="n">f</span> <span class="n">g</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">W</span><span class="o">,</span>
  <span class="n">π</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">p</span> <span class="n">f&#39;</span> <span class="n">g&#39;</span> <span class="o">(</span><span class="n">f&#39;</span> <span class="err">≫</span> <span class="n">f</span><span class="o">),</span>
    <span class="n">naturality&#39;</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">q</span> <span class="n">f</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">f</span><span class="bp">;</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">functor</span><span class="bp">.</span><span class="n">const</span><span class="o">,</span> <span class="n">to_category</span><span class="o">]</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="n">comp_id</span><span class="o">,</span> <span class="n">category</span><span class="bp">.</span><span class="n">id_comp</span><span class="o">,</span> <span class="n">h</span><span class="o">]</span> <span class="o">}</span> <span class="o">}</span>

<span class="kn">end</span> <span class="n">pullback_diagram</span>

<span class="bp">@</span><span class="o">[</span><span class="n">class</span><span class="o">]</span> <span class="n">def</span> <span class="n">has_pullback</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">limits</span><span class="bp">.</span><span class="n">has_limits_of_shape</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span>

<span class="kn">section</span> <span class="n">has_pullback</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="err">𝒞</span> <span class="o">:</span> <span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">P</span> <span class="o">:</span> <span class="n">has_pullback</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span>
<span class="n">include</span> <span class="err">𝒞</span> <span class="n">P</span>

<span class="n">def</span> <span class="n">pullback</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">P</span> <span class="o">(</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">to_category</span> <span class="n">f</span> <span class="n">g</span><span class="o">))</span><span class="bp">.</span><span class="n">cone</span><span class="bp">.</span><span class="n">X</span>

<span class="n">def</span> <span class="n">pullback</span><span class="bp">.</span><span class="n">fst</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:</span> <span class="n">pullback</span> <span class="n">f</span> <span class="n">g</span> <span class="err">⟶</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">P</span> <span class="o">(</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">to_category</span> <span class="n">f</span> <span class="n">g</span><span class="o">))</span><span class="bp">.</span><span class="n">cone</span><span class="bp">.</span><span class="n">π</span><span class="bp">.</span><span class="n">app</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">base_left</span>

<span class="n">def</span> <span class="n">pullback</span><span class="bp">.</span><span class="n">snd</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">:</span> <span class="n">pullback</span> <span class="n">f</span> <span class="n">g</span> <span class="err">⟶</span> <span class="n">Y</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">P</span> <span class="o">(</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">to_category</span> <span class="n">f</span> <span class="n">g</span><span class="o">))</span><span class="bp">.</span><span class="n">cone</span><span class="bp">.</span><span class="n">π</span><span class="bp">.</span><span class="n">app</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">base_right</span>

<span class="n">def</span> <span class="n">pullback</span><span class="bp">.</span><span class="n">corec</span> <span class="o">{</span><span class="n">X</span> <span class="n">Y</span> <span class="n">Z</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">Y</span> <span class="err">⟶</span> <span class="n">Z</span><span class="o">)</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">f&#39;</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">g&#39;</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">Y</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">f&#39;</span> <span class="err">≫</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">g&#39;</span> <span class="err">≫</span> <span class="n">g</span><span class="o">)</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">pullback</span> <span class="n">f</span> <span class="n">g</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">P</span> <span class="o">(</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">to_category</span> <span class="n">f</span> <span class="n">g</span><span class="o">))</span><span class="bp">.</span><span class="n">is_limit</span><span class="bp">.</span><span class="n">lift</span> <span class="o">(</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">to_category_cone</span> <span class="n">f</span> <span class="n">g</span> <span class="n">W</span> <span class="n">f&#39;</span> <span class="n">g&#39;</span> <span class="n">h</span><span class="o">)</span>

<span class="kn">end</span> <span class="n">has_pullback</span>

<span class="n">class</span> <span class="n">has_site</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">has_pullback</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">cov</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">U</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="n">set</span> <span class="o">(</span><span class="n">set</span> <span class="o">(</span><span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">)))</span>
<span class="o">(</span><span class="n">iso_mem</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">V</span> <span class="err">≅</span> <span class="n">U</span><span class="o">),</span> <span class="o">{</span> <span class="n">sigma</span><span class="bp">.</span><span class="n">mk</span> <span class="n">V</span> <span class="n">e</span><span class="bp">.</span><span class="mi">1</span> <span class="o">}</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">U</span><span class="o">)</span>
<span class="o">(</span><span class="n">comp_mem</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">U</span> <span class="o">:</span> <span class="n">C</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">))</span> <span class="o">(</span><span class="n">HS</span> <span class="o">:</span> <span class="n">S</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">U</span><span class="o">)</span>
  <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">m</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">,</span> <span class="n">m</span> <span class="err">∈</span> <span class="n">S</span> <span class="bp">→</span> <span class="n">set</span> <span class="o">(</span><span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">m</span><span class="bp">.</span><span class="mi">1</span><span class="o">)),</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="n">m</span> <span class="n">hm</span><span class="o">,</span> <span class="n">F</span> <span class="n">m</span> <span class="n">hm</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">m</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span> <span class="bp">→</span>
  <span class="o">{</span> <span class="n">m</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">t</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">u</span> <span class="err">∈</span> <span class="n">F</span> <span class="n">t</span> <span class="n">H</span><span class="o">,</span> <span class="o">(</span><span class="bp">⟨</span><span class="n">u</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">u</span><span class="bp">.</span><span class="mi">2</span> <span class="err">≫</span> <span class="n">t</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">)</span> <span class="bp">=</span> <span class="n">m</span> <span class="o">}</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">U</span><span class="o">)</span>
<span class="o">(</span><span class="n">pullback_mem</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">m</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">t</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="o">(</span><span class="bp">⟨_</span><span class="o">,</span> <span class="n">pullback</span><span class="bp">.</span><span class="n">fst</span> <span class="n">f</span> <span class="n">t</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">W</span><span class="o">,</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">V</span><span class="o">)</span> <span class="bp">=</span> <span class="n">m</span> <span class="o">}</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">V</span><span class="o">)</span>

<span class="kn">end</span> <span class="n">category_theory</span>

<span class="kn">namespace</span> <span class="n">lattice</span>

<span class="n">class</span> <span class="n">Sup_lattice</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">lattice</span> <span class="n">X</span><span class="o">,</span> <span class="n">has_Sup</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">le_Sup</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">X</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">X</span><span class="o">},</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">s</span><span class="o">)</span>
<span class="o">(</span><span class="n">Sup_le</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">X</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">X</span><span class="o">},</span> <span class="o">(</span><span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">X</span><span class="o">),</span> <span class="n">b</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="bp">→</span> <span class="n">Sup</span> <span class="n">s</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span>

<span class="n">class</span> <span class="n">Sup_distrib_lattice</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">Sup_lattice</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">inf_Sup_le</span> <span class="o">{}</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">X</span><span class="o">}</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">X</span><span class="o">},</span> <span class="n">x</span> <span class="err">⊓</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">Sup</span> <span class="n">s</span> <span class="bp">≤</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">Sup</span> <span class="o">((</span><span class="err">⊓</span><span class="o">)</span> <span class="n">x</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">))</span>

<span class="kn">section</span> <span class="n">Sup_lattice</span>

<span class="kn">instance</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">to_Sup_lattice</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">Sup_lattice</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="bp">..</span> <span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">complete_lattice</span> <span class="n">X</span><span class="o">)</span> <span class="o">}</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">Sup_lattice</span> <span class="n">X</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">le_Sup&#39;</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">X</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">X</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="n">s</span> <span class="o">:=</span>
<span class="n">Sup_lattice</span><span class="bp">.</span><span class="n">le_Sup</span>

<span class="kn">theorem</span> <span class="n">Sup_le&#39;</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">X</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">X</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">X</span><span class="o">),</span> <span class="n">b</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span><span class="o">)</span> <span class="bp">→</span> <span class="n">Sup</span> <span class="n">s</span> <span class="bp">≤</span> <span class="n">a</span> <span class="o">:=</span>
<span class="n">Sup_lattice</span><span class="bp">.</span><span class="n">Sup_le</span>

<span class="kn">theorem</span> <span class="n">Sup_singleton&#39;</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">Sup</span> <span class="o">{</span><span class="n">x</span><span class="o">}</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">le_antisymm</span> <span class="o">(</span><span class="n">Sup_le&#39;</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span> <span class="n">hb</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">eq_of_mem_singleton</span> <span class="n">hb</span> <span class="bp">▸</span> <span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="err">$</span>
<span class="n">le_Sup&#39;</span> <span class="err">$</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_singleton</span> <span class="n">x</span>

<span class="kn">end</span> <span class="n">Sup_lattice</span>

<span class="kn">section</span> <span class="n">Sup_discrete_lattice</span>

<span class="kn">instance</span> <span class="n">complete_distrib_lattice</span><span class="bp">.</span><span class="n">to_Sup_distrib_lattice</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_distrib_lattice</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">Sup_distrib_lattice</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">inf_Sup_le</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">s</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">inf_Sup_eq</span><span class="o">,</span> <span class="n">Sup_image</span><span class="o">],</span>
  <span class="bp">..</span> <span class="o">(</span><span class="n">infer_instance</span> <span class="o">:</span> <span class="n">complete_distrib_lattice</span> <span class="n">X</span><span class="o">)</span> <span class="o">}</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">Sup_distrib_lattice</span> <span class="n">X</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">inf_Sup</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">X</span><span class="o">}</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">X</span><span class="o">}</span> <span class="o">:</span> <span class="n">x</span> <span class="err">⊓</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">Sup</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">Sup</span> <span class="o">((</span><span class="err">⊓</span><span class="o">)</span> <span class="n">x</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">le_antisymm</span> <span class="n">Sup_distrib_lattice</span><span class="bp">.</span><span class="n">inf_Sup_le</span> <span class="err">$</span> <span class="n">Sup_le&#39;</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hcs</span><span class="o">,</span> <span class="n">hxcb</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hxcb</span> <span class="bp">▸</span> <span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">le_Sup&#39;</span> <span class="n">hcs</span><span class="o">)</span>

<span class="kn">end</span> <span class="n">Sup_discrete_lattice</span>

<span class="kn">end</span> <span class="n">lattice</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span>

<span class="n">class</span> <span class="n">is_univalent</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">univalent</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">X</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">e</span> <span class="o">:</span> <span class="n">x</span> <span class="err">≅</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span><span class="o">)</span>

<span class="kn">theorem</span> <span class="n">eq_of_iso</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span><span class="o">]</span> <span class="o">[</span><span class="n">is_univalent</span> <span class="n">X</span><span class="o">]</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">X</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">x</span> <span class="err">≅</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span> <span class="o">:=</span>
<span class="n">is_univalent</span><span class="bp">.</span><span class="n">univalent</span> <span class="n">x</span> <span class="n">y</span> <span class="n">e</span>

<span class="kn">instance</span> <span class="n">is_univalent_partial_order</span> <span class="o">[</span><span class="n">partial_order</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">is_univalent</span> <span class="n">X</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">x</span> <span class="n">y</span> <span class="n">e</span><span class="o">,</span> <span class="n">le_antisymm</span> <span class="n">e</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="n">e</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">has_pullback</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_pullback</span> <span class="n">X</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">F</span><span class="o">,</span>
<span class="o">{</span> <span class="n">cone</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">X</span> <span class="o">:=</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">base_left</span> <span class="err">⊓</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">base_right</span><span class="o">,</span>
    <span class="n">π</span> <span class="o">:=</span>
    <span class="o">{</span> <span class="n">app</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span><span class="o">,</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">p</span> <span class="bp">⟨⟨</span><span class="n">inf_le_left</span><span class="bp">⟩⟩</span> <span class="bp">⟨⟨</span><span class="n">inf_le_right</span><span class="bp">⟩⟩</span>
        <span class="bp">⟨⟨</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">hom</span><span class="bp">.</span><span class="n">to_target_left</span><span class="o">)</span><span class="bp">.</span><span class="n">down</span><span class="bp">.</span><span class="n">down</span><span class="bp">⟩⟩</span><span class="o">,</span>
      <span class="n">naturality&#39;</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">intros</span><span class="bp">;</span> <span class="n">ext</span> <span class="o">}</span> <span class="o">},</span>
  <span class="n">is_limit</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">lift</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">c</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">c</span><span class="bp">.</span><span class="n">π</span><span class="bp">.</span><span class="n">app</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">base_left</span><span class="o">)</span><span class="bp">.</span><span class="n">down</span><span class="bp">.</span><span class="n">down</span> <span class="o">(</span><span class="n">c</span><span class="bp">.</span><span class="n">π</span><span class="bp">.</span><span class="n">app</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">base_right</span><span class="o">)</span><span class="bp">.</span><span class="n">down</span><span class="bp">.</span><span class="n">down</span><span class="bp">⟩⟩</span><span class="o">,</span>
    <span class="n">fac&#39;</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">intros</span><span class="bp">;</span> <span class="n">ext</span><span class="o">,</span>
    <span class="n">uniq&#39;</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">intros</span><span class="bp">;</span> <span class="n">ext</span> <span class="o">}</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="n">Sup_lattice</span><span class="bp">.</span><span class="n">has_site</span> <span class="o">[</span><span class="n">Sup_distrib_lattice</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_site</span> <span class="n">X</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cov</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span><span class="o">,</span> <span class="o">{</span> <span class="n">c</span> <span class="bp">|</span> <span class="n">U</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="err">&#39;&#39;</span> <span class="n">c</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">iso_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">e</span><span class="o">,</span> <span class="k">show</span> <span class="n">U</span> <span class="bp">≤</span> <span class="bp">_</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">set</span><span class="bp">.</span><span class="n">image_singleton</span><span class="o">,</span> <span class="n">Sup_singleton&#39;</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">e</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
  <span class="n">comp_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">S</span> <span class="n">HS</span> <span class="n">F</span> <span class="n">HF</span><span class="o">,</span> <span class="n">le_trans</span> <span class="n">HS</span> <span class="err">$</span> <span class="n">Sup_le&#39;</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">m</span><span class="o">,</span> <span class="n">hmS</span><span class="o">,</span> <span class="n">hmx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hx</span> <span class="k">in</span>
    <span class="n">hmx</span> <span class="bp">▸</span> <span class="n">le_trans</span> <span class="o">(</span><span class="n">HF</span> <span class="n">m</span> <span class="n">hmS</span><span class="o">)</span> <span class="o">(</span><span class="n">Sup_le&#39;</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">hnFS</span><span class="o">,</span> <span class="n">hny</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hy</span> <span class="k">in</span>
      <span class="n">le_Sup&#39;</span> <span class="bp">⟨⟨</span><span class="n">n</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">le_trans</span> <span class="n">n</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="n">m</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⟩⟩⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">m</span><span class="o">,</span> <span class="n">hmS</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">hnFS</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hny</span><span class="bp">⟩</span><span class="o">),</span>
  <span class="n">pullback_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">S</span> <span class="n">HS</span> <span class="n">V</span> <span class="n">f</span><span class="o">,</span>
  <span class="k">calc</span>  <span class="n">V</span>
      <span class="bp">≤</span> <span class="n">V</span> <span class="err">⊓</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="err">&#39;&#39;</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="n">le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">f</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="n">HS</span><span class="o">)</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">Sup</span> <span class="o">((</span><span class="err">⊓</span><span class="o">)</span> <span class="n">V</span> <span class="err">&#39;&#39;</span> <span class="o">(</span><span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="err">&#39;&#39;</span> <span class="n">S</span><span class="o">))</span> <span class="o">:</span> <span class="n">inf_Sup</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">Sup</span> <span class="o">((</span><span class="err">⊓</span><span class="o">)</span> <span class="n">V</span> <span class="err">∘</span> <span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="err">&#39;&#39;</span> <span class="n">S</span><span class="o">)</span> <span class="o">:</span> <span class="n">congr_arg</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">image_comp</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">S</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span>
  <span class="bp">...</span> <span class="bp">≤</span> <span class="n">Sup</span> <span class="o">(</span><span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="err">&#39;&#39;</span> <span class="o">{</span><span class="n">m</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">t</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="o">(</span><span class="bp">⟨_</span><span class="o">,</span> <span class="n">pullback</span><span class="bp">.</span><span class="n">fst</span> <span class="n">f</span> <span class="n">t</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">W</span><span class="o">,</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">V</span><span class="o">)</span> <span class="bp">=</span> <span class="n">m</span><span class="o">})</span> <span class="o">:</span>
    <span class="n">Sup_le&#39;</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hcs</span><span class="o">,</span> <span class="n">hb</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">le_Sup&#39;</span> <span class="bp">⟨⟨</span><span class="n">V</span> <span class="err">⊓</span> <span class="n">c</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">inf_le_left</span><span class="bp">⟩⟩⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">hcs</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hb</span><span class="bp">⟩</span><span class="o">)</span> <span class="o">}</span>

<span class="kn">end</span> <span class="n">category_theory</span>
</pre></div>

<a name="168812549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168812549" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168812549">Kenny Lau (Jun 23 2019 at 23:32)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">limits</span><span class="bp">.</span><span class="n">types</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kn">instance</span> <span class="n">has_pullback_Type</span> <span class="o">:</span> <span class="n">has_pullback</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">F</span><span class="o">,</span> <span class="k">by</span> <span class="n">apply_instance</span>

<span class="kn">instance</span> <span class="n">has_site_Type</span> <span class="o">:</span> <span class="n">has_site</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cov</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">α</span><span class="o">,</span> <span class="o">{</span> <span class="n">S</span> <span class="bp">|</span> <span class="bp">∀</span> <span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="bp">∃</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">β</span><span class="o">,</span> <span class="n">β</span> <span class="err">⟶</span> <span class="n">α</span><span class="o">),</span> <span class="bp">∃</span> <span class="n">hf</span> <span class="o">:</span> <span class="n">f</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">set</span><span class="bp">.</span><span class="n">range</span> <span class="n">f</span><span class="bp">.</span><span class="mi">2</span><span class="o">},</span>
  <span class="n">iso_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">α</span> <span class="n">β</span> <span class="n">e</span> <span class="n">x</span><span class="o">,</span> <span class="bp">⟨⟨</span><span class="n">β</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_singleton</span> <span class="bp">_</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">2</span> <span class="n">x</span><span class="o">,</span> <span class="n">congr_fun</span> <span class="n">e</span><span class="bp">.</span><span class="mi">4</span> <span class="n">x</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">comp_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">α</span> <span class="n">S</span> <span class="n">HS</span> <span class="n">F</span> <span class="n">HF</span> <span class="n">x</span><span class="o">,</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">,</span> <span class="n">p</span><span class="o">,</span> <span class="n">hfpx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">HS</span> <span class="n">x</span> <span class="k">in</span>
    <span class="k">let</span> <span class="bp">⟨</span><span class="n">g</span><span class="o">,</span> <span class="n">hg</span><span class="o">,</span> <span class="n">q</span><span class="o">,</span> <span class="n">hgqp</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">HF</span> <span class="n">f</span> <span class="n">hf</span> <span class="n">p</span> <span class="k">in</span>
    <span class="bp">⟨⟨</span><span class="n">g</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">g</span><span class="bp">.</span><span class="mi">2</span> <span class="err">≫</span> <span class="n">f</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">hf</span><span class="o">,</span> <span class="n">g</span><span class="o">,</span> <span class="n">hg</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">q</span><span class="o">,</span> <span class="n">hfpx</span> <span class="bp">▸</span> <span class="n">hgqp</span> <span class="bp">▸</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">pullback_mem</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">α</span> <span class="n">S</span> <span class="n">HS</span> <span class="n">β</span> <span class="n">f</span> <span class="n">x</span><span class="o">,</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">g</span><span class="o">,</span> <span class="n">hg</span><span class="o">,</span> <span class="n">p</span><span class="o">,</span> <span class="n">hgpx</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">HS</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="k">in</span>
    <span class="bp">⟨⟨</span><span class="n">pullback</span> <span class="n">f</span> <span class="n">g</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="n">pullback</span><span class="bp">.</span><span class="n">fst</span> <span class="n">f</span> <span class="n">g</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">g</span><span class="o">,</span> <span class="n">hg</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="bp">⟨λ</span> <span class="n">v</span><span class="o">,</span> <span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">v</span> <span class="n">x</span> <span class="n">p</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">),</span>
      <span class="k">by</span> <span class="n">intros</span> <span class="n">v</span> <span class="n">w</span> <span class="n">h</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">h</span><span class="bp">;</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">pullback_diagram</span><span class="bp">.</span><span class="n">to_category</span><span class="o">]</span><span class="bp">;</span> <span class="o">{</span> <span class="n">refl</span> <span class="bp">&lt;|&gt;</span> <span class="n">exact</span> <span class="n">hgpx</span> <span class="o">}</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">rfl</span><span class="bp">⟩</span> <span class="o">}</span>

<span class="kn">end</span> <span class="n">category_theory</span>
</pre></div>

<a name="168812588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168812588" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168812588">Kenny Lau (Jun 23 2019 at 23:32)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Am I duplicating effort?</p>

<a name="168821878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168821878" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168821878">Johan Commelin (Jun 24 2019 at 04:43)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Thanks for looking into this. The idea of the <code>is_univalent</code> class is a nice one! Also, as has been mentioned in the other thread, I agree that refining the lattice hierarchy is probably a good idea. (And I hope it doesn't lead to some exponential blow-up down the road.)<br>
I don't think you are duplicating effort. Concerning <code>pullback_diagram</code>: there have been long discussions between <span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110032">@Reid Barton</span> and myself and I think we are still not completely clear on what the best way to support special shapes is.<br>
Other thoughts:</p>
<ul>
<li>there are different approaches to sites: Grothendieck topologies, coverages, and Grothendieck pretopologies. You have formalised <em>pretopologies</em> but not every site admits a pretopology (e.g. a basis for a topological space can be turned into a site, but doesn't have to be a pretopology).</li>
<li>When I was working on these things half a year ago, I managed to formalise the definition of a sheaf on site. But I had a hard time actually verifying that certain "trivial" examples are sheaves: e.g. (continuous) functions from a topological space <code>X</code> to (a topological space) <code>Y</code>.</li>
<li>Currently Kevin and you are thinking/working hard on gluing sheaves, which I think is a perfect way to stress-test the definitions. However, I would really want to add two things to that list: sheafification and the adjunction between pushforward and pullback. Without those, we won't have a reasonable API to sheaves.</li>
</ul>
<p>In hindsight, I took on a project that was way to big. I'm very excited that there are now more people pouring power into this (-;</p>

<a name="168822649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168822649" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168822649">Scott Morrison (Jun 24 2019 at 05:05)</a>:</h4>
<p>Regarding <code>is_univalent</code> --- usually this is called <code>skeletal</code>.</p>

<a name="168830190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168830190" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168830190">Kenny Lau (Jun 24 2019 at 08:09)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> didn't I formalize sites in terms of coverages?</p>

<a name="168831004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831004">Johan Commelin (Jun 24 2019 at 08:25)</a>:</h4>
<p>You use pullbacks</p>

<a name="168831018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831018" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831018">Johan Commelin (Jun 24 2019 at 08:25)</a>:</h4>
<p>Coverages allow you to define sites on categories that don't have pullbacks</p>

<a name="168831026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831026">Johan Commelin (Jun 24 2019 at 08:25)</a>:</h4>
<p>E.g. lattices without infs</p>

<a name="168831031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831031">Johan Commelin (Jun 24 2019 at 08:25)</a>:</h4>
<p>E.g. bases of topologies</p>

<a name="168831090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831090" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831090">Kevin Buzzard (Jun 24 2019 at 08:26)</a>:</h4>
<p>The schemes work that Ramon did about extending sheaves on bases to sheaves was made much easier by the fact that the intersection of two basic open sets was basic open in our situation.</p>

<a name="168831100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831100" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831100">Kevin Buzzard (Jun 24 2019 at 08:26)</a>:</h4>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mo>(</mo><mi>f</mi><mo>)</mo><mo>∩</mo><mi>D</mi><mo>(</mo><mi>g</mi><mo>)</mo><mo>=</mo><mi>D</mi><mo>(</mo><mi>f</mi><mi>g</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">D(f)\cap D(g)=D(fg)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mclose">)</span><span class="mbin">∩</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span>.</p>

<a name="168831122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831122">Kevin Buzzard (Jun 24 2019 at 08:27)</a>:</h4>
<p>Without that, the construction of the sheaf of rings on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="normal">S</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi></mrow><mo>(</mo><mi>A</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathrm{Spec}(A)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathrm">S</span><span class="mord mathrm">p</span><span class="mord mathrm">e</span><span class="mord mathrm">c</span></span><span class="mopen">(</span><span class="mord mathit">A</span><span class="mclose">)</span></span></span></span> would have been harder.</p>

<a name="168831237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831237" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831237">Kenny Lau (Jun 24 2019 at 08:29)</a>:</h4>
<p>I just followed Stacks project</p>

<a name="168831354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831354" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831354">Johan Commelin (Jun 24 2019 at 08:31)</a>:</h4>
<p><a href="https://ncatlab.org/nlab/show/coverage" target="_blank" title="https://ncatlab.org/nlab/show/coverage">https://ncatlab.org/nlab/show/coverage</a></p>

<a name="168831373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831373">Kenny Lau (Jun 24 2019 at 08:31)</a>:</h4>
<p>so I should use that definition instead?</p>

<a name="168831532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168831532" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168831532">Kenny Lau (Jun 24 2019 at 08:34)</a>:</h4>
<p>also where did the first two axioms go?</p>

<a name="168832878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168832878" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168832878">Johan Commelin (Jun 24 2019 at 08:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> You don't need the first two axioms.</p>

<a name="168832888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168832888" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168832888">Kenny Lau (Jun 24 2019 at 08:59)</a>:</h4>
<p>then why did Stacks include them?</p>

<a name="168832975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168832975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168832975">Johan Commelin (Jun 24 2019 at 09:00)</a>:</h4>
<p>See also <a href="https://ncatlab.org/nlab/show/Grothendieck+topology#Saturation" target="_blank" title="https://ncatlab.org/nlab/show/Grothendieck+topology#Saturation">https://ncatlab.org/nlab/show/Grothendieck+topology#Saturation</a></p>

<a name="168833014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833014">Johan Commelin (Jun 24 2019 at 09:01)</a>:</h4>
<p>It might make sense to browse through the first half of SGA 4 if you want to seriously attempt to build a library for sites.</p>

<a name="168833024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833024" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833024">Kevin Buzzard (Jun 24 2019 at 09:01)</a>:</h4>
<p>SGA 4 you mean? Or not</p>

<a name="168833036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833036" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833036">Johan Commelin (Jun 24 2019 at 09:01)</a>:</h4>
<p>Fixed <span aria-label="smiley" class="emoji emoji-1f603" role="img" title="smiley">:smiley:</span></p>

<a name="168833042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833042" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833042">Kenny Lau (Jun 24 2019 at 09:02)</a>:</h4>
<p>how about no</p>

<a name="168833087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833087">Kevin Buzzard (Jun 24 2019 at 09:02)</a>:</h4>
<p>SGA4 is not hard to read</p>

<a name="168833099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833099" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833099">Kevin Buzzard (Jun 24 2019 at 09:02)</a>:</h4>
<p>It's much easier than EGA4</p>

<a name="168833139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833139" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833139">Kenny Lau (Jun 24 2019 at 09:03)</a>:</h4>
<p>is there an English translation?</p>

<a name="168833221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833221" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833221">Kevin Buzzard (Jun 24 2019 at 09:04)</a>:</h4>
<p>I don't know. "Categorie" = category, "morphisme" = morphism, "univers" = universe. Try just taking symmetric difference with {e}.</p>

<a name="168833237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833237" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833237">Kenny Lau (Jun 24 2019 at 09:04)</a>:</h4>
<p>so espace etale = spac tal?</p>

<a name="168833259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833259">Kevin Buzzard (Jun 24 2019 at 09:05)</a>:</h4>
<p>change e-acute to s</p>

<a name="168833264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833264" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833264">Kevin Buzzard (Jun 24 2019 at 09:05)</a>:</h4>
<p>that sometimes work.</p>

<a name="168833266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833266">Kevin Buzzard (Jun 24 2019 at 09:05)</a>:</h4>
<p>fenetre -&gt; fenester</p>

<a name="168833274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833274" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833274">Kenny Lau (Jun 24 2019 at 09:05)</a>:</h4>
<p>surely fenetre -&gt; fnstr</p>

<a name="168833288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833288">Kevin Buzzard (Jun 24 2019 at 09:05)</a>:</h4>
<p>Oh it's e-hat goes to s</p>

<a name="168833289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833289" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833289">Johan Commelin (Jun 24 2019 at 09:05)</a>:</h4>
<p>Come on Kenny, your French is better than mine... and I can read that...</p>

<a name="168833333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833333">Kevin Buzzard (Jun 24 2019 at 09:06)</a>:</h4>
<p>You're missing off the accents. They're not all e's.</p>

<a name="168833460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833460">Kenny Lau (Jun 24 2019 at 09:09)</a>:</h4>
<p>how did Grothendieck call Grothendieck topos/topology/etc?</p>

<a name="168833660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833660" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833660">Kevin Buzzard (Jun 24 2019 at 09:12)</a>:</h4>
<p>Probably just topos / topology on a category.</p>

<a name="168833668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833668">Kenny Lau (Jun 24 2019 at 09:12)</a>:</h4>
<p>et d'ailleurs, quelles pages dois-je lire?</p>

<a name="168833693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833693">Kevin Buzzard (Jun 24 2019 at 09:12)</a>:</h4>
<p>The definitions are probably only a few pages in.</p>

<a name="168833886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168833886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168833886">Kenny Lau (Jun 24 2019 at 09:15)</a>:</h4>
<p>il ne definit faisceaux que dans page 223</p>

<a name="168834132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834132">Kenny Lau (Jun 24 2019 at 09:18)</a>:</h4>
<p>ok tous ce que j'ai besoin de est dans expose II</p>

<a name="168834358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834358" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834358">Johan Commelin (Jun 24 2019 at 09:23)</a>:</h4>
<p>I'm not saying you should formalise SGA 4.1. But I'm saying that it might be good to be aware of what's in there.</p>

<a name="168834432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834432">Kenny Lau (Jun 24 2019 at 09:24)</a>:</h4>
<blockquote>
<p>Soit C une categorie. On appelle crible de la categorie C une sous-categorie pleine D de C possedant la propriete suivante: tout objet de C tel qu'il existe un morphisme de cet objet dans un objet de D est dans D. Soit X un objet de C; on appelle (par abus de langage) cribles de X les cribles de la categorie C/X.</p>
</blockquote>

<a name="168834438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834438">Kenny Lau (Jun 24 2019 at 09:24)</a>:</h4>
<p>seems complicated</p>

<a name="168834511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834511" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834511">Johan Commelin (Jun 24 2019 at 09:26)</a>:</h4>
<p>Right... another option is to forget about sites for the moment.</p>

<a name="168834528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834528" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834528">Johan Commelin (Jun 24 2019 at 09:26)</a>:</h4>
<p>And focus on sheaves on <code>distrib_inf_lattice</code>s or whatever the variant you need.</p>

<a name="168834534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834534">Kenny Lau (Jun 24 2019 at 09:27)</a>:</h4>
<p>can't I just use some variants of my current definition</p>

<a name="168834543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834543" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834543">Johan Commelin (Jun 24 2019 at 09:27)</a>:</h4>
<p>Sure, you can</p>

<a name="168834549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834549" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834549">Johan Commelin (Jun 24 2019 at 09:27)</a>:</h4>
<p>But if you want a basis for a topology to be a site, then you need coverages</p>

<a name="168834604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834604">Kenny Lau (Jun 24 2019 at 09:28)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">sheaf</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">has_pullback</span> <span class="n">C</span><span class="o">]</span> <span class="o">[</span><span class="n">has_site</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span> <span class="o">(</span><span class="n">w</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_presheaf</span> <span class="o">:</span> <span class="n">presheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span> <span class="n">w</span><span class="o">}</span> <span class="n">C</span><span class="o">)</span>
<span class="o">(</span><span class="n">ext</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">U</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">s</span> <span class="n">t</span> <span class="o">:</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">c</span> <span class="err">∈</span> <span class="n">has_site</span><span class="bp">.</span><span class="n">cov</span> <span class="n">U</span><span class="o">,</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="n">d</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">,</span> <span class="n">d</span> <span class="err">∈</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">res</span> <span class="n">d</span><span class="bp">.</span><span class="mi">2</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">res</span> <span class="n">d</span><span class="bp">.</span><span class="mi">2</span> <span class="n">t</span><span class="o">)</span> <span class="bp">→</span>
  <span class="n">s</span> <span class="bp">=</span> <span class="n">t</span><span class="o">)</span>
<span class="o">(</span><span class="n">glue</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">U</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">c</span> <span class="err">∈</span> <span class="n">has_site</span><span class="bp">.</span><span class="n">cov</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">d</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">,</span> <span class="n">d</span> <span class="err">∈</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">d</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="n">d1</span> <span class="n">d2</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">H1</span> <span class="o">:</span> <span class="n">d1</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">H2</span> <span class="o">:</span> <span class="n">d2</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span>
    <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">pullback</span><span class="bp">.</span><span class="n">fst</span> <span class="n">d1</span><span class="bp">.</span><span class="mi">2</span> <span class="n">d2</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="n">d1</span> <span class="n">H1</span><span class="o">)</span> <span class="bp">=</span>
    <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="bp">@@</span><span class="n">pullback</span><span class="bp">.</span><span class="n">snd</span> <span class="bp">_</span> <span class="bp">_</span><span class="n">inst_2</span> <span class="n">d1</span><span class="bp">.</span><span class="mi">2</span> <span class="n">d2</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="n">d2</span> <span class="n">H2</span><span class="o">))</span> <span class="bp">→</span>
  <span class="bp">∃</span> <span class="n">g</span> <span class="o">:</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">d</span> <span class="o">:</span> <span class="err">Σ</span> <span class="n">V</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">H</span> <span class="o">:</span> <span class="n">d</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span>
    <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">res</span> <span class="n">d</span><span class="bp">.</span><span class="mi">2</span> <span class="n">g</span> <span class="bp">=</span> <span class="n">F</span> <span class="n">d</span> <span class="n">H</span><span class="o">)</span>
</pre></div>

<a name="168834607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834607">Kenny Lau (Jun 24 2019 at 09:28)</a>:</h4>
<blockquote>
<p>But if you want a basis for a topology to be a site, then you need coverages</p>
</blockquote>
<p>oh that's for extending a sheaf from a sheaf on basis?</p>

<a name="168834611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834611">Johan Commelin (Jun 24 2019 at 09:28)</a>:</h4>
<p>Yup, if you want to do that using the general framework</p>

<a name="168834617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834617">Kenny Lau (Jun 24 2019 at 09:28)</a>:</h4>
<p>how do I do that if I have coverages?</p>

<a name="168834618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834618">Johan Commelin (Jun 24 2019 at 09:28)</a>:</h4>
<p>We could of course do a hands-on extension</p>

<a name="168834644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834644" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834644">Johan Commelin (Jun 24 2019 at 09:29)</a>:</h4>
<blockquote>
<p>how do I do that if I have coverages?</p>
</blockquote>
<p>You need to formalise morphism of sites, and then the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>b</mi><mi>a</mi><mi>s</mi><mi>i</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">site_{basis}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.80952em;vertical-align:-0.15em;"></span><span class="base"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">t</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">b</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">s</span><span class="mord mathit mtight">i</span><span class="mord mathit mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> comes with a geometric morphism (aka morphism of sites/topoi) to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>i</mi><mi>t</mi><msub><mi>e</mi><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">site_{topology}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.9456279999999999em;vertical-align:-0.286108em;"></span><span class="base"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">t</span><span class="mord"><span class="mord mathit">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight">p</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight" style="margin-right:0.01968em;">l</span><span class="mord mathit mtight">o</span><span class="mord mathit mtight" style="margin-right:0.03588em;">g</span><span class="mord mathit mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"></span></span></span></span></span></span></span></span>.</p>

<a name="168834650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834650">Johan Commelin (Jun 24 2019 at 09:29)</a>:</h4>
<p>You pushforward along this morphism.</p>

<a name="168834720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834720" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834720">Kenny Lau (Jun 24 2019 at 09:30)</a>:</h4>
<p>and how do you show that if I restrict a sheaf to a sheaf on basis then extend it again, I get the "same" sheaf?</p>

<a name="168834737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834737">Johan Commelin (Jun 24 2019 at 09:30)</a>:</h4>
<p>That's a theorem. I'm not saying it's easy.</p>

<a name="168834742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834742" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834742">Johan Commelin (Jun 24 2019 at 09:30)</a>:</h4>
<p>(It's math easy, of course)</p>

<a name="168834755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834755" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834755">Kenny Lau (Jun 24 2019 at 09:31)</a>:</h4>
<p>how do you do it in maths?</p>

<a name="168834821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834821" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834821">Johan Commelin (Jun 24 2019 at 09:32)</a>:</h4>
<p>"Proof. Follows from the sheaf property. QED" (I guess this is what most people would do...)</p>

<a name="168834846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834846">Johan Commelin (Jun 24 2019 at 09:33)</a>:</h4>
<p>I think there is a proof in the stacks project. The define a notion of "sheaf on a basis". But what they do is hands on. If you use coverages, then a "sheaf on a basis" is <em>just a sheaf</em>.</p>

<a name="168834854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834854" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834854">Johan Commelin (Jun 24 2019 at 09:33)</a>:</h4>
<p>I don't know if we want to care about sheaves on bases...</p>

<a name="168834928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168834928" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168834928">Kenny Lau (Jun 24 2019 at 09:34)</a>:</h4>
<p>so what I'm wondering is, if you use this wonderful language of coverage, how do you do it?</p>

<a name="168835220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168835220" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168835220">Johan Commelin (Jun 24 2019 at 09:40)</a>:</h4>
<p>Well, you will still need to use the sheaf property for coverages</p>

<a name="168835249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168835249" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168835249">Johan Commelin (Jun 24 2019 at 09:41)</a>:</h4>
<p>But anyway... do you have a good reason to pursue this?</p>

<a name="168835263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168835263" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168835263">Johan Commelin (Jun 24 2019 at 09:41)</a>:</h4>
<p>Or should we first try to do the push-pull adjunction for sheaves on topological spaces?</p>

<a name="168835428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168835428" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168835428">Kenny Lau (Jun 24 2019 at 09:44)</a>:</h4>
<p>I don't know</p>

<a name="168836742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168836742" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168836742">Kenny Lau (Jun 24 2019 at 10:07)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">category</span>

<span class="n">universes</span> <span class="n">v</span> <span class="n">u</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="n">class</span> <span class="n">has_site</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">cov</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">U</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="n">set</span> <span class="o">(</span><span class="n">set</span> <span class="o">(</span><span class="err">Σ</span> <span class="n">V</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">)))</span>
<span class="o">(</span><span class="n">lift</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">U</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">c</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">V</span> <span class="o">:</span> <span class="n">C</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">g</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">h</span> <span class="err">∈</span> <span class="n">cov</span> <span class="n">V</span><span class="o">,</span>
  <span class="bp">∀</span> <span class="n">j</span> <span class="err">∈</span> <span class="n">h</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">i</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">k</span> <span class="o">:</span> <span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="n">j</span> <span class="err">⟶</span> <span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="n">i</span><span class="o">,</span> <span class="n">k</span> <span class="err">≫</span> <span class="n">i</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">j</span><span class="bp">.</span><span class="mi">2</span> <span class="err">≫</span> <span class="n">g</span><span class="o">)</span>

<span class="kn">end</span> <span class="n">category_theory</span>
</pre></div>

<a name="168836746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168836746" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168836746">Kenny Lau (Jun 24 2019 at 10:07)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> how does this look?</p>

<a name="168837063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168837063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168837063">Mario Carneiro (Jun 24 2019 at 10:13)</a>:</h4>
<p>is that really the only axiom? I would have expected something like "{&lt;U, id&gt;} \in cov U" and possibly something about covers of covers</p>

<a name="168837349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168837349" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168837349">Kenny Lau (Jun 24 2019 at 10:19)</a>:</h4>
<p>I'm just using <a href="https://ncatlab.org/nlab/show/coverage#Definition" target="_blank" title="https://ncatlab.org/nlab/show/coverage#Definition">https://ncatlab.org/nlab/show/coverage#Definition</a></p>

<a name="168837365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168837365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168837365">Kenny Lau (Jun 24 2019 at 10:19)</a>:</h4>
<p>I believe it's like how you can generate an equivalence relation given just any relation</p>

<a name="168837414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168837414" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168837414">Kenny Lau (Jun 24 2019 at 10:20)</a>:</h4>
<p>and it's also to allow for a basis to be a site</p>

<a name="168838299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168838299" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168838299">Kenny Lau (Jun 24 2019 at 10:36)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">category_theory</span><span class="bp">.</span><span class="n">sites</span><span class="bp">.</span><span class="n">basic</span> <span class="n">topology</span><span class="bp">.</span><span class="n">bases</span> <span class="n">topology</span><span class="bp">.</span><span class="n">opens</span>

<span class="n">universes</span> <span class="n">v</span> <span class="n">u</span>

<span class="kn">namespace</span> <span class="n">category_theory</span>

<span class="kn">open</span> <span class="n">topological_space</span> <span class="n">lattice</span>

<span class="bp">@</span><span class="o">[</span><span class="kn">reducible</span><span class="o">]</span> <span class="n">def</span> <span class="n">topological_basis</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">B</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="bp">//</span> <span class="n">opens</span><span class="bp">.</span><span class="n">is_basis</span> <span class="n">B</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="n">basis</span><span class="bp">.</span><span class="n">has_site</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="n">topological_basis</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">has_site</span> <span class="n">B</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">cov</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span><span class="o">,</span> <span class="o">{</span> <span class="n">c</span> <span class="bp">|</span> <span class="bp">∀</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">U</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">∃</span> <span class="n">i</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="n">sigma</span><span class="bp">.</span><span class="n">fst</span> <span class="n">i</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">lift</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">c</span> <span class="n">hc</span> <span class="n">V</span> <span class="n">g</span><span class="o">,</span> <span class="bp">⟨</span><span class="o">{</span> <span class="n">h</span> <span class="bp">|</span> <span class="bp">∃</span> <span class="n">i</span> <span class="err">∈</span> <span class="n">c</span><span class="o">,</span> <span class="n">h</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">≤</span> <span class="n">V</span> <span class="err">⊓</span> <span class="n">i</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="o">},</span>
    <span class="bp">λ</span> <span class="n">x</span> <span class="n">hxV</span><span class="o">,</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hic</span><span class="o">,</span> <span class="n">hxi</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">hc</span> <span class="n">x</span> <span class="o">(</span><span class="n">g</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hxV</span><span class="o">),</span>
      <span class="bp">⟨</span><span class="n">W</span><span class="o">,</span> <span class="n">HWB</span><span class="o">,</span> <span class="n">hxW</span><span class="o">,</span> <span class="n">HWVi</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">opens</span><span class="bp">.</span><span class="n">is_basis_iff_nbhd</span><span class="bp">.</span><span class="mi">1</span> <span class="n">B</span><span class="bp">.</span><span class="mi">2</span> <span class="o">(</span><span class="k">show</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">V</span><span class="bp">.</span><span class="mi">1</span> <span class="err">⊓</span> <span class="n">i</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="k">from</span> <span class="bp">⟨</span><span class="n">hxV</span><span class="o">,</span> <span class="n">hxi</span><span class="bp">⟩</span><span class="o">)</span> <span class="k">in</span>
      <span class="bp">⟨⟨⟨</span><span class="n">W</span><span class="o">,</span> <span class="n">HWB</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨⟨λ</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span> <span class="o">(</span><span class="n">HWVi</span> <span class="n">hy</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">⟩⟩⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hic</span><span class="o">,</span> <span class="n">HWVi</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">hxW</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="bp">λ</span> <span class="n">j</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hic</span><span class="o">,</span> <span class="n">hjVi</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hic</span><span class="o">,</span> <span class="bp">⟨⟨λ</span> <span class="n">y</span> <span class="n">hy</span><span class="o">,</span> <span class="o">(</span><span class="n">hjVi</span> <span class="n">hy</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩⟩</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩⟩</span> <span class="o">}</span>

<span class="kn">end</span> <span class="n">category_theory</span>
</pre></div>

<a name="168838310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168838310" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168838310">Kenny Lau (Jun 24 2019 at 10:37)</a>:</h4>
<p>looks like it's working</p>

<a name="168839312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168839312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168839312">Johan Commelin (Jun 24 2019 at 10:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Cool!</p>

<a name="168840462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840462" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840462">Johan Commelin (Jun 24 2019 at 11:17)</a>:</h4>
<p>So now you can probably also write down the sheaf axiom(s) in this language.</p>

<a name="168840541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840541" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840541">Kevin Buzzard (Jun 24 2019 at 11:18)</a>:</h4>
<blockquote>
<p>But anyway... do you have a good reason to pursue this?</p>
</blockquote>
<p>Pushforwards and pullbacks are just adjoint functors. Kenny is flagging the situation where we go from a sheaf on a basis to a sheaf, and in that situation both the functors are equivalences. Is this some sort of Galois connection but one level up? </p>
<p>I guess Grothendieck knew that a top space, and a top-space-with-a-basis, were the same thing as far as sheaf theory goes, so he defined the topos associated to the site to be the category of sheaves on the site, and then we have two different sites with the same topos (and hence the same "geometry").</p>
<blockquote>
<p>is that really the only axiom? I would have expected something like "{&lt;U, id&gt;} \in cov U" and possibly something about covers of covers</p>
</blockquote>
<p>These are definitely axioms in some of these abstrations. What's a Grothendieck topology? Is this the difference between a Groth Top and a coverage?</p>

<a name="168840583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840583" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840583">Johan Commelin (Jun 24 2019 at 11:19)</a>:</h4>
<p>Galois connections are adjunctions one level down, yes.</p>

<a name="168840601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840601" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840601">Johan Commelin (Jun 24 2019 at 11:20)</a>:</h4>
<p>A <code>coverage</code> is the bare minimum that you need. You can use those to generate a Grothendieck topology.</p>

<a name="168840650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840650">Kevin Buzzard (Jun 24 2019 at 11:20)</a>:</h4>
<p>Is it a Galois insertion I'm talking about then?</p>

<a name="168840670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840670" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840670">Johan Commelin (Jun 24 2019 at 11:20)</a>:</h4>
<p>A Galois insertion is like an adjunction where the left(?) adjoint is fully faithful.</p>

<a name="168840686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840686" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840686">Johan Commelin (Jun 24 2019 at 11:21)</a>:</h4>
<p>Ad <code>coverage</code> and axioms, see <a href="https://ncatlab.org/nlab/show/coverage#saturation_conditions" target="_blank" title="https://ncatlab.org/nlab/show/coverage#saturation_conditions">https://ncatlab.org/nlab/show/coverage#saturation_conditions</a></p>

<a name="168840818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840818" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840818">Kevin Buzzard (Jun 24 2019 at 11:24)</a>:</h4>
<p>I have never used the nlab as a serious reference before (of course this is mostly because I do number theory rather than higher category stuff). I get the impression that there's a small community so probably not much refereeing going on. It would an interesting test for the nlab pages if they were being used as a resource for formalising. How accurate are they? I know that Kenny sees the nlab and can't tell it apart from SGA4, but for me SGA4 is refereed, much used, and trustworthy, whereas nlab is just some random website which might be full of fake news.</p>

<a name="168840872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168840872" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168840872">Kevin Buzzard (Jun 24 2019 at 11:24)</a>:</h4>
<p>This was also a problem with Wikipedia in the beginning, when it had some maths pages and the quality was extremely variable.</p>

<a name="168843850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168843850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168843850">Reid Barton (Jun 24 2019 at 12:13)</a>:</h4>
<p>I would say nlab in general is somewhat more trustworthy than Wikipedia though of course still less trustworthy than peer-reviewed publications. Compared to Wikipedia, the nlab authors are a lot more likely to know what they're talking about in the first place.</p>

<a name="168846247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/sheaves%20and%20sites/near/168846247" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/44395sheavesandsites.html#168846247">Kevin Buzzard (Jun 24 2019 at 12:51)</a>:</h4>
<p>Well that's good to know. With Wikipedia there used to be dozens of inaccuracies in some articles, some were very poor initially, but I could never be bothered to learn how to change them (I had three small kids at the time). Sufficiently many people did learn that Wikipedia is much better now, but I just didn't really know about nLab's record for accuracy, and if I don't know then my default opinion is "do not trust". What I've seen from it does look good though, when I'm reading about stuff I already understand.</p>


{% endraw %}

{% include archive_update.html %}