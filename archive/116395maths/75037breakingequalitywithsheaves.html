---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/75037breakingequalitywithsheaves.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html">breaking equality with sheaves</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="168696896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168696896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168696896">Kevin Buzzard (Jun 21 2019 at 16:47)</a>:</h4>
<p>A sheaf of types <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">F</mi></mrow></mrow><annotation encoding="application/x-tex">\mathcal{F}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span></span></span></span> on a topological space <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> is, for every open set <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mo>⊆</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">V\subseteq X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mrel">⊆</span><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>, a type <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">F</mi></mrow><mo>(</mo><mi>V</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{F}(V)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mclose">)</span></span></span></span>, plus some extra data and some axioms.</p>
<p>As part of the schemes project we would like to glue sheaves on open subsets. In short, given an open cover <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> and sheaves on each <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> which are compatible in some precise way, one can glue the sheaves together to get a sheaf on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>. I tried to formalise this the naive way, and formalising the compatibility was a real nightmare, because a sheaf is on a topological space so I had to really work with types <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> and I had to constantly be moving between the type <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub><mo>∩</mo><msub><mi>U</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">U_i\cap U_j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∩</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"></span></span></span></span></span></span></span></span>, the open subset <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub><mo>∩</mo><msub><mi>U</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">U_i\cap U_j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∩</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"></span></span></span></span></span></span></span></span> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, the open subset <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub><mo>∩</mo><msub><mi>U</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">U_i\cap U_j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∩</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"></span></span></span></span></span></span></span></span> of $U_j$$ and the open subset <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub><mo>∩</mo><msub><mi>U</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">U_i\cap U_j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mbin">∩</span><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"></span></span></span></span></span></span></span></span> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>; all of these four objects show up. One of the compatibilities one needs is a "cocycle identity" which involves three subsets <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">U_j</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"></span></span></span></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">U_k</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>, and it was pretty horrible.</p>
<p>Kenny suggested a completely insane way around this. He defined a sheaf on an open subset <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> to simply be a sheaf on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>! It is true that given a sheaf on an open subset <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi><mo>⊆</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">U\subseteq X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.8193em;vertical-align:-0.13597em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mrel">⊆</span><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> one can push it forward to get a sheaf on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span>, given a sheaf on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> one can pull it back to get a sheaf on an open subset <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span>, but it is also true that two sheaves on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span></span></span></span> which are not equal (resp isomorphic), can become equal (resp isomorphic) when restricted to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span>. </p>
<p>In short, Kenny has proposed a definition of a sheaf on <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> for which Lean's <code>=</code> type is <em>wrong</em> -- it does not correctly capture the notion of equality of sheaves. </p>
<p>Kenny went on to define morphisms of sheaves-on-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> (using his definition) and a notion of <code>equiv</code> which is the correct definition. So we do have the correct notion of isomorphism, and the sheaves-on-<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>U</mi></mrow><annotation encoding="application/x-tex">U</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10903em;">U</span></span></span></span> form a category which is equivalent to the correct category. This category has the extraordinary (to me) property that the notion of equality on it is incorrect. However I have just formalised the statement of the universal property which the glued sheaf has to satisfy (its restriction to the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>U</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">U_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> should be isomorphic to the sheaf <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="script">F</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{F}_i</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> we started with -- <em>not</em> equal to it) and at least the statement looks fine.</p>
<p>Am I going to run into trouble later?</p>
<p>One way of thinking about this is that a sheaf is a functor, so we have made some functor category, and we are interested in restricting this functor to a subcategory to get a new functor category, and I want to define it to be the actual restriction, but Kenny has just defined it to be the original functor and has basically said screw equality.</p>

<a name="168701236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168701236" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168701236">Kenny Lau (Jun 21 2019 at 17:47)</a>:</h4>
<p>we don't ever want to say that two (at least set-valued-) sheaves are equal right</p>

<a name="168701920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168701920" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168701920">Kevin Buzzard (Jun 21 2019 at 17:56)</a>:</h4>
<p>I guess that's my question. They are two terms of some type so I thought that equality was ok. But they involve some dependent type so maybe it's not ok</p>

<a name="168701997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168701997" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168701997">Kevin Buzzard (Jun 21 2019 at 17:57)</a>:</h4>
<p>You can prove that if two sheaves are equal when restricted to an open subset then they are equal. This is very counterintuitive to me</p>

<a name="168702026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168702026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168702026">Kevin Buzzard (Jun 21 2019 at 17:57)</a>:</h4>
<p>Perhaps your argument is that equality of sheaves is never ok</p>

<a name="168702043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168702043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168702043">Kenny Lau (Jun 21 2019 at 17:57)</a>:</h4>
<p>that is indeed my argument</p>

<a name="168702102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168702102" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168702102">Kevin Buzzard (Jun 21 2019 at 17:58)</a>:</h4>
<p>It is not true that if two sheaves are the same when restricted to an open subset then they are the same</p>

<a name="168702120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168702120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168702120">Kevin Buzzard (Jun 21 2019 at 17:58)</a>:</h4>
<p>But I have become more and more confused about what "the same" means recently</p>

<a name="168702163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168702163" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168702163">Kevin Buzzard (Jun 21 2019 at 17:59)</a>:</h4>
<p>I find this very surprising. Here we have an equality on a type which is literally not correct -- it is too weak</p>

<a name="168702383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168702383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168702383">Kevin Buzzard (Jun 21 2019 at 18:02)</a>:</h4>
<p>My rule of thumb was that <code>x = y</code> was not good if <code>x : Sort u</code> but <code>x = y</code> was OK if <code>x : T</code> with <code>T : Type u</code>. This is a counterexample.</p>

<a name="168704673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168704673" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168704673">Sebastien Gouezel (Jun 21 2019 at 18:30)</a>:</h4>
<p>I encountered a similar situation with manifolds. The basic objects is charts, i.e., local homeomorphisms (defined on their source), that one keeps composing (thereby restricting the sources by taking the intersection of the source of the first guy and the preimage of the source of the second guy). There are (at least) three ways to formalize them:</p>
<ul>
<li>(1) use a homeomorphism defined on a subtype</li>
<li>(2) use a map taking values in <code>option ...</code>, which is none outside of the source</li>
<li>(3) use a map defined on all the space, that happens to be a homeomorphism on a subset of the space that you call <code>source</code>, and do not care about what this map does outside of <code>source</code>.</li>
</ul>
<p>(1) is a nightmare from the point of view of intersections of subtypes just as what you have for sheaves. (2) is a nightmare when you want to define regularity classes because you always need to distinguish between points in the genuine space and points in <code>option</code>. (3) looks crazy, but in fact it works very well. The only drawback is that you want to say that two local homeomorphisms are "equal" if they have the same source and coincide there. This is an <code>equiv</code>, that I introduced. But in fact it turns out that in 99% of the proofs I don't need to talk about equality of local homeomorphisms, I just need to compose them. So it works fine. And I think it more or less corresponds to Kenny's suggestion for sheaves.</p>
<p>There was already a discussion on the chat where people told me to use (1) or (2) instead. And I agree that from a mathematical point of view this is the right thing to do, but from an implementation point of view (3) simply works better. Yesterday, I asked Assia Mahboubi , who has done way more formalization using DTT than anyone on this chat, about what to choose between (1), (2), (3), and her reaction was: (3) is clearly better.</p>

<a name="168704742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168704742" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168704742">Kevin Buzzard (Jun 21 2019 at 18:31)</a>:</h4>
<p>OK I'm convinced :-)</p>

<a name="168704862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168704862" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168704862">Kevin Buzzard (Jun 21 2019 at 18:33)</a>:</h4>
<p>In fact I was already half-convinced when I realised that I could formalise the glueing lemma and the statement of its universal property. I guess what I am half-worried about is rewriting. If we lose the true meaning of <code>=</code> then we lose the ability to rewrite.</p>
<p>I will try and formalise the proof of the glueing lemma over the weekend, this will be a very good test case I think.</p>

<a name="168705381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168705381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168705381">Sebastien Gouezel (Jun 21 2019 at 18:39)</a>:</h4>
<p>Yes, you can not rewrite. But if you have enough lemmas saying that, under the assumption that two objects are "equivalent", then some property holds, then you can rewrite using these lemmas.</p>

<a name="168705484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168705484" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168705484">Kevin Buzzard (Jun 21 2019 at 18:40)</a>:</h4>
<p>I do not yet have a feeling as to how much of a handicap this will be.</p>

<a name="168705546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168705546" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168705546">Sebastien Gouezel (Jun 21 2019 at 18:41)</a>:</h4>
<p>I think it will be very interesting to hear how your proof of the glueing lemma goes.</p>

<a name="168716480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168716480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168716480">Mario Carneiro (Jun 21 2019 at 21:03)</a>:</h4>
<p>There is a way to recover equality while still using sheaves on X. There is a condition you can put on your sheaf such that pushing back to U and then forward to X recovers the same sheaf</p>

<a name="168717921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168717921" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168717921">Kevin Buzzard (Jun 21 2019 at 21:24)</a>:</h4>
<p>Yes you're right; I discussed this privately with Kenny. The condition is that for all V open in X, the restriction map from F(V) to F(V intersect U) is an isomorphism (in the appropriate category). Here are several comments about this idea.</p>
<p>Firstly, we have a restriction map from F(V) to F(V intersect U), but we have no inverse, so one would have to make a choice about either just saying it's a bijection, or demanding an inverse. This seemed a bit weird.</p>
<p>Secondly, if we do this then sheaves on U are a subtype of sheaves on X, so we get the right equality but we'd have to constantly be carrying round and checking these proofs. </p>
<p>Thirdly, I can see that my philosophy is wrong. If <code>x, y : T</code> with <code>T : Type u</code> then sometimes it's fine to talk about <code>x = y</code> (e.g. if T=nat). If <code>x, y : Type u</code> then in general I can see that it is not really the right thing to do in dependent type theory, and I am quite happy with the weaker concept of being isomorphic, although I still think that there should be a whole bunch of automation which is not currently in Lean which will enable me to rewrite along isomorphisms in certain cases, with auto-generated proofs. However I do see that equality of two types is a bit weird. With the sheaf setting, equality really does look weird, because here <code>x, y : T</code> and <code>T : Type u</code> but T is a structure which has a dependent type as a field, and equality of x and y would imply equality of those dependent functions, which by functional extensionality boils down to equality of types again. This does not seem to be a good idea in type theory. If we go with the philosophy that equality of types is to be avoided, then equality of these particular terms should also I think be avoided.</p>
<p>Another way to recover equality is simply to quotient out by the correct notion. Whether this comes out nicer or more nastily than the subtype approach Mario is suggesting -- who knows. But currently my plan is to go with Kenny's crazy idea, because Sebastian and Assia seem to think that it's not so crazy after all, and I am open to the suggestion that losing the ability to rewrite will not hurt me. After all, if I have sheaves F_i on U_i and glue them together to get a sheaf F on X, the universal property really is <em>not</em> the statement that the restriction of F to U_i equals F_i, it is the data of an isomorphism.</p>

<a name="168719290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719290">Mario Carneiro (Jun 21 2019 at 21:45)</a>:</h4>
<p>I agree that equality of sheafs should be avoided. What I want to avoid is "random" data inside a sheaf</p>

<a name="168719373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719373">Kevin Buzzard (Jun 21 2019 at 21:47)</a>:</h4>
<p>So currently we have random data. I agree that there are several ways of getting rid of the randomness, including replacing sheaves on X by either a sub or a quotient. But each of these is more inconvenient to work with.</p>

<a name="168719416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719416">Kevin Buzzard (Jun 21 2019 at 21:48)</a>:</h4>
<p>I thought that randomness was everywhere in topology in Lean, with functions being randomly extended. Even 1/ 0  = 0 is a random choice.</p>

<a name="168719417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719417" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719417">Mario Carneiro (Jun 21 2019 at 21:48)</a>:</h4>
<p>A similar sort of example is subfilters. A filter on X is not the same as a filter on a subset S, but given a filter on a subset there is a canonical way to extend it to a filter, and restrict any filter to a subset, and the filters that are extended subset filters are exactly those such that <code>S \in F</code></p>

<a name="168719486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719486">Mario Carneiro (Jun 21 2019 at 21:48)</a>:</h4>
<p>random meaning not uniquely defined</p>

<a name="168719552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719552">Kevin Buzzard (Jun 21 2019 at 21:49)</a>:</h4>
<p>If I was buying into your idea I think I would go with the subtype. But then there's the question of how you say that the map F(V) -&gt; F(U intersect V) is an isomorphism. Do you just state that there exists an inverse, or do you give it?</p>

<a name="168719630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719630" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719630">Kevin Buzzard (Jun 21 2019 at 21:50)</a>:</h4>
<p>Another alternative is extension by zero. You just define F(V) to be zero if V is not a subset of U, or whatever the appropriate initial object is</p>

<a name="168719664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719664" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719664">Mario Carneiro (Jun 21 2019 at 21:51)</a>:</h4>
<p>You said there is a way to go from a sheaf on U to one on X and back. How does that work? what map F(V) -&gt; F(U \cap V) does it give you?</p>

<a name="168719680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719680">Kevin Buzzard (Jun 21 2019 at 21:51)</a>:</h4>
<p>There is more than one way.</p>

<a name="168719688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719688" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719688">Kevin Buzzard (Jun 21 2019 at 21:51)</a>:</h4>
<p>You don't know about the 6 functor formalism? ;-)</p>

<a name="168719703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719703" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719703">Kevin Buzzard (Jun 21 2019 at 21:52)</a>:</h4>
<p><a href="https://en.wikipedia.org/wiki/Six_operations" target="_blank" title="https://en.wikipedia.org/wiki/Six_operations">https://en.wikipedia.org/wiki/Six_operations</a></p>

<a name="168719748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719748" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719748">Mario Carneiro (Jun 21 2019 at 21:52)</a>:</h4>
<p>mathematician naming at its best</p>

<a name="168719754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719754" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719754">Kevin Buzzard (Jun 21 2019 at 21:52)</a>:</h4>
<p>At least there are 6 of them.</p>

<a name="168719769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719769" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719769">Kevin Buzzard (Jun 21 2019 at 21:52)</a>:</h4>
<p>You can see how to get from a sheaf on X to a sheaf on U, right? This is just some kind of forgetful functor.</p>

<a name="168719785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719785" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719785">Kevin Buzzard (Jun 21 2019 at 21:52)</a>:</h4>
<p>Well guess what: in many situations this has both a left and a right adjoint, which typically do not agree.</p>

<a name="168719816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719816" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719816">Mario Carneiro (Jun 21 2019 at 21:53)</a>:</h4>
<p>If G is the sheaf on X, then it is defined by G(V) = F(U cap V), yes?</p>

<a name="168719830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719830" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719830">Kevin Buzzard (Jun 21 2019 at 21:53)</a>:</h4>
<p>That's one of the ways of going from sheaves on U to sheaves on X, yes.</p>

<a name="168719849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719849" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719849">Mario Carneiro (Jun 21 2019 at 21:53)</a>:</h4>
<p>oh it's backwards?</p>

<a name="168719850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719850">Kevin Buzzard (Jun 21 2019 at 21:53)</a>:</h4>
<p>The other way is G(V)=0 if V is not a subset of U, and G(V)=F(V)otherwise.</p>

<a name="168719913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719913">Mario Carneiro (Jun 21 2019 at 21:54)</a>:</h4>
<p>I want the original one you said, sheaf on U -&gt; sheaf on X</p>

<a name="168719921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719921" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719921">Kevin Buzzard (Jun 21 2019 at 21:54)</a>:</h4>
<p>That one is just G(V)=F(V)</p>

<a name="168719930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719930">Kevin Buzzard (Jun 21 2019 at 21:55)</a>:</h4>
<p>wait, notation</p>

<a name="168719963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719963" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719963">Kevin Buzzard (Jun 21 2019 at 21:55)</a>:</h4>
<p>There are two ways of going from U to X. There is one way of going from X to U. There are two theorems that say something is adjoint to something else.</p>

<a name="168719975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719975">Kevin Buzzard (Jun 21 2019 at 21:55)</a>:</h4>
<p>The trivial thing is going from X to U. U is a subset of X here.</p>

<a name="168719978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168719978" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168719978">Mario Carneiro (Jun 21 2019 at 21:55)</a>:</h4>
<p>But if G is the newly defined sheaf on X, shouldn't it take an open set in X? so F(V) doesn't necessarily work</p>

<a name="168720050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720050">Kevin Buzzard (Jun 21 2019 at 21:56)</a>:</h4>
<p>The non-trivial things are going from sheaves on U to sheaves on X. One way is G(V)=F(V intersect U). The other way is G(V)=F(V) if this makes sense and 0 otherwise</p>

<a name="168720073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720073" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720073">Kevin Buzzard (Jun 21 2019 at 21:57)</a>:</h4>
<p>I am so used to thinking about etale sheaves, I am not even sure if this is right for sheaves on a top space.</p>

<a name="168720077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720077" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720077">Kevin Buzzard (Jun 21 2019 at 21:57)</a>:</h4>
<p>i might need to go and check the sheaf axiom. If it doesn't work, I might have to sheafify :-/</p>

<a name="168720108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720108">Mario Carneiro (Jun 21 2019 at 21:58)</a>:</h4>
<p>where 0 is an empty type?</p>

<a name="168720142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720142" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720142">Kevin Buzzard (Jun 21 2019 at 21:58)</a>:</h4>
<p>0 is an initial object.</p>

<a name="168720149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720149" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720149">Kevin Buzzard (Jun 21 2019 at 21:58)</a>:</h4>
<p>I'm thinking about sheaves taking values in some arbitrary category really.</p>

<a name="168720156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720156">Mario Carneiro (Jun 21 2019 at 21:58)</a>:</h4>
<p>so we can't really avoid some variation here</p>

<a name="168720158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720158">Kevin Buzzard (Jun 21 2019 at 21:58)</a>:</h4>
<p>I'm thinking about sheaves taking values in the category of abelian groups, truth be told.</p>

<a name="168720200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720200">Kevin Buzzard (Jun 21 2019 at 21:59)</a>:</h4>
<p>I think the extension by 0 is OK.</p>

<a name="168720245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720245" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720245">Kevin Buzzard (Jun 21 2019 at 22:00)</a>:</h4>
<p>It looks like the sort of thing you computer scientist would really like. "Don't know the answer? Try zero!"</p>

<a name="168720275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720275" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720275">Mario Carneiro (Jun 21 2019 at 22:00)</a>:</h4>
<p>I think that it would be best to have the actual definition be the one you started with, using subtypes, but then build an API to see them as sheafs on X</p>

<a name="168720300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720300" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720300">Kevin Buzzard (Jun 21 2019 at 22:01)</a>:</h4>
<p>If I wanted to build an API I'd just define them as sheaves on U and then go through all the pain ;-)</p>

<a name="168720311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720311" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720311">Mario Carneiro (Jun 21 2019 at 22:01)</a>:</h4>
<p>is all this pain just to build the API?</p>

<a name="168720333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720333">Kevin Buzzard (Jun 21 2019 at 22:01)</a>:</h4>
<p>Kenny built an API for sheaves on U just being sheaves on X.</p>

<a name="168720351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720351">Kevin Buzzard (Jun 21 2019 at 22:02)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">sheaves</span><span class="bp">.</span><span class="n">sheaf</span>

<span class="n">universes</span> <span class="n">v</span> <span class="n">w</span> <span class="n">u₁</span> <span class="n">v₁</span> <span class="n">u</span>

<span class="kn">open</span> <span class="n">topological_space</span>

<span class="n">def</span> <span class="n">sheaf_on_opens</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">sheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">X</span>

<span class="kn">namespace</span> <span class="n">sheaf_on_opens</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">{</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">}</span>

<span class="n">def</span> <span class="kn">eval</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span> <span class="o">:=</span>
<span class="n">presheaf</span><span class="bp">.</span><span class="n">F</span> <span class="o">(</span><span class="n">sheaf</span><span class="bp">.</span><span class="n">F</span> <span class="n">F</span><span class="o">)</span> <span class="n">V</span>

<span class="n">def</span> <span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span>
  <span class="o">(</span><span class="n">HWU</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⊆</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">V</span> <span class="n">HVU</span> <span class="bp">→</span> <span class="n">F</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">W</span> <span class="n">HWU</span> <span class="o">:=</span>
<span class="n">presheaf</span><span class="bp">.</span><span class="n">res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">HWV</span>

<span class="n">def</span> <span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span> <span class="n">X</span> <span class="n">V</span> <span class="o">:=</span>
<span class="n">F</span>

<span class="kn">structure</span> <span class="n">morphism</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">V</span> <span class="n">H</span> <span class="bp">→</span> <span class="n">G</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">V</span> <span class="n">H</span><span class="o">)</span>
<span class="o">(</span><span class="n">commutes</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HV</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HW</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="err">⊆</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">),</span>
  <span class="n">map</span> <span class="n">W</span> <span class="n">HW</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">W</span> <span class="n">HW</span> <span class="n">HWV</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">G</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">W</span> <span class="n">HW</span> <span class="n">HWV</span> <span class="o">(</span><span class="n">map</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">))</span>

<span class="kn">namespace</span> <span class="n">morphism</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">id</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">F</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span>
  <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">W</span> <span class="n">HW</span> <span class="n">HWV</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">comp</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">u₁</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">G</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">ξ</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">H</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">HV</span> <span class="o">(</span><span class="n">ξ</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">),</span>
  <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">W</span> <span class="n">HW</span> <span class="n">HWV</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">ξ</span><span class="bp">.</span><span class="n">commutes</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">commutes</span><span class="o">]</span> <span class="o">}</span>

<span class="bp">@</span><span class="o">[</span><span class="n">extensionality</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">ext</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">{</span><span class="n">η</span> <span class="n">ξ</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">}</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">ξ</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">η</span> <span class="bp">=</span> <span class="n">ξ</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cases</span> <span class="n">η</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">ξ</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">ext</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">H</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">id_comp</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">G</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="n">η</span> <span class="bp">=</span> <span class="n">η</span> <span class="o">:=</span>
<span class="n">ext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">comp_id</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">η</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">F</span><span class="o">)</span> <span class="bp">=</span> <span class="n">η</span> <span class="o">:=</span>
<span class="n">ext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">x</span><span class="o">,</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">comp_assoc</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">u₁</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v₁</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">H</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">I</span><span class="o">)</span> <span class="o">(</span><span class="n">ξ</span> <span class="o">:</span> <span class="n">G</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">χ</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">η</span><span class="bp">.</span><span class="n">comp</span> <span class="n">ξ</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="n">χ</span> <span class="bp">=</span> <span class="n">η</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">ξ</span><span class="bp">.</span><span class="n">comp</span> <span class="n">χ</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">rfl</span>

<span class="n">def</span> <span class="n">res_subset</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span><span class="bp">.</span><span class="n">morphism</span> <span class="o">(</span><span class="n">G</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">W</span> <span class="n">HWV</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">map</span> <span class="n">W</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">HWV</span> <span class="n">HVU</span><span class="o">),</span>
  <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">S</span> <span class="n">HSV</span> <span class="n">T</span> <span class="n">HTV</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">commutes</span> <span class="n">S</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">HSV</span> <span class="n">HVU</span><span class="o">)</span> <span class="n">T</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">HTV</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">}</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">comp_res_subset</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">u₁</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">G</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">ξ</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">morphism</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">η</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="o">(</span><span class="n">ξ</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">η</span><span class="bp">.</span><span class="n">comp</span> <span class="n">ξ</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span> <span class="o">:=</span>
<span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">id_res_subset</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">F</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span> <span class="bp">=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">rfl</span>

<span class="kn">end</span> <span class="n">morphism</span>

<span class="kn">structure</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">inv_fun</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">G</span> <span class="n">F</span><span class="o">)</span>
<span class="o">(</span><span class="n">left_inv</span> <span class="o">:</span> <span class="n">inv_fun</span><span class="bp">.</span><span class="n">comp</span> <span class="n">to_fun</span> <span class="bp">=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">F</span><span class="o">)</span>
<span class="o">(</span><span class="n">right_inv</span> <span class="o">:</span> <span class="n">to_fun</span><span class="bp">.</span><span class="n">comp</span> <span class="n">inv_fun</span> <span class="bp">=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">G</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">equiv</span>

<span class="n">def</span> <span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">F</span> <span class="n">F</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">F</span><span class="o">,</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">F</span><span class="o">,</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">symm</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">G</span> <span class="n">F</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">e</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">4</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">3</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">trans</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">u₁</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">e₁</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">(</span><span class="n">e₂</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">G</span> <span class="n">H</span><span class="o">)</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">e₂</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">comp</span> <span class="n">e₁</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">e₁</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="n">comp</span> <span class="n">e₂</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">morphism</span><span class="bp">.</span><span class="n">comp_assoc</span><span class="o">,</span> <span class="err">←</span> <span class="n">e₂</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="n">comp_assoc</span><span class="o">,</span> <span class="n">e₂</span><span class="bp">.</span><span class="mi">3</span><span class="o">,</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id_comp</span><span class="o">,</span> <span class="n">e₁</span><span class="bp">.</span><span class="mi">3</span><span class="o">],</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">morphism</span><span class="bp">.</span><span class="n">comp_assoc</span><span class="o">,</span> <span class="err">←</span> <span class="n">e₁</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">comp_assoc</span><span class="o">,</span> <span class="n">e₁</span><span class="bp">.</span><span class="mi">4</span><span class="o">,</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id_comp</span><span class="o">,</span> <span class="n">e₂</span><span class="bp">.</span><span class="mi">4</span><span class="o">]</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">res_subset</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">w</span><span class="o">}</span> <span class="n">X</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">e</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span>
  <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">e</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">2</span><span class="bp">.</span><span class="n">res_subset</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">,</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">morphism</span><span class="bp">.</span><span class="n">comp_res_subset</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">3</span><span class="o">,</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id_res_subset</span><span class="o">],</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">morphism</span><span class="bp">.</span><span class="n">comp_res_subset</span><span class="o">,</span> <span class="n">e</span><span class="bp">.</span><span class="mi">4</span><span class="o">,</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id_res_subset</span><span class="o">]</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">equiv</span>

<span class="c1">-- should be in mathlib</span>

<span class="kn">namespace</span> <span class="n">opens</span>

<span class="n">def</span> <span class="n">Union</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">set</span><span class="bp">.</span><span class="n">Union</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span> <span class="n">is_open_Union</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span><span class="bp">⟩</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span>

<span class="kn">theorem</span> <span class="n">subset_Union</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">s</span> <span class="n">i</span> <span class="err">⊆</span> <span class="n">Union</span> <span class="n">s</span> <span class="o">:=</span>
<span class="c1">-- why does lattice.le_supr need complete lattice?</span>
<span class="bp">λ</span> <span class="n">s</span> <span class="n">i</span> <span class="n">x</span> <span class="n">hx</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_Union</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">i</span><span class="o">,</span> <span class="n">hx</span><span class="bp">⟩</span>

<span class="c">/-</span><span class="cm"> Other things I might need about this Union</span>

<span class="cm">@[simp] theorem mem_Union {x : β} {s : ι → set β} : x ∈ Union s ↔ ∃ i, x ∈ s i :=</span>
<span class="cm">⟨assume ⟨t, ⟨⟨a, (t_eq : s a = t)⟩, (h : x ∈ t)⟩⟩, ⟨a, t_eq.symm ▸ h⟩,</span>
<span class="cm">  assume ⟨a, h⟩, ⟨s a, ⟨⟨a, rfl⟩, h⟩⟩⟩</span>
<span class="cm">/- alternative proof: dsimp [Union, supr, Sup]; simp -/</span>
<span class="cm">  -- TODO: more rewrite rules wrt forall / existentials and logical connectives</span>
<span class="cm">  -- TODO: also eliminate ∃i, ... ∧ i = t ∧ ...</span>

<span class="cm">theorem Union_subset {s : ι → set β} {t : set β} (h : ∀ i, s i ⊆ t) : (⋃ i, s i) ⊆ t :=</span>
<span class="cm">-- TODO: should be simpler when sets&#39; order is based on lattices</span>
<span class="cm">@supr_le (set β) _ set.lattice_set _ _ h</span>

<span class="cm">theorem Union_subset_iff {α : Sort u} {s : α → set β} {t : set β} : (⋃ i, s i) ⊆ t ↔ (∀ i, s i ⊆ t):=</span>
<span class="cm">⟨assume h i, subset.trans (le_supr s _) h, Union_subset⟩</span>

<span class="cm">theorem subset_Union : ∀ (s : ι → set β) (i : ι), s i ⊆ (⋃ i, s i) := le_supr</span>

<span class="cm">theorem Union_const [inhabited ι] (s : set β) : (⋃ i:ι, s) = s :=</span>
<span class="cm">ext $ by simp</span>

<span class="cm">theorem inter_Union_left (s : set β) (t : ι → set β) :</span>
<span class="cm">  s ∩ (⋃ i, t i) = ⋃ i, s ∩ t i :=</span>
<span class="cm">ext $ by simp</span>

<span class="cm">theorem inter_Union_right (s : set β) (t : ι → set β) :</span>
<span class="cm">  (⋃ i, t i) ∩ s = ⋃ i, t i ∩ s :=</span>
<span class="cm">ext $ by simp</span>

<span class="cm">theorem Union_union_distrib (s : ι → set β) (t : ι → set β) :</span>
<span class="cm">  (⋃ i, s i ∪ t i) = (⋃ i, s i) ∪ (⋃ i, t i) :=</span>
<span class="cm">ext $ by simp [exists_or_distrib]</span>

<span class="cm">theorem union_Union_left [inhabited ι] (s : set β) (t : ι → set β) :</span>
<span class="cm">  s ∪ (⋃ i, t i) = ⋃ i, s ∪ t i :=</span>
<span class="cm">by rw [Union_union_distrib, Union_const]</span>

<span class="cm">theorem union_Union_right [inhabited ι] (s : set β) (t : ι → set β) :</span>
<span class="cm">  (⋃ i, t i) ∪ s = ⋃ i, t i ∪ s :=</span>
<span class="cm">by rw [Union_union_distrib, Union_const]</span>

<span class="cm">theorem diff_Union_right (s : set β) (t : ι → set β) :</span>
<span class="cm">  (⋃ i, t i) \ s = ⋃ i, t i \ s :=</span>
<span class="cm">inter_Union_right _ _</span>

<span class="cm">-/</span>

<span class="kn">end</span> <span class="n">opens</span>

<span class="n">def</span> <span class="n">glue</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="o">:</span>
  <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">Union</span> <span class="n">S</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">F</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">W</span><span class="o">,</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">//</span>
      <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span>
        <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">f</span> <span class="n">j</span><span class="o">)</span> <span class="o">},</span>
    <span class="n">res</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">HUV</span> <span class="n">f</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="bp">_</span> <span class="n">HUV</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">),</span>
      <span class="k">begin</span> <span class="n">sorry</span>

      <span class="kn">end</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">Hid</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="n">Hcomp</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">},</span>
  <span class="n">locality</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">gluing</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">universal_property</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">glue</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">Hφ1</span> <span class="n">Hφ2</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">$</span> <span class="n">opens</span><span class="bp">.</span><span class="n">subset_Union</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="kn">end</span> <span class="n">sheaf_on_opens</span>
</pre></div>

<a name="168720434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720434">Kevin Buzzard (Jun 21 2019 at 22:03)</a>:</h4>
<p>If I fill in the sorries then I've proved that Kenny's random idea works out. The alternative is to use a subtype, but then I need " F(V) -&gt; F(U intersect V) is an isomorphism" to be a Prop, so things might get noncomputable.</p>

<a name="168720438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720438">Mario Carneiro (Jun 21 2019 at 22:03)</a>:</h4>
<p>wait so you still have a separate definition? This seems like a lot of duplication</p>

<a name="168720439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720439" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720439">Kevin Buzzard (Jun 21 2019 at 22:03)</a>:</h4>
<p>Not that I care, but you might.</p>

<a name="168720452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720452" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720452">Kevin Buzzard (Jun 21 2019 at 22:04)</a>:</h4>
<p>We have a wrapper:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">sheaf_on_opens</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">sheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">X</span>
</pre></div>

<a name="168720496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720496">Mario Carneiro (Jun 21 2019 at 22:04)</a>:</h4>
<p>Remind me the original definitions, I will show how to do this without all the proof obligations</p>

<a name="168720552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720552">Mario Carneiro (Jun 21 2019 at 22:04)</a>:</h4>
<p>The <code>res</code> function need not take a proof arg, nor <code>eval</code></p>

<a name="168720572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720572" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720572">Kevin Buzzard (Jun 21 2019 at 22:05)</a>:</h4>
<p>Right!</p>

<a name="168720575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720575">Kevin Buzzard (Jun 21 2019 at 22:05)</a>:</h4>
<p><a href="https://github.com/ramonfmir/lean-scheme/blob/master/src/sheaves/sheaf.lean" target="_blank" title="https://github.com/ramonfmir/lean-scheme/blob/master/src/sheaves/sheaf.lean">https://github.com/ramonfmir/lean-scheme/blob/master/src/sheaves/sheaf.lean</a></p>

<a name="168720593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720593">Kevin Buzzard (Jun 21 2019 at 22:05)</a>:</h4>
<p>That's the definition of a sheaf.</p>

<a name="168720658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168720658" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168720658">Kevin Buzzard (Jun 21 2019 at 22:06)</a>:</h4>
<p>It uses the file presheaf.lean in the same directory, plus epsilon about open coverings.</p>

<a name="168723312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168723312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168723312">Mario Carneiro (Jun 21 2019 at 22:52)</a>:</h4>
<p>I will come back to this later, but here's the first pass:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">presheaf</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">F</span>     <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="o">(</span><span class="n">res</span>   <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">U</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">),</span> <span class="n">F</span> <span class="n">U</span> <span class="bp">→</span> <span class="n">F</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">Hid</span>   <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">U</span><span class="o">),</span> <span class="n">res</span> <span class="n">U</span> <span class="n">U</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">U</span><span class="o">)</span> <span class="bp">=</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="n">Hcomp</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">U</span> <span class="n">V</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">),</span>
  <span class="n">res</span> <span class="n">U</span> <span class="n">W</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">HWV</span> <span class="n">HVU</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="err">∘</span> <span class="n">res</span> <span class="n">U</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">presheaf</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">,</span>
  <span class="n">coe</span> <span class="o">:=</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">F</span> <span class="o">}</span>

<span class="c1">-- Simplification lemmas for Hid and Hcomp.</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">Hcomp&#39;</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">U</span> <span class="n">V</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">),</span>
  <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">W</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">HWV</span> <span class="n">HVU</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span>
  <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span><span class="o">)</span> <span class="o">((</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="n">HVU</span> <span class="n">s</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">F</span><span class="bp">.</span><span class="n">Hcomp</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="n">HVU</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">Hid&#39;</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">),</span>
  <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">U</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">U</span><span class="o">))</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">s</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">U</span> <span class="n">s</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">F</span><span class="bp">.</span><span class="n">Hid</span> <span class="n">U</span><span class="bp">;</span> <span class="n">simp</span>

<span class="n">def</span> <span class="n">total</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span> <span class="err">Σ</span> <span class="n">U</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">F</span> <span class="n">U</span>

<span class="kn">instance</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="o">(</span><span class="n">F</span> <span class="n">U</span><span class="o">)</span> <span class="n">F</span><span class="bp">.</span><span class="n">total</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">sigma</span><span class="bp">.</span><span class="n">mk</span> <span class="bp">_⟩</span>

<span class="bp">@</span><span class="o">[</span><span class="n">elab_as_eliminator</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">total</span><span class="bp">.</span><span class="n">cases_on</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">total</span> <span class="bp">→</span> <span class="n">Sort</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">U</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">),</span> <span class="n">C</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cases</span> <span class="n">x</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">H</span>

<span class="n">def</span> <span class="n">res&#39;</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">total</span> <span class="bp">→</span> <span class="n">F</span><span class="bp">.</span><span class="n">total</span>
<span class="bp">|</span> <span class="bp">⟨</span><span class="n">U</span><span class="o">,</span> <span class="n">x</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="o">(</span><span class="n">U</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="n">x</span>

<span class="kn">theorem</span> <span class="n">res&#39;_def</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="o">(</span><span class="n">U</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">theorem</span> <span class="n">res&#39;_val</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">V</span> <span class="n">h</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">have</span> <span class="bp">∀</span> <span class="n">W</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">),</span> <span class="n">W</span> <span class="bp">=</span> <span class="n">V</span> <span class="bp">→</span>
  <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">W</span> <span class="n">H</span> <span class="n">x</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">total</span><span class="o">)</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">V</span> <span class="n">h</span> <span class="n">x</span> <span class="o">:=</span>
  <span class="k">by</span> <span class="n">rintro</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">rfl</span><span class="bp">;</span> <span class="n">refl</span><span class="o">,</span>
<span class="n">this</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">inf_of_le_right</span> <span class="n">h</span><span class="o">)</span>

<span class="kn">theorem</span> <span class="n">res&#39;_eq_inf</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="o">(</span><span class="n">U</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res&#39;_def</span><span class="o">,</span> <span class="err">←</span> <span class="n">res&#39;_val</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_left</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">res&#39;_eq_left</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span> <span class="n">W</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">U</span> <span class="err">⊓</span> <span class="n">V</span> <span class="bp">=</span> <span class="n">U</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">W</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res&#39;_eq_inf</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="err">←</span> <span class="n">res&#39;_eq_inf</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">res&#39;_id</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">U</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res&#39;_val</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">U</span><span class="o">),</span> <span class="n">F</span><span class="bp">.</span><span class="n">Hid</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">res&#39;_comp</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">total</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">U</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="o">(</span><span class="n">U</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">total</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">F</span> <span class="n">x</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">W</span> <span class="n">x</span><span class="o">,</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res&#39;_def</span><span class="o">,</span> <span class="n">res&#39;_def</span><span class="o">,</span> <span class="err">←</span> <span class="n">F</span><span class="bp">.</span><span class="n">Hcomp&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">res&#39;_val</span><span class="o">,</span> <span class="n">res&#39;_eq_left</span><span class="o">]</span><span class="bp">;</span>
   <span class="n">simp</span> <span class="o">[</span><span class="n">inf_left_comm</span><span class="o">,</span> <span class="n">inf_comm</span><span class="o">]</span>

<span class="kn">end</span> <span class="n">presheaf</span>
</pre></div>

<a name="168724242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724242" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724242">Kevin Buzzard (Jun 21 2019 at 23:06)</a>:</h4>
<p>I think your definition of presheaf is essentially the definition of a functor</p>

<a name="168724260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724260" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724260">Kevin Buzzard (Jun 21 2019 at 23:07)</a>:</h4>
<p>To Type</p>

<a name="168724267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724267" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724267">Reid Barton (Jun 21 2019 at 23:07)</a>:</h4>
<p>it had better be!</p>

<a name="168724270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724270">Mario Carneiro (Jun 21 2019 at 23:07)</a>:</h4>
<p>more or less; it's a preorder category on the left too, and I use the existence of infima a lot</p>

<a name="168724277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724277" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724277">Mario Carneiro (Jun 21 2019 at 23:07)</a>:</h4>
<p>which I think means products?</p>

<a name="168724352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724352">Mario Carneiro (Jun 21 2019 at 23:08)</a>:</h4>
<p>However this generalization is basically zero cost, while I'm not sure that generalizing to functor is also zero cost</p>

<a name="168724382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724382" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724382">Mario Carneiro (Jun 21 2019 at 23:09)</a>:</h4>
<p>it's not really even relevant, it's just sort of an obvious generalization the way it's been written</p>

<a name="168724387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724387" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724387">Kevin Buzzard (Jun 21 2019 at 23:09)</a>:</h4>
<p>But functors are already there. <span class="user-mention" data-user-id="110087">@Scott Morrison</span> and I had talked about this being a very good use case for the category theory library.</p>

<a name="168724391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724391">Mario Carneiro (Jun 21 2019 at 23:09)</a>:</h4>
<p>the point I want to make involves <code>res'</code></p>

<a name="168724439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724439" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724439">Kevin Buzzard (Jun 21 2019 at 23:10)</a>:</h4>
<p>And this <code>total</code> trick</p>

<a name="168724444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724444" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724444">Mario Carneiro (Jun 21 2019 at 23:10)</a>:</h4>
<p>once again, untyped to the rescue</p>

<a name="168724497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724497">Mario Carneiro (Jun 21 2019 at 23:11)</a>:</h4>
<p>there is still some unpacking to do with the definition of <code>locality</code> and <code>gluing</code>; one wants the statement to be in terms of families not sets</p>

<a name="168724547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724547" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724547">Kevin Buzzard (Jun 21 2019 at 23:12)</a>:</h4>
<p>There seem to be several approaches to this. I remember Scott saying that presheaves were fine but the sheaf axiom got a bit grotty in the sense that he wasn't happy with his attempts to formalise it. The sheaf axiom is <code>gluing \and locality</code></p>

<a name="168724559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724559" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724559">Kevin Buzzard (Jun 21 2019 at 23:13)</a>:</h4>
<p>You can make them into one axiom by changing that exists in the conclusion of glueing to exists unique, but Ramon found it nicer to keep them separate.</p>

<a name="168724634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724634" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724634">Mario Carneiro (Jun 21 2019 at 23:14)</a>:</h4>
<p>Oh, this is epsilon nicer:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">gluing</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">{{</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">}}</span> <span class="o">{{</span><span class="n">S</span><span class="o">}},</span> <span class="n">is_lub</span> <span class="n">S</span> <span class="n">U</span> <span class="bp">→</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">V</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="n">F</span> <span class="n">V</span><span class="o">),</span>
<span class="o">(</span><span class="bp">∀</span> <span class="n">V</span> <span class="n">W</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span>
  <span class="n">res&#39;</span> <span class="n">F</span> <span class="o">(</span><span class="n">V</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">V</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res&#39;</span> <span class="n">F</span> <span class="o">(</span><span class="n">V</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">W</span><span class="o">))</span> <span class="bp">→</span>
<span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">V</span><span class="o">:</span><span class="n">S</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">s</span> <span class="n">V</span>
</pre></div>

<a name="168724646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724646">Kevin Buzzard (Jun 21 2019 at 23:14)</a>:</h4>
<p>So what is the advantage of this approach over Kenny's, given that I decided I didn't care about equality being broken? <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> does this approach have an analogue in your chart world?</p>

<a name="168724659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724659" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724659">Mario Carneiro (Jun 21 2019 at 23:15)</a>:</h4>
<p>Axiomatically, this is equivalent to the very first definition we started with when we first looked at it</p>

<a name="168724665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724665" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724665">Mario Carneiro (Jun 21 2019 at 23:15)</a>:</h4>
<p>All I'm doing is layering a more convenient API on top</p>

<a name="168724667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724667">Kevin Buzzard (Jun 21 2019 at 23:15)</a>:</h4>
<p>In the schemes project we need sheaves of rings, and then sheaves of modules over the rings.</p>

<a name="168724714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724714" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724714">Mario Carneiro (Jun 21 2019 at 23:16)</a>:</h4>
<p>You can change <code>Type</code> to a category here without changing anything</p>

<a name="168724720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724720" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724720">Kevin Buzzard (Jun 21 2019 at 23:16)</a>:</h4>
<p>I'm not sure there's a category of modules over the category of rings, as it were</p>

<a name="168724721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724721" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724721">Mario Carneiro (Jun 21 2019 at 23:16)</a>:</h4>
<p>well that's not exactly true; I'm using  a sigma type which needs the underlying space to be a type</p>

<a name="168724747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724747">Kevin Buzzard (Jun 21 2019 at 23:17)</a>:</h4>
<p>In the perfectoid project we need sheaves of topological rings, and there's an extra subtlety there</p>

<a name="168724784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724784" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724784">Kevin Buzzard (Jun 21 2019 at 23:18)</a>:</h4>
<p>The sheaf axiom says that a certain map is an equalizer, and we're writing it as "there exists unique x" but in the category of topological spaces there's more to it than that.</p>

<a name="168724820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724820" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724820">Kevin Buzzard (Jun 21 2019 at 23:18)</a>:</h4>
<p>We need two topologies on a ring to coincide as well. This seems like a good excuse to go full category with the target</p>

<a name="168724823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724823">Mario Carneiro (Jun 21 2019 at 23:18)</a>:</h4>
<p>Eh, I'm not really sure about the quality of any remarks I make here. Show me the code and we can talk</p>

<a name="168724882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724882" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724882">Mario Carneiro (Jun 21 2019 at 23:19)</a>:</h4>
<p>Make this definition in the generality that you actually need</p>

<a name="168724884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724884" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724884">Kevin Buzzard (Jun 21 2019 at 23:19)</a>:</h4>
<p>I'm just thinking of all the "extreme" notions of sheaves which I've encountered so far in my Lean work.</p>

<a name="168724933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724933" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724933">Kevin Buzzard (Jun 21 2019 at 23:20)</a>:</h4>
<blockquote>
<p>Make this definition in the generality that you actually need</p>
</blockquote>
<p>That's not the right approach, because the generality we actually need is sheaves of categories on a site.</p>

<a name="168724944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724944" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724944">Kevin Buzzard (Jun 21 2019 at 23:20)</a>:</h4>
<p>That's what we'll need when we start doing etale cohomology.</p>

<a name="168724960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168724960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168724960">Kevin Buzzard (Jun 21 2019 at 23:20)</a>:</h4>
<p>So now you won't be able to get away with lattices, there is a category with a Grothendieck topology.</p>

<a name="168725044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725044" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725044">Kevin Buzzard (Jun 21 2019 at 23:22)</a>:</h4>
<p>The whole "work in the correct generality" thing might work for basic Lean stuff but in maths things get so absurdly general sometimes that it's really not that clear that you want to work in the fullest 2019 generality.</p>

<a name="168725047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725047">Kevin Buzzard (Jun 21 2019 at 23:22)</a>:</h4>
<p>Not least because you might be out of date in 5 years anyway.</p>

<a name="168725077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725077" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725077">Mario Carneiro (Jun 21 2019 at 23:23)</a>:</h4>
<p>I don't mean the possible generality that exists, I mean the generality that suffices for the short to mid term future</p>

<a name="168725128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725128" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725128">Mario Carneiro (Jun 21 2019 at 23:24)</a>:</h4>
<p>like "what we need for the current major milestone"</p>

<a name="168725135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725135" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725135">Kevin Buzzard (Jun 21 2019 at 23:24)</a>:</h4>
<p>For all I know they're doing sheaves on infinity,1 categories nowadays.</p>

<a name="168725153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725153">Mario Carneiro (Jun 21 2019 at 23:25)</a>:</h4>
<p>always have a concrete application in mind that is not in danger of being pushed off to the infinite future</p>

<a name="168725268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725268">Kevin Buzzard (Jun 21 2019 at 23:27)</a>:</h4>
<p>The reason I'm thinking about gluing sheaves is that we have a nice theory of affine schemes, and then to make general schemes you have to glue affine schemes together. We can glue topological spaces together, so all we have to do is to glue sheaves together and we can make general schemes. That would be a cool milestone. To do that we would need to be able to glue sheaves of commutative rings together.</p>

<a name="168725279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725279">Mario Carneiro (Jun 21 2019 at 23:27)</a>:</h4>
<p>Okay, so you need to have more than sheaves on Type then. Do you need more than lattices?</p>

<a name="168725333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725333">Kevin Buzzard (Jun 21 2019 at 23:28)</a>:</h4>
<p>A sheaf of commutative rings is just a sheaf of types but all the res maps are ring homs. We're still talking about sheaves on topological spaces here, so if opens X is a lattice then we don't need more than lattices.</p>

<a name="168725375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725375" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725375">Kevin Buzzard (Jun 21 2019 at 23:29)</a>:</h4>
<p>I've been thinking about the next few things which it would be fun to formalise (and looking for students to do them). I should perhaps post them as issues, as per Scott's suggestion.</p>

<a name="168725662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725662">Mario Carneiro (Jun 21 2019 at 23:35)</a>:</h4>
<p>something like this then?</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">sheaf</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">presheaf</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">locality</span> <span class="o">:</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">locality</span><span class="o">)</span>
<span class="o">(</span><span class="n">gluing</span>   <span class="o">:</span> <span class="n">to_presheaf</span><span class="bp">.</span><span class="n">gluing</span><span class="o">)</span>

<span class="kn">structure</span> <span class="n">sheaf_of_rings</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="kn">extends</span> <span class="n">sheaf</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">[</span><span class="n">ring</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">U</span><span class="o">,</span> <span class="n">ring</span> <span class="o">(</span><span class="n">F</span> <span class="n">U</span><span class="o">)]</span>
<span class="o">[</span><span class="n">ring_hom</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">U</span> <span class="n">V</span> <span class="n">h</span><span class="o">,</span> <span class="n">is_ring_hom</span> <span class="o">(</span><span class="n">res</span> <span class="n">U</span> <span class="n">V</span> <span class="n">h</span><span class="o">)]</span>
</pre></div>

<a name="168725820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168725820" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168725820">Mario Carneiro (Jun 21 2019 at 23:38)</a>:</h4>
<p>you can't prove that <code>res'</code> is a ring_hom because it has the wrong type, but you could either use a different total space that is a ring, like Reid suggested in the CDGA thread, or you could just prove concretely that it preserves addition and so on modulo a coercion</p>

<a name="168726652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168726652" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168726652">Mario Carneiro (Jun 21 2019 at 23:56)</a>:</h4>
<p>Ah, actually neither of those options works. Apparently rings don't have a very nice indexed coproduct; it can be trivial because of characteristic constraints. And it's not really easy to talk about addition and so on over a coercion unless the total space has an addition</p>

<a name="168726762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168726762" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168726762">Mario Carneiro (Jun 21 2019 at 23:58)</a>:</h4>
<p>But this definition is so higher order that perhaps you aren't really doing actual algebra on the rings anymore, and knowing that the res maps are abstractly a ring hom is sufficient</p>

<a name="168740744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740744" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740744">Kevin Buzzard (Jun 22 2019 at 07:30)</a>:</h4>
<p>Yes, you really don't want to be making all the objects subtypes of a large object, this can't be done in general (and in particular it can't be done with commutative rings, which are an important case). In the CDGA thread we had abelian groups (or more generally R-modules for a fixed R), where it can be done. As far as I know nobody has formalised sheaves of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="script">O</mi><mi>X</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{O}_X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span>-modules, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="script">O</mi><mi>X</mi></msub></mrow><annotation encoding="application/x-tex">\mathcal{O}_X</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base"><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span> is the traditional name for the standard sheaf of rings on a scheme, the structure sheaf (namely the sheaf of functions on the scheme). </p>
<p>I am unclear about why Mario is unhappy about the definition containing random junk.</p>

<a name="168740862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740862" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740862">Mario Carneiro (Jun 22 2019 at 07:35)</a>:</h4>
<p>It can always be done, but you get some thing that's not in the category in general</p>

<a name="168740902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740902" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740902">Mario Carneiro (Jun 22 2019 at 07:36)</a>:</h4>
<p>which is not actually a problem in most cases</p>

<a name="168740907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740907">Mario Carneiro (Jun 22 2019 at 07:37)</a>:</h4>
<p>I don't know if I can explain the issue I have with "random junk" clearly, which is worrisome</p>

<a name="168740917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740917" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740917">Mario Carneiro (Jun 22 2019 at 07:37)</a>:</h4>
<p>Although I don't suggest the use of = on these objects, I do want the shape of the types to reflect the structure of the type</p>

<a name="168740959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740959" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740959">Mario Carneiro (Jun 22 2019 at 07:38)</a>:</h4>
<p>I will grant that consistently using a "weird equiv" will mostly make this decision invisible</p>

<a name="168740969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168740969" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168740969">Mario Carneiro (Jun 22 2019 at 07:39)</a>:</h4>
<p>maybe I'm still hoping for that HoTT style transfer tactic, where equivs are magicked up from the definition of the type</p>

<a name="168741031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168741031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168741031">Kevin Buzzard (Jun 22 2019 at 07:41)</a>:</h4>
<p>It can always be done -- ah yes sorry, I was sticking within the category. I see you can always make the sigma type, and doing Reid's CDGA exercise the naive way showed me clearly how it can be advantageous to make the type. I haven't seen the point of it here yet but presumably we're just waiting for the analogue of Reid's challenge questions to show up. </p>
<p>Random junk -- I am going to press ahead with the bad <code>=</code> type just out of interest, although apparently I have to go and be social this weekend, which rather spoils my fun plans. Sheaves and schemes have turned out to be a really good test case for teaching me about the subtleties of type theory. Part of me is still amazed that there weren't mathematicians doing this stuff in Coq 10 years ago.</p>

<a name="168741035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168741035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168741035">Kevin Buzzard (Jun 22 2019 at 07:41)</a>:</h4>
<blockquote>
<p>maybe I'm still hoping for that HoTT style transfer tactic, where equivs are magicked up from the definition of the type</p>
</blockquote>
<p>Aah! I see that this will definitely fail with Kenny's approach!</p>

<a name="168749542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749542" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749542">Kevin Buzzard (Jun 22 2019 at 12:29)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">glue</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="o">:</span>
  <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">Union</span> <span class="n">S</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">F</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">W</span><span class="o">,</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">//</span>
      <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span>
        <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">f</span> <span class="n">j</span><span class="o">)</span> <span class="o">},</span>
    <span class="n">res</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">HUV</span> <span class="n">f</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="bp">_</span> <span class="n">HUV</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">i</span><span class="o">),</span>
      <span class="k">begin</span>
        <span class="n">intros</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span>
<span class="c1">--        cases f with f hf,</span>
        <span class="n">rw</span> <span class="n">res_comp</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">res_comp</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">answer</span> <span class="o">:=</span> <span class="n">congr_arg</span> <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span>
          <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="bp">_</span> <span class="n">HUV</span><span class="o">))</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">property</span> <span class="n">i</span> <span class="n">j</span><span class="o">),</span>
        <span class="n">rw</span> <span class="n">res_comp</span> <span class="n">at</span> <span class="n">answer</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span><span class="n">answer</span><span class="o">,</span>
        <span class="n">clear</span> <span class="n">answer</span><span class="o">,</span>
        <span class="k">let</span> <span class="n">XXX</span> <span class="o">:=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">to_fun</span><span class="bp">.</span><span class="n">commutes</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span>
          <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="bp">_</span> <span class="n">HUV</span><span class="o">)</span>
          <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_left</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
            <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="kn">eval</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span>
            <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))),</span>
<span class="c1">--        simp only [eval_res_subset] at XXX,</span>
<span class="c1">--        rw eval_res_subset at XXX,</span>
<span class="c1">--          rw XXX,</span>
<span class="c1">--        convert XXX,</span>
<span class="c1">--        simp [XXX],</span>
        <span class="c1">--rw ←res_comp (F i) (S i ∩ U) _ (S i ∩ S j ∩ U)</span>
        <span class="c1">--  (set.subset.trans (set.inter_subset_left _ _) (set.inter_subset_left _ _))</span>
        <span class="c1">--  (S i ∩ S j ∩ V) _ (set.inter_subset_inter_left _ (set.inter_subset_left _ _)) (set.inter_subset_inter_right _ HUV),</span>
<span class="c1">--        rw ←(F i : sheaf X).F.Hcomp&#39;,</span>
<span class="c1">--        rw (φ i j).to_fun.commutes _ _ _ _ _, -- (V : opens X) (HV : V ⊆ U) (W : opens X) (HW : W ⊆ U) (HWV : W ⊆ V) (x : eval F V HV)</span>
<span class="n">sorry</span><span class="o">,</span>
      <span class="kn">end</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">Hid</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="n">Hcomp</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">},</span>
  <span class="n">locality</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">gluing</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>
</pre></div>


<p>Glueing sheaves is quite interesting <span class="user-mention" data-user-id="110064">@Kenny Lau</span> . There are all sorts of things to think about. I am not sure I fully understand the power of <code>Hφ2</code> yet. Do you know a better way of understanding it? Is it a 1-cocycle of some sort?</p>

<a name="168749548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749548" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749548">Kenny Lau (Jun 22 2019 at 12:29)</a>:</h4>
<p>it's the cocycle condition right</p>

<a name="168749600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749600">Kevin Buzzard (Jun 22 2019 at 12:30)</a>:</h4>
<p><a href="https://github.com/anca797/group-cohomology" target="_blank" title="https://github.com/anca797/group-cohomology">https://github.com/anca797/group-cohomology</a></p>

<a name="168749607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749607">Kevin Buzzard (Jun 22 2019 at 12:30)</a>:</h4>
<p><span class="user-mention" data-user-id="202902">@Anca Ciobanu</span> 's definition of a 1-cocycle is in that link.</p>

<a name="168749616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749616" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749616">Kevin Buzzard (Jun 22 2019 at 12:31)</a>:</h4>
<p>She's doing 3rd year project with me.</p>

<a name="168749618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749618">Kevin Buzzard (Jun 22 2019 at 12:31)</a>:</h4>
<p>We're just trundling along learning about cocycles.</p>

<a name="168749621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749621" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749621">Kevin Buzzard (Jun 22 2019 at 12:31)</a>:</h4>
<p>So can you make a cocycle from something which people call the cocycle condition?</p>

<a name="168749674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749674" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749674">Kevin Buzzard (Jun 22 2019 at 12:33)</a>:</h4>
<p>Anca is going to prove the long exact sequence of terms of low degree coming from the spectral sequence of group cohomology.</p>

<a name="168749677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749677" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749677">Kevin Buzzard (Jun 22 2019 at 12:33)</a>:</h4>
<p>We're nearly there.</p>

<a name="168749728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749728">Reid Barton (Jun 22 2019 at 12:35)</a>:</h4>
<p>People always call it the cocycle condition when gluing sheaves and things like that, but it actually becomes one if you imagine gluing vector bundles, say, on a topological space, each of which is trivial so we can call it <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^n</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68889em;"></span><span class="strut bottom" style="height:0.68889em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span></span></span></span>, and then the transition functions <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord mathit">ϕ</span></span></span></span> can be seen as taking values in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mi>L</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">GL(n)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit">G</span><span class="mord mathit">L</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>

<a name="168749765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749765" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749765">Kevin Buzzard (Jun 22 2019 at 12:36)</a>:</h4>
<p>So there's your homework <span class="user-mention" data-user-id="110064">@Kenny Lau</span></p>

<a name="168749771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749771" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749771">Reid Barton (Jun 22 2019 at 12:36)</a>:</h4>
<p>It's not group cohomology though, it's some kind of nonabelian Cech cohomology (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>H</mi><mn>1</mn></msup></mrow><annotation encoding="application/x-tex">H^1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">1</span></span></span></span></span></span></span></span></span></span></span>)</p>

<a name="168749772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749772">Reid Barton (Jun 22 2019 at 12:37)</a>:</h4>
<p>Unless your space happens to be the classifying space of a group in which case it might also be group cohomology</p>

<a name="168749823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749823">Kevin Buzzard (Jun 22 2019 at 12:38)</a>:</h4>
<p>Working with group cohomology H^1 as 1-cocycles over 1-coboundaries has been really interesting. I had not realised that the boundary map from H^0 to H^1 was non-computable until recently.</p>

<a name="168749837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168749837" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168749837">Kevin Buzzard (Jun 22 2019 at 12:38)</a>:</h4>
<p>I'm sure there's some crazy spectral sequence way to do all this, but having the really explicit cocycle stuff was still an interesting exercise, and quite a concrete way of doing it.</p>

<a name="168759646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168759646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168759646">Kevin Buzzard (Jun 22 2019 at 17:59)</a>:</h4>
<p>For the purposes of this exercise, can I make subset inclusion a typeclass and make all the lemmas I'm using again and again equal to instances?</p>

<a name="168760813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168760813" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168760813">Johan Commelin (Jun 22 2019 at 18:41)</a>:</h4>
<p>You can certainly do that locally, I guess.</p>

<a name="168761026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168761026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168761026">Reid Barton (Jun 22 2019 at 18:47)</a>:</h4>
<p>But can you glue the local instances into global instances?</p>

<a name="168761721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168761721" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168761721">Johan Commelin (Jun 22 2019 at 19:08)</a>:</h4>
<p>They need to satisfy a cocycle condition, I guess (-;</p>

<a name="168763611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168763611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168763611">Kevin Buzzard (Jun 22 2019 at 20:09)</a>:</h4>
<p>Fortunately I think that cocycle condition is vacuous for some reason, possibly proof irrelevance</p>

<a name="168763668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168763668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168763668">Kevin Buzzard (Jun 22 2019 at 20:10)</a>:</h4>
<p>It's somehow the statement that the direct proof that W is a subset of U is the same as the proof that says that W is a subset of V which is a subset of U</p>

<a name="168765089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765089" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765089">Kevin Buzzard (Jun 22 2019 at 20:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> </p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">presheaf</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">F</span>     <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span>
<span class="o">(</span><span class="n">res</span>   <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">U</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">),</span> <span class="n">F</span> <span class="n">U</span> <span class="bp">→</span> <span class="n">F</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">Hid</span>   <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">U</span><span class="o">),</span> <span class="n">res</span> <span class="n">U</span> <span class="n">U</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">U</span><span class="o">)</span> <span class="bp">=</span> <span class="n">id</span><span class="o">)</span>
<span class="o">(</span><span class="n">Hcomp</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">U</span> <span class="n">V</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">),</span>
  <span class="n">res</span> <span class="n">U</span> <span class="n">W</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">HWV</span> <span class="n">HVU</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="err">∘</span> <span class="n">res</span> <span class="n">U</span> <span class="n">V</span> <span class="n">HVU</span><span class="o">)</span>
</pre></div>


<p>So you really do not care that there is a <code>Type v</code> mentioned in a structure field, where <code>v</code> is a universe not mentioned before the colon?</p>

<a name="168765146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765146" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765146">Kevin Buzzard (Jun 22 2019 at 21:01)</a>:</h4>
<p>I thought you one told Patrick that he would get into trouble with this, and there would be annoying universe issues everywhere. Am I just being too paranoid here? I still don't understand this issue. I have been led to suspect that your definition is asking for trouble later down the line.</p>

<a name="168765190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765190" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765190">Kevin Buzzard (Jun 22 2019 at 21:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> what do you think of all these universes? Is Mario's way the correct way to do it or just a waste of time?</p>

<a name="168765194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765194">Kevin Buzzard (Jun 22 2019 at 21:02)</a>:</h4>
<p>I am unclear about this foundational issue.</p>

<a name="168765204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765204">Kenny Lau (Jun 22 2019 at 21:03)</a>:</h4>
<p>this one is fine; the one that bugs me is when you want to quantify over all sets in ZFC, but there isn't an equivalent in type theory, i.e. you can only quantify over all types in Type w</p>

<a name="168765258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765258">Kevin Buzzard (Jun 22 2019 at 21:05)</a>:</h4>
<p>I guess I might have defined something like a glueing of a presheaf of types using Kenny's API. I will try and write this up in a coherent manner right now.</p>

<a name="168765375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168765375" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168765375">Kevin Buzzard (Jun 22 2019 at 21:09)</a>:</h4>
<p><a href="https://github.com/kbuzzard/xena/blob/master/Examples/sheaf_on_opens_total_glueing.lean" target="_blank" title="https://github.com/kbuzzard/xena/blob/master/Examples/sheaf_on_opens_total_glueing.lean">Me trying to glue presheaves</a></p>

<a name="168766047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168766047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168766047">Kevin Buzzard (Jun 22 2019 at 21:32)</a>:</h4>
<p>I'm trying to remove all dependency on the schemes project and just make this a little "glueing sheaves" project of its own without all the Spec A stuff. Kenny I'm porting what you wrote to Mario's foundations. It's quite interesting.</p>

<a name="168766596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168766596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168766596">Kevin Buzzard (Jun 22 2019 at 21:51)</a>:</h4>
<p>I can use regexps to help with the porting. It's pretty cool. VS Code good for this sort of thing.</p>

<a name="168766840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168766840" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168766840">Kevin Buzzard (Jun 22 2019 at 21:59)</a>:</h4>
<p>I find emacs Lean easier to use than VS Code Lean for this stuff. I just know how to do stuff like "search and replace from this point on" in emacs. This is the first time I've used Lean in emacs for ages.</p>

<a name="168767068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767068" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767068">Kevin Buzzard (Jun 22 2019 at 22:06)</a>:</h4>
<p>This file only depends on mathlib.</p>
<p><a href="https://github.com/kbuzzard/xena/blob/e524026fa8db94b228b99fe8d500a530de1bf14e/Examples/sheaf_on_opens_total_glueing.lean#L138" target="_blank" title="https://github.com/kbuzzard/xena/blob/e524026fa8db94b228b99fe8d500a530de1bf14e/Examples/sheaf_on_opens_total_glueing.lean#L138">https://github.com/kbuzzard/xena/blob/e524026fa8db94b228b99fe8d500a530de1bf14e/Examples/sheaf_on_opens_total_glueing.lean#L138</a></p>
<p>I have my first universe issue <span class="user-mention" data-user-id="110064">@Kenny Lau</span></p>

<a name="168767087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767087">Kevin Buzzard (Jun 22 2019 at 22:07)</a>:</h4>
<p>I really don't care about universes. Can someone just tell me the regex to fix all universe issues?</p>

<a name="168767091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767091" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767091">Kenny Lau (Jun 22 2019 at 22:08)</a>:</h4>
<p>change <code>universes u v</code> to <code>universes v u</code> on L10</p>

<a name="168767128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767128" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767128">Kevin Buzzard (Jun 22 2019 at 22:08)</a>:</h4>
<p>Many thanks Kenny.</p>

<a name="168767381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767381">Kevin Buzzard (Jun 22 2019 at 22:17)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">opens</span><span class="bp">.</span><span class="n">Union</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span><span class="n">α</span><span class="o">)</span> <span class="o">:</span><span class="n">α</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">set</span><span class="bp">.</span><span class="n">Union</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">),</span> <span class="n">is_open_Union</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span><span class="bp">⟩</span>
</pre></div>


<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> how do I translate that into this semilattice language?</p>

<a name="168767424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767424">Kenny Lau (Jun 22 2019 at 22:18)</a>:</h4>
<p>I mean it doesn't compile right</p>

<a name="168767432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767432">Kevin Buzzard (Jun 22 2019 at 22:18)</a>:</h4>
<p>That's right. I need to take infinite unions at this point.</p>

<a name="168767442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767442" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767442">Kevin Buzzard (Jun 22 2019 at 22:19)</a>:</h4>
<p>But I only have <code>[semilattice_inf]</code></p>

<a name="168767560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767560">Kevin Buzzard (Jun 22 2019 at 22:22)</a>:</h4>
<p>I need more than this to make sense of glueing presheaves. I definitely want my parameter to be <code>{I : Type*} (s : I → α)</code> and I want to take some kind of sup, which has all the properties of sup which I'll need later.</p>

<a name="168767588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767588" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767588">Kevin Buzzard (Jun 22 2019 at 22:23)</a>:</h4>
<p>which is this:</p>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">subset_Union</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">s</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">Union</span> <span class="n">s</span> <span class="o">:=</span> <span class="o">(</span><span class="n">some</span> <span class="n">constructor</span> <span class="n">or</span> <span class="n">other</span><span class="o">)</span>
</pre></div>

<a name="168767635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767635">Kevin Buzzard (Jun 22 2019 at 22:24)</a>:</h4>
<p>What mathematical object is that called in Lean?</p>

<a name="168767659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767659" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767659">Kevin Buzzard (Jun 22 2019 at 22:25)</a>:</h4>
<p>I need <code>Union</code> and <code>subset_Union</code>. I'm assuming someone has already discovered this object. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110032">@Reid Barton</span> any ideas? <span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> if you're out there?</p>

<a name="168767703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767703" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767703">Kevin Buzzard (Jun 22 2019 at 22:26)</a>:</h4>
<p>How close is this to a topological space?</p>

<a name="168767717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767717">Kevin Buzzard (Jun 22 2019 at 22:27)</a>:</h4>
<p>Is it some sort of bundled topological space?</p>

<a name="168767768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767768" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767768">Kevin Buzzard (Jun 22 2019 at 22:28)</a>:</h4>
<p>Oh, is it precisely <code>opens X</code> or something?</p>

<a name="168767773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168767773" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168767773">Kevin Buzzard (Jun 22 2019 at 22:29)</a>:</h4>
<p>I could even try and prove this!</p>

<a name="168768695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168768695" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168768695">Reid Barton (Jun 22 2019 at 23:00)</a>:</h4>
<p>Not at a computer but is it just about being able to form sups of arbitrary families?</p>

<a name="168768706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168768706" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168768706">Reid Barton (Jun 22 2019 at 23:01)</a>:</h4>
<p>Sounds like you just have a complete lattice</p>

<a name="168768752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168768752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168768752">Kevin Buzzard (Jun 22 2019 at 23:02)</a>:</h4>
<p>Yes I think that's it. Many thanks Reid. I should be able to literally check this in Lean in quite a formulaic way.</p>

<a name="168769224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769224" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769224">Kevin Buzzard (Jun 22 2019 at 23:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> is there this:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">Union</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="mi">37</span><span class="o">},</span> <span class="o">(</span><span class="n">I</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">α</span>
</pre></div>


<p>?</p>

<a name="168769308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769308">Reid Barton (Jun 22 2019 at 23:20)</a>:</h4>
<p>I don't know offhand whether it already exists, but you can define it as the sup of the <code>range</code> of the <code>(I → α)</code></p>

<a name="168769322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769322">Kevin Buzzard (Jun 22 2019 at 23:21)</a>:</h4>
<p>For glueing presheaves I really do not want to restrict myself to glueing on a set of subsets. I believe want to allow these more general unions. This is not a universe issue (at least as far as I'm concerned -- a topological space has a set of subsets). Before I press on, can I check that I have named this function correctly? <span class="user-mention" data-user-id="110064">@Kenny Lau</span> ?</p>

<a name="168769363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769363">Kenny Lau (Jun 22 2019 at 23:22)</a>:</h4>
<p>I'm not very sure what you want to do. Isn't this just supr?</p>

<a name="168769364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769364" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769364">Kevin Buzzard (Jun 22 2019 at 23:22)</a>:</h4>
<p>This is a situation where I would just let I and alpha be in the same universe.</p>

<a name="168769365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769365">Kevin Buzzard (Jun 22 2019 at 23:22)</a>:</h4>
<p>I don't know anything about lattices.</p>

<a name="168769370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769370" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769370">Kevin Buzzard (Jun 22 2019 at 23:22)</a>:</h4>
<p>The API is huge and I've never looked at it.</p>

<a name="168769380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769380" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769380">Kevin Buzzard (Jun 22 2019 at 23:23)</a>:</h4>
<p>Lattices are just weird computer science things that people like <span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> enjoy. They're not proper maths ;-)</p>

<a name="168769385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769385" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769385">Kevin Buzzard (Jun 22 2019 at 23:24)</a>:</h4>
<p>That's why I'm happy to call my types <code>\alpha</code> in this development. I don't think a complete lattice deserves a name in maths mode -- a "maths name".</p>

<a name="168769441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769441" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769441">Kevin Buzzard (Jun 22 2019 at 23:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> </p>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">supr</span> <span class="c1">-- unknown</span>
</pre></div>

<a name="168769446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769446" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769446">Kenny Lau (Jun 22 2019 at 23:25)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">supr</span>
</pre></div>

<a name="168769488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769488" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769488">Kevin Buzzard (Jun 22 2019 at 23:26)</a>:</h4>
<p>Is <code>complete_lattice.supr</code> a hole in mathlib? <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> ?</p>

<a name="168769547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168769547" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168769547">Kevin Buzzard (Jun 22 2019 at 23:28)</a>:</h4>
<p>Just thinking abstractly about the concept of what setting we need in order to do glueing of sheaves, has led me to a type which has grown organically. It would be interesting if it was precisely <code>complete_lattice</code> or maybe it will be some other known type. It gives some sort of insight into the correct way to think about glueing sheaves. We throw in axioms as we need them and see what we end up growing.</p>

<a name="168770164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770164" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770164">Kevin Buzzard (Jun 22 2019 at 23:50)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="bp">@</span><span class="n">lattice</span><span class="bp">.</span><span class="n">supr</span>
<span class="n">supr</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u_2</span><span class="o">}</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">has_Sup</span> <span class="n">α</span><span class="o">],</span> <span class="o">(</span><span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">α</span>
</pre></div>


<p>Is that order preferred to</p>
<div class="codehilite"><pre><span></span>supr : Π {α : Type u_1} [_inst_1 : has_Sup α] {ι : Sort u_2}, (ι → α) → α
</pre></div>


<p>? Is there some convention?</p>

<a name="168770165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770165" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770165">Kevin Buzzard (Jun 22 2019 at 23:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span></p>

<a name="168770367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770367" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770367">Kevin Buzzard (Jun 22 2019 at 23:59)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">supr</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">X</span> <span class="o">:</span> <span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span>
  <span class="bp">@</span><span class="n">lattice</span><span class="bp">.</span><span class="n">supr</span> <span class="n">α</span> <span class="n">I</span> <span class="bp">_</span> <span class="c1">-- Grumpy old mathematician observes that stupid polymorphism</span>
                      <span class="c1">-- makes me have to fill in more stuff</span>

<span class="kn">theorem</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">subset_Union</span> <span class="o">[</span><span class="n">X</span> <span class="o">:</span> <span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span>
  <span class="bp">∀</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">s</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">supr</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">sorry</span>
</pre></div>


<p>There's a conjecture for you complete_latticeists.</p>

<a name="168770369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770369" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770369">Kevin Buzzard (Jun 22 2019 at 23:59)</a>:</h4>
<p>I need to learn your language.</p>

<a name="168770429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770429" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770429">Kevin Buzzard (Jun 23 2019 at 00:00)</a>:</h4>
<p>Oh I guess I know exactly where to look in the mathlib API.</p>

<a name="168770501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770501">Kevin Buzzard (Jun 23 2019 at 00:03)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">le_supr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="err">?</span><span class="n">M_2</span> <span class="bp">→</span> <span class="err">?</span><span class="n">M_1</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="err">?</span><span class="n">M_2</span><span class="o">),</span> <span class="n">s</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">supr</span> <span class="n">s</span>
</pre></div>


<p>Porting this code is really interesting. I'm trying to see if I can do it in a completely algorithmic way. I think I'm nearly there.</p>

<a name="168770760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770760" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770760">Reid Barton (Jun 23 2019 at 00:13)</a>:</h4>
<p>I think the order of implicit and type class arguments is usually arbitrary and depends on how it was convenient to organize the <code>variable</code> declarations</p>

<a name="168770808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168770808" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168770808">Kevin Buzzard (Jun 23 2019 at 00:14)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">le_supr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">),</span>
  <span class="n">s</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">supr</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">failed to synthesize type class instance for</span>
<span class="cm">α : Type u,</span>
<span class="cm">ι : Sort v,</span>
<span class="cm">_inst_1 : complete_lattice α,</span>
<span class="cm">s : ι → α,</span>
<span class="cm">i : ι</span>
<span class="cm">⊢ has_le α</span>
<span class="cm">sheaf_on_opens_total_glueing.lean:15:8: error</span>
<span class="cm">failed to synthesize type class instance for</span>
<span class="cm">α : Type u,</span>
<span class="cm">ι : Sort v,</span>
<span class="cm">_inst_1 : complete_lattice α,</span>
<span class="cm">s : ι → α,</span>
<span class="cm">i : ι</span>
<span class="cm">⊢ has_Sup α</span>
<span class="cm">-/</span>
</pre></div>


<p>What have I done to deserve this??</p>

<a name="168771022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771022" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771022">Kevin Buzzard (Jun 23 2019 at 00:21)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">order</span><span class="bp">.</span><span class="n">complete_lattice</span>

<span class="c1">-- #check lattice.le -- unknown identifier</span>
<span class="bp">#</span><span class="kn">check</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">lattice</span><span class="bp">.</span><span class="n">le</span> <span class="c1">-- but this works??</span>
</pre></div>


<p>Is that a poorly-named function in mathlib?</p>

<a name="168771223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771223" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771223">Kevin Buzzard (Jun 23 2019 at 00:28)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_le</span> <span class="n">α</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">failed to synthesize instance name, name should be provided explicitly</span>
<span class="cm">-/</span>
</pre></div>


<p>What should this be instance be called?</p>

<a name="168771226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771226" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771226">Kevin Buzzard (Jun 23 2019 at 00:28)</a>:</h4>
<p>Why is this happening?</p>

<a name="168771614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771614">Kevin Buzzard (Jun 23 2019 at 00:43)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">order</span><span class="bp">.</span><span class="n">complete_lattice</span>

<span class="c1">-- #check lattice.le -- unknown identifier</span>
<span class="bp">#</span><span class="kn">check</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">lattice</span><span class="bp">.</span><span class="n">le</span> <span class="c1">-- should this work?</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="n">def</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">le</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">lattice</span><span class="bp">.</span><span class="n">lattice</span><span class="bp">.</span><span class="n">le</span>

<span class="kn">instance</span> <span class="n">I_DONT_KNOW_WHY_I_NEED_TO_NAME_THIS_INSTANCE</span>
  <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_le</span> <span class="n">α</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>

<span class="n">def</span> <span class="n">WHAT_IS_GOING_ON</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_Sup</span> <span class="n">α</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>

<span class="n">def</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">le_supr</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">ι</span><span class="o">),</span>
  <span class="bp">@</span><span class="n">has_le</span><span class="bp">.</span><span class="n">le</span> <span class="n">α</span> <span class="o">(</span><span class="k">by</span> <span class="n">resetI</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">I_DONT_KNOW_WHY_I_NEED_TO_NAME_THIS_INSTANCE</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">supr</span> <span class="n">α</span> <span class="n">ι</span> <span class="o">(</span><span class="bp">@</span><span class="n">WHAT_IS_GOING_ON</span> <span class="n">α</span> <span class="o">(</span><span class="k">by</span> <span class="n">resetI</span><span class="bp">;</span> <span class="n">apply_instance</span><span class="o">)))</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="bp">#</span><span class="kn">exit</span>
</pre></div>


<p>This is not going well. What am I doing wrong?</p>

<a name="168771739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771739" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771739">Reid Barton (Jun 23 2019 at 00:47)</a>:</h4>
<p>You put the <code>[complete_lattice \a]</code> to the right of the colon</p>

<a name="168771785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771785" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771785">Kevin Buzzard (Jun 23 2019 at 00:48)</a>:</h4>
<p>bleurgh thanks. I am sort-of generating the code algorithmically, you're just finding bugs in my algorithm.</p>

<a name="168771912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168771912" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168771912">Kevin Buzzard (Jun 23 2019 at 00:53)</a>:</h4>
<p>I am writing some completely mechanical code, made possible because of excellent naming conventions <span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>

<a name="168772005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772005" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772005">Kevin Buzzard (Jun 23 2019 at 00:56)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">complete_lattice</span><span class="bp">.</span><span class="n">subset_Union</span> <span class="o">[</span><span class="n">X</span> <span class="o">:</span> <span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">)</span> <span class="o">:</span> <span class="n">s</span> <span class="n">i</span> <span class="bp">≤</span> <span class="n">supr</span> <span class="n">s</span> <span class="o">:=</span>
<span class="n">complete_lattice</span><span class="bp">.</span><span class="n">le_supr</span> <span class="n">s</span> <span class="n">i</span>
</pre></div>


<p>There's some sort of dictionary going between subset land and lattice land. <code>subset_Union</code> becomes <code>le_supr</code>.</p>

<a name="168772012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772012">Kevin Buzzard (Jun 23 2019 at 00:57)</a>:</h4>
<p>When I manipulate terms of type <code>opens X</code>, is the canonical way to manipulate them using the language of complete lattices?</p>

<a name="168772013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772013" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772013">Kevin Buzzard (Jun 23 2019 at 00:57)</a>:</h4>
<p>Is that the language that the <code>simp</code> lemmas will be in?</p>

<a name="168772241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772241" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772241">Kevin Buzzard (Jun 23 2019 at 01:06)</a>:</h4>
<p>Oh my goodness I just found <code>lattice.complete_lattice.le</code>. What's it doing down there? Complete lattices are actually called <code>lattice.complete_lattice</code></p>

<a name="168772280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772280" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772280">Kevin Buzzard (Jun 23 2019 at 01:06)</a>:</h4>
<p>Is that how it works? Who decided that lattice was a top level thing but complete_lattice wasn't?</p>

<a name="168772398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772398">Mario Carneiro (Jun 23 2019 at 01:11)</a>:</h4>
<p>this is a naming bug which we haven't done anything about yet</p>

<a name="168772435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772435" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772435">Mario Carneiro (Jun 23 2019 at 01:12)</a>:</h4>
<p>the <code>lattice.lattice</code> thing is obviously not good</p>

<a name="168772440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772440" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772440">Mario Carneiro (Jun 23 2019 at 01:12)</a>:</h4>
<p>I think far too much stuff ended up in the lattice namespace, including <code>lattice</code> itself</p>

<a name="168772447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772447">Kevin Buzzard (Jun 23 2019 at 01:12)</a>:</h4>
<p>Is the naming bug because <code>lattice.complete_lattice</code> is a class which is doesn't have a top level name?</p>

<a name="168772509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772509" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772509">Kevin Buzzard (Jun 23 2019 at 01:15)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span><span class="bp">.</span><span class="n">has_le</span>
  <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_le</span> <span class="n">α</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>


<p>or</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span><span class="bp">.</span><span class="n">has_le</span>
  <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_le</span> <span class="n">α</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>


<p>? Why? And should it be an explicit instance or should it just remain undefined?</p>

<a name="168772511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772511" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772511">Kevin Buzzard (Jun 23 2019 at 01:15)</a>:</h4>
<p>I feel like if I ever had to mention this name then something had gone wrong, because there's only one le on a complete lattice.</p>

<a name="168772611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772611">Mario Carneiro (Jun 23 2019 at 01:19)</a>:</h4>
<p>What are you doing?</p>

<a name="168772615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772615" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772615">Mario Carneiro (Jun 23 2019 at 01:19)</a>:</h4>
<p>you shouldn't need to write anything remotely close to either of those</p>

<a name="168772616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772616" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772616">Mario Carneiro (Jun 23 2019 at 01:19)</a>:</h4>
<p>you should write <code>&lt;=</code> and be done with it</p>

<a name="168772623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772623" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772623">Kevin Buzzard (Jun 23 2019 at 01:19)</a>:</h4>
<p>I'm just learning about complete lattices. I've never heard of them. I'm learning the language of complete lattices.</p>

<a name="168772665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772665" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772665">Mario Carneiro (Jun 23 2019 at 01:20)</a>:</h4>
<p><code>lattice</code> is a top level namespace like <code>category_theory</code></p>

<a name="168772667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772667">Mario Carneiro (Jun 23 2019 at 01:20)</a>:</h4>
<p>it encloses most of the lattice-related constants</p>

<a name="168772670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772670" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772670">Mario Carneiro (Jun 23 2019 at 01:20)</a>:</h4>
<p>but like I said, I think it should be removed</p>

<a name="168772672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772672">Mario Carneiro (Jun 23 2019 at 01:20)</a>:</h4>
<p>Most of the time people <code>open lattice</code> for this reason</p>

<a name="168772682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772682" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772682">Mario Carneiro (Jun 23 2019 at 01:21)</a>:</h4>
<p>I'm amused you think complete lattices are a CS thing</p>

<a name="168772736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772736" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772736">Kevin Buzzard (Jun 23 2019 at 01:23)</a>:</h4>
<p>They're being called alpha in the repo. That is an insult as far as I am concerned</p>

<a name="168772739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772739" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772739">Kevin Buzzard (Jun 23 2019 at 01:23)</a>:</h4>
<p>They don't deserve a maths name</p>

<a name="168772740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772740" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772740">Mario Carneiro (Jun 23 2019 at 01:23)</a>:</h4>
<p>Huh? that's pretty standard in mathlib</p>

<a name="168772781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772781" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772781">Kevin Buzzard (Jun 23 2019 at 01:24)</a>:</h4>
<p>I know but I tell my undergraduates to use maths notation for mathsy stuff</p>

<a name="168772794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772794" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772794">Mario Carneiro (Jun 23 2019 at 01:25)</a>:</h4>
<p>what notation are you going to give <code>complete_lattice</code>? That's plain text in maths</p>

<a name="168772803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772803">Kevin Buzzard (Jun 23 2019 at 01:25)</a>:</h4>
<p>That group cohomology repo is all done with $$G$$s and $$M$$s just like in the maths books. No alphas at all</p>

<a name="168772845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772845" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772845">Kevin Buzzard (Jun 23 2019 at 01:26)</a>:</h4>
<p>I will never have to mention complete lattices in maths texts. They are beneath mathematicians. They are just some tool that people like Johannes like</p>

<a name="168772846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772846">Mario Carneiro (Jun 23 2019 at 01:26)</a>:</h4>
<p>I'm sure if you had written complete lattices it would use L as well</p>

<a name="168772847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772847">Kevin Buzzard (Jun 23 2019 at 01:26)</a>:</h4>
<p>That's an interesting suggestion</p>

<a name="168772855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772855" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772855">Kevin Buzzard (Jun 23 2019 at 01:27)</a>:</h4>
<p>I tend to use the notation that mathematicians use you see</p>

<a name="168772856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772856" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772856">Mario Carneiro (Jun 23 2019 at 01:27)</a>:</h4>
<p>I would say that mathlib had a convention for this, and you and others didn't like it, and now we have inconsistency re: variable names</p>

<a name="168772857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772857">Mario Carneiro (Jun 23 2019 at 01:27)</a>:</h4>
<p>and I don't care enough to do anything about it</p>

<a name="168772859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772859">Kevin Buzzard (Jun 23 2019 at 01:27)</a>:</h4>
<p>But I've never seen a mathematician talking about compete lattices in the number theory seminar</p>

<a name="168772901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772901" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772901">Kevin Buzzard (Jun 23 2019 at 01:28)</a>:</h4>
<p>The maths stuff gets maths names and the weird stuff can have computer science names.</p>

<a name="168772903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772903" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772903">Kevin Buzzard (Jun 23 2019 at 01:28)</a>:</h4>
<p>Maybe the maths conventions should just have one universe too</p>

<a name="168772910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772910" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772910">Kevin Buzzard (Jun 23 2019 at 01:29)</a>:</h4>
<p>:-)</p>

<a name="168772912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772912" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772912">Mario Carneiro (Jun 23 2019 at 01:29)</a>:</h4>
<p>I don't know why we are on this again, but the only difference is lattices were written before the rebellion</p>

<a name="168772965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772965" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772965">Mario Carneiro (Jun 23 2019 at 01:30)</a>:</h4>
<p>I can't be bothered to tell the difference between types, so I call types of things alpha and index types iota and that's about it</p>

<a name="168772973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772973">Mario Carneiro (Jun 23 2019 at 01:31)</a>:</h4>
<p>I have no idea what letter is preferred for these things, I'm not a group theorist</p>

<a name="168772975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168772975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168772975">Mario Carneiro (Jun 23 2019 at 01:31)</a>:</h4>
<p>I just want library-wide consistency</p>

<a name="168773023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773023" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773023">Mario Carneiro (Jun 23 2019 at 01:33)</a>:</h4>
<p>But since variable names don't affect the applicability of a theorem, I don't really care what names are chosen, so if you want to call it G in your own files then go ahead</p>

<a name="168773231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773231" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773231">Kevin Buzzard (Jun 23 2019 at 01:41)</a>:</h4>
<p>I can't appeal to alpha-equivalence? ;-)</p>

<a name="168773271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773271" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773271">Kevin Buzzard (Jun 23 2019 at 01:42)</a>:</h4>
<p>Anyway, that's got nothing to do with what I'm doing, what I'm doing is wondering whether the natural domain for glueing sheaves of types is complete lattices.</p>

<a name="168773283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773283" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773283">Mario Carneiro (Jun 23 2019 at 01:43)</a>:</h4>
<p>based solely on your statements, yes</p>

<a name="168773326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773326" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773326">Mario Carneiro (Jun 23 2019 at 01:44)</a>:</h4>
<p>I used a <code>semilattice_inf</code> for the definitions I showed because I didn't actually need a union operator, only a axiom that quantifies over lubs</p>

<a name="168773334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773334" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773334">Mario Carneiro (Jun 23 2019 at 01:45)</a>:</h4>
<p>but if you want to actually take some arbitrary subset and "take its union" then you need a <code>complete_lattice</code></p>

<a name="168773381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773381">Kevin Buzzard (Jun 23 2019 at 01:46)</a>:</h4>
<p>I might be able to get away with just the predicate "the sup of this set is the max"</p>

<a name="168773383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773383">Mario Carneiro (Jun 23 2019 at 01:46)</a>:</h4>
<p>I did something like that in the sheaf axioms</p>

<a name="168773389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773389" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773389">Kevin Buzzard (Jun 23 2019 at 01:47)</a>:</h4>
<p>but I sort-of feel that Assia would be frowning.</p>

<a name="168773390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773390" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773390">Mario Carneiro (Jun 23 2019 at 01:47)</a>:</h4>
<p>The question is whether this compromises the meaning of the statement in the case that no lub exists</p>

<a name="168773392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773392" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773392">Kevin Buzzard (Jun 23 2019 at 01:47)</a>:</h4>
<p>i think that in the odd order project the idea was to just ignore the big ambient group</p>

<a name="168773432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773432">Kevin Buzzard (Jun 23 2019 at 01:48)</a>:</h4>
<p>Let's call it 37 in that case.</p>

<a name="168773433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773433">Mario Carneiro (Jun 23 2019 at 01:48)</a>:</h4>
<p>that will definitely compromise the meaning of the statement</p>

<a name="168773434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773434">Kevin Buzzard (Jun 23 2019 at 01:48)</a>:</h4>
<p>only in your mind</p>

<a name="168773439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773439" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773439">Kevin Buzzard (Jun 23 2019 at 01:49)</a>:</h4>
<p>We know what we're doing in the maths department</p>

<a name="168773443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773443" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773443">Mario Carneiro (Jun 23 2019 at 01:49)</a>:</h4>
<p>I'm not talking about totalizing a function, I'm talking about statements that require a lub</p>

<a name="168773444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773444" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773444">Mario Carneiro (Jun 23 2019 at 01:49)</a>:</h4>
<p>like <code>gluing</code></p>

<a name="168773448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773448">Kevin Buzzard (Jun 23 2019 at 01:49)</a>:</h4>
<p>OK just make it to option.</p>

<a name="168773450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773450">Mario Carneiro (Jun 23 2019 at 01:49)</a>:</h4>
<p>sure, but again I'm not talking about totalization</p>

<a name="168773494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773494">Mario Carneiro (Jun 23 2019 at 01:50)</a>:</h4>
<p>what does the theorem <em>say</em> if you apply it to a set with no lub?</p>

<a name="168773497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773497">Kevin Buzzard (Jun 23 2019 at 01:50)</a>:</h4>
<p>I do not care because I will always supply a proof that the lub exists in practice.</p>

<a name="168773500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773500" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773500">Mario Carneiro (Jun 23 2019 at 01:50)</a>:</h4>
<p>what if there is no lub?</p>

<a name="168773501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773501">Kevin Buzzard (Jun 23 2019 at 01:50)</a>:</h4>
<p>I promise there is a lub</p>

<a name="168773502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773502">Mario Carneiro (Jun 23 2019 at 01:51)</a>:</h4>
<p>if it's a semilattice_inf there may not be a lub</p>

<a name="168773512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773512" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773512">Kevin Buzzard (Jun 23 2019 at 01:51)</a>:</h4>
<p>well there are lubs in the only model I'm interested in, which is <code>opens</code></p>

<a name="168773515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773515" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773515">Mario Carneiro (Jun 23 2019 at 01:51)</a>:</h4>
<p>the question of whether to "upgrade" to <code>complete_lattice</code> lies in whether the statements break down in the absence of lubs</p>

<a name="168773556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773556" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773556">Kevin Buzzard (Jun 23 2019 at 01:52)</a>:</h4>
<p>And I say that that's your problem</p>

<a name="168773557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773557" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773557">Kevin Buzzard (Jun 23 2019 at 01:52)</a>:</h4>
<p>because I promise I will never run that code in the absence of an upper bound</p>

<a name="168773564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773564" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773564">Kevin Buzzard (Jun 23 2019 at 01:53)</a>:</h4>
<p>like I promise I will never take the square root of a negative number, even though you let me.</p>

<a name="168773598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773598" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773598">Mario Carneiro (Jun 23 2019 at 01:54)</a>:</h4>
<p>this is more the opposite problem - you don't have the language to say something that you want to say</p>

<a name="168773659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773659" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773659">Mario Carneiro (Jun 23 2019 at 01:56)</a>:</h4>
<p>I'm not sure why you are so against contemplating such a simple generalization of sheaves when apparently you have much more complicated generalizations in mind</p>

<a name="168773672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168773672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168773672">Mario Carneiro (Jun 23 2019 at 01:57)</a>:</h4>
<p>I can't answer this question because I don't know what sheaves are beyond the definitions I've seen</p>

<a name="168774715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168774715" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168774715">Kevin Buzzard (Jun 23 2019 at 02:34)</a>:</h4>
<p>You just have to wait for me to catch up Mario :-) I'll get there in the end. I don't know how to steer complete lattices, and I am running into Lean issues which I don't understand. For example</p>
<div class="codehilite"><pre><span></span>type mismatch at field &#39;le_sup_left&#39;
  sorry
has type
  ∀ (a b : α), semilattice_inf.le a (?m_1 a b)
but is expected to have type
  ∀ (a b : α), a ≤ a ⊔ b
</pre></div>


<p>I hate it when <code>sorry</code> is underlined in red.</p>

<a name="168775031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775031">Mario Carneiro (Jun 23 2019 at 02:46)</a>:</h4>
<p>One thing I'm not a big fan of in the lattice theorems is the large number of implicit parameters</p>

<a name="168775032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775032" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775032">Mario Carneiro (Jun 23 2019 at 02:46)</a>:</h4>
<p>it can cause some unification problems</p>

<a name="168775043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775043">Mario Carneiro (Jun 23 2019 at 02:47)</a>:</h4>
<p>but I can't diagnose that problem based on the error alone. What's the context?</p>

<a name="168775046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775046" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775046">Kevin Buzzard (Jun 23 2019 at 02:47)</a>:</h4>
<p>I really have no clue about whether to use <code>{}</code> or <code>()</code>. I used to think it was "use <code>{}</code> if and only if you can work it out from all the <code>()</code> stuff, but that's not always the rule. Probably you Mario know some examples of this.</p>

<a name="168775086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775086" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775086">Mario Carneiro (Jun 23 2019 at 02:48)</a>:</h4>
<p>that is the rule, and the lattice theorems don't follow it</p>

<a name="168775097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775097">Kevin Buzzard (Jun 23 2019 at 02:49)</a>:</h4>
<p><a href="https://github.com/kbuzzard/xena/blob/1284a71aa327040494f13babb336c73d41680787/Examples/sheaf_on_opens_total_glueing.lean#L274" target="_blank" title="https://github.com/kbuzzard/xena/blob/1284a71aa327040494f13babb336c73d41680787/Examples/sheaf_on_opens_total_glueing.lean#L274">https://github.com/kbuzzard/xena/blob/1284a71aa327040494f13babb336c73d41680787/Examples/sheaf_on_opens_total_glueing.lean#L274</a></p>

<a name="168775144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775144" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775144">Kevin Buzzard (Jun 23 2019 at 02:50)</a>:</h4>
<blockquote>
<p>that is the rule, and the lattice theorems don't follow it</p>
</blockquote>
<p>Is this a bug? What is the name for this issue? They don't follow it for a good reason, right?</p>

<a name="168775152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775152" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775152">Kevin Buzzard (Jun 23 2019 at 02:50)</a>:</h4>
<p>Should one just force the unconventional functions to have a <code>'</code> in their name, like the <code>quotient'</code> stuff?</p>

<a name="168775204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775204">Mario Carneiro (Jun 23 2019 at 02:52)</a>:</h4>
<p>what the heck is going on in your file? What is <code>thing</code>?</p>

<a name="168775205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775205">Jesse Michael Han (Jun 23 2019 at 02:52)</a>:</h4>
<blockquote>
<p>You just have to wait for me to catch up Mario :-) I'll get there in the end. I don't know how to steer complete lattices, and I am running into Lean issues which I don't understand. For example</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">field</span> <span class="err">&#39;</span><span class="n">le_sup_left&#39;</span>
  <span class="n">sorry</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le</span> <span class="n">a</span> <span class="o">(</span><span class="err">?</span><span class="n">m_1</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span> <span class="err">⊔</span> <span class="n">b</span>
</pre></div>


<p>I hate it when <code>sorry</code> is underlined in red.</p>
</blockquote>
<p>For some reason, Lean believes the sorry is an inequality taking place in <code>semilattice_inf</code> land, which doesn't have a <code>sup</code> instance</p>
<p>maybe because earlier you filled in some holes with things in <code>semilattice_inf</code> land</p>

<a name="168775216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775216" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775216">Mario Carneiro (Jun 23 2019 at 02:53)</a>:</h4>
<p>This issue comes up sometimes when you have a large hierarchical class where you fill everything in with underscores</p>

<a name="168775220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775220" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775220">Mario Carneiro (Jun 23 2019 at 02:53)</a>:</h4>
<p>If you fill everything with <code>sorry</code> instead it should work</p>

<a name="168775224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775224" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775224">Mario Carneiro (Jun 23 2019 at 02:53)</a>:</h4>
<p>but if you fill early stuff with underscore and later stuff with sorry then it will fail</p>

<a name="168775262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775262" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775262">Kevin Buzzard (Jun 23 2019 at 02:54)</a>:</h4>
<blockquote>
<p>what the heck is going on in your file? What is <code>thing</code>?</p>
</blockquote>
<p>I'm just exploring. This is all your fault. You said "what generality do you want to do glueing in to create a milestone". For me the milestone is a construction of glueing sheaves.</p>

<a name="168775266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775266">Kevin Buzzard (Jun 23 2019 at 02:54)</a>:</h4>
<p>So you said "ok I'll write it all properly, will topological spaces do?" and I said "yeah" and then next thing you know we have bloody lattices.</p>

<a name="168775267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775267" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775267">Mario Carneiro (Jun 23 2019 at 02:54)</a>:</h4>
<p>For your reference, if you have a partial order with a supr function, then you can prove it has a complete lattice structure</p>

<a name="168775269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775269" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775269">Kevin Buzzard (Jun 23 2019 at 02:54)</a>:</h4>
<p>So you dragged me here and now you have to wait around until I've finished exploring.</p>

<a name="168775276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775276" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775276">Kevin Buzzard (Jun 23 2019 at 02:55)</a>:</h4>
<blockquote>
<p>For your reference, if you have a partial order with a supr function, then you can prove it has a complete lattice structure</p>
</blockquote>
<p>I am using the stupidest constructors imaginable.</p>

<a name="168775281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775281" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775281">Mario Carneiro (Jun 23 2019 at 02:55)</a>:</h4>
<p>which is to say, your definitions are provable. It won't be that much fun to do</p>

<a name="168775282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775282" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775282">Kevin Buzzard (Jun 23 2019 at 02:56)</a>:</h4>
<p>I am trying to write the code algorithmically, and my algorithm says "just do what the lean hole structure command thing says"</p>

<a name="168775321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775321" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775321">Kevin Buzzard (Jun 23 2019 at 02:56)</a>:</h4>
<p>You and I have different ideas about fun.</p>

<a name="168775323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775323">Mario Carneiro (Jun 23 2019 at 02:56)</a>:</h4>
<p>If you really want to do this you should break up the proof into the different parts of the hierarchy</p>

<a name="168775329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775329" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775329">Kevin Buzzard (Jun 23 2019 at 02:57)</a>:</h4>
<p>I'm just trying to understand how much work it is to make mathlib's definition of <code>lattice.complete_lattice</code> from scratch, in some sense.</p>

<a name="168775331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775331" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775331">Mario Carneiro (Jun 23 2019 at 02:57)</a>:</h4>
<p>I think this might be proven in the complete_lattice.lean file</p>

<a name="168775333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775333">Kevin Buzzard (Jun 23 2019 at 02:57)</a>:</h4>
<blockquote>
<p>If you really want to do this you should break up the proof into the different parts of the hierarchy</p>
</blockquote>
<p>I'm still learning things about the structure which I am building. How should I be ordering things? There are two files in the Xena project.</p>

<a name="168775378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775378" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775378">Kevin Buzzard (Jun 23 2019 at 02:58)</a>:</h4>
<blockquote>
<p>I think this might be proven in the complete_lattice.lean file</p>
</blockquote>
<p>Hey, why is that file not called <code>lattice/complete_lattice.lean</code>?</p>

<a name="168775381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775381">Kevin Buzzard (Jun 23 2019 at 02:58)</a>:</h4>
<p>I think there are several questions I've raised in this thread that are still not really answered.</p>

<a name="168775399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775399">Mario Carneiro (Jun 23 2019 at 02:59)</a>:</h4>
<p>some of this is architectural stuff you should ask Johannes</p>

<a name="168775461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775461" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775461">Mario Carneiro (Jun 23 2019 at 03:01)</a>:</h4>
<p>I recall the entire thing being committed in one huge block that gave us filters and complete lattices and topology, and I wasn't super happy about all the design decisions but I didn't want to bikeshed forever so I merged it</p>

<a name="168775509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775509" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775509">Mario Carneiro (Jun 23 2019 at 03:02)</a>:</h4>
<p>so you are asking me a lot of hard questions about stuff where I mostly agree with you. Don't assume everything in mathlib is optimal</p>

<a name="168775513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775513">Kevin Buzzard (Jun 23 2019 at 03:02)</a>:</h4>
<p>I really like learning about this stuff. I got rid of the red sorry :-) Thanks for all your help this evening. I find this very interesting stuff.</p>

<a name="168775519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775519">Mario Carneiro (Jun 23 2019 at 03:03)</a>:</h4>
<p>First you want to prove it's a lattice</p>

<a name="168775520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775520" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775520">Kevin Buzzard (Jun 23 2019 at 03:03)</a>:</h4>
<p>golly it's 4am</p>

<a name="168775521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775521">Mario Carneiro (Jun 23 2019 at 03:03)</a>:</h4>
<p>then you prove it's a complete lattice</p>

<a name="168775524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775524" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775524">Kevin Buzzard (Jun 23 2019 at 03:03)</a>:</h4>
<blockquote>
<p>First you want to prove it's a lattice</p>
</blockquote>
<p>How did you know that?</p>

<a name="168775528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775528" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775528">Kevin Buzzard (Jun 23 2019 at 03:03)</a>:</h4>
<p>My algorithm is buggy here.</p>

<a name="168775529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775529" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775529">Mario Carneiro (Jun 23 2019 at 03:03)</a>:</h4>
<p>because that's the way the hierarchy is set up</p>

<a name="168775568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775568">Kevin Buzzard (Jun 23 2019 at 03:04)</a>:</h4>
<p>But how can I work that out for myself?</p>

<a name="168775571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775571" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775571">Mario Carneiro (Jun 23 2019 at 03:04)</a>:</h4>
<p>it's actually broken up into quite a few more pieces than that</p>

<a name="168775573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775573">Mario Carneiro (Jun 23 2019 at 03:04)</a>:</h4>
<p>look at the <code>extends</code> clauses</p>

<a name="168775575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775575">Kevin Buzzard (Jun 23 2019 at 03:04)</a>:</h4>
<p>I want to learn how to write good structures. I am a really bad structure-writer, and I am now indicating that I am also a really bad structure-maker.</p>

<a name="168775587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775587" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775587">Mario Carneiro (Jun 23 2019 at 03:06)</a>:</h4>
<p>Ignoring the notation typeclasses, you have <code>complete_lattice &lt;- bounded_lattice &lt;- lattice, order_top, order_bot</code> and <code>lattice &lt;- semilattice_sup, semilattice_inf &lt;- partial order</code></p>

<a name="168775673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775673" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775673">Mario Carneiro (Jun 23 2019 at 03:08)</a>:</h4>
<p>So to keep it organized, you should try to first show <code>partial_order foo</code>, then <code>semilattice_inf foo</code> and <code>semilattice_sup foo</code>, then <code>lattice foo</code> and <code>order_top foo</code> and <code>order_bot foo</code>, then <code>bounded_lattice foo</code>, then <code>complete_lattice foo</code></p>

<a name="168775683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775683" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775683">Mario Carneiro (Jun 23 2019 at 03:10)</a>:</h4>
<p>In practice you can skip some of those steps by proving them simultaneous with other steps, but you should realize that when a later typeclass has an axiom that uses a notation provided by an earlier typeclass, the proof that you are in that typeclass appears as an argument</p>

<a name="168775775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775775">Kevin Buzzard (Jun 23 2019 at 03:12)</a>:</h4>
<p>Had to fix the errors before bed :-) </p>
<p><a href="https://github.com/kbuzzard/xena/blob/master/Examples/sheaf_on_opens_total_glueing.lean" target="_blank" title="https://github.com/kbuzzard/xena/blob/master/Examples/sheaf_on_opens_total_glueing.lean">https://github.com/kbuzzard/xena/blob/master/Examples/sheaf_on_opens_total_glueing.lean</a></p>
<p>Challenge 1: glue presheaves of types on opens<br>
Challenge 2 : glue sheaves of types on opens.<br>
Challenge 3 : glue sheaves of rings on opens.</p>

<a name="168775857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775857">Mario Carneiro (Jun 23 2019 at 03:16)</a>:</h4>
<p>For example, consider the following:</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">A</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">zero</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="o">(</span><span class="n">one</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="o">(</span><span class="n">zero_ne_one</span> <span class="o">:</span> <span class="n">zero</span> <span class="bp">≠</span> <span class="n">one</span><span class="o">)</span>

<span class="n">class</span> <span class="n">B</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="kn">extends</span> <span class="n">A</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">pos</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span>
<span class="o">(</span><span class="n">one_pos</span> <span class="o">:</span> <span class="n">pos</span> <span class="n">one</span><span class="o">)</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">B</span> <span class="n">nat</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">zero_ne_one</span> <span class="o">:=</span> <span class="n">zero_ne_one</span><span class="o">,</span>
  <span class="n">pos</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">one_pos</span> <span class="o">:=</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>


<p>Notice that I've proven both <code>A nat</code> and <code>B nat</code> in one go. The printed type of <code>pos_one</code> is <code>A.one ℕ &gt; 0</code>, but how could it say <code>A.one ℕ</code> if <code>A nat</code> hasn't been proven yet? The truth is that if you look at the typeclass args, you find that the provided instance is</p>
<div class="codehilite"><pre><span></span><span class="o">{</span> <span class="n">zero</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">zero_ne_one</span> <span class="o">:=</span> <span class="n">zero_ne_one</span> <span class="o">}</span>
</pre></div>


<p>that is, the full proof that you just wrote above it</p>

<a name="168775892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775892">Mario Carneiro (Jun 23 2019 at 03:17)</a>:</h4>
<p>This happens every time one axiom references a parent instance, and it's even worse the deeper the nesting you prove in one go</p>

<a name="168775937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168775937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168775937">Mario Carneiro (Jun 23 2019 at 03:18)</a>:</h4>
<p>this can lead to serious performance problems if you aren't careful (plus the <code>pp.all</code> size grows exponentially which isn't great either)</p>

<a name="168776345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168776345" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168776345">Kevin Buzzard (Jun 23 2019 at 03:34)</a>:</h4>
<div class="codehilite"><pre><span></span>type mismatch at field &#39;inf_le_left&#39;
  complete_lattice.inf_le_left
has type
  ∀ (a b : α),
    @has_le.le α
      (@preorder.to_has_le α
         (@partial_order.to_preorder α
            (@partial_order.mk α (@lattice.complete_lattice.le α X) (@lattice.complete_lattice.lt α X) _ _ _ _)))
      (@lattice.has_inf.inf α (@lattice.has_inf.mk α (@lattice.complete_lattice.inf α X)) a b)
      a
but is expected to have type
  ∀ (a b : α),
    @has_le.le α
      (@preorder.to_has_le α
         (@partial_order.to_preorder α
            (@partial_order.mk α
               (λ (a a_1 : α), @has_le.le α (@has_le.mk α (@lattice.complete_lattice.le α X)) a a)
               (@partial_order.lt._default α
                  (λ (a a_1 : α), @has_le.le α (@has_le.mk α (@lattice.complete_lattice.le α X)) a a))
               _
               ?m_1
               ?m_2
               ?m_3)))
      (@lattice.has_inf.inf α (@lattice.has_inf.mk α ?m_4) a b)
      a
</pre></div>


<p>Why am I in this mess? :-/</p>

<a name="168776408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168776408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168776408">Kevin Buzzard (Jun 23 2019 at 03:37)</a>:</h4>
<p><a href="https://github.com/kbuzzard/xena/blob/99cd50f01ca068d0e8796a7900f6e1a16fa8ff35/Examples/sheaf_on_opens_total_glueing.lean#L289" target="_blank" title="https://github.com/kbuzzard/xena/blob/99cd50f01ca068d0e8796a7900f6e1a16fa8ff35/Examples/sheaf_on_opens_total_glueing.lean#L289">https://github.com/kbuzzard/xena/blob/99cd50f01ca068d0e8796a7900f6e1a16fa8ff35/Examples/sheaf_on_opens_total_glueing.lean#L289</a></p>
<p>why u hate me Lean</p>

<a name="168776456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168776456" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168776456">Kevin Buzzard (Jun 23 2019 at 03:39)</a>:</h4>
<p>Oh I just have to fill in random fields and hope.</p>

<a name="168776460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168776460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168776460">Kevin Buzzard (Jun 23 2019 at 03:39)</a>:</h4>
<p>All I know is that Lean wants me to prove <code>?m_1</code> etc</p>

<a name="168777111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777111" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777111">Kevin Buzzard (Jun 23 2019 at 04:03)</a>:</h4>
<div class="codehilite"><pre><span></span>1 goal
α : Type u,
_inst_2 : bounded_lattice α,
_inst_3 : has_Sup α,
_inst_4 : has_Inf α,
X : complete_lattice α,
_inst : has_inf α := semilattice_inf.to_has_inf α,
_inst_1 : partial_order α := order_bot.to_partial_order α
⊢ (∀ (a b c : α), a ≤ b → b ≤ c → a ≤ c) ↔ ∀ (a b c : α), a ≤ b → b ≤ c → a ≤ c
</pre></div>


<p><code>by refl</code> doesn't work. Presumably I have got my instances wrong?</p>

<a name="168777155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777155" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777155">Kevin Buzzard (Jun 23 2019 at 04:04)</a>:</h4>
<p>I genuinely don't know how I am supposed to make one of these lattice classes. I'm in all sorts of trouble.</p>

<a name="168777271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777271" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777271">Kevin Buzzard (Jun 23 2019 at 04:08)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">ext_inf</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">}</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="o">(</span><span class="k">by</span> <span class="n">haveI</span> <span class="o">:=</span> <span class="n">A</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="bp">↔</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="k">by</span> <span class="n">haveI</span> <span class="o">:=</span> <span class="n">A</span><span class="bp">;</span> <span class="n">exact</span> <span class="o">(</span><span class="n">x</span> <span class="err">⊓</span> <span class="n">y</span><span class="o">))</span> <span class="bp">=</span> <span class="n">x</span> <span class="err">⊓</span> <span class="n">y</span> <span class="o">:=</span>
<span class="n">eq_of_forall_le_iff</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">c</span><span class="o">,</span>
<span class="k">by</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">le_inf_iff</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">H</span><span class="o">,</span> <span class="bp">@</span><span class="n">le_inf_iff</span> <span class="n">α</span> <span class="n">A</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">H</span><span class="o">]</span>
</pre></div>


<p>That's in mathlib, in <code>order/lattice.lean</code>. What's going on there?</p>

<a name="168777448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777448">Kevin Buzzard (Jun 23 2019 at 04:14)</a>:</h4>
<p>Oh I get it, I just look at the constructor <em>duh</em>. It would be cool if that hole command which spat out structure fields which need to be made, could take this sort of thing into account. I'm all for automation, I'm always using that hole command. Oh I'm back on track now.</p>

<a name="168777932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777932" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777932">Mario Carneiro (Jun 23 2019 at 04:32)</a>:</h4>
<p>This is what I mean by proving them one step at a time rather than all in one go</p>

<a name="168777934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777934" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777934">Mario Carneiro (Jun 23 2019 at 04:32)</a>:</h4>
<p>if you try to prove them in the wrong order, your goals make no sense</p>

<a name="168777940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168777940" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168777940">Mario Carneiro (Jun 23 2019 at 04:32)</a>:</h4>
<p>but lean and the hole command make it look like order doesn't matter, which is only true after you are done proving everything</p>

<a name="168778907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168778907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168778907">Kevin Buzzard (Jun 23 2019 at 05:06)</a>:</h4>
<p>What's the trick to do all of the semilattice fields at once?</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">canonical2</span><span class="bp">.</span><span class="n">to_fun</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="o">[</span><span class="n">bounded_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_Sup</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_Inf</span> <span class="n">α</span><span class="o">]</span>
<span class="o">[</span><span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">thing</span> <span class="n">α</span> <span class="o">:=</span>
<span class="k">begin</span>
<span class="c1">--let this : semilattice_inf α := by apply_instance,</span>
<span class="n">refine</span> <span class="o">{</span> <span class="n">inf</span> <span class="o">:=</span> <span class="k">begin</span> <span class="n">exact</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">inf</span> <span class="kn">end</span><span class="o">,</span>
         <span class="n">le</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le</span><span class="o">,</span>
         <span class="n">le_refl</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_refl</span><span class="o">,</span>
         <span class="n">le_trans</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_trans</span><span class="o">,</span>
         <span class="n">le_antisymm</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_antisymm</span><span class="o">,</span>
  <span class="c1">--       inf_le_inf := semilattice_inf.inf_le_inf,</span>
         <span class="n">inf_le_left</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">inf_le_left</span><span class="o">,</span>
         <span class="n">inf_le_right</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">inf_le_right</span><span class="o">,</span>
         <span class="n">le_inf</span> <span class="o">:=</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_inf</span><span class="o">,</span>
          <span class="c1">-- the rest are not from semilattice namespace</span>
         <span class="n">le_supr</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">ι</span> <span class="n">s</span><span class="o">,</span> <span class="k">begin</span> <span class="n">convert</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span><span class="bp">.</span><span class="n">le_supr</span> <span class="n">s</span><span class="o">,</span> <span class="n">sorry</span> <span class="kn">end</span><span class="o">,</span>
         <span class="n">supr</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">ι</span> <span class="n">s</span><span class="o">,</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">complete_lattice</span><span class="bp">.</span><span class="n">supr</span> <span class="n">s</span><span class="o">,</span>
         <span class="o">},</span>
<span class="kn">end</span>
</pre></div>


<p>And have I got my typeclasses right? Still not entirely confident on these things.</p>

<a name="168778908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168778908" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168778908">Kevin Buzzard (Jun 23 2019 at 05:06)</a>:</h4>
<blockquote>
<p>if you try to prove them in the wrong order, your goals make no sense</p>
</blockquote>
<p>How do I work out the correct order to prove them?</p>

<a name="168779007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779007">Mario Carneiro (Jun 23 2019 at 05:10)</a>:</h4>
<p>Look at the definition of <code>complete_lattice</code>, it extends <code>bounded_lattice</code> so you should prove stuff about bounded lattice before you do stuff involving Sup and Inf</p>

<a name="168779017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779017" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779017">Mario Carneiro (Jun 23 2019 at 05:11)</a>:</h4>
<p>You should not have <code>[bounded_lattice α] [has_Sup α] [has_Inf α] [lattice.complete_lattice α]</code> because <code>complete_lattice</code> contains another copy of the first three</p>

<a name="168779062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779062" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779062">Mario Carneiro (Jun 23 2019 at 05:12)</a>:</h4>
<p>That direction should be relatively easy, if you <code>open lattice</code> then the proof should just be <code>supr := supr</code> and <code>le_supr := le_supr</code></p>

<a name="168779065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779065" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779065">Kevin Buzzard (Jun 23 2019 at 05:13)</a>:</h4>
<p>I have a universe issue.</p>
<div class="codehilite"><pre><span></span>kernel failed to type check declaration &#39;canonical2.to_fun&#39; this is usually due to a buggy tactic or a bug in the builtin elaborator
elaborated type:
  Π (α : Type u) [_inst_1 : complete_lattice α], thing α
elaborated value:
  λ (α : Type u) [_inst_1 : complete_lattice α],
    {to_semilattice_inf := {inf := semilattice_inf.inf (semilattice_inf_bot.to_semilattice_inf α),
                            le := semilattice_inf.le (semilattice_inf_bot.to_semilattice_inf α),
                            lt := partial_order.lt._default semilattice_inf.le,
                            le_refl := _,
                            le_trans := _,
                            lt_iff_le_not_le := _,
                            le_antisymm := _,
                            inf_le_left := _,
                            inf_le_right := _,
                            le_inf := _},
     supr := λ (ι : Sort v) (s : ι → α), complete_lattice.supr s,
     le_supr := _}
nested exception message:
invalid reference to undefined universe level parameter &#39;v&#39;
</pre></div>

<a name="168779069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779069">Mario Carneiro (Jun 23 2019 at 05:13)</a>:</h4>
<p>oh right, <code>thing</code> has a universe issue in its definition because v is free</p>

<a name="168779070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779070" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779070">Kevin Buzzard (Jun 23 2019 at 05:13)</a>:</h4>
<p><code>thing.{v} α</code></p>

<a name="168779072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779072" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779072">Kevin Buzzard (Jun 23 2019 at 05:13)</a>:</h4>
<p>got it</p>

<a name="168779112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779112" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779112">Mario Carneiro (Jun 23 2019 at 05:14)</a>:</h4>
<p>You should either use <code>u</code> in place of <code>v</code> , or do the same thing as complete_lattice and axiomatize Sup instead of supr</p>

<a name="168779117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779117" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779117">Mario Carneiro (Jun 23 2019 at 05:15)</a>:</h4>
<p>You can't properly axiomatize supr because of the required existential universe variables</p>

<a name="168779124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779124" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779124">Kevin Buzzard (Jun 23 2019 at 05:15)</a>:</h4>
<p>I don't really understand what is going on here, as my code probably indicates.</p>

<a name="168779175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779175" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779175">Mario Carneiro (Jun 23 2019 at 05:17)</a>:</h4>
<p>My original claim that <code>thing</code> is equivalent to <code>complete_lattice</code> is actually false with <code>v</code> used the way it currently is</p>

<a name="168779177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779177">Mario Carneiro (Jun 23 2019 at 05:17)</a>:</h4>
<p>If <code>v</code> is less than <code>u</code> then you are actually claiming only the existence of "small suprema"</p>

<a name="168779217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779217" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779217">Kevin Buzzard (Jun 23 2019 at 05:18)</a>:</h4>
<p>Because I am universe-monomorphic I do not recognise this issue.</p>

<a name="168779221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779221" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779221">Mario Carneiro (Jun 23 2019 at 05:18)</a>:</h4>
<p>As a simpler analogue, it's as if you are only asking for countable suprema</p>

<a name="168779222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779222" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779222">Kevin Buzzard (Jun 23 2019 at 05:18)</a>:</h4>
<p>That's an interesting analogue</p>

<a name="168779227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779227">Mario Carneiro (Jun 23 2019 at 05:19)</a>:</h4>
<p>if the set itself is not countable it should not be a surprise that this isn't the same as being complete</p>

<a name="168779279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779279">Kevin Buzzard (Jun 23 2019 at 05:20)</a>:</h4>
<p>But another observation is presumably that if <code>Type u</code> and <code>Sort v</code> are just <code>Type</code> then the problem goes away?</p>

<a name="168779281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779281" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779281">Mario Carneiro (Jun 23 2019 at 05:20)</a>:</h4>
<p>More specifically, if you set <code>v = u</code> then the problem goes away</p>

<a name="168779286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779286" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779286">Kevin Buzzard (Jun 23 2019 at 05:21)</a>:</h4>
<p>Is that right? That would be really nice. I thought the Sort stuff might mess things up.</p>

<a name="168779287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779287" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779287">Mario Carneiro (Jun 23 2019 at 05:21)</a>:</h4>
<p>or like I said, if you restrict the indexing set to be subsets of the original space</p>

<a name="168779290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779290">Kevin Buzzard (Jun 23 2019 at 05:21)</a>:</h4>
<blockquote>
<p>or like I said, if you restrict the indexing set to be subsets of the original space</p>
</blockquote>
<p>I can't do that for glueing schemes.</p>

<a name="168779291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779291" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779291">Mario Carneiro (Jun 23 2019 at 05:21)</a>:</h4>
<p>sure you can</p>

<a name="168779333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779333">Mario Carneiro (Jun 23 2019 at 05:22)</a>:</h4>
<p>do you have an example?</p>

<a name="168779338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779338" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779338">Kevin Buzzard (Jun 23 2019 at 05:22)</a>:</h4>
<p>You think that the set-valued version of glueing implies the Union version?</p>

<a name="168779341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779341" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779341">Mario Carneiro (Jun 23 2019 at 05:23)</a>:</h4>
<p>Yes</p>

<a name="168779344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779344">Kevin Buzzard (Jun 23 2019 at 05:23)</a>:</h4>
<p>I had not realised this</p>

<a name="168779346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779346">Mario Carneiro (Jun 23 2019 at 05:23)</a>:</h4>
<p>The definition I gave of <code>gluing</code> and <code>locality</code> uses subsets</p>

<a name="168779348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779348">Kevin Buzzard (Jun 23 2019 at 05:23)</a>:</h4>
<p>The set-valued version will only use one universe, right?</p>

<a name="168779351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779351">Mario Carneiro (Jun 23 2019 at 05:23)</a>:</h4>
<p>it actually only uses one type, which is in the same universe as the original</p>

<a name="168779391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779391">Kevin Buzzard (Jun 23 2019 at 05:24)</a>:</h4>
<p>I know that <code>gluing</code> and <code>locality</code> use subsets, but they are conceptually simpler than gluing sheaves. They are gluing sections.</p>

<a name="168779393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779393" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779393">Mario Carneiro (Jun 23 2019 at 05:24)</a>:</h4>
<p>okay you are going to have to give me a code snippet to back that statement up</p>

<a name="168779400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779400" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779400">Mario Carneiro (Jun 23 2019 at 05:25)</a>:</h4>
<p>what are the types of the relevant objects?</p>

<a name="168779403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779403">Kevin Buzzard (Jun 23 2019 at 05:25)</a>:</h4>
<p>This is the thing I want:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">universal_property</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">α</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">glue</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">Hφ1</span> <span class="n">Hφ2</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">$</span> <span class="n">opens</span><span class="bp">.</span><span class="n">subset_Union</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</pre></div>

<a name="168779450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779450">Kevin Buzzard (Jun 23 2019 at 05:26)</a>:</h4>
<p>If you can make the type of an analogous "set version" of this term which mentions no <code>I</code> and no <code>Sort v</code> and replaces <code>S</code> with some kind of <code>set</code> thing, sorry it, and then prove the universal property I want from your set one, then I will understand why the set one suffices.</p>

<a name="168779455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779455" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779455">Mario Carneiro (Jun 23 2019 at 05:27)</a>:</h4>
<p>This is a theorem, though, right?</p>

<a name="168779458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779458">Kevin Buzzard (Jun 23 2019 at 05:27)</a>:</h4>
<p>I don't know.</p>

<a name="168779460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779460">Mario Carneiro (Jun 23 2019 at 05:27)</a>:</h4>
<p>you wrote <code>:= sorry</code> so I assume so</p>

<a name="168779501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779501">Mario Carneiro (Jun 23 2019 at 05:28)</a>:</h4>
<p>this is supposed to follow from the axioms of sheaves</p>

<a name="168779502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779502">Kevin Buzzard (Jun 23 2019 at 05:28)</a>:</h4>
<p>I don't know if it's true. It's a conjecture.</p>

<a name="168779561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779561" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779561">Kevin Buzzard (Jun 23 2019 at 05:30)</a>:</h4>
<p>Assuming Kenny and I have formalised it correctly, that should be true. It's an exercise in Hartshorne.</p>

<a name="168779568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779568">Kevin Buzzard (Jun 23 2019 at 05:31)</a>:</h4>
<p>Exercise 1.22 of one of the early chapters.</p>

<a name="168779569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779569">Mario Carneiro (Jun 23 2019 at 05:31)</a>:</h4>
<p>the proof args make me weep</p>

<a name="168779570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779570" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779570">Kevin Buzzard (Jun 23 2019 at 05:31)</a>:</h4>
<p>Just tell me how to do it.</p>

<a name="168779571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779571" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779571">Kevin Buzzard (Jun 23 2019 at 05:31)</a>:</h4>
<p>I don't have a clue what I'm doing. I know enough Lean to be able to solve problems I run into, and I just blunder on.</p>

<a name="168779612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779612" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779612">Kevin Buzzard (Jun 23 2019 at 05:32)</a>:</h4>
<p>Probably chapter 2, I think section 2.1 is sheaves.</p>

<a name="168779614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779614">Johan Commelin (Jun 23 2019 at 05:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Did you just pull an all-nighter gluing sheaves <span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span></p>

<a name="168779615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779615" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779615">Mario Carneiro (Jun 23 2019 at 05:32)</a>:</h4>
<p>There are two ways forward: the way I've been championing that tries to hide proof args, or the category theory way that makes the proof args the only thing and hides the objects</p>

<a name="168779668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779668">Kevin Buzzard (Jun 23 2019 at 05:34)</a>:</h4>
<p>And another conjecture is that if T is a type with the discrete topology, and if F(U) is defined to be the continuous maps from U to T, then the cocycle condition should give us a 1-cocycle with values in Aut(T) or something. This might be nonabelian sheaf cohomology though, which we didn't formalise yet. Anca only did abelian group H1.</p>

<a name="168779672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779672">Kevin Buzzard (Jun 23 2019 at 05:34)</a>:</h4>
<blockquote>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> Did you just pull an all-nighter gluing sheaves <span aria-label="lol" class="emoji emoji-1f606" role="img" title="lol">:lol:</span></p>
</blockquote>
<p>My partner is away :-)</p>

<a name="168779728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779728">Kevin Buzzard (Jun 23 2019 at 05:36)</a>:</h4>
<p>There will be an easier universal property just for presheaves of types. I might have done this one.</p>

<a name="168779729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168779729" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168779729">Kevin Buzzard (Jun 23 2019 at 05:36)</a>:</h4>
<p>In the <code>opens</code> case, not in the lattice case.</p>

<a name="168780754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168780754" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168780754">Kevin Buzzard (Jun 23 2019 at 06:11)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">has_sup</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">Y</span> <span class="o">:</span> <span class="n">thing</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">has_sup</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">sup</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="bp">@</span><span class="n">thing</span><span class="bp">.</span><span class="n">supr</span> <span class="n">α</span> <span class="n">Y</span> <span class="n">bool</span> <span class="o">(</span><span class="bp">@</span><span class="n">bool</span><span class="bp">.</span><span class="n">rec</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">α</span><span class="o">)</span> <span class="n">a</span> <span class="n">b</span><span class="o">)}</span>
</pre></div>


<p>Will this instance never trigger?</p>

<a name="168780795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168780795" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168780795">Kevin Buzzard (Jun 23 2019 at 06:12)</a>:</h4>
<p>I rolled my own <code>sup</code> from <code>supr</code></p>

<a name="168780806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168780806" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168780806">Kevin Buzzard (Jun 23 2019 at 06:13)</a>:</h4>
<p>and now I have universe issues :-(</p>
<div class="codehilite"><pre><span></span>type mismatch at application
  thing.has_sup α Y
term
  Y
has type
  thing.{u_1 u} α : Type (max u u_1)
but is expected to have type
  thing.{1 u} α : Type (max u 1)
state:
α : Type u,
H : semilattice_inf α,
Y : thing α
⊢ Sort ?
</pre></div>


<p>stupid bool. Did I need a ubool or something?</p>

<a name="168781098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781098">Mario Carneiro (Jun 23 2019 at 06:24)</a>:</h4>
<p>you can use <code>ulift bool</code></p>

<a name="168781099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781099" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781099">Kevin Buzzard (Jun 23 2019 at 06:24)</a>:</h4>
<p>I don't understand the universe combinatorics well enough to know which universe I should be lifting to.</p>

<a name="168781107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781107" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781107">Kevin Buzzard (Jun 23 2019 at 06:25)</a>:</h4>
<div class="codehilite"><pre><span></span>type mismatch at application
  thing.has_sup α Y
term
  Y
has type
  thing.{u_1 u} α : Type (max u u_1)
but is expected to have type
  thing.{?l_1+1 u} α : Type (max u (?l_1+1))
state:
α : Type u,
H : semilattice_inf α,
Y : thing α
⊢ Sort ?
</pre></div>


<p>I can't even solve the equations.</p>

<a name="168781469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781469">Kevin Buzzard (Jun 23 2019 at 06:38)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">Y</span> <span class="o">:</span> <span class="n">thing</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">semilattice_inf</span> <span class="n">α</span> <span class="o">:=</span> <span class="n">thing</span><span class="bp">.</span><span class="n">to_semilattice_inf</span> <span class="n">Y</span>
<span class="c1">-- example (α : Type u) (Y : thing α) : semilattice_inf α := by apply_instance -- fails</span>
</pre></div>


<p>I can't get this instance to fire. Do I have to make <code>thing</code> a class to proceed more smoothly?</p>

<a name="168781595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781595" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781595">Mario Carneiro (Jun 23 2019 at 06:42)</a>:</h4>
<p>Why does <code>thing</code> still take two universe args?</p>

<a name="168781599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781599" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781599">Kevin Buzzard (Jun 23 2019 at 06:42)</a>:</h4>
<p>I'm scared Mario</p>

<a name="168781607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781607">Mario Carneiro (Jun 23 2019 at 06:43)</a>:</h4>
<p>I'm still not clear on exactly what the goal is</p>

<a name="168781608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781608" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781608">Kevin Buzzard (Jun 23 2019 at 06:43)</a>:</h4>
<p>I am not sure that sets are enough for glueing</p>

<a name="168781611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781611">Mario Carneiro (Jun 23 2019 at 06:43)</a>:</h4>
<p>You aren't using sets</p>

<a name="168781614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781614">Mario Carneiro (Jun 23 2019 at 06:43)</a>:</h4>
<p>I managed to prove that sheaf has a comap operation, will show</p>

<a name="168781616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781616" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781616">Kevin Buzzard (Jun 23 2019 at 06:43)</a>:</h4>
<p>I'll formalise the thing I'm not sure whether to believe.</p>

<a name="168781661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781661" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781661">Mario Carneiro (Jun 23 2019 at 06:44)</a>:</h4>
<p><a href="https://gist.github.com/digama0/2ee44987e8613b41c24536ddcde86d35" target="_blank" title="https://gist.github.com/digama0/2ee44987e8613b41c24536ddcde86d35">https://gist.github.com/digama0/2ee44987e8613b41c24536ddcde86d35</a></p>

<a name="168781674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781674" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781674">Mario Carneiro (Jun 23 2019 at 06:45)</a>:</h4>
<p>That's equivalent to the theorem that you can make a sheaf on a subset</p>

<a name="168781779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781779" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781779">Kevin Buzzard (Jun 23 2019 at 06:49)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">infixr</span> <span class="bp">`</span> <span class="err">↪⊓⨆</span> <span class="bp">`</span><span class="o">:</span><span class="mi">25</span> <span class="o">:=</span> <span class="n">semilattice_inf_lub_emb</span>
</pre></div>


<p>I'm liking that.</p>

<a name="168781839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781839">Kevin Buzzard (Jun 23 2019 at 06:51)</a>:</h4>
<p>I cannot formalise the "can sheaf glueing be done on subsets WLOG" goal until someone has ported Kenny's work on glueing to Mario's framework.</p>

<a name="168781881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781881" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781881">Mario Carneiro (Jun 23 2019 at 06:52)</a>:</h4>
<p>That's the goal</p>

<a name="168781896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781896">Johan Commelin (Jun 23 2019 at 06:53)</a>:</h4>
<p>It seems to me that half of that file is duplicating things that we have in <code>category_theory/</code> already...</p>

<a name="168781938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168781938" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168781938">Kevin Buzzard (Jun 23 2019 at 06:54)</a>:</h4>
<p>It's normally <span class="user-mention" data-user-id="110087">@Scott Morrison</span> who says that. I don't know too much about the category theory library either.</p>

<a name="168782067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782067" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782067">Johan Commelin (Jun 23 2019 at 06:59)</a>:</h4>
<p>In fact, we already have the definition of presheaf in mathlib + a bunch of other abstract generalities. I think it would make a lot of sense to build the sheaf condition on top of that.</p>

<a name="168782379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782379" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782379">Kevin Buzzard (Jun 23 2019 at 07:10)</a>:</h4>
<p>But is it a presheaf over a complete lattice?</p>

<a name="168782389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782389" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782389">Kevin Buzzard (Jun 23 2019 at 07:11)</a>:</h4>
<p>Oh it's some category definition, right? It's a functor. I think it would be an interesting question to see how much fun it was to formalise sheaf glueing in that language. I think it would be more difficult than what Mario is doing.</p>

<a name="168782441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782441" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782441">Mario Carneiro (Jun 23 2019 at 07:13)</a>:</h4>
<p>One thing that the category formulation will give you is a much easier way to do this stuff</p>
<div class="codehilite"><pre><span></span>  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="o">:</span>
</pre></div>


<p>with diagrams</p>

<a name="168782445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782445">Johan Commelin (Jun 23 2019 at 07:13)</a>:</h4>
<p>You can still just work over complete lattices.</p>

<a name="168782446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782446" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782446">Johan Commelin (Jun 23 2019 at 07:13)</a>:</h4>
<p>So do the sheafy part the way you've been doing it. But just use the existing presheaves, instead of rolling your own.</p>

<a name="168782485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782485" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782485">Johan Commelin (Jun 23 2019 at 07:14)</a>:</h4>
<p>The definition of presheaf and functor or defeq up to eta for records...</p>

<a name="168782773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782773" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782773">Kevin Buzzard (Jun 23 2019 at 07:25)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">comap</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span><span class="err">⊓</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">presheaf</span> <span class="n">α</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">F</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">),</span>
  <span class="n">res</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">mono</span> <span class="n">h</span><span class="o">),</span>
  <span class="n">Hid</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">Hid</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">Hcomp</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">bc</span> <span class="n">ab</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">Hcomp</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>


<p>This is much harder for sheaves; one might need some extra assumptions on alpha to make it work.</p>

<a name="168782775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782775">Kevin Buzzard (Jun 23 2019 at 07:25)</a>:</h4>
<p>You have to "sheafify".</p>

<a name="168782814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782814" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782814">Kevin Buzzard (Jun 23 2019 at 07:26)</a>:</h4>
<p>Apply the adjoint functor to the forgetful functor from sheaves to presheaves.</p>

<a name="168782822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782822">Mario Carneiro (Jun 23 2019 at 07:26)</a>:</h4>
<p>Here's presheaves:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">topology</span><span class="bp">.</span><span class="n">Top</span><span class="bp">.</span><span class="n">presheaf</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="kn">open</span> <span class="n">category_theory</span>
<span class="kn">open</span> <span class="n">topological_space</span>
<span class="kn">open</span> <span class="n">opposite</span>

<span class="n">def</span> <span class="n">presheaf&#39;</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="err">𝒞</span> <span class="o">:</span> <span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span> <span class="o">:=</span> <span class="o">(</span><span class="n">Top</span><span class="bp">.</span><span class="n">of</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">presheaf</span> <span class="n">C</span>

<span class="kn">namespace</span> <span class="n">presheaf&#39;</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">α</span><span class="o">]</span>
  <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="err">𝒞</span> <span class="o">:</span> <span class="n">category</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">}</span> <span class="n">C</span><span class="o">]</span>
<span class="n">include</span> <span class="err">𝒞</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe_to_fun</span> <span class="o">(</span><span class="n">presheaf&#39;</span> <span class="n">α</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">F</span> <span class="n">U</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">obj</span> <span class="o">(</span><span class="n">op</span> <span class="n">U</span><span class="o">)</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf&#39;</span> <span class="n">α</span> <span class="n">C</span><span class="o">)</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span> <span class="err">⟶</span> <span class="n">F</span> <span class="n">V</span> <span class="o">:=</span> <span class="n">F</span><span class="bp">.</span><span class="n">map</span> <span class="n">f</span><span class="bp">.</span><span class="n">op</span>

<span class="kn">end</span> <span class="n">presheaf&#39;</span>
</pre></div>


<p>Not sure how to state the sheaf axioms without elements of the category</p>

<a name="168782832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782832" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782832">Mario Carneiro (Jun 23 2019 at 07:27)</a>:</h4>
<p>I don't know why <code>presheaf</code> is stated using a <code>Top</code> argument</p>

<a name="168782834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782834" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782834">Kevin Buzzard (Jun 23 2019 at 07:27)</a>:</h4>
<p>You can't make sheaves on an arbitrary category.</p>

<a name="168782836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782836" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782836">Kevin Buzzard (Jun 23 2019 at 07:28)</a>:</h4>
<p>You need a notion of covering. This is what a site is.</p>

<a name="168782875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782875" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782875">Mario Carneiro (Jun 23 2019 at 07:28)</a>:</h4>
<p>okay, how's that work?</p>

<a name="168782877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782877" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782877">Kevin Buzzard (Jun 23 2019 at 07:28)</a>:</h4>
<p><a href="https://en.wikipedia.org/wiki/Grothendieck_topology" target="_blank" title="https://en.wikipedia.org/wiki/Grothendieck_topology">https://en.wikipedia.org/wiki/Grothendieck_topology</a></p>

<a name="168782883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782883">Mario Carneiro (Jun 23 2019 at 07:29)</a>:</h4>
<p>Wait, this is about the domain category</p>

<a name="168782886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782886">Kevin Buzzard (Jun 23 2019 at 07:29)</a>:</h4>
<p>If you work with categories then that is the correct thing to use.</p>

<a name="168782887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782887">Mario Carneiro (Jun 23 2019 at 07:29)</a>:</h4>
<p>mathlib presheaves are on top spaces</p>

<a name="168782888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782888" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782888">Kevin Buzzard (Jun 23 2019 at 07:29)</a>:</h4>
<p>To say what a sheaf is, you have to know what a covering of an open set by open sets is</p>

<a name="168782889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782889" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782889">Mario Carneiro (Jun 23 2019 at 07:29)</a>:</h4>
<p>The category here is the target, replacing Type</p>

<a name="168782895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782895">Kevin Buzzard (Jun 23 2019 at 07:30)</a>:</h4>
<p>If you want to define sheaves of types on an arbitrary category, you need the extra structure of a site on that category.</p>

<a name="168782935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782935">Mario Carneiro (Jun 23 2019 at 07:30)</a>:</h4>
<p>I don't</p>

<a name="168782940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782940" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782940">Kevin Buzzard (Jun 23 2019 at 07:30)</a>:</h4>
<p>No?</p>

<a name="168782943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782943">Mario Carneiro (Jun 23 2019 at 07:30)</a>:</h4>
<p>I'm just considering top spaces for now, because that's what mathlib presheaves are</p>

<a name="168782944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782944" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782944">Mario Carneiro (Jun 23 2019 at 07:30)</a>:</h4>
<p>I just want to know why it's bundled</p>

<a name="168782953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782953">Mario Carneiro (Jun 23 2019 at 07:31)</a>:</h4>
<p>mathlib presheaves could also be generalized to preorder categories, but that's work for another day</p>

<a name="168782954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782954" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782954">Mario Carneiro (Jun 23 2019 at 07:31)</a>:</h4>
<p>or general categories, and then you have this site business</p>

<a name="168782999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168782999" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168782999">Kevin Buzzard (Jun 23 2019 at 07:32)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">sheaf_on_opens</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
<span class="n">sheaf</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">α</span>
</pre></div>


<p>How are you going to port that line to your library?</p>

<a name="168783004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783004">Kevin Buzzard (Jun 23 2019 at 07:32)</a>:</h4>
<p>It might be best to do <code>presheaf_on_opens</code> first</p>

<a name="168783005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783005" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783005">Mario Carneiro (Jun 23 2019 at 07:32)</a>:</h4>
<p><code>sheaf_on_opens U := sheaf {V // V &lt;= U}</code></p>

<a name="168783013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783013" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783013">Mario Carneiro (Jun 23 2019 at 07:33)</a>:</h4>
<p>or more generally a sheaf on some object isomorphic to that</p>

<a name="168783019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783019" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783019">Kevin Buzzard (Jun 23 2019 at 07:33)</a>:</h4>
<p>So you really want to carry the subtype around?</p>

<a name="168783022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783022" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783022">Mario Carneiro (Jun 23 2019 at 07:33)</a>:</h4>
<p>That's why I defined <code>comap</code>, because <code>subtype.val</code> is an inf_sup_emb</p>

<a name="168783074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783074">Mario Carneiro (Jun 23 2019 at 07:35)</a>:</h4>
<p>But the theory starts to look very categorical at that point, because you need products in the category to replace intersection of subsets</p>

<a name="168783080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783080">Kevin Buzzard (Jun 23 2019 at 07:35)</a>:</h4>
<p>And you think that (a) this will make the gluing of presheaves go better and (b) you will be able to prove the universal property from a set-valued one.</p>

<a name="168783126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783126" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783126">Kevin Buzzard (Jun 23 2019 at 07:36)</a>:</h4>
<p>We can just stick to gluing of presheaves. I want to see this trick of going from the set to the parametrised set.</p>

<a name="168783133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783133">Mario Carneiro (Jun 23 2019 at 07:37)</a>:</h4>
<p>I'm not sure I want to actually define <code>sheaf_on_opens U := sheaf {V // V &lt;= U}</code> because then it won't apply cleanly to <code>opens</code>, since <code>opens U</code> (using U as a subset of the topological space as a top space in its own right) is isomorphic but not defeq to <code>{V : opens alpha // V &lt;= U}</code></p>

<a name="168783183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783183">Mario Carneiro (Jun 23 2019 at 07:38)</a>:</h4>
<p>So you can use something like <code>comap</code> to avoid having to prescribe a particular representation for the type, but at some point you just want to say "intersect these subsets and give me the result" without having to assume the result exists in the first place</p>

<a name="168783193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783193" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783193">Mario Carneiro (Jun 23 2019 at 07:39)</a>:</h4>
<p>And this is especially important for the gluing axiom, because it's kind of the whole point that you don't know the glued sheaf exists until you construct it</p>

<a name="168783238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783238">Mario Carneiro (Jun 23 2019 at 07:40)</a>:</h4>
<p>But I'm not sure how to state these axioms in the categorical presentation:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">locality</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf&#39;</span> <span class="n">α</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">{{</span><span class="n">U</span> <span class="n">S</span><span class="o">}},</span> <span class="n">is_lub</span> <span class="n">S</span> <span class="n">U</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="o">{{</span><span class="n">s</span> <span class="n">t</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">}},</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="n">V</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">t</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">t</span>

<span class="n">def</span> <span class="n">gluing</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf&#39;</span> <span class="n">α</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">{{</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">}}</span> <span class="o">{{</span><span class="n">S</span><span class="o">}},</span> <span class="n">is_lub</span> <span class="n">S</span> <span class="n">U</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">V</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="n">F</span> <span class="n">V</span><span class="o">),</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="n">V</span> <span class="n">W</span> <span class="o">:</span> <span class="n">S</span><span class="o">,</span> <span class="n">res&#39;</span> <span class="n">F</span> <span class="o">(</span><span class="n">V</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">V</span><span class="o">)</span> <span class="bp">=</span> <span class="n">res&#39;</span> <span class="n">F</span> <span class="o">(</span><span class="n">V</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">W</span><span class="o">))</span> <span class="bp">→</span>
  <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">F</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">V</span><span class="o">:</span><span class="n">S</span><span class="o">,</span> <span class="n">F</span><span class="bp">.</span><span class="n">res&#39;</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">s</span> <span class="n">V</span>
</pre></div>

<a name="168783241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783241" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783241">Mario Carneiro (Jun 23 2019 at 07:40)</a>:</h4>
<p>they are too pointed</p>

<a name="168783416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783416">Kevin Buzzard (Jun 23 2019 at 07:46)</a>:</h4>
<div class="codehilite"><pre><span></span>failed to synthesize type class instance for
α : Type u,
_inst_1 : semilattice_inf α,
U : α
⊢ semilattice_inf {V // V ≤ U}
</pre></div>

<a name="168783428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783428" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783428">Kevin Buzzard (Jun 23 2019 at 07:47)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>
<span class="n">def</span> <span class="n">presheaf_on_opens</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">&lt;=</span> <span class="n">U</span><span class="o">}</span>
</pre></div>

<a name="168783541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783541" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783541">Mario Carneiro (Jun 23 2019 at 07:51)</a>:</h4>
<p>there's that too</p>

<a name="168783606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783606">Kevin Buzzard (Jun 23 2019 at 07:54)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">semilattice_inf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span> <span class="n">sorry</span>
</pre></div>


<p>:-(</p>

<a name="168783710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783710" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783710">Mario Carneiro (Jun 23 2019 at 07:56)</a>:</h4>
<p>it's not hard to prove</p>

<a name="168783720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783720" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783720">Kevin Buzzard (Jun 23 2019 at 07:57)</a>:</h4>
<p>I just thought it would happen by magic</p>

<a name="168783721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783721" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783721">Kevin Buzzard (Jun 23 2019 at 07:57)</a>:</h4>
<p>I am really not good at making any instances of anything with the word lattice in the name.</p>

<a name="168783724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783724" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783724">Kevin Buzzard (Jun 23 2019 at 07:57)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">has_inf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails</span>
</pre></div>

<a name="168783761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168783761" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168783761">Kevin Buzzard (Jun 23 2019 at 07:58)</a>:</h4>
<p>but <code>semilattice_inf</code> extends <code>has_inf</code></p>

<a name="168784007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168784007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168784007">Mario Carneiro (Jun 23 2019 at 08:04)</a>:</h4>
<p>you have to define that too</p>

<a name="168784008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168784008" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168784008">Mario Carneiro (Jun 23 2019 at 08:04)</a>:</h4>
<p>aha, this typechecks:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">locality</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf&#39;</span> <span class="n">α</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">{{</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">opens</span> <span class="n">α</span><span class="o">)}}</span> <span class="o">{{</span><span class="n">X</span><span class="o">}}</span> <span class="o">{{</span><span class="n">s</span> <span class="n">t</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">F</span> <span class="o">(</span><span class="n">Sup</span> <span class="n">S</span><span class="o">)}},</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="o">(</span><span class="n">V</span> <span class="err">∈</span> <span class="n">S</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">Sup</span> <span class="n">S</span><span class="o">),</span> <span class="n">s</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">t</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">f</span><span class="o">)</span> <span class="bp">→</span> <span class="n">s</span> <span class="bp">=</span> <span class="n">t</span>

<span class="n">def</span> <span class="n">gluing</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf&#39;</span> <span class="n">α</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">∀</span> <span class="o">{{</span><span class="n">S</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">opens</span> <span class="n">α</span><span class="o">)}}</span> <span class="o">{{</span><span class="n">X</span><span class="o">}}</span> <span class="o">{{</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">V</span> <span class="err">∈</span> <span class="n">S</span><span class="o">,</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">F</span> <span class="n">V</span><span class="o">}},</span>
  <span class="o">(</span><span class="bp">∀</span> <span class="n">V</span> <span class="n">hV</span> <span class="n">W</span> <span class="n">hW</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊓</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊓</span> <span class="n">W</span> <span class="err">⟶</span> <span class="n">W</span><span class="o">),</span>
    <span class="n">s</span> <span class="n">V</span> <span class="n">hV</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">s</span> <span class="n">W</span> <span class="n">hW</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">r</span><span class="o">)</span> <span class="bp">→</span>
  <span class="bp">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">X</span> <span class="err">⟶</span> <span class="n">F</span> <span class="o">(</span><span class="n">Sup</span> <span class="n">S</span><span class="o">),</span> <span class="bp">∀</span> <span class="n">V</span> <span class="n">hV</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⟶</span> <span class="n">Sup</span> <span class="n">S</span><span class="o">),</span> <span class="n">x</span> <span class="err">≫</span> <span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">f</span> <span class="bp">=</span> <span class="n">s</span> <span class="n">V</span> <span class="n">hV</span>
</pre></div>

<a name="168784039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168784039" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168784039">Mario Carneiro (Jun 23 2019 at 08:05)</a>:</h4>
<p>the main drawback seems to be that you have to specify the morphism all the time, even though it's unique</p>

<a name="168786796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786796">Kevin Buzzard (Jun 23 2019 at 09:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">mario_sheaf</span> <span class="c1">-- Mario&#39;s gist</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>

<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span>

<span class="kn">variable</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>

<span class="c1">--#print notation →⊓</span>
<span class="c1">--#check @semilattice_inf_hom</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">class semilattice_inf (α : Type u) extends has_inf α, partial_order α :=</span>
<span class="cm">(inf_le_left : ∀ a b : α, a ⊓ b ≤ a)</span>
<span class="cm">(inf_le_right : ∀ a b : α, a ⊓ b ≤ b)</span>
<span class="cm">(le_inf : ∀ a b c : α, a ≤ b → a ≤ c → a ≤ b ⊓ c)</span>
<span class="cm">-/</span>

<span class="c1">--#where</span>

<span class="kn">namespace</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">opens</span>

<span class="c1">--#print has_inf.inf</span>

<span class="n">def</span> <span class="n">inf</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">&lt;=</span> <span class="n">U</span><span class="o">})</span> <span class="o">:</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">&lt;=</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">a</span><span class="bp">.</span><span class="n">val</span> <span class="err">⊓</span> <span class="n">b</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span> <span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">a</span><span class="bp">.</span><span class="n">property</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="n">has_inf</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">has_inf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">inf</span> <span class="n">U</span><span class="bp">⟩</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">has_inf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>

<span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">partial_order</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>

<span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">semilattice_inf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span> <span class="o">{</span>
    <span class="n">inf_le_left</span> <span class="c1">--: ∀ a b : α, a ⊓ b ≤ a</span>
      <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="k">by</span> <span class="n">exact</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">inf_le_left</span> <span class="n">a</span><span class="bp">.</span><span class="n">val</span> <span class="n">b</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
    <span class="n">inf</span> <span class="o">:=</span> <span class="o">(</span><span class="err">⊓</span><span class="o">),</span>
    <span class="n">le</span> <span class="o">:=</span> <span class="o">(</span><span class="bp">≤</span><span class="o">),</span>
    <span class="n">le_refl</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_refl</span> <span class="n">a</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
    <span class="n">le_trans</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">,</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_trans</span> <span class="n">a</span><span class="bp">.</span><span class="n">val</span> <span class="n">b</span><span class="bp">.</span><span class="n">val</span> <span class="n">c</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
    <span class="n">le_antisymm</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span>
    <span class="k">begin</span>
      <span class="n">convert</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_antisymm</span> <span class="n">a</span><span class="bp">.</span><span class="n">val</span> <span class="n">b</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
      <span class="n">convert</span> <span class="n">rfl</span><span class="o">,</span>
      <span class="n">apply</span> <span class="n">propext</span><span class="o">,</span>
      <span class="n">split</span><span class="o">,</span>
        <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
        <span class="n">apply</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span><span class="o">,</span>
        <span class="n">apply</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
      <span class="n">rw</span> <span class="n">h1</span> <span class="n">h2</span> <span class="n">h3</span><span class="o">,</span>
    <span class="kn">end</span><span class="o">,</span>
    <span class="n">inf_le_right</span> <span class="c1">--: ∀ a b : α, a ⊓ b ≤ b</span>
      <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">inf_le_right</span> <span class="n">a</span><span class="bp">.</span><span class="n">val</span> <span class="n">b</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span><span class="c1">--sorry,</span>
    <span class="n">le_inf</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">,</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">le_inf</span> <span class="n">a</span><span class="bp">.</span><span class="n">val</span> <span class="n">b</span><span class="bp">.</span><span class="n">val</span> <span class="n">c</span><span class="bp">.</span><span class="n">val</span><span class="o">,</span>
  <span class="o">}</span>

<span class="n">def</span> <span class="n">presheaf_on_opens</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">presheaf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">&lt;=</span> <span class="n">U</span><span class="o">}</span>

<span class="kn">structure</span> <span class="n">morphism</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">map</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">V</span> <span class="o">:</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}),</span> <span class="n">F</span><span class="bp">.</span><span class="n">F</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">G</span><span class="bp">.</span><span class="n">F</span> <span class="n">V</span><span class="o">)</span>
<span class="o">(</span><span class="n">commutes</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">V</span> <span class="n">W</span> <span class="o">:</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">})</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">),</span>
  <span class="n">map</span> <span class="n">W</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">G</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="o">(</span><span class="n">map</span> <span class="n">V</span> <span class="n">x</span><span class="o">))</span>

<span class="kn">namespace</span> <span class="n">morphism</span>

<span class="kn">definition</span> <span class="n">commutes&#39;</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">V</span> <span class="n">W</span> <span class="o">:</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">})</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">F</span><span class="bp">.</span><span class="n">F</span> <span class="n">V</span><span class="o">),</span>
  <span class="n">f</span><span class="bp">.</span><span class="n">map</span> <span class="n">W</span> <span class="o">((</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">G</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="o">((</span><span class="n">f</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span>
<span class="o">:=</span> <span class="k">begin</span> <span class="n">intros</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HVW</span><span class="o">,</span> <span class="n">funext</span> <span class="n">x</span><span class="o">,</span> <span class="n">apply</span> <span class="n">f</span><span class="bp">.</span><span class="n">commutes</span> <span class="kn">end</span>

<span class="n">def</span> <span class="n">commutes&#39;&#39;</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="o">(</span><span class="n">V</span> <span class="n">W</span> <span class="o">:</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">})</span> <span class="o">(</span><span class="n">HWV</span> <span class="o">:</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">V</span><span class="o">),</span>
  <span class="n">f</span><span class="bp">.</span><span class="n">map</span> <span class="n">W</span> <span class="err">∘</span> <span class="o">(</span><span class="n">F</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span><span class="o">)</span> <span class="bp">=</span> <span class="n">G</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="err">∘</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span><span class="o">)</span>
<span class="o">:=</span> <span class="k">begin</span> <span class="n">intros</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HVW</span><span class="o">,</span> <span class="n">funext</span> <span class="n">x</span><span class="o">,</span> <span class="n">apply</span> <span class="n">f</span><span class="bp">.</span><span class="n">commutes</span> <span class="kn">end</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">id</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">F</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span>
  <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span><span class="o">,</span> <span class="k">by</span> <span class="n">intros</span><span class="bp">;</span> <span class="n">refl</span><span class="o">}</span>


<span class="n">def</span> <span class="n">comp</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">G</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">ξ</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">H</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">x</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="o">(</span><span class="n">ξ</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">x</span><span class="o">),</span>
  <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span><span class="o">,</span> <span class="k">begin</span>
    <span class="n">intro</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">commutes&#39;</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span> <span class="n">ξ</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">commutes&#39;</span> <span class="n">U</span> <span class="n">G</span> <span class="n">H</span> <span class="n">η</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">}</span>


<span class="bp">@</span><span class="o">[</span><span class="n">extensionality</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">ext</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">{</span><span class="n">η</span> <span class="n">ξ</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">}</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">V</span> <span class="n">x</span><span class="o">,</span> <span class="n">η</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">ξ</span><span class="bp">.</span><span class="n">map</span> <span class="n">V</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">η</span> <span class="bp">=</span> <span class="n">ξ</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">cases</span> <span class="n">η</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">ξ</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">ext</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">H</span>


<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">id_comp</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comp</span> <span class="n">U</span> <span class="o">(</span><span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">U</span> <span class="n">G</span><span class="o">)</span> <span class="n">η</span> <span class="bp">=</span> <span class="n">η</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">comp_id</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comp</span> <span class="n">U</span> <span class="n">η</span> <span class="o">(</span><span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">U</span> <span class="n">F</span><span class="o">)</span> <span class="bp">=</span> <span class="n">η</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">refl</span><span class="o">,</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">comp_assoc</span> <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">{</span><span class="n">H</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">}</span>
  <span class="o">(</span><span class="n">η</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">H</span> <span class="n">I</span><span class="o">)</span> <span class="o">(</span><span class="n">ξ</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">G</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">χ</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comp</span> <span class="n">U</span> <span class="o">(</span><span class="n">comp</span> <span class="n">U</span> <span class="n">η</span> <span class="n">ξ</span><span class="o">)</span> <span class="n">χ</span> <span class="bp">=</span> <span class="n">comp</span> <span class="n">U</span> <span class="n">η</span> <span class="o">(</span><span class="n">comp</span> <span class="n">U</span> <span class="n">ξ</span> <span class="n">χ</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">rfl</span>

<span class="kn">end</span> <span class="n">morphism</span>

<span class="kn">structure</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">G</span> <span class="o">:</span> <span class="n">presheaf_on_opens</span> <span class="n">U</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">to_fun</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">F</span> <span class="n">G</span><span class="o">)</span>
<span class="o">(</span><span class="n">inv_fun</span> <span class="o">:</span> <span class="n">morphism</span> <span class="n">U</span> <span class="n">G</span> <span class="n">F</span><span class="o">)</span>
<span class="o">(</span><span class="n">left_inv</span> <span class="o">:</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">comp</span> <span class="n">U</span> <span class="n">inv_fun</span> <span class="n">to_fun</span> <span class="bp">=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">U</span> <span class="n">F</span><span class="o">)</span>
<span class="o">(</span><span class="n">right_inv</span> <span class="o">:</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">comp</span> <span class="n">U</span> <span class="n">to_fun</span> <span class="n">inv_fun</span> <span class="bp">=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span> <span class="n">U</span> <span class="n">G</span><span class="o">)</span>

<span class="bp">#</span><span class="kn">exit</span>

<span class="n">def</span> <span class="n">universal_property</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">presheaf_on_opens</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)))</span> <span class="o">:</span>
<span class="bp">∀</span> <span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">,</span> <span class="n">equiv</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">glue</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">Hφ1</span> <span class="n">Hφ2</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">$</span> <span class="n">opens</span><span class="bp">.</span><span class="n">subset_Union</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>


<span class="kn">end</span> <span class="n">semilattice_inf</span><span class="bp">.</span><span class="n">opens</span>
</pre></div>


<p>That's the equiv in Mario's non-category language, using Kenny's trick. Now I can start to formalise the universal property for glueing.</p>

<a name="168786844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786844" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786844">Kevin Buzzard (Jun 23 2019 at 09:38)</a>:</h4>
<p>This is with <code>def presheaf_on_opens (U : α) := presheaf {V // V &lt;= U}</code></p>

<a name="168786860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786860" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786860">Mario Carneiro (Jun 23 2019 at 09:39)</a>:</h4>
<p>Why do you have a proof of <code>partial_order</code> and then not use it for <code>semilattice_inf</code>?</p>

<a name="168786864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786864">Kevin Buzzard (Jun 23 2019 at 09:39)</a>:</h4>
<p>Because I don't know what I'm doing.</p>

<a name="168786866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786866" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786866">Kevin Buzzard (Jun 23 2019 at 09:39)</a>:</h4>
<p>I'm behaving quite algorithmically still, I'm not thinking much.</p>

<a name="168786910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786910" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786910">Mario Carneiro (Jun 23 2019 at 09:40)</a>:</h4>
<p>I think that if you leave off the fields they get inferred automatically</p>

<a name="168786914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786914" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786914">Kevin Buzzard (Jun 23 2019 at 09:40)</a>:</h4>
<p>I was having trouble getting this to work.</p>

<a name="168786917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786917" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786917">Kevin Buzzard (Jun 23 2019 at 09:40)</a>:</h4>
<p>Which lines do you think I can delete?</p>

<a name="168786922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786922" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786922">Mario Carneiro (Jun 23 2019 at 09:40)</a>:</h4>
<p>if not, you can use <code>..(by apply_instance : partial_order {V // V ≤ U})</code> at the end</p>

<a name="168786935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786935">Mario Carneiro (Jun 23 2019 at 09:41)</a>:</h4>
<p>the ones associated to partial_order, so le, le_trans, le_antisymm etc</p>

<a name="168786977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168786977" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168786977">Mario Carneiro (Jun 23 2019 at 09:42)</a>:</h4>
<p>you can do the same thing with <code>has_inf</code>, although that doesn't save a whole lot</p>

<a name="168787186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168787186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168787186">Kevin Buzzard (Jun 23 2019 at 09:49)</a>:</h4>
<p>Here's the current state of my work:</p>
<p><a href="https://github.com/kbuzzard/xena/blob/master/Examples/mario_glueing.lean" target="_blank" title="https://github.com/kbuzzard/xena/blob/master/Examples/mario_glueing.lean">https://github.com/kbuzzard/xena/blob/master/Examples/mario_glueing.lean</a></p>
<p>I just can't get the deleting to work. I don't understand structure field inheritence well enough and I can never remember the tricks; there are a couple of cool idioms which I'm sure will help me.</p>

<a name="168787507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168787507" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168787507">Mario Carneiro (Jun 23 2019 at 09:57)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">order</span><span class="bp">.</span><span class="n">lattice</span>
<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="kn">open</span> <span class="n">lattice</span>

<span class="kn">instance</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">semilattice_inf</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">semilattice_inf</span> <span class="o">{</span><span class="n">V</span> <span class="bp">//</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">}</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">inf_le_left</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">inf_le_left</span><span class="o">,</span>
  <span class="n">inf</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">a</span><span class="bp">.</span><span class="mi">1</span> <span class="err">⊓</span> <span class="n">b</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">a</span><span class="bp">.</span><span class="mi">2</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="n">inf_le_right</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">inf_le_right</span><span class="o">,</span>
  <span class="n">le_inf</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="o">,</span> <span class="n">le_inf</span><span class="o">,</span>
  <span class="bp">..</span><span class="n">subtype</span><span class="bp">.</span><span class="n">partial_order</span> <span class="bp">_</span> <span class="o">}</span>
</pre></div>

<a name="168787557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168787557" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168787557">Kevin Buzzard (Jun 23 2019 at 09:58)</a>:</h4>
<p>Thanks.</p>

<a name="168788041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788041">Reid Barton (Jun 23 2019 at 10:13)</a>:</h4>
<blockquote>
<p>Anyway, that's got nothing to do with what I'm doing, what I'm doing is wondering whether the natural domain for glueing sheaves of types is complete lattices.</p>
</blockquote>
<p>Probably it is <a href="https://ncatlab.org/nlab/show/locale#definitions" target="_blank" title="https://ncatlab.org/nlab/show/locale#definitions">frames</a>, though as noted there a frame is also a complete lattice. I see you two already have something called <code>semilattice_inf_lub_emb</code>, which is an embedding that's a frame homomorphism.<br>
Also see "Relation to topological spaces", and Definition 4.9 and following.</p>

<a name="168788085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788085" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788085">Kevin Buzzard (Jun 23 2019 at 10:14)</a>:</h4>
<p>Do we have frames in mathlib?</p>

<a name="168788179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788179" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788179">Kenny Lau (Jun 23 2019 at 10:17)</a>:</h4>
<p>can we glue sheaves on sites?</p>

<a name="168788186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788186">Kevin Buzzard (Jun 23 2019 at 10:17)</a>:</h4>
<p>We can't glue anything on anything right now</p>

<a name="168788226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788226" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788226">Kevin Buzzard (Jun 23 2019 at 10:18)</a>:</h4>
<p>But in maths land I should think you can glue sheaves on sites.</p>

<a name="168788235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788235" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788235">Kevin Buzzard (Jun 23 2019 at 10:18)</a>:</h4>
<p>Even type-v-indexed sheaves, I should think.</p>

<a name="168788322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788322">Mario Carneiro (Jun 23 2019 at 10:22)</a>:</h4>
<p>Maybe it might help to actually try using this thing rather than working so much to state an axiom</p>

<a name="168788356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168788356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168788356">Mario Carneiro (Jun 23 2019 at 10:22)</a>:</h4>
<p>I still have no idea if this is the best way to glue things when we have choice</p>

<a name="168792688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168792688" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168792688">Jesse Michael Han (Jun 23 2019 at 12:39)</a>:</h4>
<blockquote>
<p>Do we have frames in mathlib?</p>
</blockquote>
<p>no, but they would be easy to define</p>
<p>a caveat: <code>complete_lattice</code> bundles together <code>Sup</code> and <code>Inf</code>, and <code>complete_distrib_lattice</code> bundles together distributivity of sup over Inf and inf over Sup, so we might have to refine the hierarchy before implementing frames</p>

<a name="168793081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168793081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168793081">Kevin Buzzard (Jun 23 2019 at 12:51)</a>:</h4>
<p>So I've done a bunch of Kenny's API, but stopped just short of defining the glued sheaf.</p>
<p><a href="https://github.com/kbuzzard/xena/blob/b4994ccfa949a1586e9119ce8fefdd2b656647f9/Examples/mario_glueing.lean#L197" target="_blank" title="https://github.com/kbuzzard/xena/blob/b4994ccfa949a1586e9119ce8fefdd2b656647f9/Examples/mario_glueing.lean#L197">https://github.com/kbuzzard/xena/blob/b4994ccfa949a1586e9119ce8fefdd2b656647f9/Examples/mario_glueing.lean#L197</a></p>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I didn't use <code>res'</code> at all. How should I have done this better?</p>

<a name="168793138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168793138" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168793138">Mario Carneiro (Jun 23 2019 at 12:52)</a>:</h4>
<p>if there is a nontrivial proof in a statement, the answer is yes</p>

<a name="168794153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168794153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168794153">Kenny Lau (Jun 23 2019 at 13:24)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">opens</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">X</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">topological_space</span> <span class="n">X</span><span class="o">]</span> <span class="o">{</span><span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">S</span> <span class="n">T</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">}</span>

<span class="kn">theorem</span> <span class="n">subset</span><span class="bp">.</span><span class="n">refl</span> <span class="o">:</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">U</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">refl</span> <span class="n">U</span>
<span class="kn">theorem</span> <span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="o">:</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">W</span> <span class="bp">→</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">W</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span>
<span class="kn">theorem</span> <span class="n">inter_subset_left</span> <span class="o">:</span> <span class="n">U</span> <span class="err">∩</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">U</span><span class="bp">.</span><span class="mi">1</span> <span class="n">V</span><span class="bp">.</span><span class="mi">1</span>
<span class="kn">theorem</span> <span class="n">inter_subset_right</span> <span class="o">:</span> <span class="n">U</span> <span class="err">∩</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">V</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_right</span> <span class="n">U</span><span class="bp">.</span><span class="mi">1</span> <span class="n">V</span><span class="bp">.</span><span class="mi">1</span>
<span class="kn">theorem</span> <span class="n">subset_inter</span> <span class="o">:</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">W</span> <span class="bp">→</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">V</span> <span class="err">∩</span> <span class="n">W</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">subset_inter</span>
<span class="kn">theorem</span> <span class="n">inter_subset_inter_left</span> <span class="o">:</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">U</span> <span class="err">∩</span> <span class="n">W</span> <span class="err">⊆</span> <span class="n">V</span> <span class="err">∩</span> <span class="n">W</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_left</span> <span class="n">W</span><span class="bp">.</span><span class="mi">1</span>
<span class="kn">theorem</span> <span class="n">inter_subset_inter_right</span> <span class="o">:</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">W</span> <span class="bp">→</span> <span class="n">U</span> <span class="err">∩</span> <span class="n">V</span> <span class="err">⊆</span> <span class="n">U</span> <span class="err">∩</span> <span class="n">W</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="n">U</span><span class="bp">.</span><span class="mi">1</span>
<span class="kn">theorem</span> <span class="n">inter_subset_inter</span> <span class="o">:</span> <span class="n">U</span> <span class="err">⊆</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">S</span> <span class="err">⊆</span> <span class="n">T</span> <span class="bp">→</span> <span class="n">U</span> <span class="err">∩</span> <span class="n">S</span> <span class="err">⊆</span> <span class="n">V</span> <span class="err">∩</span> <span class="n">T</span> <span class="o">:=</span> <span class="n">set</span><span class="bp">.</span><span class="n">inter_subset_inter</span>

<span class="kn">end</span> <span class="n">opens</span>

<span class="n">def</span> <span class="n">glue</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="bp">_</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">Union</span> <span class="n">S</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">F</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">W</span><span class="o">,</span> <span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="bp">//</span>
      <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
          <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
          <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span>
        <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">∩</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
          <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
          <span class="o">(</span><span class="n">f</span> <span class="n">j</span><span class="o">)</span> <span class="o">},</span>
    <span class="n">res</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">HVU</span> <span class="n">f</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">i</span><span class="o">),</span> <span class="bp">λ</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span>
      <span class="k">calc</span>  <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
              <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span>
                <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
                <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
                    <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
                <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
                    <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="n">HVU</span><span class="o">)</span>
                    <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">i</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
          <span class="bp">=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
              <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
                <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span>
                <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
                <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="n">HVU</span><span class="o">)</span>
                <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span>
                  <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
                  <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
                      <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
                  <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)))</span> <span class="o">:</span>
        <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="n">res</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="n">HVU</span><span class="o">)</span>
              <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
                <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span>
                  <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
                  <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)</span>
                      <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
                  <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span><span class="o">)))</span> <span class="o">:</span>
        <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">commutes</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span>
      <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span>
              <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
              <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset_inter</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">subset</span><span class="bp">.</span><span class="n">trans</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
                <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_right</span><span class="o">)</span>
              <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">U</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_left</span>
                <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">inter_subset_inter_right</span> <span class="n">HVU</span><span class="o">)</span>
                <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">val</span> <span class="n">j</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">∩</span> <span class="n">S</span> <span class="n">j</span> <span class="err">∩</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:</span>
        <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">f</span><span class="bp">.</span><span class="mi">2</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">Hid</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
    <span class="n">Hcomp</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">},</span>
  <span class="n">locality</span> <span class="o">:=</span> <span class="n">sorry</span><span class="o">,</span>
  <span class="n">gluing</span> <span class="o">:=</span> <span class="n">sorry</span> <span class="o">}</span>
</pre></div>

<a name="168794154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168794154" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168794154">Kenny Lau (Jun 23 2019 at 13:25)</a>:</h4>
<p>I have |no idea| what I was doing</p>

<a name="168794352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168794352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168794352">Kenny Lau (Jun 23 2019 at 13:31)</a>:</h4>
<p>I should extract defs/lemmas</p>

<a name="168802279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168802279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168802279">Johan Commelin (Jun 23 2019 at 17:54)</a>:</h4>
<p>Why are you using the <code>\cap</code> and <code>\cup</code> notation? Isn't it a lot easier to use the lattice notation? Saves you all those little lemmas at the top as well.</p>

<a name="168802821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168802821" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168802821">Kevin Buzzard (Jun 23 2019 at 18:11)</a>:</h4>
<p>Kenny I refactored your code so that it works for complete lattices</p>

<a name="168802864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168802864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168802864">Kevin Buzzard (Jun 23 2019 at 18:12)</a>:</h4>
<p>That's quite some <code>calc</code> by the way!</p>

<a name="168831876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168831876" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168831876">Patrick Massot (Jun 24 2019 at 08:41)</a>:</h4>
<p>I didn't read code in this thread, but I just want to tell Kevin: Johannes explained countless times why there are lattices all other mathlib. This is category theory that actually works and helps. Up to now nobody managed to make category theory usable in Lean. In Edinburgh I asked Scott and Reid to show me how to define the category of uniform spaces, the subcategory of complete separated uniform spaces, and the completion functor (all of this is already in mathlib, unbundled and without using category theory). They couldn't. Defining categories was ok, but then they hit the weirdest kinds of bugs, with Lean randomly unfolding things beyond recognition. </p>
<p>Also when I changed the order on <code>topological_space</code> and <code>uniform_space</code> last week, I had to change 16 files. After setting up the change correctly in the first file it was a smooth ride all along except for <code>topology/Top/limits.lean</code> which got me amazingly confused, because the statements and intermediate goals were undecipherable to me. </p>
<p>Now there is one kind of category that works in Lean: posets. Setting up is easy, functor work (monotone maps) adjunctions work (the Galois connection thing), limits and colimits work (<code>infi</code> and <code>supr</code>). And many many lemmas in <code>topology</code> are really proven in a categorical way using this trick. If you think complete lattices is computer science (as I also did before Johannes explained it) then category theory is computer science.</p>

<a name="168831952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168831952" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168831952">Kevin Buzzard (Jun 24 2019 at 08:42)</a>:</h4>
<p><code>category theory is computer science.</code> I think that too, kind of.</p>

<a name="168832144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168832144" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168832144">Kevin Buzzard (Jun 24 2019 at 08:46)</a>:</h4>
<p>So categories with general type-valued homs are hard to work with in dependent type theory, because the morphism isn't actually a function, so we lose some powerful flexibility. Types and morphisms between them (the category Type) are fine though because these are pi-type-valued homs. Patrick is saying that terms and Prop-valued homs are also a good fit for dependent type theory.</p>

<a name="168832790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168832790" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168832790">Kevin Buzzard (Jun 24 2019 at 08:57)</a>:</h4>
<p>It's all beginning to make some sense to me. But in some sense this should just be an interface issue, right?</p>

<a name="168833357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833357" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833357">Johan Commelin (Jun 24 2019 at 09:06)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> I'm sad to hear that story</p>

<a name="168833383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833383">Kevin Buzzard (Jun 24 2019 at 09:07)</a>:</h4>
<p>I don't know how much is interface and how much is "Lean could do better".</p>

<a name="168833468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833468" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833468">Mario Carneiro (Jun 24 2019 at 09:09)</a>:</h4>
<p>This is kind of why I was against moving Scott's category library into mathlib to start with. I think it's improved a lot since then, but it still is sorely lacking in applications</p>

<a name="168833555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833555" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833555">Kevin Buzzard (Jun 24 2019 at 09:10)</a>:</h4>
<p>Every time we try something it's kind of "oh well, probably it can be made to work, but let's just do it the easy way because that's all we need".</p>

<a name="168833575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833575">Mario Carneiro (Jun 24 2019 at 09:10)</a>:</h4>
<p>All the work thus far has been to write things as categories, but all the sharing goes one way only. We need to figure out how to prove something that does not directly use categories via category theory</p>

<a name="168833585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833585" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833585">Kevin Buzzard (Jun 24 2019 at 09:11)</a>:</h4>
<p>For etale cohomology I am unclear about how much we can get away with.</p>

<a name="168833594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833594" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833594">Mario Carneiro (Jun 24 2019 at 09:11)</a>:</h4>
<p>Notice that orders and lattices are at the <em>very bottom</em> of the mathlib dependency structure</p>

<a name="168833692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833692" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833692">Mario Carneiro (Jun 24 2019 at 09:12)</a>:</h4>
<p>I think there is a good argument that once you start dealing with 2-categorical notions you should probably use category theory to organize stuff</p>

<a name="168833713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833713" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833713">Kevin Buzzard (Jun 24 2019 at 09:13)</a>:</h4>
<p>The moment homs are not Props, basically.</p>

<a name="168833727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833727">Mario Carneiro (Jun 24 2019 at 09:13)</a>:</h4>
<p>right</p>

<a name="168833769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833769" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833769">Mario Carneiro (Jun 24 2019 at 09:13)</a>:</h4>
<p>Your <code>glue</code> and <code>universal_property</code> theorems look like that</p>

<a name="168833823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833823">Mario Carneiro (Jun 24 2019 at 09:14)</a>:</h4>
<p>so I'm hoping that we can maybe use this as a case study for practical use of category theory</p>

<a name="168833850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833850">Mario Carneiro (Jun 24 2019 at 09:15)</a>:</h4>
<p>Yes, we can do it without category theory, but the current solutions look pretty scary. Let's see what the alternative is</p>

<a name="168833894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168833894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168833894">Mario Carneiro (Jun 24 2019 at 09:15)</a>:</h4>
<p>try it both ways and let the best infrastructure win</p>

<a name="168838215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168838215" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168838215">Scott Morrison (Jun 24 2019 at 10:35)</a>:</h4>
<blockquote>
<p>I didn't read code in this thread, but I just want to tell Kevin: Johannes explained countless times why there are lattices all other mathlib. This is category theory that actually works and helps. Up to now nobody managed to make category theory usable in Lean. In Edinburgh I asked Scott and Reid to show me how to define the category of uniform spaces, the subcategory of complete separated uniform spaces, and the completion functor (all of this is already in mathlib, unbundled and without using category theory). They couldn't. Defining categories was ok, but then they hit the weirdest kinds of bugs, with Lean randomly unfolding things beyond recognition. </p>
</blockquote>
<p>I'm pretty surprised by this characterisation. My memory was rather than we stopped defining the adjunction <code>def adj : completion_functor ⊣ forget_to_UniformSpace</code> because we realised there was a lemma about completions that hadn't been proved yet. I haven't looked at this since that afternoon in Edinburgh, but the branch <code>category-of-uniform-spaces</code> seems to have what we did then, with a single sorry at that point.</p>

<a name="168838309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168838309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168838309">Scott Morrison (Jun 24 2019 at 10:37)</a>:</h4>
<p>I do remember some problem with Lean being over eager about unfolding. Unfortunately I can't see it still there.</p>

<a name="168838505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168838505" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168838505">Scott Morrison (Jun 24 2019 at 10:40)</a>:</h4>
<p>The file we wrote that afternoon is <a href="https://github.com/leanprover-community/mathlib/blob/category-of-uniform-spaces/src/topology/uniform_space/UniformSpace.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/category-of-uniform-spaces/src/topology/uniform_space/UniformSpace.lean">here</a>.</p>

<a name="168841185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841185" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841185">Kevin Buzzard (Jun 24 2019 at 11:30)</a>:</h4>
<p>Patrick can be a bit cynical at times :-) But the point remains. The last time I talked to you about sheaves you said "we've got presheaves, I just need to figure out a neat way of doing the sheaf condition which is not ugly". But in this low-level approach here we just write stuff down and it works. There's a trick to finding out a good way to write it down, but once you have a good working basic set of definitions it's really good fun to build an API and then "prove some lemmas" (like the "lemma" that you can glue sheaves, which I would say to CS people was a definition, but I would call it a theorem to maths people) and watch the API become robust. I guess the theorem is that a universal object exists.</p>
<p>I am still unclear about whether the problem is having Hom(X,Y) =  inductive type, or whether the problem is that Lean 3 is not very good at categories because of design decisions which we're having to fight against.</p>
<p>I mentioned issues with categories to Tom Hales at AITP and he said "well as far as I know Coq doesn't have any issues with them, I believe they have a nice category theory library" (I'm paraphrasing but that's my memory of what he said). Is this true? Can they do things better than us here? Where is this library? There is all this talk of not knowing how best to implement diagrams -- how do they do it in Coq?</p>

<a name="168841196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841196">Kevin Buzzard (Jun 24 2019 at 11:30)</a>:</h4>
<p>This deserves a new thread really.</p>

<a name="168841542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841542" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841542">Mario Carneiro (Jun 24 2019 at 11:36)</a>:</h4>
<p>I don't think there are any fundamental issues with using categories any more than any other branch of maths</p>

<a name="168841584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841584">Mario Carneiro (Jun 24 2019 at 11:37)</a>:</h4>
<p>I think people just aren't doing it, because you and I prefer to work without them and Scott and Reid prefer to work on categories as the endpoint</p>

<a name="168841709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841709" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841709">Mario Carneiro (Jun 24 2019 at 11:39)</a>:</h4>
<p>stuff like proving that uniform spaces form a category is utterly uninteresting to me. Of course you can do it. It gets interesting when you prove something that's not a triviality in an area that's not category theory using this gigantic library that's being developed. If you can't do that then it just looks like a bridge to nowhere from my point of view</p>

<a name="168841812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841812" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841812">Kevin Buzzard (Jun 24 2019 at 11:40)</a>:</h4>
<p>Categories lead to questions about universes which are not there in other branches of maths (at least when maths is done by mathematicians), and one question is how well Lean solves those issues. </p>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110032">@Reid Barton</span> how would glueing <em>presheaves</em> on open subsets look in the category theory library? Already it was causing us problems down in the land where the objects were terms and the morphisms were in Prop, but we have this workaround now (analogous to what they did in the odd order repo when they worked with subgroups of a big ambient group because it was more convenient). I find this approach rather distasteful in some sense, but then again these CS people seem to prefer computational efficiency to the abstract approach.</p>

<a name="168841932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841932" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841932">Kevin Buzzard (Jun 24 2019 at 11:42)</a>:</h4>
<p>Kenny's code above</p>
<p><a href="#narrow/stream/116395-maths/topic/breaking.20equality.20with.20sheaves/near/168794153" title="#narrow/stream/116395-maths/topic/breaking.20equality.20with.20sheaves/near/168794153">https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking.20equality.20with.20sheaves/near/168794153</a></p>
<p>is the definition of a glued presheaf, but he has not proved the universal property. <span class="user-mention" data-user-id="110064">@Kenny Lau</span> Can you formulate the universal property for a glued presheaf? That's what we have right now.</p>

<a name="168841943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168841943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168841943">Kevin Buzzard (Jun 24 2019 at 11:43)</a>:</h4>
<p>oh -- it is probably exactly the same as the universal property for a glued sheaf isn't it.</p>

<a name="168842002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842002">Kevin Buzzard (Jun 24 2019 at 11:43)</a>:</h4>
<p>Then we will have proved a theorem about glued presheaves, namely that there exists an object having the universal property for glued presheaves. This has turned out to be a great test of various foundational set-ups.</p>

<a name="168842096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842096" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842096">Kevin Buzzard (Jun 24 2019 at 11:45)</a>:</h4>
<p>People didn't see the nightmares I had because in the main I didn't post them. But I did hint about having to interpret U intersect V as an object of opens U, opens V, opens U intersect V and opens X. With the Kenny/Mario approach there is only one U intersect V. Can this trick be pulled off in the category theory set-up?</p>

<a name="168842458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842458">Reid Barton (Jun 24 2019 at 11:50)</a>:</h4>
<p>Just regarding the subject of using category theory. <a href="https://github.com/rwbarton/lean-homotopy-theory" target="_blank" title="https://github.com/rwbarton/lean-homotopy-theory">https://github.com/rwbarton/lean-homotopy-theory</a> is over 8000 lines and almost all of it is built on top of category theory: either to do homotopy theory in a general category (with additional structure) or to prove things about Top which are hard to even state without category theory (for example, the pushout of a closed embedding is a closed embedding). For context, it is larger than the amount of category theory in mathlib.</p>

<a name="168842511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842511" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842511">Kevin Buzzard (Jun 24 2019 at 11:51)</a>:</h4>
<p>Do you have any of presheaves, sheaves, glueing sheaves, sheafification? Or do you not need sheaves at all for this stuff?</p>

<a name="168842513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842513">Mario Carneiro (Jun 24 2019 at 11:51)</a>:</h4>
<p>You know how Kevin says everything is CS? That still sounds like category theory to me</p>

<a name="168842745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842745">Reid Barton (Jun 24 2019 at 11:55)</a>:</h4>
<blockquote>
<p>Do you have any of presheaves, sheaves, glueing sheaves, sheafification? Or do you not need sheaves at all for this stuff?</p>
</blockquote>
<p>No, these didn't come up in what I was doing</p>

<a name="168842972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168842972" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168842972">Reid Barton (Jun 24 2019 at 11:59)</a>:</h4>
<blockquote>
<p>You know how Kevin says everything is CS? That still sounds like category theory to me</p>
</blockquote>
<p>This is kind of like saying algebraic geometry is not math but rather French, because EGA is written in French</p>

<a name="168843166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168843166" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168843166">Reid Barton (Jun 24 2019 at 12:02)</a>:</h4>
<p>Using the language of category theory to study subject X doesn't make subject X into category theory</p>

<a name="168843268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168843268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168843268">Reid Barton (Jun 24 2019 at 12:04)</a>:</h4>
<p>And maybe it's particularly convenient to apply category theory to algebraic topology (considering that category theory was invented for the purpose of algebraic topology in the first place) but in any case it can be done.</p>

<a name="168891115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168891115" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168891115">Scott Morrison (Jun 24 2019 at 22:37)</a>:</h4>
<blockquote>
<p>Scott and Reid prefer to work on categories as the endpoint</p>
</blockquote>
<p>I don't think this is true at all, and to tell the truth I'm a bit annoyed at this. I worked on an API for limits because it seemed essential for ever doing the basics of sheaf theory, or the basics of homological algebra, or the basics of algebraic topology, without endlessly repeating yourself in slight variations. None of these are subjects that I'm particularly interested in directly, but I was trying to be helpful, because it seemed there was interest in those directions.</p>
<p>It's true that my "day job" research is about things like modular tensor categories. But it is a pretty bad error to think that these things are "part of category theory" in the sense of boring 20th category theory that exists in mathlib at the moment and that we are discussing here. Modular tensor categories are mathematical objects more like ... I don't know schemes or something. Everyone will use category theoretic language to describe the axioms, but at the end of the day they are actually pretty alien to "category theory". They are completely finitary objects (finitely much algebraic data, over a number field), and to study them you use combinatorics and topology and representation theory and little bits of number theory: far from the abstract nonsense!</p>

<a name="168891342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168891342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168891342">Scott Morrison (Jun 24 2019 at 22:41)</a>:</h4>
<p>Regarding the category of uniform spaces, <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, <span class="user-mention" data-user-id="110031">@Patrick Massot</span>, I agree that's completely boring. We did it because Patrick asked to see how it was done. I agree it was annoying that afternoon that we ran into some still-mysterious Lean 'feature' involving unwanted unfolding. But besides that I thought that exercise was mostly a success. Reid and I got distracted at the end of the discussion trying to work out how to use reflective subcategories, but the file at the end was what Patrick had asked for, modulo one sorry (that was actually about uniform spaces).</p>

<a name="168891541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168891541" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168891541">Mario Carneiro (Jun 24 2019 at 22:44)</a>:</h4>
<p>Fair enough. I would hope that these applications are not some giant years-from-now endpoint though; you should be able to give some near term applications as well. Without applications it's far too easy to build things the wrong way and not realize it's useless until you actually get to that application at the end of the road</p>

<a name="168891596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168891596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168891596">Mario Carneiro (Jun 24 2019 at 22:46)</a>:</h4>
<p>But I think you won't be surprised that I can't tell the difference between "modular tensor categories" and "category theory" :P</p>

<a name="168892082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168892082" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168892082">Scott Morrison (Jun 24 2019 at 22:54)</a>:</h4>
<p>Regarding sheaf-y stuff. I think a great test case is whether the stuff you're building works for sheaves of topological rings. This is not some esoteric corner case: people have to think about these constantly. And they are a great example where you can't just spend all your time thinking about the underlying sheaf of types, because that's not enough! (There are presheaves of topological rings, whose underlying presheaf of types satisfies the sheaf condition, but does not itself.) I'm worried that if you don't attempt to do this at the correct level of generality, then there's going to be endless repetition (sheaves of types, sheaves of rings, sheaves of topological spaces, sheaves of topological rings), and you'll find yourself having to talk about gluing separately and with slight variations in all the cases, and it will turn into a nightmare. But this isn't my subject, so perhaps I'm mistaking the fact that every source for this stuff uses category theoretic language to describe the sheaf condition for necessity.... :-)</p>

<a name="168892265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168892265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168892265">Reid Barton (Jun 24 2019 at 22:57)</a>:</h4>
<p>I still worry a bit that I don't know a math definition which encompasses both this example of sheaves of topological rings (on a topological space or whatever) and also sheaves on a general site.</p>

<a name="168892373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168892373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168892373">Reid Barton (Jun 24 2019 at 22:59)</a>:</h4>
<blockquote>
<p>But I think you won't be surprised that I can't tell the difference between "modular tensor categories" and "category theory" :P</p>
</blockquote>
<p>Next you'll be telling me you can't tell the difference between "model categories" and "category theory", sheesh!</p>

<a name="168913759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168913759" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168913759">Kevin Buzzard (Jun 25 2019 at 06:46)</a>:</h4>
<p>Unfortunately I'm just as ignorant here. I've only ever had to use the most basic notions of category theory in my day job (representable functors). What's the problem with sheaves of topological rings on a site?</p>

<a name="168917010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917010" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917010">Johan Commelin (Jun 25 2019 at 07:56)</a>:</h4>
<p>That a continuous bijection doesn't need to be a homeomorphism</p>

<a name="168917035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917035">Johan Commelin (Jun 25 2019 at 07:56)</a>:</h4>
<p>So you can't ask for some equilizer to be an iso in <code>Type</code>. It really has to be an iso in <code>Top</code> or <code>TopRing</code>.</p>

<a name="168917149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917149" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917149">Kevin Buzzard (Jun 25 2019 at 07:58)</a>:</h4>
<p>I understand that -- my question is what is the problem with sheaves of (insert category here) on a site?</p>

<a name="168917314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917314" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917314">Johan Commelin (Jun 25 2019 at 08:01)</a>:</h4>
<p>I guess there is not that much of a problem, but it means yet another variable in the API.</p>

<a name="168917773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917773" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917773">Kevin Buzzard (Jun 25 2019 at 08:08)</a>:</h4>
<p>Another universe variable? Is that the issue? Why don't we just put everything in the same universe like in normal maths?</p>

<a name="168917803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917803">Scott Morrison (Jun 25 2019 at 08:09)</a>:</h4>
<p>No, no universe variables. :-)</p>

<a name="168917822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917822">Scott Morrison (Jun 25 2019 at 08:09)</a>:</h4>
<p>Johan just meant that it's literally an extra variable to the definition of a sheaf: you have to specify the category the sections live in.</p>

<a name="168917887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917887">Scott Morrison (Jun 25 2019 at 08:10)</a>:</h4>
<p>and you need to ask that the sheaf condition diagram is an equalizer in that category, rather than doing something elementwise.</p>

<a name="168917889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917889" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917889">Kevin Buzzard (Jun 25 2019 at 08:10)</a>:</h4>
<p>I feel like I am always specifying this variable in practice. It was like when the CS people were going "oh noes, you're going to have to say which ring this is a module over" and I was just thinking "that's OK, I know which ring it's a module over"</p>

<a name="168917918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917918">Scott Morrison (Jun 25 2019 at 08:11)</a>:</h4>
<p>or, alternatively, for every different target category you need to write a different version of the sheaf condition, which includes an extra field effectively spelling out: this bijection of the underlying types is actually an isomorphism.</p>

<a name="168917972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917972" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917972">Scott Morrison (Jun 25 2019 at 08:12)</a>:</h4>
<p>I'd assumed way back that everyone would be unhappy with writing out different versions of the sheaf condition for different target categories. (Because then you have to repeat and reprove theorems about sheaves in different target categories.)</p>

<a name="168917981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168917981" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168917981">Kevin Buzzard (Jun 25 2019 at 08:12)</a>:</h4>
<p>I defined a scheme, and that part was pretty easy. But proving that anything at all was a scheme involved some serious messing around with sheaves (and in particular proving that some explicit presheaf satisfied the sheaf axiom). We now have perfectoid spaces, but proving that anything at all is a perfectoid space will be just the same, except that we will have to prove that something is a sheaf of topological rings. So it's on the horizon.</p>

<a name="168918060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168918060" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168918060">Kevin Buzzard (Jun 25 2019 at 08:14)</a>:</h4>
<blockquote>
<p>this bijection of the underlying types is actually an isomorphism.</p>
</blockquote>
<p>Yes, I remember you pointing this out when I was moaning about 10 different notations for "I am an equiv of this kind of structure"</p>

<a name="168918246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168918246" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168918246">Scott Morrison (Jun 25 2019 at 08:17)</a>:</h4>
<p>That one is easy to fix. :-)</p>

<a name="168918255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168918255" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168918255">Scott Morrison (Jun 25 2019 at 08:17)</a>:</h4>
<p>(As long as you're willing to work in a fixed universe, but I don't think that will be a problem for you. :-)</p>

<a name="168919055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919055">Kenny Lau (Jun 25 2019 at 08:31)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">sheaf_glue</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_right</span><span class="o">))</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="bp">_</span><span class="o">))</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
  <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">))</span> <span class="bp">=</span>
  <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">))</span>

<span class="bp">@</span><span class="o">[</span><span class="kn">reducible</span><span class="o">]</span> <span class="n">def</span> <span class="n">compat</span> <span class="o">(</span><span class="n">W</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="bp">//</span>
  <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="n">inf_le_left</span>
    <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
      <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span>
      <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">W</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span>
      <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span>
      <span class="o">(</span><span class="n">f</span> <span class="n">j</span><span class="o">)</span> <span class="o">}</span>

<span class="n">def</span> <span class="n">res</span> <span class="o">(</span><span class="n">U</span> <span class="n">V</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">HVU</span> <span class="o">:</span> <span class="n">V</span> <span class="bp">≤</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span><span class="o">)</span> <span class="o">:</span> <span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">V</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">),</span> <span class="bp">λ</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span>
<span class="k">calc</span>  <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span>
        <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span>
          <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
          <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
              <span class="n">inf_le_right</span><span class="o">)</span>
          <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span>
              <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">HVU</span><span class="o">)</span>
              <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
    <span class="bp">=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span>
        <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span>
          <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span>
          <span class="n">inf_le_left</span>
          <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">HVU</span><span class="o">)</span>
          <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span>
            <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
            <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
                <span class="n">inf_le_right</span><span class="o">)</span>
            <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)))</span> <span class="o">:</span>
  <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span>
        <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span>
        <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span>
          <span class="n">inf_le_right</span><span class="o">)</span>
        <span class="o">(</span><span class="n">res</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span>
          <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">HVU</span><span class="o">)</span>
          <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="mi">1</span> <span class="n">j</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span> <span class="o">:</span>
  <span class="k">by</span> <span class="n">rw</span> <span class="o">[(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">commutes</span><span class="o">,</span> <span class="n">f</span><span class="bp">.</span><span class="mi">2</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span><span class="bp">⟩</span>

<span class="kn">theorem</span> <span class="n">locality</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">OC</span> <span class="o">:</span> <span class="n">covering</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span><span class="o">)</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">i</span><span class="o">)</span> <span class="n">s</span> <span class="bp">=</span>
    <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">i</span><span class="o">)</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">s</span> <span class="bp">=</span> <span class="n">t</span> <span class="o">:=</span>
<span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">locality</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">j</span><span class="o">,</span>
<span class="k">by</span> <span class="k">have</span> <span class="o">:=</span> <span class="n">H</span> <span class="n">j</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">inj_eq</span><span class="o">]</span> <span class="n">at</span> <span class="n">this</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">congr_fun</span> <span class="n">this</span> <span class="n">i</span>

<span class="n">noncomputable</span> <span class="n">def</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">OC</span> <span class="o">:</span> <span class="n">covering</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_right</span> <span class="o">(</span><span class="n">s</span> <span class="n">j</span><span class="o">))</span>
  <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">glue</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">s</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
<span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">),</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">inf_assoc</span><span class="o">,</span> <span class="n">inf_left_comm</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">),</span> <span class="err">←</span> <span class="n">inf_assoc</span><span class="o">,</span> <span class="n">inf_idem</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">le_refl</span> <span class="bp">_</span><span class="o">,</span>
<span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">,</span>
<span class="k">from</span> <span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">inf_le_left</span><span class="o">,</span>
<span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">,</span>
<span class="k">from</span> <span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">,</span>
<span class="k">have</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="n">inf_le_left</span> <span class="n">h2</span> <span class="o">((</span><span class="n">s</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span>
  <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="n">inf_le_left</span> <span class="n">h3</span> <span class="o">((</span><span class="n">s</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">),</span>
<span class="k">from</span> <span class="n">congr_fun</span> <span class="o">(</span><span class="n">congr_arg</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">val</span> <span class="o">(</span><span class="n">H</span> <span class="n">j</span> <span class="n">k</span><span class="o">))</span> <span class="n">i</span><span class="o">,</span>
<span class="k">calc</span>  <span class="bp">_</span>
    <span class="bp">=</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">((</span><span class="n">s</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="n">rfl</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="bp">_</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="bp">_</span> <span class="n">h1</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="n">inf_le_left</span> <span class="n">h2</span> <span class="o">((</span><span class="n">s</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">))</span> <span class="o">:</span> <span class="o">(</span><span class="n">res_res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">))</span> <span class="bp">_</span> <span class="n">inf_le_right</span> <span class="o">((</span><span class="n">s</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">this</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux2</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">OC</span> <span class="o">:</span> <span class="n">covering</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_right</span> <span class="o">(</span><span class="n">s</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">)</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span>
      <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
        <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span>
        <span class="o">(</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">i</span><span class="o">))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span>
      <span class="o">(</span><span class="k">by</span> <span class="n">rw</span> <span class="n">inf_assoc</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">inf_le_right</span><span class="o">)</span>
      <span class="o">(</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">j</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">locality</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">OC</span><span class="o">)</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">k</span><span class="o">,</span>
<span class="k">calc</span>  <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="n">inf_le_left</span>
        <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">k</span><span class="o">))</span>
        <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">inf_le_left</span>
          <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span>
            <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span>
            <span class="o">(</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">i</span><span class="o">)))</span>
    <span class="bp">=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="n">inf_le_left</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
          <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span>
          <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="n">inf_le_left</span>
            <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">k</span><span class="o">))</span>
            <span class="o">(</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">i</span><span class="o">)))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">commutes</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span>
        <span class="o">(</span><span class="k">by</span> <span class="n">rw</span> <span class="n">inf_assoc</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">inf_le_right</span><span class="o">)</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="n">inf_le_left</span>
          <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">k</span><span class="o">))</span>
          <span class="o">(</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">j</span><span class="o">))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">erw</span> <span class="o">[</span><span class="n">res_glue</span><span class="o">,</span> <span class="n">res_glue</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="o">(</span><span class="n">s</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="n">i</span> <span class="n">j</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">j</span><span class="o">))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span>

<span class="kn">theorem</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux3</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">OC</span> <span class="o">:</span> <span class="n">covering</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_right</span> <span class="o">(</span><span class="n">s</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">i</span><span class="o">)</span> <span class="bp">⟨λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">i</span><span class="o">,</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux2</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span><span class="bp">⟩</span> <span class="bp">=</span> <span class="n">s</span> <span class="n">i</span> <span class="o">:=</span>
<span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span><span class="o">]</span><span class="bp">;</span>
<span class="n">change</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">((</span><span class="n">opens</span><span class="bp">.</span><span class="n">covering_inf_left</span> <span class="n">U</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="n">OC</span><span class="o">)</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">=</span> <span class="bp">_;</span>
<span class="n">erw</span> <span class="n">res_glue</span>

<span class="kn">theorem</span> <span class="n">gluing</span> <span class="o">(</span><span class="n">U</span> <span class="o">:</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">OC</span> <span class="o">:</span> <span class="n">covering</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">s</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">inf_le_right</span> <span class="o">(</span><span class="n">s</span> <span class="n">j</span><span class="o">))</span> <span class="o">:</span>
  <span class="bp">∃</span> <span class="n">t</span> <span class="o">:</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span><span class="o">,</span> <span class="bp">∀</span> <span class="n">i</span> <span class="o">:</span> <span class="n">OC</span><span class="bp">.</span><span class="n">γ</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="o">(</span><span class="n">OC</span><span class="bp">.</span><span class="n">Uis</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">subset_covering</span> <span class="n">i</span><span class="o">)</span> <span class="n">t</span> <span class="bp">=</span> <span class="n">s</span> <span class="n">i</span> <span class="o">:=</span>
<span class="bp">⟨⟨λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux1</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">i</span><span class="o">,</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux2</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">gluing</span><span class="bp">.</span><span class="n">aux3</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="n">U</span> <span class="n">OC</span> <span class="n">s</span> <span class="n">H</span> <span class="n">i</span><span class="bp">⟩</span>

<span class="kn">end</span> <span class="n">sheaf_glue</span>

<span class="n">def</span> <span class="n">sheaf_glue</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span>
    <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_right</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="bp">_</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">opens</span><span class="bp">.</span><span class="n">Union</span> <span class="n">S</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">F</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">F</span> <span class="o">:=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">compat</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span><span class="o">,</span>
    <span class="n">res</span> <span class="o">:=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span><span class="o">,</span>
    <span class="n">Hid</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span><span class="o">,</span> <span class="n">id</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="n">res_self</span><span class="o">,</span>
    <span class="n">Hcomp</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">V</span> <span class="n">W</span> <span class="n">HWV</span> <span class="n">HVU</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">f</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">by</span> <span class="n">symmetry</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">res_res</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">inf_le_left</span> <span class="o">},</span>
  <span class="n">locality</span> <span class="o">:=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">locality</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span><span class="o">,</span>
  <span class="n">gluing</span> <span class="o">:=</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">gluing</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span> <span class="o">}</span>
</pre></div>

<a name="168919130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919130" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919130">Kenny Lau (Jun 25 2019 at 08:32)</a>:</h4>
<p>and I never used the cocycle conditions</p>

<a name="168919399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919399">Kevin Buzzard (Jun 25 2019 at 08:37)</a>:</h4>
<p>Maybe you need them to prove the universal property?</p>

<a name="168919407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919407">Kevin Buzzard (Jun 25 2019 at 08:37)</a>:</h4>
<p>This is not proved even for presheaves.</p>

<a name="168919513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919513">Kevin Buzzard (Jun 25 2019 at 08:39)</a>:</h4>
<p>As far as I know, the universal property is simply the data of an isomorphism from the glued sheaf, restricted to an open subset <code>S i</code>, with the sheaf  <code>F i</code>.</p>

<a name="168919651"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919651" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919651">Kenny Lau (Jun 25 2019 at 08:41)</a>:</h4>
<p>that is indeed what you gave me</p>

<a name="168919712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919712">Kevin Buzzard (Jun 25 2019 at 08:42)</a>:</h4>
<p>I guess an isomorphism of sheaves is an isomorphism of presheaves. Maybe you need it for one of the maps. To write down from <code>F i (S i)</code> to the product over j of <code>F j (S i \cap S j)</code> you can use <code>phi i j</code>, but to prove that these sections are compatible will involve <code>phi j k</code> so that's where it will be.</p>

<a name="168919737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919737">Kevin Buzzard (Jun 25 2019 at 08:43)</a>:</h4>
<p>To write down the map the other way I don't see how to do it without using the sheaf axiom.</p>

<a name="168919753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168919753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168919753">Kevin Buzzard (Jun 25 2019 at 08:43)</a>:</h4>
<p>So maybe the universal property isn't even true if you glue presheaves naively.</p>

<a name="168922749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168922749" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168922749">Patrick Massot (Jun 25 2019 at 09:34)</a>:</h4>
<blockquote>
<p>Regarding the category of uniform spaces, I agree that's completely boring. We did it because Patrick asked to see how it was done. I agree it was annoying that afternoon that we ran into some still-mysterious Lean 'feature' involving unwanted unfolding. But besides that I thought that exercise was mostly a success. Reid and I got distracted at the end of the discussion trying to work out how to use reflective subcategories, but the file at the end was what Patrick had asked for, modulo one sorry (that was actually about uniform spaces).</p>
</blockquote>
<p>Scott, I'm sorry my message sounded more aggressive than I intended. But I still claim it doesn't work. I tried to include that file in current mathlib (latest nightly) and the definition of <code>completion_functor</code> doesn't work anymore. It seems that condition <code>map_id'</code> was filled in automatically in Edinburgh but isn't today. And I have no clue how I could try to prove it (although I'm sure it has no mathematical content).   Same applies to one item of the <code>adj</code> definition. I guess a bit part of the issue is documentation of the API</p>

<a name="168923186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168923186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168923186">Patrick Massot (Jun 25 2019 at 09:41)</a>:</h4>
<p>And if you want to get back part of the unfolding craziness you can replace the last tactic block by an invocation of the structure skeketon hole command.</p>

<a name="168923277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168923277" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168923277">Patrick Massot (Jun 25 2019 at 09:42)</a>:</h4>
<p>You'll see <code>subtype uniform_continuous</code> appearing everywhere</p>

<a name="168924336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168924336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168924336">Kenny Lau (Jun 25 2019 at 10:01)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">sheaf_glue_res_val</span> <span class="o">{</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_right</span><span class="o">))</span>
  <span class="o">(</span><span class="n">U</span> <span class="n">HU</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">HVU</span> <span class="n">s</span> <span class="n">i</span><span class="o">)</span> <span class="o">:</span> <span class="o">((</span><span class="n">sheaf_glue</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="n">U</span> <span class="n">HU</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">HVU</span> <span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span> <span class="bp">=</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">inf_le_inf</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span> <span class="n">HVU</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="n">def</span> <span class="n">universal_property</span> <span class="o">(</span><span class="n">I</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="o">:</span> <span class="n">I</span> <span class="bp">→</span> <span class="n">opens</span> <span class="n">X</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">),</span> <span class="n">sheaf_on_opens</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">X</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">equiv</span> <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="o">((</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">))</span> <span class="n">inf_le_right</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">φ</span> <span class="n">i</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">))</span>
  <span class="o">(</span><span class="n">Hφ2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span>
    <span class="o">((</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="n">inf_le_left</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span>
      <span class="o">((</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">))</span> <span class="bp">=</span>
    <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="o">(</span><span class="n">S</span> <span class="n">k</span><span class="o">))</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">))</span>
  <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">I</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">equiv</span> <span class="o">(</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">sheaf_glue</span> <span class="n">S</span> <span class="n">F</span> <span class="n">φ</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="err">$</span> <span class="n">opens</span><span class="bp">.</span><span class="n">subset_Union</span> <span class="n">S</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">to_fun</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">H</span> <span class="n">s</span><span class="o">,</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_inf</span> <span class="n">H</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">),</span>
    <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">HU</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">HVU</span> <span class="n">s</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res_res</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">]</span><span class="bp">;</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">res</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="o">,</span> <span class="n">sheaf_glue</span><span class="bp">.</span><span class="n">res</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">presheaf</span><span class="bp">.</span><span class="n">Hcomp&#39;</span><span class="bp">;</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">inv_fun</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">map</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">H</span> <span class="n">s</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="n">j</span><span class="o">,</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_right</span> <span class="n">H</span><span class="o">)</span> <span class="n">inf_le_left</span><span class="o">)</span>
        <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_right</span> <span class="n">H</span><span class="o">)</span> <span class="n">inf_le_right</span> <span class="n">s</span><span class="o">),</span>
      <span class="bp">λ</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span> <span class="k">begin</span>
        <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="err">⊓</span> <span class="n">U</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="o">:=</span> <span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_right</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">),</span>
        <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">inf_assoc</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">inf_le_right</span><span class="o">,</span>
        <span class="k">have</span> <span class="n">h3</span> <span class="o">:</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="err">⊓</span> <span class="n">U</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">rw</span>  <span class="o">[</span><span class="n">inf_comm</span><span class="o">,</span> <span class="n">inf_assoc</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">inf_le_inf</span> <span class="n">H</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">),</span>
        <span class="k">have</span> <span class="n">h4</span> <span class="o">:</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="err">⊓</span> <span class="n">U</span> <span class="bp">≤</span> <span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_right</span> <span class="n">H</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_right</span><span class="o">),</span>
        <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">res_res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h1</span><span class="o">,</span> <span class="err">←</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">],</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">res_subset_apply</span> <span class="o">(</span><span class="n">φ</span> <span class="n">j</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span><span class="o">)</span> <span class="n">h2</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">h3</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">res_subset_apply</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">k</span> <span class="err">⊓</span> <span class="n">U</span><span class="o">)</span> <span class="n">h3</span><span class="o">,</span>
        <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">trans_apply</span><span class="o">,</span> <span class="n">Hφ2</span> <span class="n">i</span> <span class="n">j</span> <span class="n">k</span><span class="o">,</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">res_subset_apply</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">],</span>
        <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">res_res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">k</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h4</span><span class="o">,</span> <span class="err">←</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">k</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">],</span>
      <span class="kn">end</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">commutes</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">U</span> <span class="n">HU</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">HVU</span> <span class="n">s</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">res_res_subset</span><span class="o">,</span> <span class="n">sheaf_glue_res_val</span><span class="o">]</span><span class="bp">;</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">res_res_subset</span> <span class="o">(</span><span class="n">F</span> <span class="n">j</span><span class="o">),</span> <span class="err">←</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">left_inv</span> <span class="o">:=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">ext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">s</span><span class="o">,</span> <span class="n">subtype</span><span class="bp">.</span><span class="n">eq</span> <span class="err">$</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">j</span><span class="o">,</span> <span class="k">have</span> <span class="bp">_</span><span class="o">,</span> <span class="k">from</span> <span class="n">s</span><span class="bp">.</span><span class="mi">2</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="k">calc</span>
      <span class="bp">_</span> <span class="bp">=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_right</span> <span class="n">HV</span><span class="o">)</span> <span class="n">inf_le_left</span><span class="o">)</span>
            <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="n">V</span> <span class="n">HV</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_right</span> <span class="n">HV</span><span class="o">)</span> <span class="n">inf_le_right</span>
              <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="n">V</span> <span class="n">HV</span> <span class="o">(</span><span class="n">le_inf</span> <span class="n">HV</span> <span class="o">(</span><span class="n">le_refl</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)))</span> <span class="o">:</span> <span class="n">rfl</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span>
            <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="n">res_res</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span>
            <span class="o">(((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res_subset</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="n">inf_le_left</span> <span class="bp">_</span> <span class="bp">_</span>
              <span class="o">(</span><span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">inf_assoc</span><span class="o">,</span> <span class="n">inf_left_comm</span><span class="o">,</span> <span class="n">inf_of_le_right</span> <span class="n">HV</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">le_refl</span> <span class="bp">_</span><span class="o">)</span>
              <span class="o">((</span><span class="n">F</span> <span class="n">i</span><span class="o">)</span><span class="bp">.</span><span class="n">res</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="bp">_</span> <span class="o">((</span><span class="n">S</span> <span class="n">i</span> <span class="err">⊓</span> <span class="n">S</span> <span class="n">j</span><span class="o">)</span> <span class="err">⊓</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span>
                <span class="o">(</span><span class="n">le_inf</span> <span class="o">(</span><span class="n">le_trans</span> <span class="n">inf_le_left</span> <span class="n">inf_le_left</span><span class="o">)</span> <span class="n">inf_le_right</span><span class="o">)</span>
                <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="n">i</span><span class="o">)))</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">]</span>
    <span class="bp">...</span> <span class="bp">=</span> <span class="n">s</span><span class="bp">.</span><span class="mi">1</span> <span class="n">j</span> <span class="o">:</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[(</span><span class="n">φ</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span> <span class="n">s</span><span class="bp">.</span><span class="mi">2</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">res_res_subset</span><span class="o">,</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_self</span><span class="o">],</span>
  <span class="n">right_inv</span> <span class="o">:=</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">ext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">V</span> <span class="n">HV</span> <span class="n">s</span><span class="o">,</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="n">only</span> <span class="o">[</span><span class="n">morphism</span><span class="bp">.</span><span class="n">comp</span><span class="o">,</span> <span class="n">morphism</span><span class="bp">.</span><span class="n">id</span><span class="o">,</span> <span class="n">id</span><span class="o">]</span><span class="bp">;</span>
    <span class="n">erw</span> <span class="o">[</span><span class="n">Hφ1</span><span class="o">,</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">refl_apply</span> <span class="o">(</span><span class="n">F</span> <span class="n">i</span><span class="o">),</span> <span class="n">res_res</span><span class="o">,</span> <span class="n">res_self</span><span class="o">]</span> <span class="o">}</span>
</pre></div>

<a name="168924338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168924338" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168924338">Kenny Lau (Jun 25 2019 at 10:01)</a>:</h4>
<p>it's computable!</p>

<a name="168926394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926394">Kevin Buzzard (Jun 25 2019 at 10:41)</a>:</h4>
<p>I claim that the following would not be computable: if instead of <code>S : I -&gt; opens X</code> we had done everything for <code>s : set (opens X)</code>, and then we wanted to move back to <code>S : I -&gt; opens X</code>, then <code>s</code> would be <code>range S</code> and we would start to have to make choices of a "canonical" element of I for every element of s.</p>

<a name="168926501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926501">Mario Carneiro (Jun 25 2019 at 10:43)</a>:</h4>
<p>This is true. This passing back and forth is necessary if you want to support <code>I</code> in another universe</p>

<a name="168926563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926563" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926563">Mario Carneiro (Jun 25 2019 at 10:44)</a>:</h4>
<p>You can support <code>I</code> in a lower universe if you use <code>ulift</code>, and maybe that's enough for one-universe man, but for higher universes I don't think it's possible without having some kind of super sheaf property</p>

<a name="168926586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926586">Scott Morrison (Jun 25 2019 at 10:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>, there were some other files changed in that branch, so just bringing forward the one file wasn't going to work. I've merged master back into that branch, and it works again.</p>

<a name="168926849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926849" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926849">Kevin Buzzard (Jun 25 2019 at 10:50)</a>:</h4>
<blockquote>
<p>You can support <code>I</code> in a lower universe if you use <code>ulift</code>, and maybe that's enough for one-universe man, but for higher universes I don't think it's possible without having some kind of super sheaf property</p>
</blockquote>
<p>Is there a way of formalising <code>I : Type v &lt;= u</code> in Lean?</p>

<a name="168926856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926856" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926856">Kevin Buzzard (Jun 25 2019 at 10:51)</a>:</h4>
<p>I am definitely one-universe man; I don't want to be ostracised by my ZFC chums.</p>

<a name="168926863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926863" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926863">Mario Carneiro (Jun 25 2019 at 10:51)</a>:</h4>
<p>use <code>max u v</code> in place of <code>u</code></p>

<a name="168926883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926883">Mario Carneiro (Jun 25 2019 at 10:51)</a>:</h4>
<p>You realize that sheafs don't fit in one universe?</p>

<a name="168926932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926932" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926932">Kevin Buzzard (Jun 25 2019 at 10:52)</a>:</h4>
<p>Of course they don't.</p>

<a name="168926942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926942">Kevin Buzzard (Jun 25 2019 at 10:52)</a>:</h4>
<p>We never consider "the set of sheaves on X". We know how to treat sheaves.</p>

<a name="168926943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926943">Mario Carneiro (Jun 25 2019 at 10:52)</a>:</h4>
<p>so... not really one universe then</p>

<a name="168926948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926948">Kevin Buzzard (Jun 25 2019 at 10:52)</a>:</h4>
<p>We have sets and classes. Sheaves are a class.</p>

<a name="168926960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926960">Kevin Buzzard (Jun 25 2019 at 10:53)</a>:</h4>
<p>It just means that you can't do certain things with them. Sets are a class. Groups are a class. This is fine.</p>

<a name="168926986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168926986" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168926986">Mario Carneiro (Jun 25 2019 at 10:53)</a>:</h4>
<p>I'm quite familiar with "large category theory". It's not fun to do in strict ZFC</p>

<a name="168927034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927034" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927034">Kevin Buzzard (Jun 25 2019 at 10:54)</a>:</h4>
<p>I'm not necessarily saying I believe this, but I know lots of people who do, and some of them get upset when people start going on about universes. I just want to make sure that these ZFC people have a voice.</p>

<a name="168927065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927065" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927065">Mario Carneiro (Jun 25 2019 at 10:54)</a>:</h4>
<p>In fact, you have to get even more into universes if you are in strict ZFC mode - you just have more notions of universe and almost-universe</p>

<a name="168927094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927094" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927094">Kevin Buzzard (Jun 25 2019 at 10:55)</a>:</h4>
<p>To be honest I can quite believe you. I've never had to worry about this though. People in other disciplines might.</p>

<a name="168927180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927180">Mario Carneiro (Jun 25 2019 at 10:56)</a>:</h4>
<p>At the very least, it's hard to do category theory on small and large categories in lean without at least one universe variable and probably two</p>

<a name="168927225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927225" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927225">Mario Carneiro (Jun 25 2019 at 10:57)</a>:</h4>
<p>unless you want two completely separate but parallel theories</p>

<a name="168927247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927247" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927247">Kevin Buzzard (Jun 25 2019 at 10:57)</a>:</h4>
<p>Well we're making two completely separate but parallel theories of presheaves.</p>

<a name="168927320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927320" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927320">Mario Carneiro (Jun 25 2019 at 10:58)</a>:</h4>
<p>I think that's more of a test - I don't see a good reason for both to exist in perpetuity</p>

<a name="168927345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927345" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927345">Mario Carneiro (Jun 25 2019 at 10:59)</a>:</h4>
<p>Unless of course we decide they aren't really the same thing but they are just "spelled the same in maths"</p>

<a name="168927410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168927410" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168927410">Mario Carneiro (Jun 25 2019 at 11:00)</a>:</h4>
<p>Which TBH may very well be the conclusion, especially for the really abstract sheaves on sites</p>

<a name="168928080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928080">Kevin Buzzard (Jun 25 2019 at 11:12)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Kenny has shown that it's possible to glue sheaves of types using a wicked trick which started this thread off. Before he did this, I had an absolutely miserable time trying to glue sheaves of types, because porting open sets from one subset to another was painful. Kenny has introduced the idea of defining a sheaf on a subset to be a sheaf on the whole space. Mario has introduced this total space idea which also made stuff easier. In my mind these two shortcuts are decisive; I had a nightmare working with this stuff before these two ideas, and it was much much easier working with them afterwards. They are distinct techniques -- Kenny's stops you from having to move from open set to open set, and Mario's fixes some possible type issues with U intersect V not being defeq to V intersect U.</p>
<p>What I fear about the "full category theory approach" (a presheaf is a functor) is that there will not be an analogue of these tricks, and there will be inevitable pain in making and using the API.</p>
<p>What I fear about the low-level approach is that we are now going to have to have glueing sheaves of groups extending glueing sheaves of types, then glueing sheaves of topological rings extending 5 other things, and so on. </p>
<p>There might be a middle approach, where one defines a sheaf to be a map from a complete lattice (or whatever) to the objects of a category, plus some extra data, rather than a functor. If one wants to use functors the question is whether glueing is still viable. Maybe there's just a straightforward analogue of Kenny's trick? Mario's trick would I think involve being able to identify the <em>isomorphic</em> full subcategories <code>opens U \cap V</code> of <code>opens U</code> and <code>opens U \cap V</code> of <code>opens X</code>. I don't think an equivalence is enough. Do you believe me or have I made a slip? Maybe you shouldn't take some of these things too seriously. Someone is going to have to sit down and work this stuff out and see if it actually works, or whether Lean 3 is not actually up to the task.</p>
<p>Given that I want sheaves of topological rings, this for me is an important issue.</p>

<a name="168928216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928216" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928216">Mario Carneiro (Jun 25 2019 at 11:14)</a>:</h4>
<p>My trick doesn't work if the homs aren't Props</p>

<a name="168928266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928266">Mario Carneiro (Jun 25 2019 at 11:16)</a>:</h4>
<p>and it's also a bit shaky on general target categories</p>

<a name="168928327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928327">Mario Carneiro (Jun 25 2019 at 11:16)</a>:</h4>
<p>If you have categories on the domain and codomain, I don't think there is a viable alternative to the category theory approach</p>

<a name="168928358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928358" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928358">Kevin Buzzard (Jun 25 2019 at 11:18)</a>:</h4>
<p>So glueing etale sheaves, which is super-important, will be interesting to do in Lean.</p>

<a name="168928412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928412" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928412">Kevin Buzzard (Jun 25 2019 at 11:18)</a>:</h4>
<p>There's an explicit section about this in Milne when he's dealing with DVRs. I'll dig it up later today.</p>

<a name="168928447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928447">Kevin Buzzard (Jun 25 2019 at 11:19)</a>:</h4>
<p>Although maybe there's a way to make the etale site work with Props? <span class="user-mention" data-user-id="110032">@Reid Barton</span> <span class="user-mention" data-user-id="112680">@Johan Commelin</span> what do you think?</p>

<a name="168928533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928533">Mario Carneiro (Jun 25 2019 at 11:20)</a>:</h4>
<p>The basic trick is, if there is only one hom between objects, you can typically avoid mentioning it at all (not even enforcing its existence) with the right choice of types</p>

<a name="168928605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928605" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928605">Mario Carneiro (Jun 25 2019 at 11:22)</a>:</h4>
<p>by comparison the category approach has you not mentioning anything except the homs, and leave the objects implicit</p>

<a name="168928627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928627" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928627">Mario Carneiro (Jun 25 2019 at 11:22)</a>:</h4>
<p>generally this tends to be shorter because the names are shorter (proof names are relatively longer than hom names)</p>

<a name="168928640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928640" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928640">Mario Carneiro (Jun 25 2019 at 11:23)</a>:</h4>
<p>and there are more operations with notation</p>

<a name="168928970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928970" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928970">Kevin Buzzard (Jun 25 2019 at 11:29)</a>:</h4>
<p>It will be much easier for me to understand if I work on examples. This is why I tried Reid's CDGA exercise and this is why I got a student to do group cohomology (she finished last night by the way, we have group cohomology done in the traditional "hands-on" way with cocycles and coboundaries plus the proof of the long exact sequence of terms of low degree in the Hochschild-Serre spectral sequence). I'm working up to homological algebra by taking baby steps. I think defining etale cohomology of schemes will be a stress-test for the system. There will be universe issues, there will be this perennial debate about how to do sheaves, there will be CDGA-like issues when doing cohomology, all this stuff that we half-understand and where the community sometimes has more than one opinion on the best way to proceed. This could very naturally turn into a multi-person project which might teach us quite interesting things about how easy it is to do stuff which is crucial to e.g. Deligne's proof of the Weil conjectures, in Lean.</p>

<a name="168928993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168928993" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168928993">Johan Commelin (Jun 25 2019 at 11:29)</a>:</h4>
<blockquote>
<p>Although maybe there's a way to make the etale site work with Props? <span class="user-mention silent" data-user-id="110032">Reid Barton</span> <span class="user-mention silent" data-user-id="112680">Johan Commelin</span> what do you think?</p>
</blockquote>
<p>My intuition says that it doesn't work. If <code>L/K</code> is a separable field extension, then you really don't want the hom-set <code>L → L</code> over <code>K</code> to be a <code>Prop</code>.</p>

<a name="168929384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929384" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929384">Kevin Buzzard (Jun 25 2019 at 11:35)</a>:</h4>
<p>Aah yes, I was wondering if there was some way to cheat and fix things, but this is a pretty convincing example.</p>

<a name="168929522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929522" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929522">Kevin Buzzard (Jun 25 2019 at 11:37)</a>:</h4>
<p>Does anyone here understand the pro-etale site?</p>

<a name="168929544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929544" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929544">Kevin Buzzard (Jun 25 2019 at 11:37)</a>:</h4>
<p>[this a new Scholze thing]</p>

<a name="168929549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929549" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929549">Mario Carneiro (Jun 25 2019 at 11:37)</a>:</h4>
<p>So if I understand it correctly you are talking about a "restriction map" that applies a field automorphism without changing the object?</p>

<a name="168929618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929618">Kevin Buzzard (Jun 25 2019 at 11:38)</a>:</h4>
<p>Yes I guess so.</p>

<a name="168929653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929653" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929653">Kevin Buzzard (Jun 25 2019 at 11:38)</a>:</h4>
<p>Spec(complexes) is a cover of Spec(reals); a cover of one object by one bigger object</p>

<a name="168929689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929689" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929689">Kevin Buzzard (Jun 25 2019 at 11:39)</a>:</h4>
<p>Aah that's not the point.</p>

<a name="168929869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929869" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929869">Kevin Buzzard (Jun 25 2019 at 11:42)</a>:</h4>
<p>The map Spec(complexes) -&gt; Spec(reals) is an etale map, so the analogue of an "open subset" in the etale site. And complex conjugation is a perfectly good map which one can restrict along. An example of an etale sheaf on Spec(reals) would be an abelian group A plus an action of Gal(complexes/reals). Its global sections would be the fixed points for the action, the sections on the "open set" Spec(complexes) would be A, and the restriction map corresponding to complex conjugation would be the map coming from the non-trivial element of the Galois group.</p>

<a name="168929968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168929968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168929968">Kevin Buzzard (Jun 25 2019 at 11:44)</a>:</h4>
<p>The sheaf axiom says that if I have an element of A which is fixed under complex conjugation then it's a global section, that's why the global sections are the invariants for the action.</p>

<a name="168930016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168930016" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168930016">Kevin Buzzard (Jun 25 2019 at 11:45)</a>:</h4>
<p>Open sets having automorphism groups gives rise to their sections having automorphism groups acting on them.</p>

<a name="168930036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168930036" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168930036">Kevin Buzzard (Jun 25 2019 at 11:45)</a>:</h4>
<p>An etale sheaf of abelian groups on Spec(Q) is the same as an abelian group with an action of Gal(Q-bar/Q).</p>

<a name="168930278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168930278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168930278">Patrick Massot (Jun 25 2019 at 11:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> For the purpose of clarifying this discussion, I just pushed <a href="https://github.com/leanprover-community/mathlib/commit/e4308313b2b992d159d177771bc5ac581a20d331" target="_blank" title="https://github.com/leanprover-community/mathlib/commit/e4308313b2b992d159d177771bc5ac581a20d331">https://github.com/leanprover-community/mathlib/commit/e4308313b2b992d159d177771bc5ac581a20d331</a> which removes the sorry in the completion adjunction. Is this what I was meant to do? Or should I skip the intermediate lemma I created in the category language?</p>

<a name="168966622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168966622" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168966622">Kenny Lau (Jun 25 2019 at 18:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> should the stalk be def-eq to the stalk or another quotient?</p>

<a name="168966892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168966892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168966892">Johan Commelin (Jun 25 2019 at 19:02)</a>:</h4>
<p>We already have stalks in mathlib.</p>

<a name="168966962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168966962" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168966962">Kenny Lau (Jun 25 2019 at 19:03)</a>:</h4>
<p>where?</p>

<a name="168967052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168967052" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168967052">Kenny Lau (Jun 25 2019 at 19:04)</a>:</h4>
<p>also what I was asking is: should the stalk [of a "sheaf on opens" as I have defined it] be definitionally equal to the stalk of the underlying sheaf, or should I make it another type consisting of a quotient?</p>

<a name="168967177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168967177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168967177">Johan Commelin (Jun 25 2019 at 19:05)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/search?q=stalk&amp;unscoped_q=stalk" target="_blank" title="https://github.com/leanprover-community/mathlib/search?q=stalk&amp;unscoped_q=stalk">https://github.com/leanprover-community/mathlib/search?q=stalk&amp;unscoped_q=stalk</a></p>

<a name="168967268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168967268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168967268">Kenny Lau (Jun 25 2019 at 19:06)</a>:</h4>
<p>How do I access that page from, say, the repo?</p>

<a name="168967427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168967427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168967427">Johan Commelin (Jun 25 2019 at 19:08)</a>:</h4>
<p>What do you mean?</p>

<a name="168967492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168967492" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168967492">Kenny Lau (Jun 25 2019 at 19:09)</a>:</h4>
<p>never mind, I figured it out</p>

<a name="168978433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168978433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168978433">Kevin Buzzard (Jun 25 2019 at 21:18)</a>:</h4>
<p>A stalk is only defined up to canonical isomorphism so in some sense it's hard to answer the question. But defeq is good, right?</p>

<a name="168984815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168984815" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168984815">Scott Morrison (Jun 25 2019 at 22:52)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> </p>
<blockquote>
<p>I still worry a bit that I don't know a math definition which encompasses both this example of sheaves of topological rings (on a topological space or whatever) and also sheaves on a general site.</p>
</blockquote>
<p>I think <a href="https://stacks.math.columbia.edu/tag/00VL" target="_blank" title="https://stacks.math.columbia.edu/tag/00VL">https://stacks.math.columbia.edu/tag/00VL</a> does it (right at the bottom) --- he uses Yoneda to say a presheaf F of Xs is a sheaf if all the Hom(X, F(-)) presheafs of sets are sheaves.</p>

<a name="168995007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/breaking%20equality%20with%20sheaves/near/168995007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/75037breakingequalitywithsheaves.html#168995007">Reid Barton (Jun 26 2019 at 02:41)</a>:</h4>
<p>Hmm, that does sound plausible</p>


{% endraw %}

{% include archive_update.html %}