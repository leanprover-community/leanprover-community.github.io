---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/95771nonempty.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html">nonempty</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="159940871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159940871" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159940871">Patrick Massot (Mar 04 2019 at 19:12)</a>:</h4>
<p>Is it evil to write </p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">nonempty_of_zero</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">0</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="n">nonempty_of_one</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">nonempty</span> <span class="n">α</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="bp">⟩</span>
</pre></div>


<p>I doesn't seem to be there already, and that makes me nervous</p>

<a name="159942538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159942538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159942538">Kevin Buzzard (Mar 04 2019 at 19:30)</a>:</h4>
<p>The thing that makes me nervous is that you don't know which one Lean will find first in general, and the CS people will get edgy if something with a zero is proved non-empty by using a 1. I tried it with a 37 once and they didn't seem to like it. I guess 1 is a lot closer to zero but still I'm not sure they're going to be happy...</p>

<a name="159942986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159942986" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159942986">Chris Hughes (Mar 04 2019 at 19:35)</a>:</h4>
<p>I PRed that once and was told it was evil.</p>

<a name="159942998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159942998" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159942998">Gabriel Ebner (Mar 04 2019 at 19:36)</a>:</h4>
<p>It should be fine to have non-canonical instances here, since <code>nonempty</code> is a Prop.  I wouldn't do this for <code>inhabited</code>, because then you run into all kinds of problems (which number is <code>default ℕ</code>..).</p>

<a name="159945384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159945384" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159945384">Mario Carneiro (Mar 04 2019 at 20:03)</a>:</h4>
<p>What makes me nervous about this is it makes <code>nonempty</code> searches traverse the whole hierarchy</p>

<a name="159949770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159949770" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159949770">Patrick Massot (Mar 04 2019 at 20:54)</a>:</h4>
<p>Ok, I feared something like this. What about defining a <code>nonmepty</code> instance for modules? vector spaces? please?</p>

<a name="159962758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/159962758" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#159962758">Mario Carneiro (Mar 04 2019 at 23:48)</a>:</h4>
<p>I'm not saying you shouldn't do it, try it and find out if it's a problem</p>

<a name="187731976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187731976" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187731976">Patrick Massot (Feb 08 2020 at 21:22)</a>:</h4>
<p>I just bumped mathlib in the perfectoid project and I really don't like <a href="https://github.com/leanprover-community/mathlib/pull/1954" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/1954">https://github.com/leanprover-community/mathlib/pull/1954</a>. It makes every statement ugly to save a couple of keystrokes in proofs. I know I had very little time for PR review since Christmas, but that PR was really game changing and was merged in one day.</p>

<a name="187732031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187732031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187732031">Patrick Massot (Feb 08 2020 at 21:24)</a>:</h4>
<p>I think readability of statements is really important, even when proofs are unreadable.</p>

<a name="187732264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187732264" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187732264">Patrick Massot (Feb 08 2020 at 21:32)</a>:</h4>
<p>Also, it would be nice to have a log of breaking changes. Currently it's pretty painful to find why code is no longer working. That <code>nonempty</code> thing is obviously breaking <em>lots</em> of proofs, but now I'm chasing what happened to <code>set.pointwise_mul_action</code>.</p>

<a name="187734238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187734238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187734238">Yury G. Kudryashov (Feb 08 2020 at 22:42)</a>:</h4>
<p>I'm sorry for breaking your code. After reaction to <a href="https://github.com/leanprover-community/mathlib/issues/1779" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1779">#1779</a> I assumed that migration from <code>≠∅</code> to <code>s.nonempty</code> would be a desired change. If needed, I can revert everything back to <code>≠∅</code>. Though I prefer the <code>s.nonempty</code> version, this is not a strong preference.<br>
Let's also wait at least for <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> and <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> who approved this PR.</p>

<a name="187735090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187735090" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187735090">Yury G. Kudryashov (Feb 08 2020 at 23:09)</a>:</h4>
<p>As for <code>pointwise_mul_action</code>,  see <a href="https://github.com/leanprover-community/mathlib/issues/1925" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1925">#1925</a></p>

<a name="187750507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187750507" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187750507">Sebastien Gouezel (Feb 09 2020 at 08:16)</a>:</h4>
<p>I think the move to nonempty was an excellent move. It takes some time to find the good abstractions, but once we have them we should definitely use them! Before, the fact that a set was nonempty could be expressed in three ways (<code>(h : s ≠ ∅)</code>, or <code>(h : ∃ x, x ∈ s)</code> or <code>(x : α) (h : x ∈ s)</code>) and the three of them were used in some places in the library, making it necessary to jump through hoops when one needed one but the theorems were formulated with another one. With a standard way to express things and a nice API, everything becomes much neater. We don't have a word "pythonic" for Lean, but if we had one it would probably apply to this <code>nonempty</code> construct.</p>
<p>Of course, it is really bad that the change broke your code. To avoid this kind of bitrot, a solution would be to put the perfectoid project in the <code>archive</code> subdirectory of mathlib, so that PRs breaking your code would also have to fix it before getting merged. This is the policy with the AFP in Isabelle, and it works extremely well. I don't know if this is the way archive has been envisioned, though. Any thoughts?</p>

<a name="187751958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187751958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187751958">Patrick Massot (Feb 09 2020 at 09:10)</a>:</h4>
<p>Thanks Yury and Sébastien. I should have separated more clearly the different issues. My main points were:</p>
<ul>
<li>this is a pretty drastic change that could have been discussed more (but of course it's difficult in a context where people's availability is very changing),</li>
</ul>

<a name="187751961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187751961" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187751961">Patrick Massot (Feb 09 2020 at 09:11)</a>:</h4>
<ul>
<li>this makes statement less readable, so it should require extra argumentation</li>
</ul>

<a name="187751965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187751965" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187751965">Patrick Massot (Feb 09 2020 at 09:12)</a>:</h4>
<p>The point about the perfectoid code being broken is much less important (although it certainly participated in getting me to write a angry message, sorry about that).</p>

<a name="187752012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187752012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187752012">Patrick Massot (Feb 09 2020 at 09:13)</a>:</h4>
<p>The main problem about perfectoid code is our huge backlog of things that should be PRed to mathlib. My work yesterday aimed at bringing the project up to date with mathlib to resume the PR effort.</p>

<a name="187752821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187752821" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187752821">Patrick Massot (Feb 09 2020 at 09:45)</a>:</h4>
<p>All that being said, I'm not really asking to revert that <code>nonempty</code> change. Let's add this to the huge pile of things that should improve in proofs assistants (to get both readable statements and good api). We can even tag this as <span aria-label="four leaf clover" class="emoji emoji-1f340" role="img" title="four leaf clover">:four_leaf_clover:</span></p>

<a name="187752863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187752863" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187752863">Patrick Massot (Feb 09 2020 at 09:46)</a>:</h4>
<p>The <code>pointwise_mul_action</code> is much more tricky. It touches an area of mathlib that has always been <em>very</em> brittle.</p>

<a name="187752876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187752876" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187752876">Patrick Massot (Feb 09 2020 at 09:47)</a>:</h4>
<p>Can <span class="user-mention" data-user-id="132889">@Jean Lo</span> or anyone else who likes type class inference failure debug the following:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">pointwise</span>
<span class="kn">import</span> <span class="n">ring_theory</span><span class="bp">.</span><span class="n">algebra</span>

<span class="n">local</span> <span class="n">attribute</span> <span class="o">[</span><span class="kn">instance</span><span class="o">]</span> <span class="n">set</span><span class="bp">.</span><span class="n">smul_set_action</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">ring</span> <span class="n">A</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">A</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="o">(</span><span class="n">set</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- works</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">B</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">B</span><span class="o">]</span> <span class="o">[</span><span class="n">algebra</span> <span class="n">R</span> <span class="n">B</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">mul_action</span> <span class="n">R</span> <span class="o">(</span><span class="n">set</span> <span class="n">B</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">apply_instance</span> <span class="c1">-- fails</span>
</pre></div>

<a name="187753029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187753029" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187753029">Patrick Massot (Feb 09 2020 at 09:53)</a>:</h4>
<p>To be clear: in both cases the expected answer is the new <code>set.smul_set_action</code>, and both used to work before that change.</p>

<a name="187754064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187754064" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187754064">Chris Hughes (Feb 09 2020 at 10:29)</a>:</h4>
<p>Increasing the <code>instance_max_depth</code> to 34 makes it work. The first instance requires a depth of 28 to make it work. I guess the <code>comm_ring</code> just made the search slightly deeper.</p>

<a name="187764661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187764661" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187764661">Patrick Massot (Feb 09 2020 at 16:38)</a>:</h4>
<p>Thank you very much Chris!</p>

<a name="187783802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/nonempty/near/187783802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/95771nonempty.html#187783802">Floris van Doorn (Feb 10 2020 at 02:08)</a>:</h4>
<p>I did not consider the desiderata of readable theorem statements. It is indeed true that <code>s.nonempty</code> is a bit harder to read than <code>s ≠ ∅</code>.<br>
I do still like <code>nonempty</code> better. Being able to do <code>cases</code> on this hypothesis to get an actual element is nice (and the readability is not that bad(?)).<br>
I could wait longer to merge big PRs like that. However, I'm afraid that will result in more work for the PR author, which will have to fix merge conflicts.</p>


{% endraw %}

{% include archive_update.html %}