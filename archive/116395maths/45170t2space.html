---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/116395maths/45170t2space.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html">t2_space</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="147451283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451283" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451283">Reid Barton (Nov 10 2018 at 22:56)</a>:</h4>
<p>This is producing a "maximum class-instance resolution depth has been reached" error: it used to work.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">topology</span><span class="bp">.</span><span class="n">continuity</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">real</span>
<span class="n">noncomputable</span> <span class="n">theory</span>
<span class="n">def</span> <span class="n">interval</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">:=</span> <span class="n">subtype</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">ℝ</span> <span class="bp">|</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="n">r</span> <span class="bp">∧</span> <span class="n">r</span> <span class="bp">≤</span> <span class="mi">1</span><span class="o">}</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">topological_space</span> <span class="n">interval</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">unfold</span> <span class="n">interval</span><span class="bp">;</span> <span class="n">apply_instance</span>
<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">t2_space</span> <span class="n">interval</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">dunfold</span> <span class="n">interval</span><span class="bp">;</span> <span class="n">apply_instance</span>
</pre></div>

<a name="147451366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451366">Kevin Buzzard (Nov 10 2018 at 22:59)</a>:</h4>
<p>Is this perhaps to do with reals now being irreducible?</p>

<a name="147451443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451443" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451443">Reid Barton (Nov 10 2018 at 23:00)</a>:</h4>
<p>hmm, it worked with a depth of 38...</p>

<a name="147451461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451461" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451461">Reid Barton (Nov 10 2018 at 23:01)</a>:</h4>
<p>but it takes many seconds</p>

<a name="147451467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451467" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451467">Reid Barton (Nov 10 2018 at 23:01)</a>:</h4>
<p>There have been a number of changes to topological spaces and metric spaces which could be responsible too.</p>

<a name="147451552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451552">Reid Barton (Nov 10 2018 at 23:03)</a>:</h4>
<p>It needs exactly 37</p>

<a name="147451941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147451941" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147451941">Reid Barton (Nov 10 2018 at 23:11)</a>:</h4>
<p>Bisecting... <span class="emoji emoji-1f93a" title="fencing">:fencing:</span></p>

<a name="147452710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147452710" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147452710">Reid Barton (Nov 10 2018 at 23:30)</a>:</h4>
<p>Apparently it stopped working in "add emetric spaces", though I don't know why yet</p>

<a name="147456963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147456963" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147456963">Reid Barton (Nov 11 2018 at 01:20)</a>:</h4>
<p>I still don't have a very clear picture here, but this is what I've learned:</p>
<ul>
<li>The above code was pretty close to the default limit (32) before emetric spaces; it needed a depth of 29.</li>
<li>emetric spaces do add some extra instances. You can now go (when solving, i.e., backwards) either from <code>uniform_space</code> to <code>emetric_space</code> to <code>metric_space</code> or from <code>uniform_space</code> directly to <code>metric_space</code>.</li>
<li>I don't understand what the parameter <code>instance_max_depth</code> actually controls. It isn't the nesting level as shown in parentheses, which never goes above 10 in the successful trace with emetric spaces. Maybe it has something to do with the number of unassigned metavariables?</li>
<li>Perhaps more concerning than hitting the depth limit is how long it takes to find the instance with the limit increased. The successful log is about 600MB. The instance search seems to have no memory, so alternative paths to the same point, like from <code>uniform_space</code> to <code>metric_space</code>, even if not causing a diamond problem, are still dangerous for performance: the work done to find an instance can grow exponentially in the number of such branches.</li>
</ul>

<a name="147457303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147457303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147457303">Reid Barton (Nov 11 2018 at 01:30)</a>:</h4>
<p>Is <code>instance metric_space.to_uniform_space'</code> still needed?</p>

<a name="147457936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/t2_space/near/147457936" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/45170t2space.html#147457936">Reid Barton (Nov 11 2018 at 01:44)</a>:</h4>
<p>For this example, using <code>apply subtype.t2_space</code> is a workaround</p>


{% endraw %}
