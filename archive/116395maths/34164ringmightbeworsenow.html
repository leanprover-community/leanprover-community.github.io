---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/116395maths/34164ringmightbeworsenow.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html">`ring` might be worse now?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="164608824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164608824" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164608824">Kevin Buzzard (May 01 2019 at 08:30)</a>:</h4>
<p>Although I didn't check, I think there's evidence in my files that <code>ring</code> used to work here:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">polynomial</span>

<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">*</span> <span class="n">X</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">ring</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">deterministic timeout</span>
<span class="cm">-/</span>
</pre></div>

<a name="164608847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164608847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164608847">Kevin Buzzard (May 01 2019 at 08:31)</a>:</h4>
<p>Sorry, I forgot the computer science word for "it used to work and now it doesn't". I might be wrong anyway -- but it looks like the sort of thing that <code>ring</code> should do...</p>

<a name="164609573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164609573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164609573">Kenny Lau (May 01 2019 at 08:47)</a>:</h4>
<p>it's called backwards compatibility?</p>

<a name="164609636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164609636" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164609636">Kevin Buzzard (May 01 2019 at 08:49)</a>:</h4>
<p>Regression was the word I was looking for</p>

<a name="164609816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164609816" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164609816">Chris Hughes (May 01 2019 at 08:53)</a>:</h4>
<p>Possibly related to this. This code is also incredibly slow.</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">polynomial</span>

<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">*</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">pow_two</span><span class="o">],</span>

<span class="kn">end</span>
</pre></div>

<a name="164726119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164726119" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164726119">Kevin Buzzard (May 02 2019 at 17:11)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">polynomial</span>

<span class="kn">open</span> <span class="n">polynomial</span>

<span class="kn">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">polynomial</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">=</span> <span class="n">X</span> <span class="bp">*</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">simp</span><span class="o">,</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">excessive memory consumption detected at &#39;replace&#39; (potential solution:</span>
<span class="cm">increase memory consumption threshold)</span>
<span class="cm">-/</span>
</pre></div>


<p>aargh how do I get around this? My actual goal of</p>
<div class="codehilite"><pre><span></span>⊢ 2 * X * (2 * X * (2 * X * X - 1) - X) - (2 * X * X - 1) = 8 * X ^ 4 - 8 * X ^ 2 + 1
</pre></div>


<p>is going to be a real pain without <code>ring</code></p>

<a name="164727669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164727669" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164727669">Kevin Buzzard (May 02 2019 at 17:31)</a>:</h4>
<p>ha ha, my coefficients are integers and Chris just pointed out that <code>dec_trivial</code> works :D</p>

<a name="164730409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164730409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164730409">Johan Commelin (May 02 2019 at 18:02)</a>:</h4>
<p>I really need to figure out when <code>dec_trivial</code> can prove something? Is there a good documentation somewhere? The bit in TPIL is really short. I tried proving <code>n + 3 = 3 + n</code>, with <code>(n : nat)</code> and that didn't fly... so I was confused.</p>

<a name="164731047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164731047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164731047">Chris Hughes (May 02 2019 at 18:09)</a>:</h4>
<p><code>n + 3 = 3 + n</code> won't work because it depends on a variable, so <code>nat.decidable_eq (n + 3) (3 + n)</code> cannot be reduced. The equality of polynomials does not depend on any variables.</p>

<a name="164731077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164731077" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164731077">Chris Hughes (May 02 2019 at 18:09)</a>:</h4>
<p>And <code>polynomial int</code> has <code>decidable_eq</code></p>

<a name="164731162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164731162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164731162">Kevin Buzzard (May 02 2019 at 18:10)</a>:</h4>
<p><code>dec_trivial</code> works if there's a trivial algorithm to decide whether what you want is true or not :-) Induction is definitely not trivial in this  context! <code>4 + 3 = 3 + 4</code> would be fine though, because everything is computable so both terms will reduce to a natural number; there's the algorithm to check to see if they're equal.</p>

<a name="164731238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164731238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164731238">Chris Hughes (May 02 2019 at 18:11)</a>:</h4>
<p>It's like you can't <code>#eval (2 * n) % 2</code>. Deciding something is the same as evaluating the decidable instance.</p>

<a name="164731581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164731581" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164731581">Johan Commelin (May 02 2019 at 18:14)</a>:</h4>
<p>Aha...</p>

<a name="164740012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164740012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164740012">Mario Carneiro (May 02 2019 at 19:57)</a>:</h4>
<p>An easy solution to these kinds of problems is to make a lemma to generalize over all types with appropriate structure, rather than relying on <code>polynomial</code>'s horrible instance searches</p>

<a name="164740361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164740361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164740361">Chris Hughes (May 02 2019 at 20:01)</a>:</h4>
<p>That's not an easy solution. Particularly to the simp issue.</p>

<a name="164740737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164740737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164740737">Kevin Buzzard (May 02 2019 at 20:05)</a>:</h4>
<p>I am looking at code which was written in something like Jan and which has all this <code>simp</code> stuff about polynomials and everything is now hanging. I'm trying to fix it but this basically entails removing all use of <code>simp</code> :-/</p>

<a name="164742202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742202">Mario Carneiro (May 02 2019 at 20:23)</a>:</h4>
<p>Except for theorems that are doing induction on polynomials or something, you can always just state the theorem in a general ring and specialize</p>

<a name="164742312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742312">Patrick Massot (May 02 2019 at 20:25)</a>:</h4>
<p>That's a workaround, not a solution</p>

<a name="164742483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742483" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742483">Mario Carneiro (May 02 2019 at 20:27)</a>:</h4>
<p>that's right</p>

<a name="164742592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742592" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742592">Mario Carneiro (May 02 2019 at 20:29)</a>:</h4>
<p>To be fair, it's actually the most efficient way to prove it if you consider the underlying proof term. You don't want to do that horrible instance search hundreds of times inside <code>ring</code></p>

<a name="164742607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742607">Chris Hughes (May 02 2019 at 20:29)</a>:</h4>
<p>And it's not a workaround for <code>simp</code>, because that does things specific to polynomials.</p>

<a name="164742617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742617">Patrick Massot (May 02 2019 at 20:29)</a>:</h4>
<p>I can totally believe that. But this is not what the end-user wants to hear...</p>

<a name="164742622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742622" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742622">Rob Lewis (May 02 2019 at 20:29)</a>:</h4>
<p>The polynomial issues are another symptom of what Johannes describes here: <a href="#narrow/stream/113488-general/topic/Problem.20with.20type.20class.20search" title="#narrow/stream/113488-general/topic/Problem.20with.20type.20class.20search">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Problem.20with.20type.20class.20search</a><br>
I had a chance to look back at my scribbled notes from dealing with this in the cap set proof. The <code>polynomial.subsingleton</code> instance is the culprit. Changing that to a local instance allows <code>simp</code> (and <code>ring</code>) to work fine on polynomials.</p>

<a name="164742686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742686" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742686">Rob Lewis (May 02 2019 at 20:30)</a>:</h4>
<p>I'm not sure if this instance is used other places in mathlib. I'm compiling now to test.</p>

<a name="164742758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742758" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742758">Rob Lewis (May 02 2019 at 20:31)</a>:</h4>
<p>I also swear I found a way to get <code>simp</code> to work, without removing this instance. But it didn't make it into the final proof, or my notes, and I can't figure it out now. So that memory might be made up.</p>

<a name="164742764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742764" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742764">Mario Carneiro (May 02 2019 at 20:31)</a>:</h4>
<p>Why would that cause problems? <code>simp</code> uses <code>congr</code>, which exploratively searches for <code>subsingleton</code> instances. So it tries to prove <code>subsingleton (polynomial A)</code>, finds all the required structure on A, fails to find <code>subsingleton A</code>, and is done</p>

<a name="164742823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742823">Mario Carneiro (May 02 2019 at 20:32)</a>:</h4>
<p>I guess we might be able to speed this up by putting the subsingleton instance first, before the ring structure</p>

<a name="164742861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742861" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742861">Rob Lewis (May 02 2019 at 20:33)</a>:</h4>
<p>There's some instance that leads to <code>subsingleton</code> through the algebraic hierarchy, iirc. I'm compiling mathlib now and don't want to change things back to see the trace again, I should have copied it.</p>

<a name="164742889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742889" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742889">Rob Lewis (May 02 2019 at 20:33)</a>:</h4>
<p>Yeah, that's it.</p>

<a name="164742906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742906" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742906">Rob Lewis (May 02 2019 at 20:34)</a>:</h4>
<p>Changing the order of those should fix it.</p>

<a name="164742953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164742953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164742953">Rob Lewis (May 02 2019 at 20:34)</a>:</h4>
<p>That's a better fix than making the instance local.</p>

<a name="164743043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164743043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164743043">Patrick Massot (May 02 2019 at 20:35)</a>:</h4>
<p>I'm not sure I understand. Are you solving the polynomial hell issue that has been a plague for one year? Or only the new part of it?</p>

<a name="164743675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164743675" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164743675">Rob Lewis (May 02 2019 at 20:43)</a>:</h4>
<p>This was introduced in <a href="https://github.com/leanprover-community/mathlib/pull/530" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/530">https://github.com/leanprover-community/mathlib/pull/530</a> , so since January. Which sounds right. I don't remember these issues in the Hensel's Lemma proof, but they were there in the cap set proof.</p>

<a name="164743732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164743732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164743732">Rob Lewis (May 02 2019 at 20:44)</a>:</h4>
<p>What's the year long plague?</p>

<a name="164743758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164743758" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164743758">Patrick Massot (May 02 2019 at 20:44)</a>:</h4>
<p>Maybe I'm exaggerating, we need to Zulip search</p>

<a name="164743787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164743787" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164743787">Patrick Massot (May 02 2019 at 20:45)</a>:</h4>
<p>or ask <span class="user-mention" data-user-id="110064">@Kenny Lau</span> if he remembers when he started to hate polynomials</p>

<a name="164743893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164743893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164743893">Rob Lewis (May 02 2019 at 20:46)</a>:</h4>
<p>But ultimately, this is also just fixing a symptom. We're abusing type class search. This is the same thing that caused the <code>int-&gt;nat</code> coercion issue, and eventually we'll find a case that can't be fixed by reordering instances.</p>

<a name="164745496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164745496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164745496">Rob Lewis (May 02 2019 at 21:07)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/970" target="_blank" title="https://github.com/leanprover-community/mathlib/pull/970">https://github.com/leanprover-community/mathlib/pull/970</a></p>

<a name="164746117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164746117" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164746117">Kevin Buzzard (May 02 2019 at 21:14)</a>:</h4>
<p>Many thanks indeed Rob. Nice find!</p>

<a name="164766622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164766622" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164766622">Johan Commelin (May 03 2019 at 04:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110596">@Rob Lewis</span> For an example of what's wrong with polynomials, this file <a href="https://github.com/leanprover-community/mathlib/blob/master/src/category_theory/instances/CommRing/adjunctions.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/src/category_theory/instances/CommRing/adjunctions.lean">https://github.com/leanprover-community/mathlib/blob/master/src/category_theory/instances/CommRing/adjunctions.lean</a> is taking ages to type check. Back when I wrote it (it was put in a separate file later) we had discussions and Kenny remarked that there were issues with <code>polynomial</code>. But what exactly the issue is was never debugged (and I wouldn't know how to).</p>

<a name="164869087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/%60ring%60%20might%20be%20worse%20now%3F/near/164869087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/34164ringmightbeworsenow.html#164869087">Rob Lewis (May 04 2019 at 13:49)</a>:</h4>
<p>I think there are a few different things going on here. </p>
<p>The <code>decidable_eq</code> problems mentioned at <a href="#narrow/stream/113488-general/topic/free_comm_ring" title="#narrow/stream/113488-general/topic/free_comm_ring">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/free_comm_ring</a> are a big one. I don't quite see the root of this problem, except that <code>mv_polynomial</code> leans too heavily on <code>decidable_eq</code>, and huge repeated searches for these instances seroiusly slow everything down. Playing around with instance priority can make a big difference here. E.g. if you're only considering two types <code>A</code> and <code>int</code>, where decidable equality on <code>A</code> is classical, set the priority for the classical instance to some big N and the priority for <code>int.decidable_eq</code> to N+1. This helps the first proof in that file, not so much the second.</p>
<p>There's another thing. The category theory library doubles the number of <code>subsingleton</code> instances, which <code>simp</code> checks repeatedly. None of them look particularly bad on their own. But replacing some of the <code>simp only [...]</code> calls with <code>simp only []; sorry</code>,  and then deleting the <code>simp only []</code> part, you see that <code>simp only []</code> is taking about a second per call. This is only like 15% of the time in the second proof, but it's still surprising.</p>


{% endraw %}
