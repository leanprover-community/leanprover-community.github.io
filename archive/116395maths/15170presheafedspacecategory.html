---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/15170presheafedspacecategory.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html">presheafed space category</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="169862458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862458">Patrick Massot (Jul 08 2019 at 12:08)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Is there anything we could do to make that <a href="https://github.com/leanprover-community/mathlib/blob/master/src/algebraic_geometry/presheafed_space.lean#L64" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/src/algebraic_geometry/presheafed_space.lean#L64">line 64</a> to consume less than half of mathlib compile time?</p>

<a name="169862538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862538">Johan Commelin (Jul 08 2019 at 12:09)</a>:</h4>
<p>I guess <code>tidy</code> might be spending some time on the category axioms...</p>

<a name="169862655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862655" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862655">Patrick Massot (Jul 08 2019 at 12:10)</a>:</h4>
<p>Maybe we could help it a bit</p>

<a name="169862696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862696" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862696">Patrick Massot (Jul 08 2019 at 12:11)</a>:</h4>
<p>I'm compiling mathlib a lot, and I keep staring at <code>src/algebraic_geometry/presheafed_space.lean: parsing at line 64</code></p>

<a name="169862701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862701" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862701">Patrick Massot (Jul 08 2019 at 12:11)</a>:</h4>
<p>and that's on my fast computer</p>

<a name="169862759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862759" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862759">Patrick Massot (Jul 08 2019 at 12:12)</a>:</h4>
<p>What I really don't understand is that I see that multiple times during a single <code>leanpkg build</code> run</p>

<a name="169862772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862772">Kevin Buzzard (Jul 08 2019 at 12:12)</a>:</h4>
<p>Is there some sort of <code>tidy</code> magic or similar clever tactic going on in that line? Is this a situation where you can look at the proof generated by the magic and just cut and paste it in?</p>

<a name="169862775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862775">Patrick Massot (Jul 08 2019 at 12:12)</a>:</h4>
<p>It spend some time on that line, then compiles other stuff and comes back to that line</p>

<a name="169862789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862789" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862789">Kevin Buzzard (Jul 08 2019 at 12:13)</a>:</h4>
<p>Are you sure it's just not doing that with one core and doing other things with other cores?</p>

<a name="169862794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862794" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862794">Patrick Massot (Jul 08 2019 at 12:13)</a>:</h4>
<p>Yes, it's probably <code>tidy</code>, so it has a hole command version we could copy-paste</p>

<a name="169862796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862796">Johan Commelin (Jul 08 2019 at 12:13)</a>:</h4>
<p>You can definitely look at what <code>tidy</code> produces.</p>

<a name="169862811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862811" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862811">Patrick Massot (Jul 08 2019 at 12:13)</a>:</h4>
<p>I don't know how the <code>leanpkg build</code> output interacts with the multiple core thing</p>

<a name="169862818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862818" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862818">Patrick Massot (Jul 08 2019 at 12:13)</a>:</h4>
<p>Lean is using 1500% CPU</p>

<a name="169862819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862819" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862819">Kevin Buzzard (Jul 08 2019 at 12:13)</a>:</h4>
<p>I don't know if tidy has anything to do with it. It's just one of these miraculous proofs which Scott is extremely good at pulling off using his magic</p>

<a name="169862880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862880" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862880">Patrick Massot (Jul 08 2019 at 12:14)</a>:</h4>
<p>tidy <em>is</em> Scott's magic</p>

<a name="169862900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169862900" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169862900">Patrick Massot (Jul 08 2019 at 12:14)</a>:</h4>
<p>but it's extremely slow</p>

<a name="169863214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/169863214" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#169863214">Kevin Buzzard (Jul 08 2019 at 12:18)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">category_of_PresheafedSpaces</span> <span class="o">:</span> <span class="n">category</span> <span class="o">(</span><span class="n">PresheafedSpace</span><span class="bp">.</span><span class="o">{</span><span class="n">v</span><span class="o">}</span> <span class="n">C</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">hom</span>  <span class="o">:=</span> <span class="n">hom</span><span class="o">,</span>
  <span class="n">id</span>   <span class="o">:=</span> <span class="n">id</span><span class="o">,</span>
  <span class="n">comp</span> <span class="o">:=</span> <span class="n">comp</span> <span class="o">}</span>
<span class="kn">end</span>
</pre></div>


<p>Shouldn't this say <code>by structure_helper</code>? ;-)</p>

<a name="170602718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/170602718" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#170602718">Scott Morrison (Jul 11 2019 at 05:19)</a>:</h4>
<p>Sorry about this. I am travelling/on holiday for another 10 days, but will try to get to this then.</p>

<a name="170602766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/170602766" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#170602766">Scott Morrison (Jul 11 2019 at 05:20)</a>:</h4>
<p>I'm dubious about using <code>by structure_helper</code> for defining data! (Notice this construction contains no proofs, because they've been tidy'd away.)</p>

<a name="170607757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/170607757" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#170607757">Keeley Hoek (Jul 11 2019 at 07:07)</a>:</h4>
<p>Indeed, if we are worried about such definitions being slow, <code>by structure_helper</code> would make that definition strictly slower (though perhaps only by microseconds).</p>

<a name="171870290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/171870290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#171870290">Scott Morrison (Jul 28 2019 at 02:52)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>, sorry, I finally got around to fixing this, it's in <a href="https://github.com/leanprover-community/mathlib/issues/1273" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1273">#1273</a> now.</p>

<a name="171884790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/presheafed%20space%20category/near/171884790" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/15170presheafedspacecategory.html#171884790">Patrick Massot (Jul 28 2019 at 10:56)</a>:</h4>
<p>Nice! Of course I really hope all this problem will disappear at some point because tactics will either become fast or properly cached.</p>


{% endraw %}

{% include archive_update.html %}