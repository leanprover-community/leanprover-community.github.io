---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/116395maths/29140partialderivatives.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/116395maths/index.html">maths</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/116395maths/29140partialderivatives.html">partial derivatives</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="170727198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/partial%20derivatives/near/170727198" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/29140partialderivatives.html#170727198">Kenny Lau (Jul 12 2019 at 14:42)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">mv_polynomial</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">σ</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">}</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">σ</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">i</span> <span class="n">j</span> <span class="o">:</span> <span class="n">σ</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="n">q</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span>

<span class="n">def</span> <span class="n">partial_deriv</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span> <span class="o">:=</span>
<span class="c1">-- p.sum $ λ v r, C r * (add_monoid.smul (v i) (X i ^ (v i - 1)) * v.prod (λ j n, if i = j then 1 else (mv_polynomial.X j)^n))</span>
<span class="n">p</span><span class="bp">.</span><span class="n">sum</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">v</span> <span class="n">r</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single</span> <span class="o">(</span><span class="n">v</span><span class="bp">.</span><span class="n">sum</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">j</span> <span class="n">n</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single</span> <span class="n">j</span> <span class="o">(</span><span class="k">if</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">j</span> <span class="k">then</span> <span class="n">n</span><span class="bp">-</span><span class="mi">1</span> <span class="k">else</span> <span class="n">n</span><span class="o">))</span> <span class="o">(</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul</span> <span class="o">(</span><span class="n">v</span> <span class="n">i</span><span class="o">)</span> <span class="n">r</span><span class="o">)</span>

<span class="c1">-- #exit</span>
<span class="kn">theorem</span> <span class="n">partial_deriv_add</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">+</span> <span class="n">q</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">p</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">q</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="o">:=</span>
<span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_add_index</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">v</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span><span class="o">)</span> <span class="err">$</span>
<span class="bp">λ</span> <span class="n">v</span> <span class="n">a1</span> <span class="n">a2</span><span class="o">,</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_add</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_add</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_zero</span> <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_zero_index</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_C</span> <span class="o">:</span> <span class="o">(</span><span class="n">C</span> <span class="n">r</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span> <span class="err">$</span> <span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="err">$</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">zero_apply</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">zero_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_X</span> <span class="o">:</span> <span class="o">(</span><span class="n">X</span> <span class="n">i</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">j</span> <span class="bp">=</span> <span class="k">if</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">j</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">partial_deriv</span><span class="o">,</span> <span class="n">X</span><span class="o">,</span> <span class="n">monomial</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">sub_self</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">],</span>
  <span class="o">{</span> <span class="n">split_ifs</span> <span class="k">with</span> <span class="n">hji</span> <span class="n">hij</span> <span class="n">hij</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">one_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">exact</span> <span class="n">absurd</span> <span class="n">hji</span><span class="bp">.</span><span class="n">symm</span> <span class="n">hij</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">exact</span> <span class="n">absurd</span> <span class="n">hij</span><span class="bp">.</span><span class="n">symm</span> <span class="n">hji</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">zero_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">}</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">split_ifs</span> <span class="k">with</span> <span class="n">hji</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">nat</span><span class="bp">.</span><span class="n">zero_sub</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span> <span class="o">}</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_one</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">C_1</span><span class="o">,</span> <span class="n">partial_deriv_C</span><span class="o">]</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">semimodule</span> <span class="n">α</span> <span class="o">(</span><span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">to_semimodule</span> <span class="bp">_</span> <span class="bp">_</span>

<span class="kn">theorem</span> <span class="n">C_mul&#39;&#39;</span> <span class="o">:</span> <span class="n">C</span> <span class="n">r</span> <span class="bp">*</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="n">p</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">induction</span> <span class="n">p</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="o">(</span><span class="n">mul_zero</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">smul_zero</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">v</span> <span class="n">s</span> <span class="n">f</span> <span class="n">hfv</span> <span class="n">hs</span> <span class="n">ih</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">,</span> <span class="n">smul_add</span><span class="o">,</span> <span class="n">ih</span><span class="o">],</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">C</span><span class="o">,</span> <span class="n">monomial</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mul_def</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">],</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">smul_single</span><span class="o">,</span> <span class="n">smul_eq_mul</span><span class="o">],</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">mul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">zero_mul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span> <span class="o">}</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_smul</span> <span class="o">:</span> <span class="o">(</span><span class="n">r</span> <span class="err">•</span> <span class="n">p</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">r</span> <span class="err">•</span> <span class="n">p</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">partial_deriv</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_smul_index&#39;</span><span class="o">,</span> <span class="n">partial_deriv</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;&#39;</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mul_sum</span><span class="o">],</span> <span class="n">refine</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_congr</span> <span class="n">rfl</span> <span class="bp">_</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">v</span> <span class="n">hv</span><span class="o">,</span> <span class="n">dsimp</span> <span class="n">only</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_eq_mul</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_eq_mul</span><span class="o">,</span> <span class="n">mul_left_comm</span><span class="o">,</span> <span class="err">←</span> <span class="n">smul_eq_mul</span><span class="o">,</span> <span class="err">←</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">smul_single</span><span class="o">,</span> <span class="n">C_mul&#39;&#39;</span><span class="o">]</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">v</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_mul</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">q</span><span class="o">)</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="n">p</span> <span class="bp">*</span> <span class="n">q</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">p</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">v</span> <span class="n">w</span> <span class="o">:</span> <span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="n">w</span> <span class="n">i</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="n">v</span> <span class="bp">+</span> <span class="n">w</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">σ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single</span> <span class="n">j</span> <span class="o">(</span><span class="n">ite</span> <span class="o">(</span><span class="n">i</span> <span class="bp">=</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="n">n</span><span class="o">))</span> <span class="bp">=</span>
    <span class="n">v</span> <span class="bp">+</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum</span> <span class="n">w</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">j</span> <span class="o">:</span> <span class="n">σ</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single</span> <span class="n">j</span> <span class="o">(</span><span class="n">ite</span> <span class="o">(</span><span class="n">i</span> <span class="bp">=</span> <span class="n">j</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="mi">1</span><span class="o">)</span> <span class="n">n</span><span class="o">)),</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">v</span> <span class="n">w</span> <span class="n">hw</span><span class="o">,</span> <span class="n">ext</span> <span class="n">j</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">add_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_eq_single</span> <span class="n">j</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum</span><span class="o">,</span> <span class="n">finset</span><span class="bp">.</span><span class="n">sum_eq_single</span> <span class="n">j</span><span class="o">],</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">,</span> <span class="n">if_pos</span> <span class="n">rfl</span><span class="o">,</span> <span class="n">if_pos</span> <span class="n">rfl</span><span class="o">],</span> <span class="n">split_ifs</span> <span class="k">with</span> <span class="n">hij</span><span class="o">,</span>
      <span class="o">{</span> <span class="n">subst</span> <span class="n">hij</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">add_apply</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_assoc</span><span class="o">],</span> <span class="n">exact</span> <span class="n">nat</span><span class="bp">.</span><span class="n">one_le_of_lt</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">pos_of_ne_zero</span> <span class="n">hw</span><span class="o">)</span> <span class="o">},</span>
      <span class="o">{</span> <span class="n">refl</span> <span class="o">}</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">k</span> <span class="n">hk</span> <span class="n">hkj</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">,</span> <span class="n">if_neg</span> <span class="n">hkj</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">hjw</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">,</span> <span class="n">if_pos</span> <span class="n">rfl</span><span class="o">],</span> <span class="n">split_ifs</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">not_mem_support_iff</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hjw</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">k</span> <span class="n">hk</span> <span class="n">hkj</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">,</span> <span class="n">if_neg</span> <span class="n">hkj</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">intros</span> <span class="n">hjw</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">single_apply</span><span class="o">,</span> <span class="n">if_pos</span> <span class="n">rfl</span><span class="o">],</span> <span class="n">split_ifs</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">not_mem_support_iff</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hjw</span><span class="o">]</span> <span class="o">}</span> <span class="o">},</span>
  <span class="n">refine</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">induction</span> <span class="n">p</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">v</span> <span class="n">r</span> <span class="n">p</span> <span class="n">hpv</span> <span class="n">hr</span> <span class="n">ihp</span><span class="o">,</span> <span class="bp">_</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">erw</span> <span class="n">zero_mul</span><span class="o">,</span> <span class="n">rw</span> <span class="n">zero_add</span><span class="o">,</span> <span class="n">erw</span> <span class="n">partial_deriv_zero</span><span class="o">,</span> <span class="n">rw</span> <span class="n">mul_zero</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_mul</span><span class="o">,</span> <span class="n">partial_deriv_add</span><span class="o">],</span> <span class="n">refine</span> <span class="n">eq</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">congr_arg</span> <span class="bp">_</span> <span class="n">ihp</span><span class="o">)</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_mul</span><span class="o">,</span> <span class="n">partial_deriv_add</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">,</span> <span class="n">add_comm₄</span><span class="o">],</span> <span class="n">congr&#39;</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">induction</span> <span class="n">q</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">w</span> <span class="n">s</span> <span class="n">q</span> <span class="n">hqw</span> <span class="n">hs</span> <span class="n">ihq</span><span class="o">,</span> <span class="bp">_</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">erw</span> <span class="n">mul_zero</span><span class="o">,</span> <span class="n">rw</span> <span class="n">zero_add</span><span class="o">,</span> <span class="n">erw</span> <span class="n">zero_mul</span><span class="o">,</span> <span class="n">rw</span> <span class="n">partial_deriv_zero</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">,</span> <span class="n">partial_deriv_add</span><span class="o">],</span> <span class="n">refine</span> <span class="n">eq</span><span class="bp">.</span><span class="n">trans</span> <span class="o">(</span><span class="n">congr_arg</span> <span class="bp">_</span> <span class="n">ihq</span><span class="o">)</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_mul</span><span class="o">,</span> <span class="n">partial_deriv_add</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">,</span> <span class="n">add_comm₄</span><span class="o">],</span> <span class="n">congr&#39;</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">single_mul_single</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_eq_smul_one</span> <span class="n">v</span> <span class="n">r</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_eq_smul_one</span> <span class="n">w</span> <span class="n">s</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_eq_smul_one</span> <span class="o">(</span><span class="n">v</span><span class="bp">+</span><span class="n">w</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span><span class="bp">*</span><span class="n">s</span><span class="o">)],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">partial_deriv_smul</span><span class="o">,</span> <span class="n">partial_deriv_smul</span><span class="o">,</span> <span class="n">partial_deriv_smul</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;&#39;</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul&#39;&#39;</span><span class="o">],</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_comm₄</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul</span><span class="o">,</span> <span class="n">mul_comm₄</span><span class="o">,</span> <span class="err">←</span> <span class="n">C_mul</span><span class="o">,</span> <span class="n">mul_comm</span> <span class="n">s</span> <span class="n">r</span><span class="o">,</span> <span class="err">←</span> <span class="n">mul_add</span><span class="o">],</span> <span class="n">congr&#39;</span> <span class="mi">1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">partial_deriv</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">],</span> <span class="n">swap</span><span class="o">,</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">partial_deriv</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">],</span> <span class="n">swap</span><span class="o">,</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">partial_deriv</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">sum_single_index</span><span class="o">],</span> <span class="n">swap</span><span class="o">,</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">smul_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">refl</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">finsupp</span><span class="bp">.</span><span class="n">add_apply</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_mul_single</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_mul_single</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">],</span>
  <span class="n">by_cases</span> <span class="n">hv</span> <span class="o">:</span> <span class="n">v</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">hv</span><span class="o">,</span> <span class="n">zero_add</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">zero_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">],</span> <span class="n">erw</span> <span class="n">add_zero</span><span class="o">,</span>
    <span class="n">by_cases</span> <span class="n">hw</span> <span class="o">:</span> <span class="n">w</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">hw</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">zero_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">this</span> <span class="n">v</span> <span class="n">w</span> <span class="n">hw</span><span class="o">]</span> <span class="o">}</span> <span class="o">},</span>
  <span class="n">by_cases</span> <span class="n">hw</span> <span class="o">:</span> <span class="n">w</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">hw</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">zero_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">,</span> <span class="n">add_zero</span><span class="o">],</span> <span class="n">erw</span> <span class="n">zero_add</span><span class="o">,</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_comm</span> <span class="n">v</span> <span class="n">w</span><span class="o">,</span> <span class="n">this</span> <span class="n">w</span> <span class="n">v</span> <span class="n">hv</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_monoid</span><span class="bp">.</span><span class="n">add_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_add</span><span class="o">,</span> <span class="n">add_comm</span><span class="o">],</span> <span class="n">congr&#39;</span> <span class="mi">1</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">rw</span> <span class="n">this</span> <span class="n">v</span> <span class="n">w</span> <span class="n">hw</span> <span class="o">},</span> <span class="o">{</span> <span class="n">rw</span> <span class="o">[</span><span class="n">add_comm</span> <span class="n">v</span> <span class="n">w</span><span class="o">,</span> <span class="n">this</span> <span class="n">w</span> <span class="n">v</span> <span class="n">hv</span><span class="o">]</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">theorem</span> <span class="n">vars_add</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">+</span> <span class="n">q</span><span class="o">)</span><span class="bp">.</span><span class="n">vars</span> <span class="err">⊆</span> <span class="n">p</span><span class="bp">.</span><span class="n">vars</span> <span class="err">∪</span> <span class="n">q</span><span class="bp">.</span><span class="n">vars</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">by</span> <span class="n">unfold</span> <span class="n">vars</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">mem_union</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">mem_to_finset</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span>
<span class="bp">λ</span> <span class="n">hi</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">mem_add</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">subset_of_le</span>
  <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">degrees_add</span> <span class="n">p</span> <span class="n">q</span><span class="o">)</span> <span class="err">$</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">sup_le</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">le_add_right</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">le_add_left</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span> <span class="n">hi</span><span class="o">)</span>

<span class="kn">theorem</span> <span class="n">vars_mul</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">*</span> <span class="n">q</span><span class="o">)</span><span class="bp">.</span><span class="n">vars</span> <span class="err">⊆</span> <span class="n">p</span><span class="bp">.</span><span class="n">vars</span> <span class="err">∪</span> <span class="n">q</span><span class="bp">.</span><span class="n">vars</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="k">by</span> <span class="n">unfold</span> <span class="n">vars</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">finset</span><span class="bp">.</span><span class="n">mem_union</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">mem_to_finset</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span>
<span class="bp">λ</span> <span class="n">hi</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">mem_add</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">subset_of_le</span> <span class="o">(</span><span class="n">degrees_mul</span> <span class="n">p</span> <span class="n">q</span><span class="o">)</span> <span class="n">hi</span><span class="o">)</span>

<span class="kn">theorem</span> <span class="n">vars_X_subset</span> <span class="o">:</span> <span class="n">vars</span> <span class="o">(</span><span class="n">X</span> <span class="n">i</span> <span class="o">:</span> <span class="n">mv_polynomial</span> <span class="n">σ</span> <span class="n">α</span><span class="o">)</span> <span class="err">⊆</span> <span class="o">{</span><span class="n">i</span><span class="o">}</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">j</span> <span class="n">hj</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">subset_of_le</span> <span class="o">(</span><span class="n">degrees_X</span> <span class="n">i</span><span class="o">)</span> <span class="err">$</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">mem_to_finset</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hj</span>

<span class="kn">theorem</span> <span class="n">of_not_mem_vars</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">i</span> <span class="err">∉</span> <span class="n">p</span><span class="bp">.</span><span class="n">vars</span><span class="o">)</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">σ</span> <span class="bp">→</span><span class="err">₀</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hv</span> <span class="o">:</span> <span class="n">v</span> <span class="err">∈</span> <span class="n">p</span><span class="bp">.</span><span class="n">support</span><span class="o">)</span> <span class="o">:</span> <span class="n">v</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">finsupp</span><span class="bp">.</span><span class="n">not_mem_support_iff</span><span class="bp">.</span><span class="mi">1</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">hiv</span><span class="o">,</span> <span class="n">h</span> <span class="err">$</span>
<span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="n">v</span><span class="bp">.</span><span class="n">to_multiset</span> <span class="bp">≤</span> <span class="n">p</span><span class="bp">.</span><span class="n">degrees</span> <span class="o">:=</span> <span class="n">finset</span><span class="bp">.</span><span class="n">le_sup</span> <span class="n">hv</span><span class="o">,</span>
<span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="bp">_</span> <span class="bp">≤</span> <span class="n">v</span><span class="bp">.</span><span class="n">to_multiset</span> <span class="o">:=</span> <span class="n">finset</span><span class="bp">.</span><span class="n">single_le_sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">zero_le</span> <span class="bp">_</span><span class="o">)</span> <span class="n">hiv</span><span class="o">,</span>
<span class="n">multiset</span><span class="bp">.</span><span class="n">mem_to_finset</span><span class="bp">.</span><span class="mi">2</span> <span class="err">$</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">subset_of_le</span> <span class="n">h1</span> <span class="err">$</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">subset_of_le</span> <span class="n">h2</span> <span class="err">$</span>
<span class="k">by</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ_pred_eq_of_pos</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">pos_of_ne_zero</span> <span class="err">$</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">mem_support_iff</span><span class="bp">.</span><span class="mi">1</span> <span class="n">hiv</span><span class="o">)</span><span class="bp">;</span> <span class="n">exact</span>
<span class="n">multiset</span><span class="bp">.</span><span class="n">mem_cons_self</span> <span class="bp">_</span> <span class="bp">_</span>

<span class="kn">theorem</span> <span class="n">partial_deriv_of_not_mem_vars</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">i</span> <span class="err">∉</span> <span class="n">p</span><span class="bp">.</span><span class="n">vars</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span><span class="bp">.</span><span class="n">partial_deriv</span> <span class="n">i</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="n">finset</span><span class="bp">.</span><span class="n">sum_eq_zero</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">v</span> <span class="n">hv</span><span class="o">,</span> <span class="k">by</span> <span class="n">dsimp</span> <span class="n">only</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="n">of_not_mem_vars</span> <span class="n">i</span> <span class="n">p</span> <span class="n">h</span> <span class="n">v</span> <span class="n">hv</span><span class="o">,</span> <span class="n">add_monoid</span><span class="bp">.</span><span class="n">zero_smul</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">single_zero</span><span class="o">]</span><span class="bp">;</span> <span class="n">refl</span>

<span class="kn">end</span> <span class="n">mv_polynomial</span>
</pre></div>

<a name="170727214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/116395-maths/topic/partial%20derivatives/near/170727214" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/116395maths/29140partialderivatives.html#170727214">Kenny Lau (Jul 12 2019 at 14:43)</a>:</h4>
<p>PR-ready?</p>


{% endraw %}

{% include archive_update.html %}