---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113489newmembers/91403Weirderrormessage.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html">Weird error message</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="164574647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574647" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574647">Katherine Cordwell (Apr 30 2019 at 20:38)</a>:</h4>
<p>I'm trying to use nat.prime.coprime_iff_not_dvd, which has signature nat.prime.coprime_iff_not_dvd : nat.prime ?M_1 → (nat.coprime ?M_1 ?M_2 ↔ ¬?M_1 ∣ ?M_2).  But when I try to call it, I get an "maximum class-instance resolution depth has been reached" error, and I have no idea why.</p>

<a name="164574687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574687" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574687">Patrick Massot (Apr 30 2019 at 20:39)</a>:</h4>
<p>We need more context</p>

<a name="164574747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574747">Patrick Massot (Apr 30 2019 at 20:40)</a>:</h4>
<p>Could you try to get a minimized version of your code, still showing the error, but not much more?</p>

<a name="164574761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574761" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574761">Katherine Cordwell (Apr 30 2019 at 20:40)</a>:</h4>
<p>I have p and q that are nats and I write<br>
"have iffconc: nat.prime p → (nat.coprime p q ↔ ¬ p | q), from apply nat.prime.coprime_iff_not_dvd,"<br>
which is the line that gives the error message.</p>

<a name="164574811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574811" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574811">Kenny Lau (Apr 30 2019 at 20:41)</a>:</h4>
<p>maybe your p and q are integers</p>

<a name="164574894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574894">Katherine Cordwell (Apr 30 2019 at 20:42)</a>:</h4>
<p>The context says "p q : ℕ", so I don't think so?</p>

<a name="164574926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574926" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574926">Patrick Massot (Apr 30 2019 at 20:42)</a>:</h4>
<p>You may have the wrong vertical bar</p>

<a name="164574947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574947" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574947">Kenny Lau (Apr 30 2019 at 20:43)</a>:</h4>
<p>right, make sure that it is <code>\|</code></p>

<a name="164574959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574959" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574959">Kenny Lau (Apr 30 2019 at 20:43)</a>:</h4>
<p>which results in a different bar than <code>|</code></p>

<a name="164574983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164574983" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164574983">Katherine Cordwell (Apr 30 2019 at 20:44)</a>:</h4>
<p>Oh great, that fixed it!  Thanks so much</p>

<a name="164575030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164575030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164575030">Patrick Massot (Apr 30 2019 at 20:44)</a>:</h4>
<p>also, <code>from apply</code> doesn't mean anything</p>

<a name="164575044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164575044" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164575044">Patrick Massot (Apr 30 2019 at 20:44)</a>:</h4>
<p>No problem. Welcome to Lean Zulip!</p>

<a name="164575392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164575392" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164575392">Rob Lewis (Apr 30 2019 at 20:49)</a>:</h4>
<p>The vertical bar thing drives me nuts. I've been using this notation for years and I still mix the two up periodically. It never sticks in my brain.</p>

<a name="164577311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577311" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577311">Travis Hance (Apr 30 2019 at 21:12)</a>:</h4>
<p>to tack onto this question, what exactly <em>does</em> the "maximum class-instance resolution depth has been reached" error message mean, in general? Every time I see it I know it just means I have a type error <em>somewhere</em> but the error never helps me find it and part of that is because I don't know what it means.</p>

<a name="164577353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577353" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577353">Patrick Massot (Apr 30 2019 at 21:13)</a>:</h4>
<p>Do you know the basics of the type class system?</p>

<a name="164577361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577361">Kevin Buzzard (Apr 30 2019 at 21:13)</a>:</h4>
<p>What it actually means is that Lean was trying to solve a typeclass problem, and it failed because it gave up</p>

<a name="164577370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577370" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577370">Kevin Buzzard (Apr 30 2019 at 21:13)</a>:</h4>
<p>because things weren't looking good</p>

<a name="164577438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577438">Kevin Buzzard (Apr 30 2019 at 21:14)</a>:</h4>
<p>What is misleading about the message is that sometimes Lean is trying to solve a completely random problem which you had no intention of making it solve; that's what was happening above.</p>

<a name="164577501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577501">Kevin Buzzard (Apr 30 2019 at 21:15)</a>:</h4>
<p>The real error was some subtle syntax error (<code>|</code> instead of <code>\|</code>) and Lean got completely confused; the error message was ultimately irrelevant.</p>

<a name="164577751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577751" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577751">Kenny Lau (Apr 30 2019 at 21:18)</a>:</h4>
<p>yeah Lean can work on its error messages</p>

<a name="164577788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577788">Kevin Buzzard (Apr 30 2019 at 21:19)</a>:</h4>
<p>The <code>|</code> indicates the end of something, so Lean was faced with <code>¬ p</code> with <code>p : nat</code></p>

<a name="164577793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577793">Kenny Lau (Apr 30 2019 at 21:19)</a>:</h4>
<p>but again, [insert saying about how it's easy to complain]</p>

<a name="164577808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577808" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577808">Simon Hudon (Apr 30 2019 at 21:19)</a>:</h4>
<p>If you had to choose three error messages that you want to be more informative, which ones would it be?</p>

<a name="164577871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577871" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577871">Patrick Massot (Apr 30 2019 at 21:20)</a>:</h4>
<p>Error message craft is highly non-trivial. In this case I would say that maximal depth error message would be much easier if it included an indication of what type class problem it failed to solve</p>

<a name="164577886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577886">Patrick Massot (Apr 30 2019 at 21:20)</a>:</h4>
<p>That one would certainly be in my top 3</p>

<a name="164577930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577930">Kevin Buzzard (Apr 30 2019 at 21:21)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">nat</span><span class="bp">.</span><span class="n">prime</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">p</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">maximum class-instance resolution depth has been reached yada yada</span>
<span class="cm">-/</span>
</pre></div>

<a name="164577954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577954" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577954">Kevin Buzzard (Apr 30 2019 at 21:21)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="c1">-- import data.nat.prime</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">¬</span> <span class="n">p</span> <span class="o">:=</span> <span class="n">sorry</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">type mismatch at application</span>
<span class="cm">  ¬p</span>
<span class="cm">term</span>
<span class="cm">  p</span>
<span class="cm">has type</span>
<span class="cm">  ℕ</span>
<span class="cm">but is expected to have type</span>
<span class="cm">  Prop</span>
<span class="cm">-/</span>
</pre></div>

<a name="164577967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577967" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577967">Simon Hudon (Apr 30 2019 at 21:21)</a>:</h4>
<p>Excellent. How would you feel about a sort of introductory paragraph (or link to one) about type class search, instance problem and the main candidates tried?</p>

<a name="164577984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164577984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164577984">Kevin Buzzard (Apr 30 2019 at 21:22)</a>:</h4>
<p>So it's the import which causes it, on this occasion. Of course, the input is garbage</p>

<a name="164578062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578062" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578062">Kevin Buzzard (Apr 30 2019 at 21:22)</a>:</h4>
<p>Whenever I see it I assume it's user error (i.e. my fault) rather than Lean actually failing to do type class inference</p>

<a name="164578078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578078" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578078">Simon Hudon (Apr 30 2019 at 21:22)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> It might be worth opening an issue to start pitching specific improvements</p>

<a name="164578239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578239">Patrick Massot (Apr 30 2019 at 21:24)</a>:</h4>
<p>Simon, I don't understand. Do you mean you want a link in the error message?</p>

<a name="164578251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578251" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578251">Patrick Massot (Apr 30 2019 at 21:24)</a>:</h4>
<p>opening an issue where?</p>

<a name="164578264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578264" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578264">Patrick Massot (Apr 30 2019 at 21:24)</a>:</h4>
<p>In the community fork?</p>

<a name="164578309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578309">Kevin Buzzard (Apr 30 2019 at 21:25)</a>:</h4>
<p><span class="user-mention" data-user-id="219422">@Travis Hance</span> the answer to your question is that there's a thing called typeclass inference, which is invoked whenever you leave out an input to a function but the input is in <code>[]</code> square brackets. Lean invokes an algorithm called the type class inference algorithm, which searches through a database trying to find the term you didn't supply explicitly. If the algorithm is called accidentally then of course it can fail -- the unhelpful error message just means "you called typeclass inference and it didn't work"</p>

<a name="164578499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578499" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578499">Simon Hudon (Apr 30 2019 at 21:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> yes community fork. And the link I'm talking about is like Rust errors: <a href="https://doc.rust-lang.org/edition-guide/rust-2018/the-compiler/improved-error-messages.html" target="_blank" title="https://doc.rust-lang.org/edition-guide/rust-2018/the-compiler/improved-error-messages.html">https://doc.rust-lang.org/edition-guide/rust-2018/the-compiler/improved-error-messages.html</a></p>

<a name="164578564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578564" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578564">Simon Hudon (Apr 30 2019 at 21:28)</a>:</h4>
<p>When you have an error in Rust, it gives you a rule number and if you query the compiler about that rule it explains why it's there.</p>

<a name="164578570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578570" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578570">Rob Lewis (Apr 30 2019 at 21:28)</a>:</h4>
<p>Printing the failing problem would be nice. But a lot of time time, the question isn't really which problem it failed to solve, it's why the search went deep before failing.</p>

<a name="164578574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578574" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578574">Kevin Buzzard (Apr 30 2019 at 21:28)</a>:</h4>
<p>In this case Lean saw <code>¬ p</code> and thought "hmm, <code>p</code> is a natural and it's supposed to be a proposition, that must mean that there is a coercion from naturals to propositions, I'll pass that over to the type class inference system because that handles coercions, and I'll leave it looking for a natural map from natural numbers to true/false statements". Lean fails to find that natural map, because nobody told Lean such a map, but unfortuately along the way it gets very keen on the idea of using <code>canonically_ordered_comm_semiring</code> in some way, and ends up in an infinite loop.</p>

<a name="164578587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578587" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578587">Rob Lewis (Apr 30 2019 at 21:28)</a>:</h4>
<p>In Kevin's example, the culprit is <code>with_top.canonically_ordered_comm_semiring</code> looping for some reason.</p>

<a name="164578612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578612" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578612">Kevin Buzzard (Apr 30 2019 at 21:29)</a>:</h4>
<p>The garbage out is because of the garbage input -- trying to coerce a natural to a proposition.</p>

<a name="164578722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578722">Kevin Buzzard (Apr 30 2019 at 21:30)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">[</span><span class="n">canonically_ordered_comm_semiring</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">canonically_ordered_comm_semiring</span> <span class="o">(</span><span class="n">with_top</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">...</span>
</pre></div>


<p>in <code>ordered_ring</code>, which for some reason is being imported by <code>data.nat.prime</code></p>

<a name="164578796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578796">Patrick Massot (Apr 30 2019 at 21:31)</a>:</h4>
<p>Oh my God. When I read Kevin's message I thought it was a joke, because we suffered of lot with <code>with_zero</code> and ordered commutative monoids in the perfectoid project. But it seems <code>with_top.canonically_ordered_comm_semiring</code> is indeed involved here</p>

<a name="164578872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578872" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578872">Patrick Massot (Apr 30 2019 at 21:32)</a>:</h4>
<blockquote>
<p>Printing the failing problem would be nice. But a lot of time time, the question isn't really which problem it failed to solve, it's why the search went deep before failing.</p>
</blockquote>
<p>I think what you ask is complicated. Displaying the failing problem would already be immensely useful</p>

<a name="164578902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578902" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578902">Patrick Massot (Apr 30 2019 at 21:33)</a>:</h4>
<p>for instance, you could see immediately that Lean went looking for a coercion from nat to Prop in that case</p>

<a name="164578937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578937">Simon Hudon (Apr 30 2019 at 21:34)</a>:</h4>
<p>I agree, that would be a good start</p>

<a name="164578996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164578996" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164578996">Kevin Buzzard (Apr 30 2019 at 21:34)</a>:</h4>
<p><code>data.nat.basic</code> imports <code>algebra.ordered_ring</code> which contains the offending instance.</p>

<a name="164579017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579017" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579017">Simon Hudon (Apr 30 2019 at 21:35)</a>:</h4>
<p>Is that in mathlib? Is it universally problematic?</p>

<a name="164579032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579032" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579032">Kevin Buzzard (Apr 30 2019 at 21:35)</a>:</h4>
<p>Yes this is all mathlib</p>

<a name="164579040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579040" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579040">Patrick Massot (Apr 30 2019 at 21:35)</a>:</h4>
<p>It doesn't sound quite right that basics of natural numbers involves canonically ordered commutative semi-ring. That must be my mathematician bad habits...</p>

<a name="164579048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579048" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579048">Kevin Buzzard (Apr 30 2019 at 21:35)</a>:</h4>
<p>it's OK, I don't think data.nat.basic is used very much</p>

<a name="164579082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579082" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579082">Kevin Buzzard (Apr 30 2019 at 21:36)</a>:</h4>
<p>sounds pretty obscure to me</p>

<a name="164579132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579132">Kevin Buzzard (Apr 30 2019 at 21:36)</a>:</h4>
<p>to be honest I am extremely surprised I didn't see this loop earlier</p>

<a name="164579291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579291" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579291">Kevin Buzzard (Apr 30 2019 at 21:39)</a>:</h4>
<blockquote>
<p>If you had to choose three error messages that you want to be more informative, which ones would it be?</p>
</blockquote>
<p><code>deterministic timeout</code> was my <a href="https://github.com/leanprover-community/mathlib/issues/1" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1">#1</a> choice last week when we were in perfectoid hell</p>

<a name="164579312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579312">Kevin Buzzard (Apr 30 2019 at 21:39)</a>:</h4>
<p>It should have said "just change that <code>Type*</code> to <code>Type u</code> and I'll stop complaining"</p>

<a name="164579328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579328" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579328">Rob Lewis (Apr 30 2019 at 21:39)</a>:</h4>
<blockquote>
<p>I think what you ask is complicated. Displaying the failing problem would already be immensely useful</p>
</blockquote>
<p>Oh, of course. "Why the search went deep" doesn't really have a well-defined answer. Printing the failing target is helpful when you accidentally invoke type class problems, and it's simple enough to do. But in that situation, you often don't want type class inference to time out, you want it to fail fast. It would be better to see a standard type checking error there than any kind of type class message.</p>

<a name="164579398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579398">Kevin Buzzard (Apr 30 2019 at 21:40)</a>:</h4>
<p>Without the import you get the standard typechecking error, as you know</p>

<a name="164579513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579513">Rob Lewis (Apr 30 2019 at 21:42)</a>:</h4>
<p>Right. That instance is worrying. It seems like there are too many metavariables for it to be applied here, so I'm not sure exactly why it's looping.</p>

<a name="164579520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579520" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579520">Rob Lewis (Apr 30 2019 at 21:43)</a>:</h4>
<p>But it's late, I'm exhausted, not gonna investigate now.</p>

<a name="164579552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164579552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164579552">Patrick Massot (Apr 30 2019 at 21:43)</a>:</h4>
<p>Have a good night! (I should go to bed too)</p>

<a name="164585031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164585031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164585031">Mario Carneiro (Apr 30 2019 at 23:09)</a>:</h4>
<p>There is nothing wrong with that instance as written. I assume it is trying to solve a <code>canonically_ordered_comm_semiring ?</code> kind of problem?</p>

<a name="164587381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164587381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164587381">Mario Carneiro (Apr 30 2019 at 23:53)</a>:</h4>
<p>Here's an abbreviated trace:</p>
<div class="codehilite"><pre><span></span>[class_instances]  class-instance resolution trace
[class_instances] (0) ?x_3 : has_coe_to_sort ℕ := @coe_sort_trans ?x_5 ?x_6 ?x_7 ?x_8
[class_instances] (1) ?x_7 : has_coe_t_aux ℕ ?x_6 := @coe_base_aux ?x_9 ?x_10 ?x_11
[class_instances] (2) ?x_11 : has_coe ℕ ?x_10 := @nat.cast_coe ?x_14 ?x_15 ?x_16 ?x_17
[class_instances] (3) ?x_16 : has_one (with_zero ?x_18) := @with_zero.has_one ?x_24 ?x_25
[class_instances] (4) ?x_25 : has_one ?x_24 := @with_top.has_one ?x_26 ?x_27 ?x_28
[class_instances] (5) ?x_27 : canonically_ordered_comm_semiring ?x_26 := @with_top.canonically_ordered_comm_semiring ?x_29 ?x_30 ?x_31 ?x_32 ?x_33
[class_instances] (6) ?x_30 : canonically_ordered_comm_semiring ?x_29 := @with_top.canonically_ordered_comm_semiring ?x_34 ?x_35 ?x_36 ?x_37 ?x_38
...
</pre></div>


<p>The problem is a confusion of whether typeclass parameters are supposed to be input or output parameters. The <code>canonically_ordered_comm_semiring</code> instance assumes it will only ever be called on a concrete type, so the metavariable indicates the problem lies elsewhere. Similarly, <code>with_zero.has_one</code> assumes it is being called on a concrete type. So we must conclude that for <code>nat.cast_coe</code> to work correctly, it must only be called on concrete types. But that's not how the <code>coe</code> instances work, in particular <code>coe_sort_trans</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">coe_sort_trans</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u₁</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u₂</span><span class="o">}</span> <span class="o">[</span><span class="n">has_coe_t_aux</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">[</span><span class="n">has_coe_to_sort</span><span class="bp">.</span><span class="o">{</span><span class="n">u₂</span> <span class="n">u₃</span><span class="o">}</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_coe_to_sort</span><span class="bp">.</span><span class="o">{</span><span class="n">u₁</span> <span class="n">u₃</span><span class="o">}</span> <span class="n">a</span>
</pre></div>


<p>This is an instance which invents <code>b</code> from nothing, as a metavariable. It solves <code>has_coe_to_sort a</code> by trying to solve <code>has_coe_t_aux a ?b</code> (which quickly boils down to solving <code>has_coe a ?b</code>) and then if that is successful it looks for <code>has_coe_to_sort b</code>. This kind of forward searching doesn't work with the mathlib instances, since you can't enumerate all the types which have coercions from nat (there are infinitely many). In fact due to the DFS search order it never gets around to checking any of them and instead builds infinitely large instances and overflows.</p>

<a name="164589824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164589824" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164589824">Floris van Doorn (May 01 2019 at 00:40)</a>:</h4>
<p>It would be nice if type class inference stops when its argument is a metavariable (note: I'm not saying it should stop when its argument <em>contains</em> a metavariable), so that <code>nat.cast_coe</code> would just fail, because the type class inference gives up once it has to find an instance of <code>has_one ?x</code>. If we ever rely on type class inference continuing in these cases, we should just provide more information.</p>

<a name="164590476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164590476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164590476">Mario Carneiro (May 01 2019 at 00:54)</a>:</h4>
<p>We could have a marker <code>in_param</code> that says "this argument must be a concrete type for this to trigger", or at least it shouldn't instantiate a metavariable in this slot. Better yet, it seems like this should be the default behavior for anything other than <code>out_param</code></p>

<a name="164590506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164590506" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164590506">Mario Carneiro (May 01 2019 at 00:55)</a>:</h4>
<p>In this case, that means that <code>canonically_ordered_comm_semiring ?x_26 := @with_top.canonically_ordered_comm_semiring </code> would not unify, because the metavar <code>?x_26</code> is treated as a constant</p>

<a name="164590604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164590604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164590604">Mario Carneiro (May 01 2019 at 00:57)</a>:</h4>
<p>Of course this sort of defeats the purpose of using a metavariable to begin with, but like I said, <code>has_coe</code> seems confused about whether its inputs are outputs or not</p>

<a name="164590660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164590660" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164590660">Mario Carneiro (May 01 2019 at 00:58)</a>:</h4>
<p><code>coe_sort_trans</code> seems like a very suspicious instance</p>

<a name="164592799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164592799" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164592799">Katherine Cordwell (May 01 2019 at 01:50)</a>:</h4>
<p>Still on the thread of weird error messages, why might Lean be giving me an "unexpected end of comment block" error on a blank line?</p>

<a name="164592819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164592819" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164592819">Katherine Cordwell (May 01 2019 at 01:51)</a>:</h4>
<p>Hmm never mind I solved it--an earlier comment was causing problems and the error message just manifested on an unrelated line.</p>

<a name="164592967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164592967" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164592967">Mario Carneiro (May 01 2019 at 01:54)</a>:</h4>
<p>the location of this error could be improved (logically it should go on the comment open token, or the entire unclosed comment region)</p>

<a name="164593199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Weird%20error%20message/near/164593199" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/91403Weirderrormessage.html#164593199">Katherine Cordwell (May 01 2019 at 01:59)</a>:</h4>
<p>Mostly what threw me off was that there were several (correct) theorems between the problematic comment and the error message.</p>


{% endraw %}
