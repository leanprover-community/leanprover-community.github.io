---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113489newmembers/75707factoringfunctions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html">"factoring" functions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="159178302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159178302" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159178302">Calle Sönne (Feb 22 2019 at 18:19)</a>:</h4>
<p>Code:</p>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">ratio_test</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">abs</span> <span class="o">((</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">/</span><span class="o">(</span><span class="n">a</span> <span class="n">n</span><span class="o">)))</span> <span class="n">L</span><span class="o">)</span>  <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="o">(</span><span class="n">a</span> <span class="n">n</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="n">a</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">h₃</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span> <span class="k">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h₄</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">&lt;</span> <span class="mi">1</span><span class="o">,</span> <span class="k">by</span> <span class="n">linarith</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="o">((</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="n">h₃</span> <span class="k">with</span> <span class="n">N</span> <span class="n">H</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">abs_sub_lt_iff</span><span class="o">]</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">imp_and_distrib</span><span class="o">,</span> <span class="n">forall_and_distrib</span><span class="o">]</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span> <span class="n">cases</span> <span class="n">H</span> <span class="k">with</span> <span class="n">Ha</span> <span class="n">Hb</span><span class="o">,</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="k">show</span> <span class="bp">∀</span> <span class="n">z</span><span class="o">,</span> <span class="n">z</span> <span class="bp">-</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">↔</span> <span class="n">z</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="mi">1</span><span class="bp">+</span><span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">,</span> <span class="k">by</span> <span class="n">intro</span> <span class="n">z</span> <span class="bp">;</span> <span class="n">split</span> <span class="bp">;</span> <span class="n">intro</span> <span class="bp">;</span> <span class="n">linarith</span><span class="o">]</span> <span class="n">at</span> <span class="n">Ha</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">h₅</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="n">n</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">n</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span><span class="o">,</span> <span class="n">exact</span> <span class="n">h₂</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">)},</span>
  <span class="k">have</span> <span class="n">h₆</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">abs</span> <span class="o">((</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="n">N</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">/</span><span class="o">(</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="n">N</span><span class="o">)))</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span><span class="bp">+</span><span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">,</span> <span class="o">{</span><span class="n">intro</span> <span class="n">n</span><span class="o">,</span> <span class="n">specialize</span> <span class="n">Ha</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">),</span> <span class="n">exact</span> <span class="n">le_of_lt</span> <span class="n">Ha</span><span class="o">},</span>
  <span class="k">have</span> <span class="n">lim₁</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="mi">0</span><span class="o">,</span> <span class="n">apply</span> <span class="n">ratio_test_aux</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="n">h₄</span> <span class="n">h₅</span> <span class="n">h₆</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<p>Tactic state:</p>
<div class="codehilite"><pre><span></span><span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="n">application</span>
  <span class="n">ratio_test_aux</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="n">h₄</span> <span class="n">h₅</span> <span class="n">h₆</span>
<span class="n">term</span>
  <span class="n">h₆</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">|</span><span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="n">n</span><span class="bp">|</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span>
<span class="n">state</span><span class="o">:</span>
<span class="mi">2</span> <span class="n">goals</span>
<span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">L</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">,</span>
<span class="n">h</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="n">n</span><span class="bp">|</span> <span class="o">)</span> <span class="n">L</span><span class="o">,</span>
<span class="n">h₁</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="mi">1</span><span class="o">,</span>
<span class="n">h₂</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="n">n</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">h₃</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">h₄</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span> <span class="bp">&lt;</span> <span class="mi">1</span><span class="o">,</span>
<span class="n">N</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">Hb</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≥</span> <span class="n">N</span> <span class="bp">→</span> <span class="n">L</span> <span class="bp">-</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">,</span>
<span class="n">Ha</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">x</span> <span class="bp">≥</span> <span class="n">N</span> <span class="bp">→</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="n">x</span><span class="bp">|</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span><span class="o">,</span>
<span class="n">h₅</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="n">n</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">,</span>
<span class="n">h₆</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">)</span><span class="bp">|</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">+</span> <span class="n">L</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">2</span>
<span class="err">⊢</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">))</span> <span class="mi">0</span>
</pre></div>


<p>How do I "factor" the functions in h6 so that ratio_test_aux will accept them as input?</p>

<a name="159178610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159178610" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159178610">Reid Barton (Feb 22 2019 at 18:22)</a>:</h4>
<p>It looks like the problem is just that <code>a (n + N + 1)</code> is not the same as <code>a ((n + 1) + N)</code></p>

<a name="159178616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159178616" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159178616">Chris Hughes (Feb 22 2019 at 18:22)</a>:</h4>
<p><code>simpa using h6</code> should work.</p>

<a name="159178635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159178635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159178635">Reid Barton (Feb 22 2019 at 18:22)</a>:</h4>
<p><code>set_option pp.beta true</code> can make this kind of error easier to spot by beta-reducing the lambdas in the expected type</p>

<a name="159178814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159178814" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159178814">Calle Sönne (Feb 22 2019 at 18:25)</a>:</h4>
<p>simpa using h6 in the argument?</p>

<a name="159178993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159178993" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159178993">Calle Sönne (Feb 22 2019 at 18:27)</a>:</h4>
<p>you are right, it seems to be just the order of the terms.</p>

<a name="159182963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159182963" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159182963">Kevin Buzzard (Feb 22 2019 at 19:14)</a>:</h4>
<p>Calle -- a year or so ago I was always asking these kinds of questions, because I did not know what Lean could or could not do. One rule of thumb is that Lean will happily identify two terms if they are <em>definitionally equal</em> -- i.e you do not explain to Lean that you need to change something to a definitionally equal thing, Lean just knows -- so it really helps if you have a good understand of what definitionally equal means. The actual definition is <a href="https://leanprover.github.io/reference/expressions.html#computation" target="_blank" title="https://leanprover.github.io/reference/expressions.html#computation">here</a>, and it's filed under "computation", which is something which took a lot of getting used to. You wanted to do "beta reduction" as you can see from that link, but if X reduces to Y via beta reduction then X and Y are definitionally equal (as you can see from the definition of definitionally equal just a bit further down) so that's why we don't have to bother with these things normally. What you need to do is to figure out which equalities are theorems rather than definitional equalities, and tell Lean to apply those theorems.</p>

<a name="159184873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159184873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159184873">Patrick Massot (Feb 22 2019 at 19:38)</a>:</h4>
<p><span class="user-mention" data-user-id="132603">@Calle Sönne</span> What are you hoping for when you write <code>simp only,</code>?</p>

<a name="159184985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159184985" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159184985">Chris Hughes (Feb 22 2019 at 19:40)</a>:</h4>
<p>Kenny probably told him to do that.</p>

<a name="159185043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185043">Patrick Massot (Feb 22 2019 at 19:40)</a>:</h4>
<p>I'm specifically talking about <code>simp only</code> without any argument</p>

<a name="159185053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185053" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185053">Patrick Massot (Feb 22 2019 at 19:40)</a>:</h4>
<p>with the comma right after "only"</p>

<a name="159185080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185080">Patrick Massot (Feb 22 2019 at 19:41)</a>:</h4>
<p>Sorry, dinner is calling</p>

<a name="159185099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185099" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185099">Kevin Buzzard (Feb 22 2019 at 19:41)</a>:</h4>
<p>Maybe it's similar to dsimp?</p>

<a name="159185118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185118" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185118">Calle Sönne (Feb 22 2019 at 19:41)</a>:</h4>
<p>I have no idea actually</p>

<a name="159185124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185124" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185124">Calle Sönne (Feb 22 2019 at 19:41)</a>:</h4>
<p>because code works without it</p>

<a name="159185217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185217" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185217">Calle Sönne (Feb 22 2019 at 19:43)</a>:</h4>
<p>I think it got left there after I gradually updated the code</p>

<a name="159185223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159185223" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159185223">Calle Sönne (Feb 22 2019 at 19:43)</a>:</h4>
<p>So in the end it had no function</p>

<a name="159188416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159188416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159188416">Patrick Massot (Feb 22 2019 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="132603">@Calle Sönne</span> I suggest you could study the following variation:</p>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">ratio_test</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">abs</span> <span class="o">((</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">/</span><span class="o">(</span><span class="n">a</span> <span class="n">n</span><span class="o">)))</span> <span class="n">L</span><span class="o">)</span>  <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="o">(</span><span class="n">a</span> <span class="n">n</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="n">a</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="o">((</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">)</span> <span class="k">with</span> <span class="n">N</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">limit_start_irrelevant</span> <span class="bp">_</span> <span class="n">N</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">ratio_test_aux</span> <span class="bp">_</span> <span class="o">((</span><span class="mi">1</span><span class="bp">+</span><span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">linarith</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">n</span><span class="o">,</span> <span class="n">apply</span> <span class="n">h₂</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">n</span><span class="o">,</span>
    <span class="n">specialize</span> <span class="n">H</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">),</span>
    <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="k">show</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">N</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">N</span><span class="o">,</span> <span class="k">by</span> <span class="n">ring</span><span class="o">]</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">set</span><span class="bp">!</span> <span class="n">r</span> <span class="o">:=</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">N</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="n">N</span><span class="o">)</span><span class="bp">|</span> <span class="k">with</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">ineq</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">-</span> <span class="n">L</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">,</span> <span class="k">by</span>  <span class="n">linarith</span> <span class="kn">using</span> <span class="o">[</span><span class="n">le_abs_self</span> <span class="o">(</span><span class="n">r</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)],</span>
    <span class="k">calc</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">-</span> <span class="n">L</span> <span class="bp">+</span> <span class="n">L</span> <span class="o">:</span> <span class="k">by</span> <span class="n">simp</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">L</span> <span class="o">:</span> <span class="n">add_le_add</span> <span class="n">ineq</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">L</span><span class="o">)</span>
       <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">1</span><span class="bp">+</span><span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span> <span class="o">},</span>
<span class="kn">end</span>
</pre></div>


<p>You'll see in particular how backward reasoning makes some things easier in this computerized math world.</p>

<a name="159190045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190045" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190045">Calle Sönne (Feb 22 2019 at 20:54)</a>:</h4>
<p>Thank you! Since you last saw my code I have made a bunch of the assumptions in limit_start_irrelevant implicit and now your code doesn't seem to be working .<br>
Code:</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">limit_start_irrelevant</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">{</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">{</span><span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">a</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="n">k</span><span class="o">))</span> <span class="n">l</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="n">a</span> <span class="n">l</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">ε</span> <span class="n">Hε</span><span class="o">,</span> <span class="n">cases</span> <span class="n">h</span> <span class="n">ε</span> <span class="n">Hε</span> <span class="k">with</span> <span class="n">N</span> <span class="n">H</span><span class="o">,</span> <span class="n">use</span> <span class="n">N</span> <span class="bp">+</span> <span class="n">k</span><span class="o">,</span> <span class="n">intros</span> <span class="n">n</span> <span class="n">Hn</span><span class="o">,</span> <span class="n">simp</span> <span class="n">only</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">ineq</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">,</span> <span class="n">rw</span> <span class="n">add_comm</span> <span class="n">at</span> <span class="n">Hn</span><span class="o">,</span> <span class="n">exact</span> <span class="o">(</span><span class="n">le_trans</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_sub_right_of_add_le</span> <span class="n">Hn</span><span class="o">)</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">sub_le_self</span> <span class="n">n</span> <span class="n">N</span><span class="o">)),</span>
  <span class="n">replace</span> <span class="n">H</span> <span class="o">:=</span> <span class="o">(</span><span class="n">H</span> <span class="o">(</span><span class="n">n</span> <span class="bp">-</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">le_sub_right_of_add_le</span> <span class="n">Hn</span><span class="o">)),</span>
  <span class="n">rwa</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="err">←</span><span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_assoc</span> <span class="n">ineq</span><span class="o">,</span> <span class="n">add_comm</span><span class="o">,</span> <span class="n">nat</span><span class="bp">.</span><span class="n">add_sub_cancel</span><span class="o">]</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<p>It gives following error:</p>
<div class="codehilite"><pre><span></span><span class="n">invalid</span> <span class="n">apply</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">unify</span>
  <span class="n">is_limit</span> <span class="n">a</span> <span class="mi">0</span>
<span class="k">with</span>
  <span class="err">↑</span><span class="n">N</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">∃</span> <span class="o">(</span><span class="n">N_1</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">n</span> <span class="bp">≥</span> <span class="n">N_1</span> <span class="bp">→</span> <span class="bp">|</span><span class="err">?</span><span class="n">m_1</span> <span class="n">n</span> <span class="bp">-</span> <span class="err">?</span><span class="n">m_2</span><span class="bp">|</span> <span class="bp">&lt;</span> <span class="err">↑</span><span class="n">N</span><span class="o">)</span>
</pre></div>


<p>If I remove N in your line <code>apply limit_start_irrelevant _ N</code> I get following tactic state:</p>
<div class="codehilite"><pre><span></span>2 goals
a : ℕ → ℝ,
L : ℝ,
h : is_limit (λ (n : ℕ), |a (n + 1) / a n| ) L,
h₁ : L &lt; 1,
h₂ : ∀ (n : ℕ), a n ≠ 0,
N : ℕ,
H : ∀ (n : ℕ), n ≥ N → |(λ (n : ℕ), |a (n + 1) / a n| ) n - L| &lt; (1 - L) / 2
⊢ ℕ

a : ℕ → ℝ,
L : ℝ,
h : is_limit (λ (n : ℕ), |a (n + 1) / a n| ) L,
h₁ : L &lt; 1,
h₂ : ∀ (n : ℕ), a n ≠ 0,
N : ℕ,
H : ∀ (n : ℕ), n ≥ N → |(λ (n : ℕ), |a (n + 1) / a n| ) n - L| &lt; (1 - L) / 2
⊢ is_limit (λ (n : ℕ), a (n + ?m_1)) 0
</pre></div>

<a name="159190253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190253" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190253">Patrick Massot (Feb 22 2019 at 20:57)</a>:</h4>
<p>You shouldn't make k implicit</p>

<a name="159190296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190296" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190296">Patrick Massot (Feb 22 2019 at 20:58)</a>:</h4>
<p>As you can see, Lean couldn't figure it out</p>

<a name="159190329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190329" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190329">Patrick Massot (Feb 22 2019 at 20:58)</a>:</h4>
<p>Your first goal (in the latest message you wrote) is asking "who is k?"</p>

<a name="159190380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190380" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190380">Patrick Massot (Feb 22 2019 at 20:59)</a>:</h4>
<p>I think even making <code>a</code> implicit is fishy</p>

<a name="159190385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190385" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190385">Patrick Massot (Feb 22 2019 at 20:59)</a>:</h4>
<p>Although in your main proof this will be ok</p>

<a name="159190412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190412" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190412">Calle Sönne (Feb 22 2019 at 20:59)</a>:</h4>
<p>Ah, I see. It worked in my main proof but I guess that was because I explictly had the limit?</p>

<a name="159190504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190504">Patrick Massot (Feb 22 2019 at 21:00)</a>:</h4>
<p>A smarter move if you want to optimize the main proof is to change <code>n+k</code> into <code>k+n</code> in the assumption <code>h</code></p>

<a name="159190523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190523" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190523">Patrick Massot (Feb 22 2019 at 21:00)</a>:</h4>
<p>This way you won't hit that <code>n+N+1</code> vs <code>N+n+1</code> issue</p>

<a name="159190534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190534">Patrick Massot (Feb 22 2019 at 21:00)</a>:</h4>
<p>yes</p>

<a name="159190662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190662">Patrick Massot (Feb 22 2019 at 21:02)</a>:</h4>
<p>With this change you can get the main proof down to:</p>

<a name="159190667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190667">Patrick Massot (Feb 22 2019 at 21:02)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">ratio_test</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">L</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">abs</span> <span class="o">((</span><span class="n">a</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span><span class="bp">/</span><span class="o">(</span><span class="n">a</span> <span class="n">n</span><span class="o">)))</span> <span class="n">L</span><span class="o">)</span>  <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="mi">1</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="o">(</span><span class="n">a</span> <span class="n">n</span><span class="o">)</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="n">a</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="o">((</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">)</span> <span class="k">with</span> <span class="n">N</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">limit_start_irrelevant</span> <span class="n">N</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">ratio_test_aux</span> <span class="bp">_</span> <span class="o">((</span><span class="mi">1</span><span class="bp">+</span><span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">linarith</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">n</span><span class="o">,</span> <span class="n">apply</span> <span class="n">h₂</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intro</span> <span class="n">n</span><span class="o">,</span>
    <span class="n">specialize</span> <span class="n">H</span> <span class="o">(</span><span class="n">N</span><span class="bp">+</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="k">by</span> <span class="n">linarith</span><span class="o">),</span>
    <span class="n">set</span><span class="bp">!</span> <span class="n">r</span> <span class="o">:=</span> <span class="bp">|</span><span class="n">a</span> <span class="o">(</span><span class="n">N</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">/</span> <span class="n">a</span> <span class="o">(</span><span class="n">N</span> <span class="bp">+</span><span class="n">n</span><span class="o">)</span><span class="bp">|</span> <span class="k">with</span> <span class="n">h</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">ineq</span> <span class="o">:</span> <span class="n">r</span> <span class="bp">-</span> <span class="n">L</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span><span class="o">,</span> <span class="k">by</span>  <span class="n">linarith</span> <span class="kn">using</span> <span class="o">[</span><span class="n">le_abs_self</span> <span class="o">(</span><span class="n">r</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)],</span>
    <span class="k">calc</span> <span class="n">r</span> <span class="bp">=</span> <span class="n">r</span> <span class="bp">-</span> <span class="n">L</span> <span class="bp">+</span> <span class="n">L</span>     <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>
       <span class="bp">...</span> <span class="bp">≤</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">-</span> <span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span> <span class="bp">+</span> <span class="n">L</span> <span class="o">:</span> <span class="n">add_le_add</span> <span class="n">ineq</span> <span class="o">(</span><span class="n">le_refl</span> <span class="n">L</span><span class="o">)</span>
       <span class="bp">...</span> <span class="bp">=</span> <span class="o">(</span><span class="mi">1</span><span class="bp">+</span><span class="n">L</span><span class="o">)</span><span class="bp">/</span><span class="mi">2</span>       <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span> <span class="o">},</span>
<span class="kn">end</span>
</pre></div>

<a name="159190722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190722">Calle Sönne (Feb 22 2019 at 21:03)</a>:</h4>
<p>ah, thank you!</p>

<a name="159190812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159190812" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159190812">Calle Sönne (Feb 22 2019 at 21:04)</a>:</h4>
<p>What is the motivation for using set! instead of let?</p>

<a name="159191675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159191675" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159191675">Patrick Massot (Feb 22 2019 at 21:16)</a>:</h4>
<p><code>set!</code> removes the complicated stuff from everywhere</p>

<a name="159192945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159192945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159192945">Patrick Massot (Feb 22 2019 at 21:31)</a>:</h4>
<p>One more free trick in nat subtraction fighting (while whaiting for <span class="user-mention" data-user-id="116585">@Seul Baek</span>  to save us all). You can study</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">limit_start_irrelevant</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">k</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">{</span><span class="n">l</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">M1P1</span><span class="bp">.</span><span class="n">is_limit</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">n</span><span class="o">,</span> <span class="n">a</span> <span class="o">(</span><span class="n">k</span><span class="bp">+</span><span class="n">n</span><span class="o">))</span> <span class="n">l</span><span class="o">)</span> <span class="o">:</span> <span class="n">M1P1</span><span class="bp">.</span><span class="n">is_limit</span> <span class="n">a</span> <span class="n">l</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">ε</span> <span class="n">Hε</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">h</span> <span class="n">ε</span> <span class="n">Hε</span> <span class="k">with</span> <span class="n">N</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">use</span> <span class="n">k</span> <span class="bp">+</span> <span class="n">N</span><span class="o">,</span>
  <span class="n">intros</span> <span class="n">n</span> <span class="n">Hn</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">key</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">k</span> <span class="bp">≥</span> <span class="n">N</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">le_sub_left_of_add_le</span> <span class="n">Hn</span><span class="o">,</span>
  <span class="n">specialize</span> <span class="n">H</span> <span class="o">(</span><span class="n">n</span><span class="bp">-</span><span class="n">k</span><span class="o">),</span>
  <span class="n">convert</span> <span class="n">H</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_inj</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_add</span><span class="o">,</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_sub</span><span class="o">],</span>
  <span class="n">repeat</span> <span class="o">{</span> <span class="n">linarith</span> <span class="o">},</span>
<span class="kn">end</span>
</pre></div>


<p>The idea is that, after fighting to get <code>n - k ≥ N</code> you can escape to integer heaven using <code>int.coe_nat_inj</code>.</p>

<a name="159197220"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197220" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197220">Calle Sönne (Feb 22 2019 at 22:31)</a>:</h4>
<p>I dont quite get how convert works. Its like refine but can also add goals based on discrepency between goal and input?</p>

<a name="159197236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197236" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197236">Patrick Massot (Feb 22 2019 at 22:31)</a>:</h4>
<p>yes</p>

<a name="159197263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197263" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197263">Patrick Massot (Feb 22 2019 at 22:31)</a>:</h4>
<p>It tries hard to bridge the gap between what you give it and the goal</p>

<a name="159197315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197315" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197315">Calle Sönne (Feb 22 2019 at 22:32)</a>:</h4>
<p>How "close" to the goal does the input need to be for lean to detect each "discrepency" then?</p>

<a name="159197347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197347">Calle Sönne (Feb 22 2019 at 22:32)</a>:</h4>
<p>like... Is there a rule I can follow? Or should I just try it whenever it would be convenient IF it worked.</p>

<a name="159197376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197376">Patrick Massot (Feb 22 2019 at 22:33)</a>:</h4>
<p>Under the hood it uses the <code>congr'</code> tactic. If this tells you nothing then you need to study <code>congr'</code> first</p>

<a name="159197450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159197450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159197450">Calle Sönne (Feb 22 2019 at 22:34)</a>:</h4>
<p>okay, I will read up on <code> congr'</code> then</p>

<a name="159201273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159201273" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159201273">Kevin Buzzard (Feb 22 2019 at 23:41)</a>:</h4>
<p><code>convert blah</code> just means that you want the goal to be proved by <code>blah</code> and so ask me about all the places where this is not exactly right</p>

<a name="159214790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159214790" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159214790">Johan Commelin (Feb 23 2019 at 05:26)</a>:</h4>
<p>I would love if I could have a bit more fine-grained control on <code>convert</code>. With <code>congr'</code> I can say how deep it should go. I would sometimes like to have <code>convert' n</code>. Because if my goal is <code>foo long_expr (bar (x * y * z))</code> and I have an assumption <code>this : foo long_expr (bar (y * x * z))</code>, then <code>convert this</code> will give me goals <code>x = y</code> and <code>y = x</code>, which is very unhelpful. It should of course give me 1 goal <code>x * y * z = y * x * z</code>.</p>

<a name="159216082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159216082" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159216082">Reid Barton (Feb 23 2019 at 06:10)</a>:</h4>
<p><code>convert this using 2</code>  (I think)</p>

<a name="159216097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/%22factoring%22%20functions/near/159216097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/75707factoringfunctions.html#159216097">Johan Commelin (Feb 23 2019 at 06:11)</a>:</h4>
<p>Aaah, I think I tried <code>convert 2 using this</code>... which feels more in line with <code>simpa</code>... but anyway. I'll try this next time I need it.</p>


{% endraw %}

{% include archive_update.html %}