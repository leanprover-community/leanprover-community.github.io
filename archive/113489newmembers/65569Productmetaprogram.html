---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113489newmembers/65569Productmetaprogram.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html">Product meta program</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="130535258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130535258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130535258">Ken Roe (Jul 29 2018 at 18:48)</a>:</h4>
<p>Here is a simple meta program to simplify a product expression.  It does not seem to match anything.  Can someone explain what is happening?</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">simplifyProd</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
    <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
      <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span> <span class="n">tt1a</span><span class="o">)</span>
      <span class="n">tt1b</span><span class="o">)</span>
     <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
        <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
          <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
            <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">mk</span><span class="o">)</span> <span class="n">tt1</span><span class="o">)</span> <span class="n">tt2</span><span class="o">)</span> <span class="n">a</span><span class="o">)</span> <span class="n">b</span><span class="o">))</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">b</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">lam</span> <span class="n">v</span> <span class="n">b</span> <span class="n">t</span> <span class="n">e</span><span class="o">)</span> <span class="o">:=</span> <span class="n">expr</span><span class="bp">.</span><span class="n">lam</span> <span class="n">v</span> <span class="n">b</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">e</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="n">v</span> <span class="n">b</span> <span class="n">t</span> <span class="n">e</span><span class="o">)</span> <span class="o">:=</span> <span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="n">v</span> <span class="n">b</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">e</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span>

<span class="kn">theorem</span> <span class="n">testit</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">fst</span><span class="bp">=</span><span class="n">f</span> <span class="o">:=</span>
<span class="k">begin</span>
   <span class="n">do</span> <span class="o">{</span>
       <span class="n">t</span> <span class="err">←</span> <span class="n">target</span><span class="o">,</span>
       <span class="n">trace</span> <span class="s2">&quot;Start&quot;</span><span class="o">,</span>
       <span class="n">trace</span> <span class="n">t</span><span class="bp">.</span><span class="n">to_raw_fmt</span><span class="o">,</span>
       <span class="n">tq</span> <span class="err">←</span> <span class="n">some</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">t</span><span class="o">),</span>
       <span class="n">trace</span> <span class="n">tq</span><span class="bp">.</span><span class="n">to_raw_fmt</span><span class="o">,</span>
       <span class="n">change</span> <span class="n">tq</span>
   <span class="o">},</span>
   <span class="n">refl</span>
<span class="kn">end</span>
</pre></div>

<a name="130536744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130536744" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130536744">Reid Barton (Jul 29 2018 at 19:26)</a>:</h4>
<p>Well, I don't know, but replacing the first case with <code>| `(prod.fst (prod.mk %%a %%b)) := a</code> works.<br>
Maybe something involving universe variables?</p>

<a name="130536883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130536883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130536883">Kevin Buzzard (Jul 29 2018 at 19:32)</a>:</h4>
<p><span class="user-mention" data-user-id="121304">@Ken Roe</span> Just to let you know that probably nobody is reading the Lean bug reports. The developers are working on Lean 4 and anything that isn't obviously a serious issue in 3.4.1 which needs addressing (e.g. a proof of false) is very likely to be ignored.</p>

<a name="130540273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130540273" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130540273">Ken Roe (Jul 29 2018 at 21:18)</a>:</h4>
<p>Actually, `(prod.fst (<a href="http://prod.mk" target="_blank" title="http://prod.mk">prod.mk</a> %%a %%b)) probably works but I'm trying to avoid quoting.  I doing pattern matching that is breaking apart \lambda expressions and I found that %%x inside a lambda lifts the variables (which I would like to avoid).  I've also been running into type checking issues.  If people are interested, I can post more cases illustrating more issues.</p>
<p>Right now, I'm pretty frustrated.  I'm trying to build a separation logic using Lean.  Right now, all paths to building the necessary tactics are blocked due to missing documentation or bugs.</p>

<a name="130540874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130540874" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130540874">Patrick Massot (Jul 29 2018 at 21:20)</a>:</h4>
<p>You should talk to Simon, he knows both tactics and separation logic in Lean</p>

<a name="130540986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130540986" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130540986">Simon Hudon (Jul 29 2018 at 21:25)</a>:</h4>
<p>If you want, I have started on a separation logic package: <a href="https://github.com/unitb/separation-logic" target="_blank" title="https://github.com/unitb/separation-logic">https://github.com/unitb/separation-logic</a>. It might be easier to collaborate on it.</p>

<a name="130541039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130541039" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130541039">Simon Hudon (Jul 29 2018 at 21:26)</a>:</h4>
<p>So far, my tactics can handle a twenty-line proof of the list reversal program: <a href="https://github.com/unitb/separation-logic/blob/master/src/separation/examples.lean#L118-L137" target="_blank" title="https://github.com/unitb/separation-logic/blob/master/src/separation/examples.lean#L118-L137">https://github.com/unitb/separation-logic/blob/master/src/separation/examples.lean#L118-L137</a></p>

<a name="130541248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130541248" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130541248">Ken Roe (Jul 29 2018 at 21:34)</a>:</h4>
<p>Can someone send me a private message with Simon's contact information?  By the way, to illustrate another issue, I just added another case which causes simplifyProd to not compile.</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">simplifyProd</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">expr</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
    <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
      <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">fst</span><span class="o">)</span> <span class="n">tt1a</span><span class="o">)</span>
      <span class="n">tt1b</span><span class="o">)</span>
     <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
        <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
          <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span>
            <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="bp">`</span><span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">mk</span><span class="o">)</span> <span class="n">tt1</span><span class="o">)</span> <span class="n">tt2</span><span class="o">)</span> <span class="n">a</span><span class="o">)</span> <span class="n">b</span><span class="o">))</span> <span class="o">:=</span> <span class="n">a</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">((</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="err">%%</span><span class="n">f</span><span class="o">)</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="err">%%</span><span class="n">z</span><span class="o">))</span> <span class="o">:=</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">f</span> <span class="o">(</span><span class="err">%%</span><span class="n">z</span><span class="bp">+</span><span class="mi">1</span><span class="o">))</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">expr</span><span class="bp">.</span><span class="n">app</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">b</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">lam</span> <span class="n">v</span> <span class="n">b</span> <span class="n">t</span> <span class="n">e</span><span class="o">)</span> <span class="o">:=</span> <span class="n">expr</span><span class="bp">.</span><span class="n">lam</span> <span class="n">v</span> <span class="n">b</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">e</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="n">v</span> <span class="n">b</span> <span class="n">t</span> <span class="n">e</span><span class="o">)</span> <span class="o">:=</span> <span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="n">v</span> <span class="n">b</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">e</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span>

<span class="kn">theorem</span> <span class="n">testit</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">f</span><span class="o">,</span><span class="n">s</span><span class="o">)</span><span class="bp">.</span><span class="n">fst</span><span class="bp">=</span><span class="n">f</span> <span class="o">:=</span>
<span class="k">begin</span>
   <span class="n">do</span> <span class="o">{</span>
       <span class="n">t</span> <span class="err">←</span> <span class="n">target</span><span class="o">,</span>
       <span class="n">trace</span> <span class="s2">&quot;Start&quot;</span><span class="o">,</span>
       <span class="n">trace</span> <span class="n">t</span><span class="bp">.</span><span class="n">to_raw_fmt</span><span class="o">,</span>
       <span class="n">tq</span> <span class="err">←</span> <span class="n">some</span> <span class="o">(</span><span class="n">simplifyProd</span> <span class="n">t</span><span class="o">),</span>
       <span class="n">trace</span> <span class="n">tq</span><span class="bp">.</span><span class="n">to_raw_fmt</span><span class="o">,</span>
       <span class="n">change</span> <span class="n">tq</span>
   <span class="o">},</span>
   <span class="n">refl</span>
<span class="kn">end</span>
</pre></div>


<p>This case with the lambda gives the following error on the %%f:</p>
<div class="codehilite"><pre><span></span><span class="n">function</span> <span class="n">expected</span> <span class="n">at</span>
  <span class="bp">_</span><span class="n">x_1</span>
<span class="n">term</span> <span class="n">has</span> <span class="n">type</span>
  <span class="err">?</span><span class="n">m_1</span>
</pre></div>

<a name="130541265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130541265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130541265">Patrick Massot (Jul 29 2018 at 21:35)</a>:</h4>
<p>you can click on his name, right above your question</p>

<a name="130541304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130541304" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130541304">Patrick Massot (Jul 29 2018 at 21:36)</a>:</h4>
<p>I mean: right above in this thread</p>

<a name="130541312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130541312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130541312">Ken Roe (Jul 29 2018 at 21:37)</a>:</h4>
<p>Never mind on the contact info--I just saw a message from Simon. </p>
<p>I'm more than happy to collaborate on separation logic.  I did work on separation logic using Coq for my PhD.  You can check out my home page at <a href="http://www.cs.jhu.edu/~roe" target="_blank" title="http://www.cs.jhu.edu/~roe">www.cs.jhu.edu/~roe</a>.  I'm working on porting my system to Lean.</p>

<a name="130541412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130541412" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130541412">Simon Hudon (Jul 29 2018 at 21:40)</a>:</h4>
<p>Cool thanks, that should be helpful. You can have a look at how far I got right here: <a href="#narrow/stream/113489-new-members/subject/Product.20meta.20program/near/130540986" title="#narrow/stream/113489-new-members/subject/Product.20meta.20program/near/130540986">https://leanprover.zulipchat.com/#narrow/stream/113489-new-members/subject/Product.20meta.20program/near/130540986</a></p>

<a name="130597942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130597942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130597942">Ken Roe (Jul 30 2018 at 18:48)</a>:</h4>
<p>Actually, an ideal solution would be not to use `(<a href="http://prod.mk" target="_blank" title="http://prod.mk">prod.mk</a>).   Is there an alternative that I can plug in without changing the surrounding text?  I would like to find a way of expression my product meta program without using any back quote annotations.  The motivation is that I actually have some more complex meta programs where I'm finding the back quote notation has semantics that is causing a number of problems.</p>

<a name="130598427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130598427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130598427">Simon Hudon (Jul 30 2018 at 18:57)</a>:</h4>
<p>Can you show us that other program?</p>

<a name="130606073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130606073" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130606073">Ken Roe (Jul 30 2018 at 21:39)</a>:</h4>
<p>I'll put it up in a day or two.  The code isn't stand alone.  It is dependent on the infrastructure in my separation logic framework.  I need to put the work into a github repository and then post the critical meta functions.</p>

<a name="130956238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Product%20meta%20program/near/130956238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/65569Productmetaprogram.html#130956238">Ken Roe (Aug 06 2018 at 03:52)</a>:</h4>
<p>I've posted the source code that I have of my separation framework so far here: <a href="https://github.com/kendroe/pedantic2" target="_blank" title="https://github.com/kendroe/pedantic2">https://github.com/kendroe/pedantic2</a>.  Some of my future questions will point to this repository.  I'm porting the Coq implementation.  Information on this implementation (and repository link) can be found here: <a href="http://www.cs.jhu.edu/~roe" target="_blank" title="http://www.cs.jhu.edu/~roe">http://www.cs.jhu.edu/~roe</a>.</p>


{% endraw %}

{% include archive_update.html %}