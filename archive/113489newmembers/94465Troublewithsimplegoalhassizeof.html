---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html">Trouble with simple goal/has_sizeof</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="157895907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157895907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157895907">cbailey (Feb 08 2019 at 21:45)</a>:</h4>
<p>Hello again. I have a proof obligation of :</p>
<div class="codehilite"><pre><span></span> <span class="err">⊢</span> <span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">h</span> <span class="bp">&lt;</span> <span class="n">succ</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">h</span><span class="o">)</span>
</pre></div>


<p>I'm not able to dismiss this with lt_succ_self (forall (n : nat), n &lt; succ n), and I'm not able to generalize them to the same term; trying to generalize them to some term h_2 leaves me with:</p>
<div class="codehilite"><pre><span></span><span class="err">⊢</span><span class="n">h_2</span> <span class="bp">&lt;</span> <span class="n">succ</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">h</span><span class="o">)</span>
</pre></div>


<p>I'm working with a self-defined instance of has_sizeof, and my lack of understanding of the relationship between has_size of and sizeof may or may not be to blame.</p>
<p>Thank you for any help</p>

<a name="157896143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896143" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896143">Kevin Buzzard (Feb 08 2019 at 21:48)</a>:</h4>
<p>are you sure you have exactly one variable <code>h</code>?</p>

<a name="157896152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896152" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896152">Kevin Buzzard (Feb 08 2019 at 21:48)</a>:</h4>
<p>Check your local context for dupes</p>

<a name="157896160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896160">Kevin Buzzard (Feb 08 2019 at 21:48)</a>:</h4>
<p>Lean will happily let you call ten things <code>h</code></p>

<a name="157896174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896174" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896174">Kevin Buzzard (Feb 08 2019 at 21:48)</a>:</h4>
<p>it's a feature</p>

<a name="157896196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896196">Patrick Massot (Feb 08 2019 at 21:49)</a>:</h4>
<p>I hate this feature, especially while teaching</p>

<a name="157896292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896292" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896292">Kevin Buzzard (Feb 08 2019 at 21:50)</a>:</h4>
<p><span class="user-mention" data-user-id="126632">@cbailey</span> if you want to get very intimidated, you could write <code>set_option pp.all true</code> just above your theorem and then look at what Lean really thinks your goal is. It might be a way of seeing if the two <code>h</code>'s are actually the same</p>

<a name="157896312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157896312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157896312">Kevin Buzzard (Feb 08 2019 at 21:50)</a>:</h4>
<p>I think that the <code>generalize</code> should work. I am guessing you have two different things called <code>h</code></p>

<a name="157899519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157899519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157899519">cbailey (Feb 08 2019 at 22:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>  <code>set_option pp.all_true</code> is awesome, I learned something new already, thank you.  It does seem to have something to do with the fact that I had to define has_sizeof. The goal</p>
<div class="codehilite"><pre><span></span><span class="n">t</span> <span class="o">:</span> <span class="n">zTree</span>
<span class="err">⊢</span> <span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span> <span class="o">(</span><span class="n">zTree_pr2</span> <span class="n">t</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">succ</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span> <span class="o">(</span><span class="n">zTree_pr2</span> <span class="n">t</span><span class="o">))</span>
</pre></div>


<p>has this term <code>has_sizeof_inst</code> which I wasn't able to find any info about in the source on github, but I guess is enough to prevent unification, since the only parts that are different are <code>zTree.has_sizeof</code> vs <code>zTree.has_sizeof_inst</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">t</span> <span class="o">:</span> <span class="n">zTree</span>
<span class="err">⊢</span> <span class="bp">@</span><span class="n">has_lt</span><span class="bp">.</span><span class="n">lt</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">nat</span> <span class="n">nat</span><span class="bp">.</span><span class="n">has_lt</span> <span class="o">(</span><span class="bp">@</span><span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">zTree</span> <span class="n">zTree</span><span class="bp">.</span><span class="n">has_sizeof</span> <span class="o">(</span><span class="n">zTree_pr2</span> <span class="n">t</span><span class="o">))</span>
    <span class="o">(</span><span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="o">(</span><span class="bp">@</span><span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span><span class="bp">.</span><span class="o">{</span><span class="mi">0</span><span class="o">}</span> <span class="n">zTree</span> <span class="n">zTree</span><span class="bp">.</span><span class="n">has_sizeof_inst</span> <span class="o">(</span><span class="n">zTree_pr2</span> <span class="n">t</span><span class="o">)))</span>
</pre></div>

<a name="157899733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157899733" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157899733">Kevin Buzzard (Feb 08 2019 at 22:42)</a>:</h4>
<p>It's hard for me to make any coherent comment because I don't know the type of anything</p>

<a name="157899735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157899735" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157899735">Mario Carneiro (Feb 08 2019 at 22:42)</a>:</h4>
<p>It sounds like you made some poor choices earlier to lead you here. Why are you defining a has_sizeof instance? What is the context of this goal?</p>

<a name="157949098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949098">cbailey (Feb 09 2019 at 22:53)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> You're probably right; I spent last night/this morning doing some more reading so as not to waste everyone's time. I'm using the nested inductive definition from TPIL ch. 7,</p>
<div class="codehilite"><pre><span></span><span class="kn">inductive</span> <span class="n">tree</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">mk</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">tree</span>
</pre></div>


<p>I was writing a mutually recursive function from tree -&gt; string to give it has_repr following the pattern in Ch. 8, and the the proof Lean wanted for termination became:</p>
<div class="codehilite"><pre><span></span><span class="n">list</span><span class="bp">.</span><span class="n">sizeof</span> <span class="o">(</span><span class="n">tree_tail</span> <span class="n">x</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">tree</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">x</span>
</pre></div>


<p>so between that and a few other attempts using patterns from TPIL chapter 8 that also got stuck on <code>list.sizeof</code> issues, I started (naively) prodding the has_sizeof typeclass  since TPIL ch. 7 doesn't go into any detail about how to define recursive functions on nested inductive types other than to say it's tricky; The mutually recursive definitions in 8.5 are on a type with two constructors. In searching Zulip I saw Dr. Carneiro and Dr. DeMoura mention that lean 3 does not supported nested inductive types and instead reduces them to normal inductive types internally, but that v4 will include support for nested inductive types. Will this kind of recursive function become admissible/feasible in version 4?</p>

<a name="157949144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949144" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949144">Mario Carneiro (Feb 09 2019 at 22:54)</a>:</h4>
<p>I don't say that to judge you; it is actually very common to have XY problems asked here because you make a choice that seems okay and it doesn't really cause a problem until way down the line</p>

<a name="157949153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949153">Kenny Lau (Feb 09 2019 at 22:54)</a>:</h4>
<p><a href="#narrow/stream/113488-general/topic/Lean.20assignment.20from.20Kenny" title="#narrow/stream/113488-general/topic/Lean.20assignment.20from.20Kenny">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean.20assignment.20from.20Kenny</a></p>

<a name="157949158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949158">Kenny Lau (Feb 09 2019 at 22:54)</a>:</h4>
<p>I think that inductive type would be very messy, right</p>

<a name="157949169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949169" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949169">Mario Carneiro (Feb 09 2019 at 22:55)</a>:</h4>
<p>My first instinct is to say "nested inductive = bad idea" here</p>

<a name="157949172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949172" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949172">Chris Hughes (Feb 09 2019 at 22:55)</a>:</h4>
<p>The trouble with nested inductive types at the moment is that the code doesn't give you a strong enough recursor, so you're forced to use the equation compiler.</p>

<a name="157949218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949218" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949218">Mario Carneiro (Feb 09 2019 at 22:56)</a>:</h4>
<p>Also I'm not a Dr yet. :)</p>

<a name="157949222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949222" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949222">Chris Hughes (Feb 09 2019 at 22:56)</a>:</h4>
<p>And I guess the <code>sizeof</code> proof obligations are probably going to be quite difficult if they're not filled in automatically by the equation compiler.</p>

<a name="157949238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949238">Mario Carneiro (Feb 09 2019 at 22:57)</a>:</h4>
<p>v4 will not include support for nested inductive types, but it will have native support for mutual inductives</p>

<a name="157949239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949239">Mario Carneiro (Feb 09 2019 at 22:57)</a>:</h4>
<p>at least as far as I know</p>

<a name="157949291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949291" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949291">Mario Carneiro (Feb 09 2019 at 22:58)</a>:</h4>
<p>However Jeremy, Simon and I are working on a better compilation of nested inductive types, which will probably be fairly similar to the current implementation in this case</p>

<a name="157949301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949301" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949301">Mario Carneiro (Feb 09 2019 at 22:59)</a>:</h4>
<p>except that you get a proper recursion principle using list.map instead of a mutual def</p>

<a name="157949345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949345" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949345">Mario Carneiro (Feb 09 2019 at 23:00)</a>:</h4>
<p>Could you share the rest of your definitions between the inductive and the problematic proof?</p>

<a name="157949414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949414" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949414">Chris Hughes (Feb 09 2019 at 23:02)</a>:</h4>
<blockquote>
<p>except that you get a proper recursion principle using list.map instead of a mutual def</p>
</blockquote>
<p>Why would the recursor use <code>list.map</code>?</p>

<a name="157949590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949590" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949590">cbailey (Feb 09 2019 at 23:08)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> No I appreciate it, I didn't feel judged. I thought you were probably right and I needed to ask a better question. The code is here : <a href="https://gist.github.com/ammkrn/2ae08526358d27ce3705861cf9187d40" target="_blank" title="https://gist.github.com/ammkrn/2ae08526358d27ce3705861cf9187d40">https://gist.github.com/ammkrn/2ae08526358d27ce3705861cf9187d40</a></p>

<a name="157949601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949601" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949601">Mario Carneiro (Feb 09 2019 at 23:09)</a>:</h4>
<p>here's the expected type and computation rule for the (nondependent) recursor:</p>
<div class="codehilite"><pre><span></span><span class="kn">constant</span> <span class="n">tree</span><span class="bp">.</span><span class="n">rec&#39;</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="o">(</span><span class="n">tree</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="n">tree</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span>

<span class="kn">axiom</span> <span class="n">tree</span><span class="bp">.</span><span class="n">rec&#39;_eq</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span>
  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="o">(</span><span class="n">tree</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">tree</span> <span class="n">α</span><span class="o">))</span> <span class="o">:</span>
  <span class="n">tree</span><span class="bp">.</span><span class="n">rec&#39;</span> <span class="n">f</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">mk</span> <span class="n">a</span> <span class="n">l</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">a</span> <span class="n">l</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">rec&#39;</span> <span class="n">f</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">l</span><span class="o">)</span>
</pre></div>

<a name="157949745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949745">Mario Carneiro (Feb 09 2019 at 23:13)</a>:</h4>
<p>in this case it's actually pretty easy to fix:</p>
<div class="codehilite"><pre><span></span><span class="kn">inductive</span> <span class="n">tree</span>
<span class="bp">|</span> <span class="n">mk</span> <span class="o">:</span> <span class="n">string</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">tree</span>

<span class="n">def</span> <span class="n">tree_val</span> <span class="o">:</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">string</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">mk</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span>

<span class="n">def</span> <span class="n">tree_list</span> <span class="o">:</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">tree</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">mk</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">b</span>

<span class="n">mutual</span> <span class="n">def</span> <span class="n">num_tree</span><span class="o">,</span> <span class="n">num_list_tree</span>
<span class="k">with</span> <span class="n">num_tree</span> <span class="o">:</span> <span class="n">tree</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">mk</span> <span class="n">a</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span> <span class="o">(</span><span class="n">num_list_tree</span> <span class="n">l</span><span class="o">)</span>
<span class="k">with</span> <span class="n">num_list_tree</span> <span class="o">:</span> <span class="n">list</span> <span class="n">tree</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">hd</span> <span class="bp">::</span> <span class="n">tl</span><span class="o">)</span> <span class="o">:=</span> <span class="n">num_tree</span> <span class="n">hd</span> <span class="bp">+</span> <span class="n">num_list_tree</span> <span class="n">tl</span>

<span class="n">mutual</span> <span class="n">def</span> <span class="n">string_tree</span><span class="o">,</span> <span class="n">string_list_tree</span>
<span class="k">with</span> <span class="n">string_tree</span> <span class="o">:</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">string</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">mk</span> <span class="n">a</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">++</span> <span class="n">string_list_tree</span> <span class="n">l</span>
<span class="k">with</span> <span class="n">string_list_tree</span> <span class="o">:</span> <span class="n">list</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">string</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">hd</span> <span class="bp">::</span> <span class="n">tl</span><span class="o">)</span> <span class="o">:=</span> <span class="n">string_tree</span> <span class="n">hd</span> <span class="bp">++</span> <span class="n">string_list_tree</span> <span class="n">tl</span>
</pre></div>

<a name="157949755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949755" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949755">Mario Carneiro (Feb 09 2019 at 23:13)</a>:</h4>
<p>You shouldn't use projections for your recursive calls. It is important that lean realizes you are destructing the input to see the structural recursion</p>

<a name="157949872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949872" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949872">Mario Carneiro (Feb 09 2019 at 23:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> One of the things we would like to be able to support is recursive defs over mutual inductives that use map, like so:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">string_tree</span> <span class="o">:</span> <span class="n">tree</span> <span class="bp">→</span> <span class="n">string</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">tree</span><span class="bp">.</span><span class="n">mk</span> <span class="n">a</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">++</span> <span class="n">list</span><span class="bp">.</span><span class="n">foldr</span> <span class="o">(</span><span class="bp">++</span><span class="o">)</span> <span class="s2">&quot;&quot;</span> <span class="o">(</span><span class="n">string_tree</span> <span class="bp">&lt;</span><span class="err">$</span><span class="bp">&gt;</span> <span class="n">l</span><span class="o">)</span>
</pre></div>

<a name="157949890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949890" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949890">Mario Carneiro (Feb 09 2019 at 23:17)</a>:</h4>
<p>this would eliminate the necessity to recapitulate basic list definitions and have lots of mutual defs for nested inductives</p>

<a name="157949940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949940" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949940">Mario Carneiro (Feb 09 2019 at 23:18)</a>:</h4>
<p>In a nested inductive, this is the analogue of a "structural induction", because the definition of <code>foo (mk a l)</code> only refers to <code>foo &lt;$&gt; l</code> and functions thereof</p>

<a name="157949951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157949951" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157949951">cbailey (Feb 09 2019 at 23:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Wow, thank you so much. That's really smart/simple, but I completely missed it.</p>

<a name="157950027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157950027" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157950027">cbailey (Feb 09 2019 at 23:20)</a>:</h4>
<p>I actually tried that definition yesterday, with the fold/map combo and got 'unexpected occurrence of recursive function'</p>

<a name="157950044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157950044" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157950044">cbailey (Feb 09 2019 at 23:21)</a>:</h4>
<p>(deleted)</p>

<a name="157950211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157950211" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157950211">Mario Carneiro (Feb 09 2019 at 23:25)</a>:</h4>
<p>it still gives that error, but we're working on a compilation mechanism to accept definitions like that</p>

<a name="157950555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/Trouble%20with%20simple%20goal/has_sizeof/near/157950555" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/94465Troublewithsimplegoalhassizeof.html#157950555">cbailey (Feb 09 2019 at 23:35)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I think that's a really elegant solution, I look forward to seeing that. Thanks again for the guidance, I 'm so happy this definition is working!</p>


{% endraw %}
