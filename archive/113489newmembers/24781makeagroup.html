---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113489newmembers/24781makeagroup.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113489newmembers/index.html">new members</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html">make a group</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="191357562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357562">orlando (Mar 21 2020 at 17:44)</a>:</h4>
<p>Hello, </p>
<p>I try to construct a group, and i have a problem i don't understand what i have to do :D </p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="n">CommRing</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ring</span>
<span class="c">/-</span><span class="cm">-</span>
<span class="cm">## This is the groupe AGL_1(R) : x ↦  ax + b invertible i.e with a inveritible !  The goal is to make</span>
<span class="cm">## into a groupe for composition !</span>
<span class="cm">-/</span>
<span class="kn">structure</span> <span class="n">AGL_1</span> <span class="o">(</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:=</span>  <span class="n">mk</span> <span class="o">{}</span> <span class="bp">::</span>
<span class="o">(</span><span class="n">a</span> <span class="n">b</span>  <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">certif</span> <span class="o">:</span>  <span class="n">a</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>
<span class="kn">namespace</span> <span class="n">agl_1</span>
<span class="kn">section</span>
  <span class="kn">parameters</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>
    <span class="n">def</span> <span class="n">one</span>  <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span> <span class="o">,</span><span class="n">b</span><span class="o">:=</span><span class="mi">0</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span><span class="n">certif</span> <span class="o">:=</span> <span class="k">begin</span> <span class="n">exact</span> <span class="n">mul_one</span> <span class="mi">1</span> <span class="kn">end</span><span class="o">}</span>
    <span class="kn">instance</span>  <span class="o">:</span> <span class="n">has_one</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">one</span><span class="bp">⟩</span>
<span class="n">def</span> <span class="n">of</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">r</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span><span class="n">certif</span> <span class="o">:=</span> <span class="k">begin</span> <span class="n">exact</span> <span class="n">mul_one</span> <span class="mi">1</span><span class="o">,</span> <span class="kn">end</span><span class="o">}</span>

<span class="kn">lemma</span> <span class="n">one_eq_of_one</span> <span class="o">:</span> <span class="n">one</span> <span class="bp">=</span> <span class="n">of</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_map&#39;</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">a1</span><span class="o">,</span><span class="n">b1</span><span class="o">,</span><span class="n">y1</span><span class="o">,</span><span class="n">certif_1</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">a2</span><span class="o">,</span><span class="n">b2</span><span class="o">,</span><span class="n">y2</span><span class="o">,</span><span class="n">certif_2</span><span class="bp">⟩</span><span class="o">,</span>
 <span class="k">begin</span>
    <span class="k">have</span> <span class="n">certif_</span> <span class="o">:</span> <span class="o">(</span><span class="n">a1</span> <span class="bp">*</span> <span class="n">a2</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y2</span> <span class="bp">*</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span>  <span class="n">mul_assoc</span> <span class="o">(</span><span class="n">a1</span> <span class="bp">*</span> <span class="n">a2</span><span class="o">)</span> <span class="n">y2</span> <span class="n">y1</span><span class="o">,</span>
        <span class="n">rw</span>  <span class="n">mul_assoc</span> <span class="n">a1</span> <span class="n">a2</span> <span class="n">y2</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">certif_2</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">mul_one</span><span class="o">,</span>
        <span class="n">rw</span> <span class="n">certif_1</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">a1</span> <span class="bp">*</span> <span class="n">a2</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">a1</span> <span class="bp">*</span> <span class="n">b2</span> <span class="bp">+</span> <span class="n">b1</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">y2</span> <span class="bp">*</span> <span class="n">y1</span> <span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">certif_</span><span class="o">},</span>
 <span class="kn">end</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">inhabited</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">mul_map&#39;</span><span class="bp">⟩</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_inv</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="n">R</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="n">certif</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="k">begin</span>
        <span class="n">exact</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">y</span><span class="o">,</span> <span class="n">b</span><span class="o">:=</span> <span class="bp">-</span><span class="n">y</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="k">begin</span> <span class="n">rw</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">certif</span><span class="o">,</span> <span class="n">assumption</span> <span class="kn">end</span> <span class="o">}</span>
    <span class="kn">end</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_inv</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span> <span class="n">mul_inv</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">Rotation</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>  <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">):</span>   <span class="o">(</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span>  <span class="bp">λ</span> <span class="n">certif</span><span class="o">,</span> <span class="k">begin</span>
<span class="n">exact</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">y</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">certif</span><span class="o">},</span> <span class="kn">end</span>

<span class="n">def</span> <span class="n">mul_one&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">g</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">,</span> <span class="n">g</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span>  <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">a1</span><span class="o">,</span><span class="n">b1</span><span class="o">,</span><span class="n">y1</span><span class="o">,</span><span class="n">certif_1</span><span class="bp">⟩</span><span class="o">,</span> <span class="k">begin</span>  <span class="c1">--- i thinck it&#39;s ok g * 1 cause has_instance mul !</span>
    <span class="k">have</span> <span class="n">certif_a</span> <span class="o">:</span> <span class="n">a1</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">a1</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">mul_one</span> <span class="n">a1</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">certif_b</span> <span class="o">:</span> <span class="n">a1</span> <span class="bp">*</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">b1</span> <span class="bp">=</span> <span class="n">b1</span><span class="o">,</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">mul_zero</span><span class="o">,</span><span class="n">zero_add</span><span class="o">],</span>
    <span class="k">have</span> <span class="n">certif_y</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">y1</span> <span class="bp">=</span> <span class="n">y1</span><span class="o">,</span>
        <span class="n">exact</span> <span class="n">one_mul</span> <span class="n">y1</span><span class="o">,</span>
    <span class="k">have</span>  <span class="n">certif_certif</span> <span class="o">:</span> <span class="o">(</span><span class="n">a1</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a1</span> <span class="bp">*</span> <span class="n">y1</span><span class="o">,</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">mul_one</span><span class="o">,</span><span class="n">one_mul</span><span class="o">],</span>
    <span class="n">sorry</span><span class="o">,</span>  <span class="c1">---  I don&#39;t know what i have to do :D</span>
<span class="kn">end</span>
<span class="kn">end</span>
<span class="kn">end</span> <span class="n">agl_1</span>
</pre></div>

<a name="191357639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357639" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357639">Kevin Buzzard (Mar 21 2020 at 17:46)</a>:</h4>
<p>You could just ask for a: units R</p>

<a name="191357672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357672">orlando (Mar 21 2020 at 17:47)</a>:</h4>
<p>Yes !</p>

<a name="191357680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357680">Kevin Buzzard (Mar 21 2020 at 17:47)</a>:</h4>
<p>In your definition</p>

<a name="191357707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357707" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357707">Kevin Buzzard (Mar 21 2020 at 17:47)</a>:</h4>
<p>I'm not at a computer right now, what is the goal you're stuck on?</p>

<a name="191357782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357782" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357782">orlando (Mar 21 2020 at 17:48)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="mi">1</span> <span class="n">goal</span>
<span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">,</span>
<span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">comm_ring</span> <span class="n">R</span><span class="o">,</span>
<span class="bp">_</span><span class="n">x</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">,</span>
<span class="bp">_</span><span class="n">fun_match</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="bp">_</span><span class="n">a</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">),</span> <span class="bp">_</span><span class="n">a</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="bp">_</span><span class="n">a</span><span class="o">,</span>
<span class="n">a1</span> <span class="n">b1</span> <span class="n">y1</span> <span class="o">:</span> <span class="n">R</span><span class="o">,</span>
<span class="n">certif_1</span> <span class="o">:</span> <span class="n">a1</span> <span class="bp">*</span> <span class="n">y1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">,</span>
<span class="n">certif_a</span> <span class="o">:</span> <span class="n">a1</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">a1</span><span class="o">,</span>
<span class="n">certif_b</span> <span class="o">:</span> <span class="n">a1</span> <span class="bp">*</span> <span class="mi">0</span> <span class="bp">+</span> <span class="n">b1</span> <span class="bp">=</span> <span class="n">b1</span><span class="o">,</span>
<span class="n">certif_y</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">y1</span> <span class="bp">=</span> <span class="n">y1</span><span class="o">,</span>
<span class="n">certif_certif</span> <span class="o">:</span> <span class="n">a1</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">1</span> <span class="bp">*</span> <span class="n">y1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a1</span> <span class="bp">*</span> <span class="n">y1</span>
<span class="err">⊢</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">a1</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">b1</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">y1</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">certif_1</span><span class="o">}</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">a1</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">b1</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">y1</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">certif_1</span><span class="o">}</span>         <span class="bp">&lt;&lt;</span> <span class="c1">--- Here Kevin,</span>
</pre></div>

<a name="191357784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357784" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357784">Kevin Buzzard (Mar 21 2020 at 17:48)</a>:</h4>
<p>You know that all these basic ring theory equalities can be proved with the <code>ring</code> tactic?</p>

<a name="191357822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357822">Kevin Buzzard (Mar 21 2020 at 17:49)</a>:</h4>
<p>You need to prove an <code>ext</code> lemma for your structure</p>

<a name="191357895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357895">Kevin Buzzard (Mar 21 2020 at 17:50)</a>:</h4>
<p>I am on my phone at the minute so it's difficult for me to give precise links but take a look at data.conplex.basic in mathlib</p>

<a name="191357905"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357905" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357905">orlando (Mar 21 2020 at 17:50)</a>:</h4>
<p>For ring : Yes i know but here calculus are not too complicated so i do by hand for fun ! </p>
<p>Ah ok, ext is the equality of two elements of the structure !</p>

<a name="191357932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357932" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357932">Kevin Buzzard (Mar 21 2020 at 17:51)</a>:</h4>
<p>If my memory is correct, very soon after the definition of a complex number they prove that if two complex numbers have the same real and imaginary part then they are equal</p>

<a name="191357948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191357948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191357948">Kevin Buzzard (Mar 21 2020 at 17:51)</a>:</h4>
<p>If you apply the ext lemma then you will immediately get a bunch of trivial goals</p>

<a name="191358006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358006">orlando (Mar 21 2020 at 17:52)</a>:</h4>
<p>Your memory is good ! </p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">ext</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">ext</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">z</span> <span class="n">w</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">},</span> <span class="n">z</span><span class="bp">.</span><span class="n">re</span> <span class="bp">=</span> <span class="n">w</span><span class="bp">.</span><span class="n">re</span> <span class="bp">→</span> <span class="n">z</span><span class="bp">.</span><span class="n">im</span> <span class="bp">=</span> <span class="n">w</span><span class="bp">.</span><span class="n">im</span> <span class="bp">→</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">w</span>
<span class="bp">|</span> <span class="bp">⟨</span><span class="n">zr</span><span class="o">,</span> <span class="n">zi</span><span class="bp">⟩</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">_⟩</span> <span class="n">rfl</span> <span class="n">rfl</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>

<a name="191358012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358012">Kevin Buzzard (Mar 21 2020 at 17:52)</a>:</h4>
<p>Take a look at the ext lemma for <code>units</code>. There is something interesting going on there</p>

<a name="191358026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358026">Kevin Buzzard (Mar 21 2020 at 17:52)</a>:</h4>
<p>If you find the definition of units in mathlib it is probably one of the first lemmas afterwards</p>

<a name="191358051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358051" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358051">Kevin Buzzard (Mar 21 2020 at 17:53)</a>:</h4>
<p>The interesting thing here is that you only need some of the structure fields to be equal in order to reduce that the terms are equal</p>

<a name="191358104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358104" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358104">Kevin Buzzard (Mar 21 2020 at 17:54)</a>:</h4>
<p>A term of type <code>units R</code> is a and b and a proof that ab=1 and a proof that ba=1</p>

<a name="191358109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358109">Kevin Buzzard (Mar 21 2020 at 17:54)</a>:</h4>
<p>But if two units have the same a, they are the same :-)</p>

<a name="191358230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358230" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358230">Kevin Buzzard (Mar 21 2020 at 17:56)</a>:</h4>
<p>Your namespace is agl_1 but your structure is AGL_1</p>

<a name="191358255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358255" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358255">Kevin Buzzard (Mar 21 2020 at 17:57)</a>:</h4>
<p>If you make them the same, then you will have access to "dot notation"</p>

<a name="191358347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191358347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191358347">Kevin Buzzard (Mar 21 2020 at 17:59)</a>:</h4>
<p><code>begin exact X end</code> can just be shortened to <code>X</code></p>

<a name="191359227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359227">orlando (Mar 21 2020 at 18:15)</a>:</h4>
<p>Yes i'm ok for the interesting thing ! </p>
<p>For the shortened : the problem is if i don't write begin  ...  end, i d'ont see the goal in lean so i always start with begin end  !</p>

<a name="191359530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359530">Kevin Buzzard (Mar 21 2020 at 18:23)</a>:</h4>
<p>Yes sure, but after you write <code>begin exact mul_one 1 end</code> you can just change it to <code> mul_one 1</code> :-)</p>

<a name="191359537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359537">Kevin Buzzard (Mar 21 2020 at 18:23)</a>:</h4>
<p><code>begin end</code> and <code>by</code>  turns Lean from term mode into tactic mode; <code>exact</code> turns Lean from tactic mode into term mode.</p>

<a name="191359643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359643" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359643">Patrick Massot (Mar 21 2020 at 18:26)</a>:</h4>
<p>Orlando, you need the first lemma after the definition to be:</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">ext</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">ext</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">},</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="n">a</span> <span class="bp">→</span> <span class="n">x</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="n">b</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">h</span> <span class="n">h&#39;</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">congr</span> <span class="bp">;</span> <span class="n">try</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
  <span class="n">change</span> <span class="n">x_a</span> <span class="bp">=</span> <span class="n">y_a</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h</span> <span class="n">at</span> <span class="n">x_certif</span><span class="o">,</span>
  <span class="n">apply_fun</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">y_y</span> <span class="n">at</span> <span class="n">x_certif</span><span class="o">,</span>
  <span class="n">rwa</span> <span class="o">[</span><span class="err">←</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_comm</span> <span class="n">y_y</span><span class="o">,</span> <span class="n">y_certif</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">]</span> <span class="n">at</span> <span class="n">x_certif</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="191359657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359657" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359657">Patrick Massot (Mar 21 2020 at 18:27)</a>:</h4>
<p>Then, each time you need to prove equality of two elements of <code>AGL_1 R</code> you'll be able to use the <code>ext</code> tactic.</p>

<a name="191359714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359714" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359714">Patrick Massot (Mar 21 2020 at 18:28)</a>:</h4>
<p>Next you need to get rid of <code>parameter</code>. There is a very simple rule deciding whether you want <code>variables</code> or <code>parameters</code>: you want <code>variables</code>.</p>

<a name="191359753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359753">Patrick Massot (Mar 21 2020 at 18:29)</a>:</h4>
<p>Then your multiplication definition is wrong, for a very subtle reason. Using pattern matching from the beginning, you won't get that <code>(x*y).a = x.a*y.a</code> <em>by definition</em> (in the very specific type theory sense of this word). This is will bring hell on you.</p>

<a name="191359830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359830" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359830">Kevin Buzzard (Mar 21 2020 at 18:31)</a>:</h4>
<p>By "wrong" Patricks means that <em>mathematically</em> it is correct, but if two things are equal because of a theorem, this is far less convenient than if they are equal by definition.</p>

<a name="191359966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359966" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359966">orlando (Mar 21 2020 at 18:34)</a>:</h4>
<p>hum ,it's because i put   <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>2</mn></msub><msub><mi>y</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">y_2 y_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ?</p>

<a name="191359990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191359990" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191359990">Patrick Massot (Mar 21 2020 at 18:35)</a>:</h4>
<p>No, it's because of your angle bracket pattern matching.</p>

<a name="191360034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360034" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360034">Patrick Massot (Mar 21 2020 at 18:36)</a>:</h4>
<p>I cleaned up the beginning:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="n">CommRing</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ring</span>
<span class="kn">import</span> <span class="n">tactic</span>
<span class="c">/-</span><span class="cm">-</span>
<span class="cm">## This is the groupe AGL_1(R) : x ↦  ax + b invertible i.e with a inveritible !  The goal is to make</span>
<span class="cm">## into a groupe for composition !</span>
<span class="cm">-/</span>
<span class="kn">structure</span> <span class="n">AGL_1</span> <span class="o">(</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">a</span> <span class="n">b</span>  <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">certif</span> <span class="o">:</span>  <span class="n">a</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">agl_1</span>
<span class="kn">section</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ext</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">ext</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">},</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="n">a</span> <span class="bp">→</span> <span class="n">x</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">y</span><span class="bp">.</span><span class="n">b</span> <span class="bp">→</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">x</span> <span class="n">y</span> <span class="n">h</span> <span class="n">h&#39;</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">congr</span> <span class="bp">;</span> <span class="n">try</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
  <span class="n">change</span> <span class="n">x_a</span> <span class="bp">=</span> <span class="n">y_a</span> <span class="n">at</span> <span class="n">h</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h</span> <span class="n">at</span> <span class="n">x_certif</span><span class="o">,</span>
  <span class="n">apply_fun</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">y_y</span> <span class="n">at</span> <span class="n">x_certif</span><span class="o">,</span>
  <span class="n">rwa</span> <span class="o">[</span><span class="err">←</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_comm</span> <span class="n">y_y</span><span class="o">,</span> <span class="n">y_certif</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">]</span> <span class="n">at</span> <span class="n">x_certif</span><span class="o">,</span>
<span class="kn">end</span>


<span class="n">def</span> <span class="n">one</span>  <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">b</span><span class="o">:=</span><span class="mi">0</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">mul_one</span> <span class="mi">1</span><span class="o">}</span>

<span class="kn">instance</span>  <span class="o">:</span> <span class="n">has_one</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">one</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">of</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">r</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">mul_one</span> <span class="mi">1</span><span class="o">}</span>

<span class="kn">lemma</span> <span class="n">one_eq_of_one</span> <span class="o">:</span> <span class="n">one</span> <span class="bp">=</span> <span class="n">of</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_map&#39;</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
<span class="o">{</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">a</span><span class="o">,</span>
  <span class="n">b</span> <span class="o">:=</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">b</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">.</span><span class="n">b</span><span class="o">,</span>
  <span class="n">y</span> <span class="o">:=</span> <span class="n">x</span><span class="bp">.</span><span class="n">y</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">y</span> <span class="o">,</span>
  <span class="n">certif</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">sorry</span> <span class="c1">-- too lazy to retype the proof with dot notations</span>
  <span class="kn">end</span><span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">inhabited</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">agl_1</span><span class="bp">.</span><span class="n">mul_map&#39;</span><span class="bp">⟩</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_inv</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="n">R</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="n">certif</span><span class="bp">⟩</span><span class="o">,</span>
<span class="o">{</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">b</span><span class="o">:=</span> <span class="bp">-</span><span class="n">y</span> <span class="bp">*</span> <span class="n">b</span><span class="o">,</span>
  <span class="n">y</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">,</span>
  <span class="n">certif</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">rwa</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">certif</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_inv</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">agl_1</span><span class="bp">.</span><span class="n">mul_inv</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">Rotation</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>  <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">):</span>   <span class="o">(</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">certif</span><span class="o">,</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">y</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">certif</span><span class="o">}</span>

<span class="n">def</span> <span class="n">mul_one&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">g</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">,</span> <span class="n">g</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">g</span><span class="o">,</span>
  <span class="n">ext</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">change</span> <span class="n">g</span><span class="bp">.</span><span class="n">a</span><span class="bp">*</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">a</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_one</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">change</span> <span class="n">g</span><span class="bp">.</span><span class="n">a</span><span class="bp">*</span><span class="mi">0</span> <span class="bp">+</span> <span class="n">g</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">b</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">}</span>
<span class="kn">end</span>
<span class="kn">end</span>
<span class="kn">end</span> <span class="n">agl_1</span>
</pre></div>

<a name="191360045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360045" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360045">Patrick Massot (Mar 21 2020 at 18:36)</a>:</h4>
<p>My advice is to very carefully compare, line by line, with your version. There are many small tricks to learn here.</p>

<a name="191360050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360050">Patrick Massot (Mar 21 2020 at 18:36)</a>:</h4>
<p>I'm not saying anything about your global strategy, only locally cleaning things.</p>

<a name="191360054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360054">orlando (Mar 21 2020 at 18:37)</a>:</h4>
<p>Ok Patrick ! Thx !!!</p>

<a name="191360345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360345" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360345">Kevin Buzzard (Mar 21 2020 at 18:44)</a>:</h4>
<p>For technical reasons, <code>λ ⟨a1,b1,y1,certif_1⟩ ...</code> is almost never right. I'm talking about <code>mul_map'</code>. Mathematically what you and Patrick did is the same, but Patrick's version is better for Lean for computer-science reasons.</p>

<a name="191360369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360369" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360369">orlando (Mar 21 2020 at 18:45)</a>:</h4>
<p>Ok if a understand, i need to use a.a a.b a.y etc and not bracket !</p>

<a name="191360448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360448">Kevin Buzzard (Mar 21 2020 at 18:46)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_map&#39;</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span>
<span class="o">{</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">a</span><span class="o">,</span>
  <span class="n">b</span> <span class="o">:=</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">b</span> <span class="bp">+</span> <span class="n">x</span><span class="bp">.</span><span class="n">b</span><span class="o">,</span>
  <span class="n">y</span> <span class="o">:=</span> <span class="n">x</span><span class="bp">.</span><span class="n">y</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">y</span> <span class="o">,</span>
  <span class="n">certif</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="n">rw</span> <span class="o">[(</span><span class="k">show</span> <span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span><span class="bp">.</span><span class="n">y</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">x</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">x</span><span class="bp">.</span><span class="n">y</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">y</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">y</span><span class="bp">.</span><span class="n">y</span><span class="o">),</span> <span class="k">by</span> <span class="n">ring</span><span class="o">),</span>
        <span class="n">x</span><span class="bp">.</span><span class="n">certif</span><span class="o">,</span> <span class="n">y</span><span class="bp">.</span><span class="n">certif</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">],</span>
  <span class="kn">end</span><span class="o">}</span>
</pre></div>


<p>I filled in a sorry in a fairly efficient way</p>

<a name="191360467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191360467" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191360467">Kevin Buzzard (Mar 21 2020 at 18:47)</a>:</h4>
<p><span class="user-mention silent" data-user-id="270476">orlando</span> <a href="#narrow/stream/113489-new-members/topic/make.20a.20group/near/191360369" title="#narrow/stream/113489-new-members/topic/make.20a.20group/near/191360369">said</a>:</p>
<blockquote>
<p>Ok if a understand, i need to use a.a a.b a.y etc and not bracket !</p>
</blockquote>
<p>In your definitions, it is better.</p>

<a name="191361092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191361092" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191361092">Kevin Buzzard (Mar 21 2020 at 19:02)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">real</span><span class="bp">.</span><span class="n">basic</span>

<span class="kn">structure</span> <span class="n">complex</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">re</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span>
<span class="o">(</span><span class="n">im</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span>

<span class="kn">notation</span> <span class="bp">`</span><span class="n">ℂ</span><span class="bp">`</span> <span class="o">:=</span> <span class="n">complex</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ext</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">ext</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">z</span> <span class="n">w</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">},</span> <span class="n">z</span><span class="bp">.</span><span class="n">re</span> <span class="bp">=</span> <span class="n">w</span><span class="bp">.</span><span class="n">re</span> <span class="bp">→</span> <span class="n">z</span><span class="bp">.</span><span class="n">im</span> <span class="bp">=</span> <span class="n">w</span><span class="bp">.</span><span class="n">im</span> <span class="bp">→</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">w</span>
<span class="bp">|</span> <span class="bp">⟨</span><span class="n">zr</span><span class="o">,</span> <span class="n">zi</span><span class="bp">⟩</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">_⟩</span> <span class="n">rfl</span> <span class="n">rfl</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="n">def</span> <span class="n">add_bad</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="bp">→</span> <span class="n">ℂ</span> <span class="bp">→</span> <span class="n">ℂ</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="bp">⟨</span><span class="n">x1</span><span class="o">,</span> <span class="n">y1</span><span class="bp">⟩</span> <span class="bp">⟨</span><span class="n">x2</span><span class="o">,</span> <span class="n">y2</span><span class="bp">⟩</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">x1</span> <span class="bp">+</span> <span class="n">x2</span><span class="o">,</span> <span class="n">y1</span> <span class="bp">+</span> <span class="n">y2</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">add_good</span> <span class="o">(</span><span class="n">z</span> <span class="n">w</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℂ</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">z</span><span class="bp">.</span><span class="n">re</span> <span class="bp">+</span> <span class="n">w</span><span class="bp">.</span><span class="n">re</span><span class="o">,</span> <span class="n">z</span><span class="bp">.</span><span class="n">im</span> <span class="bp">+</span> <span class="n">w</span><span class="bp">.</span><span class="n">im</span><span class="bp">⟩</span>

<span class="kn">section</span> <span class="n">bad</span>

<span class="bp">@</span><span class="o">[</span><span class="n">priority</span> <span class="mi">100</span><span class="o">]</span>
<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">ℂ</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">add_bad</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">add_bad_assoc</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span><span class="o">,</span>
  <span class="c1">-- what now?</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">b</span><span class="o">,</span> <span class="n">cases</span> <span class="n">c</span><span class="o">,</span>
    <span class="k">show</span> <span class="n">a_re</span> <span class="bp">+</span> <span class="n">b_re</span> <span class="bp">+</span> <span class="n">c_re</span> <span class="bp">=</span> <span class="n">a_re</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b_re</span> <span class="bp">+</span> <span class="n">c_re</span><span class="o">),</span>
    <span class="n">ring</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">a</span><span class="o">,</span> <span class="n">cases</span> <span class="n">b</span><span class="o">,</span> <span class="n">cases</span> <span class="n">c</span><span class="o">,</span>
    <span class="n">change</span> <span class="n">a_im</span> <span class="bp">+</span> <span class="n">b_im</span> <span class="bp">+</span> <span class="n">c_im</span> <span class="bp">=</span> <span class="n">a_im</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b_im</span> <span class="bp">+</span> <span class="n">c_im</span><span class="o">),</span>
    <span class="n">ring</span><span class="o">,</span>
  <span class="o">},</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">bad</span>

<span class="kn">section</span> <span class="n">good</span>

<span class="bp">@</span><span class="o">[</span><span class="n">priority</span> <span class="mi">100000</span><span class="o">]</span> <span class="c1">-- new addition will be used instead of old one</span>
<span class="kn">instance</span> <span class="n">complex</span><span class="bp">.</span><span class="n">has_good_add</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">ℂ</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">add_good</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">add_good_assoc</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">change</span> <span class="n">a</span><span class="bp">.</span><span class="n">re</span> <span class="bp">+</span> <span class="n">b</span><span class="bp">.</span><span class="n">re</span> <span class="bp">+</span> <span class="n">c</span><span class="bp">.</span><span class="n">re</span> <span class="bp">=</span> <span class="n">a</span><span class="bp">.</span><span class="n">re</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span><span class="bp">.</span><span class="n">re</span> <span class="bp">+</span> <span class="n">c</span><span class="bp">.</span><span class="n">re</span><span class="o">),</span>
    <span class="n">ring</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span> <span class="k">show</span> <span class="n">a</span><span class="bp">.</span><span class="n">im</span> <span class="bp">+</span> <span class="n">b</span><span class="bp">.</span><span class="n">im</span> <span class="bp">+</span> <span class="n">c</span><span class="bp">.</span><span class="n">im</span> <span class="bp">=</span> <span class="n">a</span><span class="bp">.</span><span class="n">im</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span><span class="bp">.</span><span class="n">im</span> <span class="bp">+</span> <span class="n">c</span><span class="bp">.</span><span class="n">im</span><span class="o">),</span>
    <span class="n">ring</span><span class="o">,</span>
  <span class="o">},</span>
<span class="kn">end</span>

<span class="kn">end</span> <span class="n">good</span>
</pre></div>


<p>There is one simple reason why using dot is better than using bracket: I don't have to do <code>cases</code> lots of times in my proofs.</p>

<a name="191361122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191361122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191361122">Johan Commelin (Mar 21 2020 at 19:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="270476">orlando</span> <a href="#narrow/stream/113489-new-members/topic/make.20a.20group/near/191359227" title="#narrow/stream/113489-new-members/topic/make.20a.20group/near/191359227">said</a>:</p>
<blockquote>
<p>Yes i'm ok for the interesting thing ! </p>
<p>For the shortened : the problem is if i don't write begin  ...  end, i d'ont see the goal in lean so i always start with begin end  !</p>
</blockquote>
<p>If you write <code>:= _</code>, then you can see the goal if you put your cursor on the <code>_</code>. This is a way to write things without <code>begin ... end</code>. Just always keep a <code>_</code> to the right of your cursor.</p>

<a name="191361129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191361129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191361129">Kevin Buzzard (Mar 21 2020 at 19:03)</a>:</h4>
<p>In fact with the good addition I can just do</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">add_good_assoc</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span><span class="bp">;</span> <span class="n">apply</span> <span class="n">add_assoc</span>
<span class="kn">end</span>
</pre></div>

<a name="191361202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191361202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191361202">Kevin Buzzard (Mar 21 2020 at 19:05)</a>:</h4>
<p>and this is very close to a way a mathematician thinks about the proof: "suffices to check on real and imaginary parts, where it follows from associativity of addition on the reals"</p>

<a name="191363643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191363643" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191363643">orlando (Mar 21 2020 at 20:10)</a>:</h4>
<p>I do the associativity <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> </p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">category</span><span class="bp">.</span><span class="n">CommRing</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">algebra</span><span class="bp">.</span><span class="n">ring</span>
<span class="kn">import</span> <span class="n">tactic</span>
<span class="c">/-</span><span class="cm">-</span>
<span class="cm">## This is the groupe AGL_1(R) : x ↦  ax + b invertible i.e with a inveritible !  The goal is to make</span>
<span class="cm">## into a groupe for composition !</span>
<span class="cm">-/</span>
<span class="kn">structure</span> <span class="n">AGL_1</span> <span class="o">(</span> <span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">a</span> <span class="n">b</span>  <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span>
<span class="o">(</span><span class="n">certif</span> <span class="o">:</span>  <span class="n">a</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span>

<span class="kn">namespace</span> <span class="n">AGL_1</span>
<span class="kn">section</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">ext</span><span class="o">]</span>
<span class="kn">lemma</span> <span class="n">ext</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">g1</span> <span class="n">g2</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">},</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">=</span> <span class="n">g2</span><span class="bp">.</span><span class="n">a</span> <span class="bp">→</span> <span class="n">g1</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">g2</span><span class="bp">.</span><span class="n">b</span> <span class="bp">→</span> <span class="n">g1</span> <span class="bp">=</span> <span class="n">g2</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">g1</span> <span class="n">g2</span><span class="o">,</span> <span class="c1">--- it&#39;s ok ? just don&#39;t use Bracket ?</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">h1</span> <span class="n">h2</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">g1</span><span class="o">,</span>                                         <span class="c1">---  difficult i have to analyse !</span>
  <span class="n">cases</span> <span class="n">g2</span><span class="o">,</span>
  <span class="n">congr</span> <span class="bp">;</span> <span class="n">try</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
  <span class="n">change</span> <span class="n">g1_a</span> <span class="bp">=</span> <span class="n">g2_a</span> <span class="n">at</span> <span class="n">h1</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">h1</span> <span class="n">at</span> <span class="n">g1_certif</span><span class="o">,</span>
  <span class="n">apply_fun</span> <span class="o">(</span><span class="bp">*</span><span class="o">)</span> <span class="n">g2_y</span> <span class="n">at</span> <span class="n">g1_certif</span><span class="o">,</span>
  <span class="n">rwa</span> <span class="o">[</span><span class="err">←</span> <span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_comm</span> <span class="n">g2_y</span><span class="o">,</span> <span class="n">g2_certif</span><span class="o">,</span> <span class="n">one_mul</span><span class="o">,</span> <span class="n">mul_one</span><span class="o">]</span> <span class="n">at</span> <span class="n">g1_certif</span><span class="o">,</span>
<span class="kn">end</span>

<span class="n">def</span> <span class="n">one</span>  <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">b</span><span class="o">:=</span><span class="mi">0</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">mul_one</span> <span class="mi">1</span><span class="o">}</span>

<span class="kn">instance</span>  <span class="o">:</span> <span class="n">has_one</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">one</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">of</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">r</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">mul_one</span> <span class="mi">1</span><span class="o">}</span>

<span class="kn">lemma</span> <span class="n">one_eq_of_one</span> <span class="o">:</span> <span class="n">one</span> <span class="bp">=</span> <span class="n">of</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_map&#39;</span> <span class="o">:</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">g1</span> <span class="n">g2</span><span class="o">,</span>
<span class="o">{</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">a</span><span class="o">,</span>
  <span class="n">b</span> <span class="o">:=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">b</span> <span class="bp">+</span> <span class="n">g1</span><span class="bp">.</span><span class="n">b</span><span class="o">,</span>
  <span class="n">y</span> <span class="o">:=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">y</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">y</span> <span class="o">,</span>
  <span class="n">certif</span> <span class="o">:=</span> <span class="k">begin</span>
    <span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">g1</span><span class="bp">.</span><span class="n">y</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g1</span><span class="bp">.</span><span class="n">y</span><span class="o">)</span>  <span class="bp">*</span> <span class="o">(</span><span class="n">g2</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">y</span><span class="o">),</span>
        <span class="n">ring</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">g1</span><span class="bp">.</span><span class="n">certif</span><span class="o">,</span><span class="n">g2</span><span class="bp">.</span><span class="n">certif</span><span class="o">],</span>
    <span class="n">exact</span> <span class="n">one_mul</span> <span class="mi">1</span><span class="o">,</span>
  <span class="kn">end</span><span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">inhabited</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="mi">1</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_mul</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">AGL_1</span><span class="bp">.</span><span class="n">mul_map&#39;</span><span class="bp">⟩</span>

<span class="kn">lemma</span> <span class="n">a_comp</span> <span class="o">(</span><span class="n">g1</span> <span class="n">g2</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">g1</span> <span class="bp">*</span> <span class="n">g2</span><span class="o">)</span><span class="bp">.</span><span class="n">a</span> <span class="bp">=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">a</span> <span class="o">:=</span>  <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">b_comp</span> <span class="o">(</span><span class="n">g1</span> <span class="n">g2</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">g1</span> <span class="bp">*</span> <span class="n">g2</span><span class="o">)</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">b</span> <span class="bp">+</span> <span class="n">g1</span><span class="bp">.</span><span class="n">b</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">protected</span> <span class="n">def</span> <span class="n">mul_inv</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span> <span class="bp">→</span> <span class="n">AGL_1</span> <span class="n">R</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">y</span><span class="o">,</span><span class="n">certif</span><span class="bp">⟩</span><span class="o">,</span>    <span class="c1">--- change here ?</span>
<span class="o">{</span> <span class="n">a</span> <span class="o">:=</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">b</span><span class="o">:=</span> <span class="bp">-</span><span class="n">y</span> <span class="bp">*</span> <span class="n">b</span><span class="o">,</span>
  <span class="n">y</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">,</span>
  <span class="n">certif</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">rwa</span> <span class="n">mul_comm</span> <span class="n">at</span> <span class="n">certif</span> <span class="o">}</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_inv</span> <span class="o">(</span><span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">AGL_1</span><span class="bp">.</span><span class="n">mul_inv</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">Rotation</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>  <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">R</span><span class="o">):</span>   <span class="o">(</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">y</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">)</span> <span class="bp">→</span> <span class="n">AGL_1</span><span class="o">(</span><span class="n">R</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">certif</span><span class="o">,</span> <span class="o">{</span><span class="n">a</span> <span class="o">:=</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">y</span><span class="o">,</span> <span class="n">certif</span> <span class="o">:=</span> <span class="n">certif</span><span class="o">}</span>

<span class="n">def</span> <span class="n">mul_one&#39;</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">g</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">,</span> <span class="n">g</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intros</span> <span class="n">g</span><span class="o">,</span>
  <span class="n">ext</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">change</span> <span class="n">g</span><span class="bp">.</span><span class="n">a</span><span class="bp">*</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">a</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">mul_one</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">change</span> <span class="n">g</span><span class="bp">.</span><span class="n">a</span><span class="bp">*</span><span class="mi">0</span> <span class="bp">+</span> <span class="n">g</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">g</span><span class="bp">.</span><span class="n">b</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">}</span>
<span class="kn">end</span>
<span class="n">def</span> <span class="n">mul_assoc&#39;</span> <span class="o">(</span><span class="n">g1</span> <span class="n">g2</span> <span class="n">g3</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>  <span class="o">(</span><span class="n">g1</span> <span class="bp">*</span> <span class="n">g2</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g3</span> <span class="bp">=</span> <span class="n">g1</span> <span class="bp">*</span> <span class="o">(</span><span class="n">g2</span> <span class="bp">*</span> <span class="n">g3</span><span class="o">)</span> <span class="o">:=</span>
    <span class="k">begin</span>
        <span class="n">ext</span><span class="o">,</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">a_comp</span><span class="o">,</span><span class="n">a_comp</span><span class="o">,</span>  <span class="n">a_comp</span> <span class="n">g1</span> <span class="o">(</span><span class="n">g2</span> <span class="bp">*</span><span class="n">g3</span><span class="o">),</span> <span class="n">a_comp</span> <span class="n">g2</span> <span class="n">g3</span><span class="o">,</span> <span class="n">mul_assoc</span><span class="o">],</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">b_comp</span><span class="o">,</span><span class="n">a_comp</span><span class="o">,</span><span class="n">b_comp</span><span class="o">,</span><span class="n">b_comp</span><span class="o">,</span><span class="n">b_comp</span><span class="o">],</span>
        <span class="n">ring</span><span class="o">,</span>
    <span class="kn">end</span>
<span class="kn">end</span>
<span class="kn">end</span> <span class="n">AGL_1</span>
</pre></div>

<a name="191364472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191364472" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191364472">Patrick Massot (Mar 21 2020 at 20:33)</a>:</h4>
<p>I didn't notice earlier, but you have definitions that should be lemmas.</p>

<a name="191364473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191364473" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191364473">Kevin Buzzard (Mar 21 2020 at 20:33)</a>:</h4>
<p>I think <code>a_comp</code> and <code>b_comp</code> should be simp lemmas. See if you can train simp to solve some of these things. And you should now make a group instance for your structure I guess</p>

<a name="191364753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191364753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191364753">Patrick Massot (Mar 21 2020 at 20:40)</a>:</h4>
<p>Going a bit along the Kevin-like automation path can be a fun path too. Have a look at:</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">one_a</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span><span class="bp">.</span><span class="n">a</span> <span class="bp">=</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">one_b</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">a_comp</span> <span class="o">(</span><span class="n">g1</span> <span class="n">g2</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">g1</span> <span class="bp">*</span> <span class="n">g2</span><span class="o">)</span><span class="bp">.</span><span class="n">a</span> <span class="bp">=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">a</span> <span class="o">:=</span>  <span class="n">rfl</span>
<span class="kn">lemma</span> <span class="n">b_comp</span> <span class="o">(</span><span class="n">g1</span> <span class="n">g2</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">g1</span> <span class="bp">*</span> <span class="n">g2</span><span class="o">)</span><span class="bp">.</span><span class="n">b</span> <span class="bp">=</span> <span class="n">g1</span><span class="bp">.</span><span class="n">a</span> <span class="bp">*</span> <span class="n">g2</span><span class="bp">.</span><span class="n">b</span> <span class="bp">+</span> <span class="n">g1</span><span class="bp">.</span><span class="n">b</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">AGL_ring</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="bp">`</span><span class="o">[</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">one_a</span><span class="o">,</span> <span class="n">one_b</span><span class="o">,</span> <span class="n">a_comp</span><span class="o">,</span> <span class="n">b_comp</span><span class="o">],</span> <span class="n">ring</span><span class="o">]</span>

<span class="n">run_cmd</span> <span class="n">add_interactive</span> <span class="o">[</span><span class="bp">`</span><span class="n">AGL_ring</span><span class="o">]</span>

<span class="kn">lemma</span> <span class="n">mul_one&#39;</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span> <span class="n">g</span> <span class="bp">*</span> <span class="mi">1</span> <span class="bp">=</span> <span class="n">g</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ext</span> <span class="bp">;</span> <span class="n">AGL_ring</span><span class="o">,</span>
<span class="kn">end</span>

<span class="kn">lemma</span> <span class="n">mul_assoc&#39;</span> <span class="o">(</span><span class="n">g1</span> <span class="n">g2</span> <span class="n">g3</span> <span class="o">:</span> <span class="n">AGL_1</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>  <span class="o">(</span><span class="n">g1</span> <span class="bp">*</span> <span class="n">g2</span><span class="o">)</span> <span class="bp">*</span> <span class="n">g3</span> <span class="bp">=</span> <span class="n">g1</span> <span class="bp">*</span> <span class="o">(</span><span class="n">g2</span> <span class="bp">*</span> <span class="n">g3</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
    <span class="n">ext</span> <span class="bp">;</span> <span class="n">AGL_ring</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="191365989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113489-new%20members/topic/make%20a%20group/near/191365989" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113489newmembers/24781makeagroup.html#191365989">Patrick Massot (Mar 21 2020 at 21:13)</a>:</h4>
<p>Note you can write <code>by ext ; AGL_ring</code> to save some space.</p>


{% endraw %}

{% include archive_update.html %}