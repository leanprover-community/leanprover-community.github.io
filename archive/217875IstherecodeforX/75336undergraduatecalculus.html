---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/217875IstherecodeforX/75336undergraduatecalculus.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/index.html">Is there code for X?</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html">undergraduate calculus</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="193772230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193772230" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193772230">Kevin Buzzard (Apr 13 2020 at 13:36)</a>:</h4>
<p>Can we do things like this now?</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">complex</span><span class="bp">.</span><span class="n">exponential</span>

<span class="kn">open</span> <span class="n">real</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span> <span class="n">sorry</span>
</pre></div>

<a name="193772766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193772766" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193772766">Kenny Lau (Apr 13 2020 at 13:43)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">complex</span><span class="bp">.</span><span class="n">exponential</span>

<span class="kn">open</span> <span class="n">complex</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">deriv_mul</span> <span class="o">(</span><span class="n">differentiable_at</span><span class="bp">.</span><span class="n">comp</span> <span class="bp">_</span> <span class="o">(</span><span class="n">differentiable_cos</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">differentiable_sin</span> <span class="bp">_</span><span class="o">))</span> <span class="o">(</span><span class="n">differentiable_exp</span> <span class="bp">_</span><span class="o">),</span>
      <span class="n">deriv</span><span class="bp">.</span><span class="n">comp</span> <span class="bp">_</span> <span class="o">(</span><span class="n">differentiable_cos</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="n">differentiable_sin</span> <span class="bp">_</span><span class="o">),</span>
      <span class="n">deriv_cos</span><span class="o">,</span> <span class="n">deriv_sin</span><span class="o">,</span> <span class="n">deriv_exp</span><span class="o">,</span> <span class="n">smul_eq_mul</span><span class="o">]</span><span class="bp">;</span> <span class="n">ring</span>
</pre></div>

<a name="193772784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193772784" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193772784">Kenny Lau (Apr 13 2020 at 13:43)</a>:</h4>
<p>I cheated rather (un)subtly though</p>

<a name="193773494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193773494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193773494">Patrick Massot (Apr 13 2020 at 13:51)</a>:</h4>
<p>Kevin's question was clearly under-specified.</p>

<a name="193773503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193773503" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193773503">Patrick Massot (Apr 13 2020 at 13:51)</a>:</h4>
<p>So I think it's fair.</p>

<a name="193773825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193773825" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193773825">Patrick Massot (Apr 13 2020 at 13:55)</a>:</h4>
<p><code>deriv.comp</code> being expressed in term of <code>smul</code> is bugging me. I guess this comes from our general base field bias, but it's still bugging me. <span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> ?</p>

<a name="193774589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774589" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774589">Kevin Buzzard (Apr 13 2020 at 14:02)</a>:</h4>
<p>So you changed the question from real to complex? Can we not do real yet?</p>

<a name="193774606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774606">Johan Commelin (Apr 13 2020 at 14:02)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">funext</span> <span class="n">x</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">deriv_mul</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">deriv_exp</span><span class="o">,</span> <span class="err">←</span> <span class="n">add_mul</span><span class="o">,</span> <span class="n">add_comm</span><span class="o">],</span>
  <span class="o">{</span> <span class="n">congr&#39;</span> <span class="mi">2</span><span class="o">,</span> <span class="k">show</span> <span class="n">deriv</span> <span class="o">(</span><span class="n">cos</span> <span class="err">∘</span> <span class="n">sin</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">deriv</span><span class="bp">.</span><span class="n">comp</span><span class="o">,</span> <span class="n">deriv_sin</span><span class="o">,</span> <span class="n">deriv_cos</span><span class="o">,</span> <span class="n">smul_eq_mul</span><span class="o">],</span>
    <span class="o">{</span> <span class="n">ring</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">differentiable_cos</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">apply</span> <span class="n">differentiable_sin</span> <span class="o">},</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">differentiable_cos</span><span class="bp">.</span><span class="n">comp</span> <span class="n">differentiable_sin</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">apply</span> <span class="n">differentiable_exp</span> <span class="o">}</span>
<span class="kn">end</span>
</pre></div>

<a name="193774621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774621" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774621">Johan Commelin (Apr 13 2020 at 14:02)</a>:</h4>
<p>That's for real</p>

<a name="193774655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774655" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774655">Patrick Massot (Apr 13 2020 at 14:03)</a>:</h4>
<p>Johan, your version is complex as well</p>

<a name="193774663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774663" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774663">Kevin Buzzard (Apr 13 2020 at 14:03)</a>:</h4>
<p>It works for real</p>

<a name="193774708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774708" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774708">Patrick Massot (Apr 13 2020 at 14:03)</a>:</h4>
<p>Sure</p>

<a name="193774722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774722">Patrick Massot (Apr 13 2020 at 14:04)</a>:</h4>
<p>You can put <code>(x : real)</code> in the statement</p>

<a name="193774885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774885" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774885">Kevin Buzzard (Apr 13 2020 at 14:05)</a>:</h4>
<p>gaagh if I had found <code>deriv.comp</code> I probably wouldn't have even asked this. I thought I checked? Maybe I tried <code>deriv_comp</code>?</p>

<a name="193774927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774927" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774927">Kevin Buzzard (Apr 13 2020 at 14:05)</a>:</h4>
<p>I found <code>deriv_cos</code>, maybe that was what threw me off.</p>

<a name="193774934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193774934" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193774934">Johan Commelin (Apr 13 2020 at 14:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/undergraduate.20calculus/near/193774655" title="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/undergraduate.20calculus/near/193774655">said</a>:</p>
<blockquote>
<p>Johan, your version is complex as well</p>
</blockquote>
<p>Why is my version complex? After the funext I have a <code>x : real</code> in my goal state</p>

<a name="193775012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775012">Kevin Buzzard (Apr 13 2020 at 14:06)</a>:</h4>
<p>if you change <code>open real</code> to <code>open complex</code> it still works</p>

<a name="193775072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775072" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775072">Patrick Massot (Apr 13 2020 at 14:06)</a>:</h4>
<p>The most readable version so far is:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">deriv_mul</span><span class="o">,</span> <span class="n">deriv</span><span class="bp">.</span><span class="n">comp</span><span class="o">,</span> <span class="n">deriv_cos</span><span class="o">,</span> <span class="n">deriv_sin</span><span class="o">,</span> <span class="n">deriv_exp</span><span class="o">,</span> <span class="n">smul_eq_mul</span><span class="o">],</span>
  <span class="n">ring</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">differentiable_cos</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">differentiable_sin</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">differentiable_cos</span><span class="bp">.</span><span class="n">comp</span> <span class="n">differentiable_sin</span><span class="o">,</span>
  <span class="n">apply</span> <span class="n">differentiable_exp</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="193775098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775098">Johan Commelin (Apr 13 2020 at 14:07)</a>:</h4>
<p>Anyway, the interesting question is... how do we make this <code>by simp; ring</code></p>

<a name="193775113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775113" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775113">Patrick Massot (Apr 13 2020 at 14:07)</a>:</h4>
<p>Which clearly shows we need a tactic taking care of the four apply at the end.</p>

<a name="193775121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775121" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775121">Johan Commelin (Apr 13 2020 at 14:07)</a>:</h4>
<p>Or <code>by power_through_analysis</code></p>

<a name="193775126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775126" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775126">Kevin Buzzard (Apr 13 2020 at 14:07)</a>:</h4>
<p>I was wondering how readable we could get it. I was thinking of undergraduates.</p>

<a name="193775151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775151">Kevin Buzzard (Apr 13 2020 at 14:07)</a>:</h4>
<p>I am pretty sure that an UG at my university solves this question using an algorithm</p>

<a name="193775209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193775209" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193775209">Kevin Buzzard (Apr 13 2020 at 14:08)</a>:</h4>
<p>They could even differentiate <code>log(x)+log(-x)</code> using the same algorithm</p>

<a name="193776607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193776607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193776607">Patrick Massot (Apr 13 2020 at 14:23)</a>:</h4>
<p>This is all very weird. Does anyone know why</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">complex</span><span class="bp">.</span><span class="n">exponential</span>

<span class="kn">open</span> <span class="n">complex</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span>  <span class="o">:</span> <span class="n">differentiable_at</span> <span class="n">ℂ</span> <span class="n">sin</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">differentiable_cos</span> <span class="n">x</span>
</pre></div>


<p>gives a time-out? I would expect it to fail very quickly. Note that sin and cos mistake is intentional. I want a typing error, but not a timeout.</p>

<a name="193776675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193776675" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193776675">Johan Commelin (Apr 13 2020 at 14:23)</a>:</h4>
<p>Had the same problem!</p>

<a name="193777810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193777810" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193777810">Kevin Buzzard (Apr 13 2020 at 14:35)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">complex</span><span class="bp">.</span><span class="n">exponential</span>

<span class="kn">open</span> <span class="n">complex</span>

<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq</span> <span class="n">true</span>
<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">type_context</span><span class="bp">.</span><span class="n">is_def_eq_detail</span> <span class="n">true</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℂ</span><span class="o">)</span>  <span class="o">:</span> <span class="n">differentiable_at</span> <span class="n">ℂ</span> <span class="n">sin</span> <span class="n">x</span> <span class="o">:=</span>
<span class="n">differentiable_cos</span> <span class="n">x</span>
</pre></div>

<a name="193777934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193777934" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193777934">Kevin Buzzard (Apr 13 2020 at 14:36)</a>:</h4>
<p><a href="https://gist.github.com/kbuzzard/b995aa029459a043b807695ea6d84ae7" title="https://gist.github.com/kbuzzard/b995aa029459a043b807695ea6d84ae7">https://gist.github.com/kbuzzard/b995aa029459a043b807695ea6d84ae7</a></p>

<a name="193778000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778000" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778000">Kevin Buzzard (Apr 13 2020 at 14:37)</a>:</h4>
<p>It is plausible that <code>sin = cos</code></p>

<a name="193778165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778165" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778165">Kevin Buzzard (Apr 13 2020 at 14:38)</a>:</h4>
<p>It takes a long time to fail, and it seems to ask this question many many times</p>
<div class="codehilite"><pre><span></span>[type_context.is_def_eq_detail] [18]: sin x&#39; =?= cos x&#39;
[type_context.is_def_eq_detail] [19]: (exp (-x&#39; * I) - exp (x&#39; * I)) * I / 2 =?= (exp (x&#39; * I) + exp (-x&#39; * I)) / 2
[type_context.is_def_eq_detail] [20]: algebra.div ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2 =?= algebra.div (exp (x&#39; * I) + exp (-x&#39; * I)) 2
[type_context.is_def_eq_detail] unfold left&amp;right: algebra.div
[type_context.is_def_eq_detail] [21]: (exp (-x&#39; * I) - exp (x&#39; * I)) * I * 2⁻¹ =?= (exp (x&#39; * I) + exp (-x&#39; * I)) * 2⁻¹
[type_context.is_def_eq_detail] [22]: mul_zero_class.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2⁻¹ =?= mul_zero_class.mul (exp (x&#39; * I) + exp (-x&#39; * I)) 2⁻¹
[type_context.is_def_eq_detail] [23]: semiring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2⁻¹ =?= semiring.mul (exp (x&#39; * I) + exp (-x&#39; * I)) 2⁻¹
[type_context.is_def_eq_detail] [24]: ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2⁻¹ =?= ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)) 2⁻¹
[type_context.is_def_eq_detail] [25]: division_ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2⁻¹ =?= division_ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)) 2⁻¹
[type_context.is_def_eq_detail] [26]: field.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2⁻¹ =?= field.mul (exp (x&#39; * I) + exp (-x&#39; * I)) 2⁻¹
[type_context.is_def_eq_detail] [27]: comm_ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I) 2⁻¹ =?= comm_ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)) 2⁻¹
[type_context.is_def_eq_detail] [28]: (exp (-x&#39; * I) - exp (x&#39; * I)) * I * 2⁻¹ =?= (exp (x&#39; * I) + exp (-x&#39; * I)) * 2⁻¹
[type_context.is_def_eq_detail] [29]: (λ (z w : ℂ), {re := z.re * w.re - z.im * w.im, im := z.re * w.im + z.im * w.re})
  ((exp (-x&#39; * I) - exp (x&#39; * I)) * I)
  2⁻¹ =?= (λ (z w : ℂ), {re := z.re * w.re - z.im * w.im, im := z.re * w.im + z.im * w.re}) (exp (x&#39; * I) + exp (-x&#39; * I))
  2⁻¹
[type_context.is_def_eq_detail] after whnf_core: {re := ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re - ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im,
 im := ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.im + ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.re} =?= {re := (exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re - (exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im,
 im := (exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.im + (exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.re}
[type_context.is_def_eq_detail] [30]: ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re - ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im =?= (exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re - (exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im
[type_context.is_def_eq_detail] [31]: algebra.sub (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re) (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im) =?= algebra.sub ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) ((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im)
[type_context.is_def_eq_detail] unfold left&amp;right: algebra.sub
[type_context.is_def_eq_detail] [32]: ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re + -(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im) =?= (exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re + -((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im)
[type_context.is_def_eq_detail] [33]: add_semigroup.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re)
  (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= add_semigroup.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [34]: add_monoid.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re)
  (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= add_monoid.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [35]: add_group.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re)
  (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= add_group.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [36]: add_comm_group.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re)
  (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= add_comm_group.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [37]: ring.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re) (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= ring.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [38]: comm_ring.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re)
  (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= comm_ring.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [39]: comm_ring.add (((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re)
  (-(((exp (-x&#39; * I) - exp (x&#39; * I)) * I).im * 2⁻¹.im)) =?= comm_ring.add ((exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re) (-((exp (x&#39; * I) + exp (-x&#39; * I)).im * 2⁻¹.im))
[type_context.is_def_eq_detail] [40]: ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re * 2⁻¹.re =?= (exp (x&#39; * I) + exp (-x&#39; * I)).re * 2⁻¹.re
[type_context.is_def_eq_detail] [41]: no_zero_divisors.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re 2⁻¹.re =?= no_zero_divisors.mul (exp (x&#39; * I) + exp (-x&#39; * I)).re 2⁻¹.re
[type_context.is_def_eq_detail] [42]: domain.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re 2⁻¹.re =?= domain.mul (exp (x&#39; * I) + exp (-x&#39; * I)).re 2⁻¹.re
[type_context.is_def_eq_detail] [43]: linear_ordered_ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re 2⁻¹.re =?= linear_ordered_ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)).re 2⁻¹.re
[type_context.is_def_eq_detail] [44]: linear_ordered_comm_ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re 2⁻¹.re =?= linear_ordered_comm_ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)).re 2⁻¹.re
[type_context.is_def_eq_detail] [45]: comm_ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re 2⁻¹.re =?= comm_ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)).re 2⁻¹.re
[type_context.is_def_eq_detail] [46]: comm_ring.mul ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re 2⁻¹.re =?= comm_ring.mul (exp (x&#39; * I) + exp (-x&#39; * I)).re 2⁻¹.re
[type_context.is_def_eq_detail] [47]: ((exp (-x&#39; * I) - exp (x&#39; * I)) * I).re =?= (exp (x&#39; * I) + exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [48]: (exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re - (exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im =?= (exp (x&#39; * I)).re + (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [49]: algebra.sub ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) ((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im) =?= distrib.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] unfold left: algebra.sub
[type_context.is_def_eq_detail] [50]: (exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re + -((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im) =?= distrib.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [51]: add_semigroup.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [52]: add_monoid.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= comm_ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [53]: add_group.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= comm_ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [54]: add_comm_group.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= comm_ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [55]: ring.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= comm_ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [56]: comm_ring.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= comm_ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [57]: comm_ring.add ((exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re) (-((exp (-x&#39; * I) - exp (x&#39; * I)).im * I.im)) =?= comm_ring.add (exp (x&#39; * I)).re (exp (-x&#39; * I)).re
[type_context.is_def_eq_detail] [58]: (exp (-x&#39; * I) - exp (x&#39; * I)).re * I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [59]: no_zero_divisors.mul (exp (-x&#39; * I) - exp (x&#39; * I)).re I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [60]: domain.mul (exp (-x&#39; * I) - exp (x&#39; * I)).re I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [61]: linear_ordered_ring.mul (exp (-x&#39; * I) - exp (x&#39; * I)).re I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [62]: linear_ordered_comm_ring.mul (exp (-x&#39; * I) - exp (x&#39; * I)).re I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [63]: comm_ring.mul (exp (-x&#39; * I) - exp (x&#39; * I)).re I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [64]: comm_ring.mul (exp (-x&#39; * I) - exp (x&#39; * I)).re I.re =?= (exp (x&#39; * I)).re
[type_context.is_def_eq_detail] [65]: comm_ring.mul =?= re
</pre></div>

<a name="193778327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778327">Johan Commelin (Apr 13 2020 at 14:40)</a>:</h4>
<p><code>attribute [irreducible] sin cos</code> doesn't seem to help</p>

<a name="193778533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778533">Kevin Buzzard (Apr 13 2020 at 14:42)</a>:</h4>
<p>Lean gets into a loop trying to prove <code>sin x' =?= cos x'</code>. If you search for this string in the gist you can see it first occurs at depth [8], then [9], then [10] etc.</p>

<a name="193778614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778614">Johan Commelin (Apr 13 2020 at 14:42)</a>:</h4>
<p>Yes, but shouldn't it help to make them irreducible?</p>

<a name="193778753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778753">Kevin Buzzard (Apr 13 2020 at 14:44)</a>:</h4>
<p>The poison, or part of it, is this line:</p>
<div class="codehilite"><pre><span></span>[type_context.is_def_eq_detail] [5]: asymptotics.is_o (λ (x&#39; : ?m_1), sin x&#39; - sin x - ⇑f&#39; (x&#39; - x)) (λ (x&#39; : ?m_1), x&#39; - x) (nhds x) =?= asymptotics.is_o (λ (x&#39; : ℂ), cos x&#39; - cos ?m_8 - ⇑f&#39; (x&#39; - ?m_8)) (λ (x&#39; : ℂ), x&#39; - ?m_8) (nhds ?m_8)
</pre></div>

<a name="193778783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778783" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778783">Kevin Buzzard (Apr 13 2020 at 14:44)</a>:</h4>
<p>Lean never recovers from this, it seems.</p>

<a name="193778875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778875" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778875">Kevin Buzzard (Apr 13 2020 at 14:45)</a>:</h4>
<p>I should remark that because this stream was somehow added in a way that most people didn't notice, I can see right now that e.g. Reid and Rob are not subscribed to it.</p>

<a name="193778894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778894">Kevin Buzzard (Apr 13 2020 at 14:45)</a>:</h4>
<p>or Gabriel</p>

<a name="193778918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193778918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193778918">Johan Commelin (Apr 13 2020 at 14:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> <span class="user-mention" data-user-id="110596">@Rob Lewis</span> <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> are you interested in this stream?</p>

<a name="193779015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193779015" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193779015">Kevin Buzzard (Apr 13 2020 at 14:46)</a>:</h4>
<p>I'll post in #general</p>

<a name="193779022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193779022" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193779022">Reid Barton (Apr 13 2020 at 14:46)</a>:</h4>
<p>I think when it was created I was a little confused about why, but given that people are now using it then sure.</p>

<a name="193779553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193779553" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193779553">Patrick Massot (Apr 13 2020 at 14:51)</a>:</h4>
<p>It's also true that this stream is very easy to derail. For instance, Kevin's question was legitimate in this thread, but then I should have switched when I hit this issue.</p>

<a name="193788621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193788621" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193788621">Sebastien Gouezel (Apr 13 2020 at 16:14)</a>:</h4>
<p>Here is my version:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">has_deriv_at</span><span class="bp">.</span><span class="n">deriv</span><span class="o">,</span>
  <span class="n">convert</span> <span class="o">((</span><span class="n">has_deriv_at_cos</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="bp">_</span> <span class="o">(</span><span class="n">has_deriv_at_sin</span> <span class="n">x</span><span class="o">))</span><span class="bp">.</span><span class="n">mul</span> <span class="o">(</span><span class="n">has_deriv_at_exp</span> <span class="n">x</span><span class="o">),</span>
  <span class="n">rw</span> <span class="n">smul_eq_mul</span><span class="o">,</span>
  <span class="n">ring</span>
<span class="kn">end</span>
</pre></div>


<p>The <code>smul_eq_mul</code> shouldn't be here, I'll work on removing it.</p>

<a name="193807496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193807496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193807496">Sebastien Gouezel (Apr 13 2020 at 19:00)</a>:</h4>
<p>This becomes</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">convert</span> <span class="o">(((</span><span class="n">has_deriv_at_cos</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="bp">_</span> <span class="o">(</span><span class="n">has_deriv_at_sin</span> <span class="n">x</span><span class="o">))</span><span class="bp">.</span><span class="n">mul</span> <span class="o">(</span><span class="n">has_deriv_at_exp</span> <span class="n">x</span><span class="o">))</span><span class="bp">.</span><span class="n">deriv</span><span class="o">,</span>
  <span class="n">ring</span>
<span class="kn">end</span>
</pre></div>


<p>with my next PR. The best thing is if you don't want to compute the derivative by hand. You write</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">convert</span> <span class="o">(((</span><span class="n">has_deriv_at_cos</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">comp</span> <span class="bp">_</span> <span class="o">(</span><span class="n">has_deriv_at_sin</span> <span class="n">x</span><span class="o">))</span><span class="bp">.</span><span class="n">mul</span> <span class="o">(</span><span class="n">has_deriv_at_exp</span> <span class="n">x</span><span class="o">))</span><span class="bp">.</span><span class="n">deriv</span><span class="o">,</span>
  <span class="n">ring</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<p>which of course doesn't work, but the goal after the last <code>ring</code> is <code>0 = -(sin (sin x) * cos x * exp x) + (cos ∘ sin) x * exp x</code>, giving you on the right a formula for the derivative.</p>

<a name="193808537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193808537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193808537">Sebastien Gouezel (Apr 13 2020 at 19:08)</a>:</h4>
<p>See <a href="https://github.com/leanprover-community/mathlib/issues/2410" title="https://github.com/leanprover-community/mathlib/issues/2410">#2410</a></p>

<a name="193808914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193808914" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193808914">Johan Commelin (Apr 13 2020 at 19:12)</a>:</h4>
<p>If there were a chain rule emoji, I would use it now (-;</p>

<a name="193839944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193839944" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193839944">Scott Morrison (Apr 14 2020 at 00:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/undergraduate.20calculus/near/193775113" title="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/undergraduate.20calculus/near/193775113">said</a>:</p>
<blockquote>
<p>Which clearly shows we need a tactic taking care of the four apply at the end.</p>
</blockquote>
<p>The right tactic to build on is <code>solve_by_elim</code>. In general, if a sequence of <code>apply Xi</code> and <code>exact Xj</code> succeed, then <code>solve_by_elim [X1, X2, ..., Xn]</code> should also succeed.</p>

<a name="193840025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193840025" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193840025">Scott Morrison (Apr 14 2020 at 00:46)</a>:</h4>
<p>You can also specify an attribute, so tagging <code>differentiable_cos, differentiable_sin, differentiable_cos.comp, differentiable_exp</code> with <code>[differentiable]</code> and writing <code>solve_by_elim with differentiable</code> should succeed.</p>

<a name="193840048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193840048" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193840048">Scott Morrison (Apr 14 2020 at 00:46)</a>:</h4>
<p>We can also provide ways to automatically collect families of lemmas, I think!</p>

<a name="193840180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193840180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193840180">Scott Morrison (Apr 14 2020 at 00:49)</a>:</h4>
<p>I think it would be great to see how far continuity and differentiability problems can be solved like this.</p>

<a name="193840288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193840288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193840288">Mario Carneiro (Apr 14 2020 at 00:50)</a>:</h4>
<p>Does the apply bug cause any problems here? Does <code>solve_by_elim</code> use <code>apply</code> or a homegrown version?</p>

<a name="193845426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845426" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845426">Scott Morrison (Apr 14 2020 at 02:43)</a>:</h4>
<p>Can you remind me "the apply bug"?</p>

<a name="193845429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845429" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845429">Scott Morrison (Apr 14 2020 at 02:43)</a>:</h4>
<p>We recently fixed a bug in <code>solve_by_elim</code> because of stuck metavariables.</p>

<a name="193845472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845472" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845472">Reid Barton (Apr 14 2020 at 02:44)</a>:</h4>
<p>Something about <code>apply</code> being confused about the number of <code>_</code>s to insert</p>

<a name="193845483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845483" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845483">Scott Morrison (Apr 14 2020 at 02:44)</a>:</h4>
<p>Which I think would have prevented this example working, because the second application of <code>differentiable_sin</code> would have been blocked by having different values of the hidden implicit metavariables.</p>

<a name="193845503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845503" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845503">Scott Morrison (Apr 14 2020 at 02:44)</a>:</h4>
<p><code>solve_by_elim</code> uses the built-in <code>apply</code>.</p>

<a name="193845507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845507" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845507">Scott Morrison (Apr 14 2020 at 02:44)</a>:</h4>
<p>So it would be great to know of an example where it fails because of whatever this issue is!</p>

<a name="193845514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845514">Reid Barton (Apr 14 2020 at 02:45)</a>:</h4>
<p>i.e. <code>apply f x</code> is really <code>refine f x _ _ ... _</code> and if you get the number of <code>_</code>s wrong then it probably won't work (since the type will be a function and not a Prop/whatever, or vice versa)</p>

<a name="193845520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193845520" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193845520">Reid Barton (Apr 14 2020 at 02:45)</a>:</h4>
<p>try applying any lemma for continuity that doesn't take exactly one argument, IIRC</p>

<a name="193861116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193861116" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193861116">Patrick Massot (Apr 14 2020 at 07:55)</a>:</h4>
<p>Any such solution will hit <a href="#narrow/stream/113488-general/topic/sin.20.3D.20cos.20timeout" title="#narrow/stream/113488-general/topic/sin.20.3D.20cos.20timeout">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/sin.20.3D.20cos.20timeout</a> with or without the apply bug. This is what started this sin vs cos discussion.</p>

<a name="193884615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193884615" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193884615">Sebastien Gouezel (Apr 14 2020 at 11:47)</a>:</h4>
<p>See <a href="https://github.com/leanprover-community/mathlib/issues/2416" title="https://github.com/leanprover-community/mathlib/issues/2416">#2416</a> making <code>is_o</code> irreducible. I think it should be possible to get formulas for the derivative just by tagging some lemmas as simp lemmas, I will try this now.</p>

<a name="193932640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193932640" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193932640">Yury G. Kudryashov (Apr 14 2020 at 17:41)</a>:</h4>
<p>Will it help to make only <code>is_O_with</code> irreducible?</p>

<a name="193933287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193933287" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193933287">Yury G. Kudryashov (Apr 14 2020 at 17:46)</a>:</h4>
<p>I also want to have an easy way to "apply" <code>is_o</code> to <code>h : 0 &lt; c</code>. If it isn't possible with <code>irreducible</code> <code>is_o</code> (didn't test), could you please add something like <code>is_o.def : ∀ {{c}}, 0 &lt; c → ∃ C, ...</code> and <code>is_o.def' : ∀ {{c}}, 0 &lt; c → is_O_with c f g l</code>?</p>

<a name="193933318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193933318" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193933318">Yury G. Kudryashov (Apr 14 2020 at 17:46)</a>:</h4>
<p>BTW, why do you make only two of three <code>irreducible</code>?</p>

<a name="193952549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193952549" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193952549">Sebastien Gouezel (Apr 14 2020 at 20:26)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="n">deriv</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">cos</span> <span class="o">(</span><span class="n">sin</span> <span class="n">x</span><span class="o">)</span> <span class="bp">*</span> <span class="n">exp</span> <span class="n">x</span><span class="o">)</span> <span class="n">x</span> <span class="bp">=</span> <span class="o">(</span><span class="n">cos</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">-</span><span class="n">sin</span><span class="o">(</span><span class="n">sin</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">))</span><span class="bp">*</span><span class="n">exp</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">by</span> <span class="o">{</span> <span class="n">simp</span><span class="o">,</span> <span class="n">ring</span> <span class="o">}</span>
</pre></div>


<p>see <a href="https://github.com/leanprover-community/mathlib/issues/2419" title="https://github.com/leanprover-community/mathlib/issues/2419">#2419</a></p>

<a name="193952732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193952732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193952732">Patrick Massot (Apr 14 2020 at 20:27)</a>:</h4>
<p>Doesn't it mean too many simp lemmas? Do we need a simp set attribute here?</p>

<a name="193953344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193953344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193953344">Sebastien Gouezel (Apr 14 2020 at 20:33)</a>:</h4>
<p>Yes, that's one of the options I considered. Since all the lemmas I tag start with <code>differentiable</code> or <code>differentiable_at</code> or <code>deriv</code>, they should be very easy to discard in other situations, so I don't expect any serious performance hit, but I might be wrong on this and I would be happy to hear more informed opinions.</p>

<a name="193953577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193953577" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193953577">Sebastien Gouezel (Apr 14 2020 at 20:35)</a>:</h4>
<p>In fact, I don't think it is important that Lean is able to compute directly the derivative of <code>(λ x, cos (sin x) * exp x)</code> (we never do this in real maths), except for one reason: to show to undergrads that Lean can do nice things. And for this goal this feature should be as simple as possible, and I think it is hard to make something more simple than just a <code>simp</code> call.</p>

<a name="193953810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193953810" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193953810">Johan Commelin (Apr 14 2020 at 20:37)</a>:</h4>
<p><code>simp with deriv</code> is slightly more complicated, but not too bad, if this turns out to be a performance hit</p>

<a name="193954473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193954473" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193954473">Sebastien Gouezel (Apr 14 2020 at 20:43)</a>:</h4>
<p>Yes, if there is a performance hit I will definitely go for a simpset attribute. A dedicated tactic would be even more efficient (here, to check differentiability of <code>exp (exp (exp (... x)))</code>, <code>simp</code> will go through the whole expression (length <code>n</code>), reach the last <code>exp</code>, and then ask if the rest of the expression (with <code>n-1</code> functions) is differentiable. Then if will again go through the complete subexpression (length <code>n-1</code>) and so on, giving in the end something quadratic while this should be linear). I don't really mind since this should never be applied in real complicated examples.</p>

<a name="193955449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193955449" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193955449">Yury G. Kudryashov (Apr 14 2020 at 20:51)</a>:</h4>
<p>A nice project for someone (not me) would be to formalize the following Arnold's problem:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo><mi>lim</mi><mo>⁡</mo></mo><mrow><mi>x</mi><mo>→</mo><mn>0</mn></mrow></munder><mfrac><mrow><mi>sin</mi><mo>⁡</mo><mi>tan</mi><mo>⁡</mo><mi>x</mi><mo>−</mo><mi>tan</mi><mo>⁡</mo><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow><mrow><msup><mo><mi>sin</mi><mo>⁡</mo></mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mo><mi>tan</mi><mo>⁡</mo></mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>x</mi><mo>−</mo><msup><mo><mi>tan</mi><mo>⁡</mo></mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mo><mi>sin</mi><mo>⁡</mo></mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>x</mi></mrow></mfrac><mo>=</mo><mo stretchy="false">?</mo></mrow><annotation encoding="application/x-tex">\lim_{x\to 0}\frac{\sin\tan x-\tan\sin x}{\sin^{-1}\tan^{-1} x - \tan^{-1}\sin^{-1} x}=?</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.190058em;vertical-align:-0.845198em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-2.382892em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mrel mtight">→</span><span class="mord mtight">0</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">lim</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.717108em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3448600000000002em;"><span style="top:-2.2381320000000002em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop">sin</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.871868em;"><span style="top:-3.12076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">tan</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8190879999999999em;"><span style="top:-3.06798em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop"><span class="mop">tan</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8190879999999999em;"><span style="top:-3.06798em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">sin</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.871868em;"><span style="top:-3.12076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">tan</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mop">tan</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.845198em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mclose">?</span></span></span></span></span></p>
<p>The legend says that he came up with a similar limit while commuting to MSU, computed it, then understood how to prove the answer with no computation, then asked it on the oral exam for PhD students (though he understood that the problem is too hard for students, so he asked professors).</p>

<a name="193955489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193955489" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193955489">Reid Barton (Apr 14 2020 at 20:51)</a>:</h4>
<p><code> ```latex </code></p>

<a name="193955497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193955497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193955497">Johan Commelin (Apr 14 2020 at 20:51)</a>:</h4>
<div class="codehilite"><pre><span></span>```latex
x + y
```
</pre></div>

<a name="193955644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193955644" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193955644">Johan Commelin (Apr 14 2020 at 20:52)</a>:</h4>
<p>Stupid mathjax doesn't know <code>\arcsin</code>?</p>

<a name="193960632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193960632" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193960632">Kevin Buzzard (Apr 14 2020 at 21:43)</a>:</h4>
<p>Of course I asked this question precisely for undergraduate-related reasons, I don't care if simp does it, but perhaps one of the CS guys should tell us their opinion</p>

<a name="193960716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193960716" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193960716">Kevin Buzzard (Apr 14 2020 at 21:44)</a>:</h4>
<p>I don't think it's unreasonable to have different tactics doing different jobs, hardly anyone at Xena knows what simp does, they just try it on anything</p>

<a name="193960746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193960746" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193960746">Kevin Buzzard (Apr 14 2020 at 21:44)</a>:</h4>
<p>I guess Chris knows:-)</p>

<a name="193998826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193998826" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193998826">Gabriel Ebner (Apr 15 2020 at 08:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110050">Sebastien Gouezel</span> <a href="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/undergraduate.20calculus/near/193954473" title="#narrow/stream/217875-Is-there.20code.20for.20X.3F/topic/undergraduate.20calculus/near/193954473">said</a>:</p>
<blockquote>
<p>[..] to check differentiability of <code>exp (exp (exp (... x)))</code>, <code>simp</code> will go through the whole expression (length <code>n</code>), reach the last <code>exp</code>, and then ask if the rest of the expression (with <code>n-1</code> functions) is differentiable. Then if will again go through the complete subexpression (length <code>n-1</code>) and so on, giving in the end something quadratic while this should be linear).</p>
</blockquote>
<p>Did you actually have this issue?  The simplifier has a cache, so this should have linear runtime.</p>

<a name="193998995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/193998995" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#193998995">Mario Carneiro (Apr 15 2020 at 08:31)</a>:</h4>
<p>Isn't the output quadratic anyway? (The dedup term is linear but I doubt lean can keep that up.)</p>

<a name="194014317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/194014317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#194014317">Yury G. Kudryashov (Apr 15 2020 at 11:13)</a>:</h4>
<p>As far as I understand, the only way to avoid quadratic output with the current setup is to use <code>has_fderiv_at</code></p>

<a name="194014368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/194014368" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#194014368">Yury G. Kudryashov (Apr 15 2020 at 11:14)</a>:</h4>
<p>Though of course I may be wrong</p>

<a name="194020360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/217875-Is%20there%20code%20for%20X%3F/topic/undergraduate%20calculus/near/194020360" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/217875IstherecodeforX/75336undergraduatecalculus.html#194020360">Sebastien Gouezel (Apr 15 2020 at 12:18)</a>:</h4>
<p>In fact I don't really care about the quadratic behavior because I think we will just use this on toy examples. And if simp indeed has a cache (I didn't know this), then it might not even be there.</p>


{% endraw %}

{% include archive_update.html %}