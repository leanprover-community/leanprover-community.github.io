---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/48347emacstools.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html">emacs tools</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="127482729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127482729" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127482729">Simon Hudon (Jun 03 2018 at 00:11)</a>:</h4>
<p>Is it possible in emacs lisp to use <code>lean-server-session-send-command</code> to get the text of a definition? Failing that, is it possible to use it with the command <code>'info</code> to get the line info of the next command in the file that contains it? I'm trying to create a command to display the definition of the symbol the cursor is currently on.</p>

<a name="127510536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127510536" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127510536">Sebastian Ullrich (Jun 03 2018 at 18:09)</a>:</h4>
<p>No, I can't think of any way to do that</p>

<a name="127511408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127511408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127511408">Simon Hudon (Jun 03 2018 at 18:44)</a>:</h4>
<p>What I ended up doing is use the list of keywords in <code>lean-syntax</code> and only keep the ones that are commands, use <code>lean-find-definition</code> to find the location of the definition and <code>re-search-forward</code> to find the next command. That's pretty primitive because it doesn't account for user command but it might just be good enough.</p>

<a name="127511513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127511513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127511513">Sebastian Ullrich (Jun 03 2018 at 18:48)</a>:</h4>
<p>Good enough I guess :)</p>

<a name="127518889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127518889" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127518889">Simon Hudon (Jun 03 2018 at 23:17)</a>:</h4>
<p>I'm wondering if it would be more useful to just go with find definition and have an option to go back. What do you think? The easiest way to do it is provide one slot memory for finding definition but it would be nicer to have many slots. I just don't want it to grow without bounds.</p>

<a name="127519166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519166" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519166">Reid Barton (Jun 03 2018 at 23:27)</a>:</h4>
<p>How about setting the mark to the old location if the definition is in the same file?</p>

<a name="127519210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519210" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519210">Simon Hudon (Jun 03 2018 at 23:28)</a>:</h4>
<p>What does that solve?</p>

<a name="127519219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519219" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519219">Reid Barton (Jun 03 2018 at 23:29)</a>:</h4>
<p>then you can C-x C-x to go back</p>

<a name="127519227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519227">Reid Barton (Jun 03 2018 at 23:29)</a>:</h4>
<p>for example, isearch (C-s) does this</p>

<a name="127519340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519340" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519340">Simon Hudon (Jun 03 2018 at 23:32)</a>:</h4>
<p>Ah I see! But then when you go to another file, you have a different shortcut than when you stay in the same file</p>

<a name="127519418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519418" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519418">Reid Barton (Jun 03 2018 at 23:36)</a>:</h4>
<p>Apparently there's also C-x C-SPC which will pop marks off a global stack, between files</p>

<a name="127519469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519469">Reid Barton (Jun 03 2018 at 23:37)</a>:</h4>
<p>So that would always work as a "go back" key</p>

<a name="127519533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519533">Reid Barton (Jun 03 2018 at 23:39)</a>:</h4>
<p><a href="https://stackoverflow.com/questions/4918707/in-emacs-how-to-go-back-to-previous-line-position-after-using-semantic-jump-to" target="_blank" title="https://stackoverflow.com/questions/4918707/in-emacs-how-to-go-back-to-previous-line-position-after-using-semantic-jump-to">https://stackoverflow.com/questions/4918707/in-emacs-how-to-go-back-to-previous-line-position-after-using-semantic-jump-to</a></p>

<a name="127519595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519595" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519595">Simon Hudon (Jun 03 2018 at 23:41)</a>:</h4>
<p>Nice! So you suggest that in <code>lean-find-definition</code> (which is called when you press <code>M-.</code>) I first push the mark and then set the mark to <code>(point)</code> and then the user will simply have access to those features?</p>

<a name="127519597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519597" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519597">Simon Hudon (Jun 03 2018 at 23:41)</a>:</h4>
<p>Is there a limit to the number of slots on that stack?</p>

<a name="127519603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519603" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519603">Reid Barton (Jun 03 2018 at 23:41)</a>:</h4>
<p>I don't know. I just found out the limit is more than one <span class="emoji emoji-1f642" title="simple smile">:simple_smile:</span></p>

<a name="127519650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519650">Reid Barton (Jun 03 2018 at 23:42)</a>:</h4>
<p>I think you just need to call <code>(push-mark)</code> before doing the navigation</p>

<a name="127519710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519710" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519710">Reid Barton (Jun 03 2018 at 23:44)</a>:</h4>
<div class="codehilite"><pre><span></span>mark-ring-max is a variable defined in ‘simple.el’.
Its value is 16

Documentation:
Maximum size of mark ring.  Start discarding off end if gets this big.
</pre></div>

<a name="127519766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519766" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519766">Simon Hudon (Jun 03 2018 at 23:46)</a>:</h4>
<blockquote>
<p>I think you just need to call <code>(push-mark)</code> before doing the navigation</p>
</blockquote>
<p>Inside of <code>lean-mode</code> or as a user of <code>lean-mode</code>?</p>

<a name="127519772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519772">Reid Barton (Jun 03 2018 at 23:47)</a>:</h4>
<p><code>lean-find-definition</code> should call it (I guess, haven't looked at the code)</p>

<a name="127519825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519825" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519825">Reid Barton (Jun 03 2018 at 23:48)</a>:</h4>
<p>Hmm. I see there is already this, in <code>lean-find-definition-cont</code></p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="nb">cl-defun</span> <span class="nv">lean-find-definition-cont</span> <span class="p">(</span><span class="kp">&amp;key</span> <span class="nv">file</span> <span class="nv">line</span> <span class="nv">column</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">fboundp</span> <span class="ss">&#39;xref-push-marker-stack</span><span class="p">)</span> <span class="p">(</span><span class="nv">xref-push-marker-stack</span><span class="p">))</span>
<span class="o">...</span>
</pre></div>

<a name="127519832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519832" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519832">Simon Hudon (Jun 03 2018 at 23:49)</a>:</h4>
<p>This is so nice! It's working very well!</p>

<a name="127519836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519836" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519836">Simon Hudon (Jun 03 2018 at 23:49)</a>:</h4>
<p>Thanks!</p>

<a name="127519894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519894">Simon Hudon (Jun 03 2018 at 23:50)</a>:</h4>
<p>I can PR it if you'd like to have it too</p>

<a name="127519900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519900" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519900">Reid Barton (Jun 03 2018 at 23:51)</a>:</h4>
<p>Yes please</p>

<a name="127519907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519907">Reid Barton (Jun 03 2018 at 23:51)</a>:</h4>
<p>I've been wanting this feature too, but the mark thing just occurred to me now</p>

<a name="127519969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127519969" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127519969">Reid Barton (Jun 03 2018 at 23:53)</a>:</h4>
<p>It looks like maybe M-, already does the same thing? but I have that mapped to autocomplete</p>

<a name="127520133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/emacs%20tools/near/127520133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/48347emacstools.html#127520133">Simon Hudon (Jun 03 2018 at 23:58)</a>:</h4>
<p>You're right! I undid my changes and <code>M-.</code> <code>M-.</code> <code>M-,</code> <code>M-,</code> brings me back to the beginning. It looks like my pull request will be the empty set. I hope it's approved!</p>


{% endraw %}
