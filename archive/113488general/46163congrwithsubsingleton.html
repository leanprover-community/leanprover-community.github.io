---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/46163congrwithsubsingleton.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html">congr with subsingleton</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="128141922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141922" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141922">Reid Barton (Jun 15 2018 at 21:20)</a>:</h4>
<p>Is this a bug in <code>congr</code>?</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">subsingleton</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">y</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">congr</span> <span class="c1">-- fails</span>
<span class="kn">example</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">subsingleton</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">y</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">congr</span> <span class="c1">-- ok</span>
</pre></div>

<a name="128141939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141939" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141939">Kenny Lau (Jun 15 2018 at 21:21)</a>:</h4>
<p>what is supposed to the state after the first <code>by congr</code>?</p>

<a name="128141945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141945">Reid Barton (Jun 15 2018 at 21:21)</a>:</h4>
<p>"no goals"</p>

<a name="128141948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141948">Kenny Lau (Jun 15 2018 at 21:21)</a>:</h4>
<p>oh</p>

<a name="128141949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141949" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141949">Reid Barton (Jun 15 2018 at 21:21)</a>:</h4>
<p>Actually, I made the second example slightly poor.</p>

<a name="128141956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141956" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141956">Reid Barton (Jun 15 2018 at 21:21)</a>:</h4>
<p>Edited now.</p>

<a name="128141958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128141958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128141958">Mario Carneiro (Jun 15 2018 at 21:21)</a>:</h4>
<p>Not in the sense that I'm not surprised by the result</p>

<a name="128142002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142002">Mario Carneiro (Jun 15 2018 at 21:22)</a>:</h4>
<p><code>congr</code> only gets its subsingleton optimization when it actually applies a function</p>

<a name="128142007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142007">Mario Carneiro (Jun 15 2018 at 21:22)</a>:</h4>
<p>because it simplifies the congruence lemma for <code>f</code></p>

<a name="128142018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142018" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142018">Mario Carneiro (Jun 15 2018 at 21:22)</a>:</h4>
<p>so if <code>congr_core</code> applies 0 times the optimization never gets a chance</p>

<a name="128142028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142028" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142028">Reid Barton (Jun 15 2018 at 21:23)</a>:</h4>
<p>I see</p>

<a name="128142047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142047">Reid Barton (Jun 15 2018 at 21:23)</a>:</h4>
<p>I have a more complicated example where <code>congr</code> fails even when there is a function being applied, but I need to minimize it first.</p>

<a name="128142090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142090" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142090">Reid Barton (Jun 15 2018 at 21:24)</a>:</h4>
<p>Is <code>simp</code> supposed to understand subsingletons then? What exactly does it do with them? It can't handle either of these goals</p>

<a name="128142125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142125" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142125">Mario Carneiro (Jun 15 2018 at 21:25)</a>:</h4>
<p><code>simp</code> uses <code>congr</code> to enter a term, so it gets subsingleton handling indirectly that way</p>

<a name="128142133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142133">Mario Carneiro (Jun 15 2018 at 21:25)</a>:</h4>
<p>but it won't rewrite <code>x</code> to <code>y</code> if that's what you mean</p>

<a name="128142180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142180">Mario Carneiro (Jun 15 2018 at 21:26)</a>:</h4>
<p>mostly it's helpful for carrying along dependent arguments</p>

<a name="128142183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142183">Reid Barton (Jun 15 2018 at 21:26)</a>:</h4>
<p>Oh, so by "it [<code>congr</code>] simplifies the congruence lemma" you don't mean using <code>simp</code>?</p>

<a name="128142191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142191" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142191">Mario Carneiro (Jun 15 2018 at 21:26)</a>:</h4>
<p>No, I mean that the congruence lemma that is generated lacks an equality subgoal for any subsingleton arguments</p>

<a name="128142196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142196">Reid Barton (Jun 15 2018 at 21:27)</a>:</h4>
<p>is this stuff in C++, in <code>mk_specialized_congr_lemma</code>?</p>

<a name="128142203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142203" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142203">Mario Carneiro (Jun 15 2018 at 21:27)</a>:</h4>
<p>yes</p>

<a name="128142207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142207" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142207">Mario Carneiro (Jun 15 2018 at 21:27)</a>:</h4>
<p>but you can see the resulting lemma by using the <code>mk_congr_lemma</code> function</p>

<a name="128142838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128142838" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128142838">Reid Barton (Jun 15 2018 at 21:43)</a>:</h4>
<p>OK, the reason <code>congr</code> didn't work in my actual code is because I only have a subsingleton instance for a particular value of one of the type arguments, and the generated congruence lemma was too general and didn't specify the value of that type.</p>

<a name="128143036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/congr%20with%20subsingleton/near/128143036" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46163congrwithsubsingleton.html#128143036">Reid Barton (Jun 15 2018 at 21:48)</a>:</h4>
<p>(Namely, I have a subsingleton instance for <code>a ⟶ b</code> only when <code>a</code> is the initial object of a category)</p>


{% endraw %}
