---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/20539squeezesimp.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html">squeeze_simp</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="135401004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135401004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135401004">Johan Commelin (Oct 08 2018 at 13:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> To what extend do you think <code>sed</code> and <code>lean</code> could cooperate to automatically turn every <code>simp</code> into a <code>squeeze_simp</code>, and then every <code>squeeze_simp</code> into a <code>simp only</code>? Can we automate Kenny?</p>

<a name="135406348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406348">Simon Hudon (Oct 08 2018 at 14:18)</a>:</h4>
<p>But we like Kenny!</p>

<a name="135406424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406424">Simon Hudon (Oct 08 2018 at 14:20)</a>:</h4>
<p>I was thinking along those lines but I was thinking of adding a feature to the emacs Lean mode. I'm not how I would do it for VS code though. Do you know how to script it?</p>

<a name="135406432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406432">Johan Commelin (Oct 08 2018 at 14:20)</a>:</h4>
<p>I don't know anything about VScode</p>

<a name="135406440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406440" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406440">Johan Commelin (Oct 08 2018 at 14:20)</a>:</h4>
<p>But couldn't this just be a CLI-only thing?</p>

<a name="135406455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406455" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406455">Johan Commelin (Oct 08 2018 at 14:21)</a>:</h4>
<p>For other purposes the output of <code>squeeze_simp</code> is already very useful.</p>

<a name="135406473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406473" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406473">Patrick Massot (Oct 08 2018 at 14:21)</a>:</h4>
<p>Can't we use a hole command here again?</p>

<a name="135406490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406490" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406490">Mario Carneiro (Oct 08 2018 at 14:21)</a>:</h4>
<p>you still have to click on a hole command</p>

<a name="135406493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406493" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406493">Johan Commelin (Oct 08 2018 at 14:22)</a>:</h4>
<p>Exactly</p>

<a name="135406537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406537">Mario Carneiro (Oct 08 2018 at 14:22)</a>:</h4>
<p>indeed, you have to manually edit the file to put a hole in in the first place</p>

<a name="135406538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406538">Johan Commelin (Oct 08 2018 at 14:22)</a>:</h4>
<p>I want <code>sed</code> to "click" on the hole command.</p>

<a name="135406554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406554" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406554">Patrick Massot (Oct 08 2018 at 14:22)</a>:</h4>
<p>Oh you mean you want this for batch processing?</p>

<a name="135406562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406562">Simon Hudon (Oct 08 2018 at 14:22)</a>:</h4>
<p>The difficult thing about using something like sed is detecting the end of the input <code>squeeze_simp</code></p>

<a name="135406574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406574" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406574">Simon Hudon (Oct 08 2018 at 14:22)</a>:</h4>
<p>But I guess we could output it in Lean</p>

<a name="135406591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406591" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406591">Simon Hudon (Oct 08 2018 at 14:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> exactly</p>

<a name="135406602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135406602" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135406602">Patrick Massot (Oct 08 2018 at 14:23)</a>:</h4>
<p>Sorry I read too quickly the beginning of this thread (I'm fighting dependent rw)</p>

<a name="135407907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135407907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135407907">Simon Hudon (Oct 08 2018 at 14:41)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> has shown us how useful awk can be in these situations. Do you think if we output the beginning line and column number of the input, the ending line and column number of the input and the replacement, we can get awk to go in there and do the replacement? You'd probably also have to go from the last to the first if you want to do it in one go so that the line numbers don't get invalidated.</p>

<a name="135408204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135408204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135408204">Johan Commelin (Oct 08 2018 at 14:45)</a>:</h4>
<p>Sure, that should definitely be possible</p>

<a name="135408213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135408213" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135408213">Johan Commelin (Oct 08 2018 at 14:45)</a>:</h4>
<p>I guess <code>squeeze_simp</code> can get access to its location in the file via some tactic_state magic, right?</p>

<a name="135408290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135408290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135408290">Johan Commelin (Oct 08 2018 at 14:46)</a>:</h4>
<p>Or you make <code>squeeze_simp</code> output a patch (-;</p>

<a name="135408296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135408296" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135408296">Johan Commelin (Oct 08 2018 at 14:46)</a>:</h4>
<p>Then we can just commit it, and git takes care of the rest <span class="emoji emoji-1f606" title="lol">:lol:</span></p>

<a name="135413309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135413309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135413309">Simon Hudon (Oct 08 2018 at 16:08)</a>:</h4>
<p>I just looked into the patch file format. It seems like more work to format than to just do it ourselves</p>

<a name="135414054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135414054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135414054">Johan Commelin (Oct 08 2018 at 16:20)</a>:</h4>
<p>Ok, so how about your suggestion, with line+col numbers</p>

<a name="135415134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415134" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415134">Simon Hudon (Oct 08 2018 at 16:40)</a>:</h4>
<p>I think the best bet is to use <code>awk</code> but I'll have to learn it</p>

<a name="135415187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415187" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415187">Simon Hudon (Oct 08 2018 at 16:41)</a>:</h4>
<p>Right now I'm experimenting with emacs to see if I can get a nice first approximation</p>

<a name="135415446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415446" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415446">Johan Commelin (Oct 08 2018 at 16:47)</a>:</h4>
<p><code>awk</code> is not hard. Also, I wouldn't mind helping you.</p>

<a name="135415506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415506" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415506">Johan Commelin (Oct 08 2018 at 16:48)</a>:</h4>
<p>We could use <code>sed</code> to squeeze_simpify a <code>.lean</code> file. After that, we run <code>lean --make</code> on the file, and capture the stdout.</p>

<a name="135415521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415521">Johan Commelin (Oct 08 2018 at 16:48)</a>:</h4>
<p>If <code>squeeze_simp</code> can produce output of the form <code>line:column:replacement_text</code> I think we can take it from there.</p>

<a name="135415693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415693">Simon Hudon (Oct 08 2018 at 16:52)</a>:</h4>
<p>I was thinking of a format like this:</p>
<div class="codehilite"><pre><span></span><span class="mi">84</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span>
<span class="mi">86</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span>
<span class="c1">--- BEGIN ---</span>
<span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">perm_cons</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">cons_coe</span><span class="o">,</span> <span class="n">iff_self</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">coe_eq_coe</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">quot_mk_to_coe&#39;&#39;</span><span class="o">]</span>
<span class="c1">--- END ---</span>
</pre></div>

<a name="135415718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415718" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415718">Johan Commelin (Oct 08 2018 at 16:53)</a>:</h4>
<p>unix prefers to keep everything on 1 line.</p>

<a name="135415785"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415785" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415785">Simon Hudon (Oct 08 2018 at 16:54)</a>:</h4>
<p>In that case, how about <code>line0:col0:line1:col1:replacement_text</code>?</p>

<a name="135415873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415873">Johan Commelin (Oct 08 2018 at 16:56)</a>:</h4>
<p>Looks good</p>

<a name="135415884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415884" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415884">Johan Commelin (Oct 08 2018 at 16:56)</a>:</h4>
<p>Unless we want to anticipate multiline replacement texts</p>

<a name="135415997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135415997" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135415997">Simon Hudon (Oct 08 2018 at 16:59)</a>:</h4>
<p>That's what I'm looking at now. The replacement is sometimes multiline but there's no real reason to be. I'll restrict it to one line and let the user reformat if needed</p>

<a name="135416006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416006">Johan Commelin (Oct 08 2018 at 16:59)</a>:</h4>
<p>There is no "user" if we run this in batch mode over 25 files.</p>

<a name="135416069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416069">Johan Commelin (Oct 08 2018 at 17:00)</a>:</h4>
<p>But we can write a smart awk script</p>

<a name="135416073"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416073" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416073">Johan Commelin (Oct 08 2018 at 17:00)</a>:</h4>
<p>It can try to reformat that line, breaking on suitable <code>,</code></p>

<a name="135416182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416182">Simon Hudon (Oct 08 2018 at 17:03)</a>:</h4>
<p>That's tricky because it might not be alone on its line</p>

<a name="135416288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416288">Johan Commelin (Oct 08 2018 at 17:05)</a>:</h4>
<p>I can compute the old line length, and the new one, etc...</p>

<a name="135416292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416292" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416292">Johan Commelin (Oct 08 2018 at 17:05)</a>:</h4>
<p>It definitely makes a trivial thing a lot harder</p>

<a name="135416372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416372" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416372">Simon Hudon (Oct 08 2018 at 17:07)</a>:</h4>
<p>Let's leave it for the "future work" section</p>

<a name="135416427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416427">Simon Hudon (Oct 08 2018 at 17:08)</a>:</h4>
<p>It might become necessary to have a Lean code formatter which would make all of that good work redundant</p>

<a name="135416431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416431" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416431">Johan Commelin (Oct 08 2018 at 17:08)</a>:</h4>
<p>Yep, sounds good</p>

<a name="135416520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416520" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416520">Simon Hudon (Oct 08 2018 at 17:10)</a>:</h4>
<p>This proof engineering stuff is so funny. We're tweaking eternal truths :P</p>

<a name="135416567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416567" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416567">Simon Hudon (Oct 08 2018 at 17:11)</a>:</h4>
<p>As impatient as I get with Lean and mathlib, it's pretty great that it finds my mistakes faster than my supervisor :D</p>

<a name="135416822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416822">Bryan Gin-ge Chen (Oct 08 2018 at 17:15)</a>:</h4>
<p>Are there other "tactics with output" where this kind of tooling would also be useful? Maybe <code>tidy</code>?</p>

<a name="135416879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416879" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416879">Mario Carneiro (Oct 08 2018 at 17:16)</a>:</h4>
<p><code>tidy</code> already makes output</p>

<a name="135416916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416916" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416916">Johan Commelin (Oct 08 2018 at 17:16)</a>:</h4>
<p>I'll be reading a bit of Milne to my kids... see you guys soon!</p>

<a name="135416940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135416940" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135416940">Simon Hudon (Oct 08 2018 at 17:17)</a>:</h4>
<p>Have fun!</p>

<a name="135417013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417013" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417013">Bryan Gin-ge Chen (Oct 08 2018 at 17:18)</a>:</h4>
<p>Indeed, what I mean is the output format being discussed here something we should also consider for e.g. <code>tidy</code>?</p>

<a name="135417183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417183">Simon Hudon (Oct 08 2018 at 17:21)</a>:</h4>
<p>That could be useful. It might be more useful for <code>tidy</code> to have it tied into the IDE because you probably don't use <code>tidy</code><em>en masse</em></p>

<a name="135417482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417482" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417482">Gabriel Ebner (Oct 08 2018 at 17:27)</a>:</h4>
<p>Where are you printing the replacement text?  Trace messages?</p>

<a name="135417541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417541" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417541">Simon Hudon (Oct 08 2018 at 17:28)</a>:</h4>
<p>Yes exactly</p>

<a name="135417756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417756" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417756">Gabriel Ebner (Oct 08 2018 at 17:32)</a>:</h4>
<p>It's pretty easy to hook them up in vscode: in the extension, you just need to <a href="https://github.com/Microsoft/vscode/blob/5b03dcd69d98b6540f789868cf4647b6486ed739/src/vs/vscode.d.ts#L2046-L2106" target="_blank" title="https://github.com/Microsoft/vscode/blob/5b03dcd69d98b6540f789868cf4647b6486ed739/src/vs/vscode.d.ts#L2046-L2106">return a list of code actions</a>.  Then you can execute these replacements with <code>ctrl+.</code> (similar to holes, which are also implemented using code actions in the extension).</p>

<a name="135417850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417850">Simon Hudon (Oct 08 2018 at 17:34)</a>:</h4>
<p>Emacs gives the line and column of the command issuing the trace. Does VS code also do the same?</p>

<a name="135417859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417859">Gabriel Ebner (Oct 08 2018 at 17:34)</a>:</h4>
<p>A few suggestions for the format: it should not occur by accident (in a simp trace e.g.).  And it would be nice to have a (textual) description for the replacement (vscode shows this in the dropdown).  Ideally also the <a href="https://github.com/Microsoft/vscode/blob/5b03dcd69d98b6540f789868cf4647b6486ed739/src/vs/vscode.d.ts#L1926-L1996" target="_blank" title="https://github.com/Microsoft/vscode/blob/5b03dcd69d98b6540f789868cf4647b6486ed739/src/vs/vscode.d.ts#L1926-L1996">kind of code action</a>, e.g. vscode can apply <em>all</em> quickfixes in a given file automatically.</p>

<a name="135417920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417920" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417920">Gabriel Ebner (Oct 08 2018 at 17:35)</a>:</h4>
<p>We have access to the same position information, yes.  However it only includes the start position of the tactic unfortunately.</p>

<a name="135417924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417924" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417924">Simon Hudon (Oct 08 2018 at 17:35)</a>:</h4>
<p>Does it run them backward so that the line numbers remain valid?</p>

<a name="135417971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417971" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417971">Gabriel Ebner (Oct 08 2018 at 17:36)</a>:</h4>
<p>Good question.  I don't really know.  If we do one-line replacements then it shouldn't matter too much.</p>

<a name="135417976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417976" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417976">Simon Hudon (Oct 08 2018 at 17:36)</a>:</h4>
<p>In the parser <code>cur_pos</code> can give me an arbitrary position. I'm putting it at the end and it gives me a good approximation</p>

<a name="135417980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/135417980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#135417980">Mario Carneiro (Oct 08 2018 at 17:36)</a>:</h4>
<p>Ooh, this is nice. Can we just get a generic hook for writing things from lean?</p>

<a name="160435221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/160435221" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#160435221">Sebastien Gouezel (Mar 10 2019 at 22:17)</a>:</h4>
<p>I got a strange <code>squeeze_simp</code> behavior, where the trace output does not has the same effect as the original one. The example is as follows (in a complete lattice):</p>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">Inf_sup_Inf</span> <span class="o">:</span> <span class="n">Inf</span> <span class="n">s</span> <span class="err">⊔</span> <span class="n">Inf</span> <span class="n">t</span> <span class="bp">=</span> <span class="n">Inf</span> <span class="o">((</span><span class="bp">λ</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">α</span><span class="o">,</span> <span class="n">p</span><span class="bp">.</span><span class="mi">1</span> <span class="err">⊔</span> <span class="n">p</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="err">&#39;&#39;</span> <span class="o">(</span><span class="n">set</span><span class="bp">.</span><span class="n">prod</span> <span class="n">s</span> <span class="n">t</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">le_antisymm</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">squeeze_simp</span><span class="o">,</span>
    <span class="n">sorry</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">sorry</span> <span class="o">}</span>
<span class="kn">end</span>
</pre></div>


<p>After <code>squeeze_simp</code>, the goal is</p>
<div class="codehilite"><pre><span></span><span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="n">x</span> <span class="n">x_1</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">x_1</span> <span class="err">∈</span> <span class="n">t</span> <span class="bp">→</span> <span class="n">x</span> <span class="err">⊔</span> <span class="n">x_1</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">Inf</span> <span class="n">s</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="n">Inf</span> <span class="n">t</span> <span class="bp">≤</span> <span class="n">b</span>
</pre></div>


<p>But if I copy the trace formula (hey, I never noticed that it looks like real math:) given by <code>squeeze_simp</code>, i.e.,</p>
<div class="codehilite"><pre><span></span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">and_imp</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_image</span><span class="o">,</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_prod</span><span class="o">,</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">le_Inf_iff</span><span class="o">,</span>
               <span class="n">exists_imp_distrib</span><span class="o">,</span> <span class="n">lattice</span><span class="bp">.</span><span class="n">sup_le_iff</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">exists</span><span class="o">],</span>
</pre></div>


<p>then I get the double goal</p>
<div class="codehilite"><pre><span></span><span class="o">(</span><span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="n">x</span> <span class="n">x_1</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">x_1</span> <span class="err">∈</span> <span class="n">t</span> <span class="bp">→</span> <span class="n">x</span> <span class="err">⊔</span> <span class="n">x_1</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">Inf</span> <span class="n">s</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="bp">∧</span>
    <span class="bp">∀</span> <span class="o">(</span><span class="n">b</span> <span class="n">x</span> <span class="n">x_1</span> <span class="o">:</span> <span class="n">α</span><span class="o">),</span> <span class="n">x</span> <span class="err">∈</span> <span class="n">s</span> <span class="bp">→</span> <span class="n">x_1</span> <span class="err">∈</span> <span class="n">t</span> <span class="bp">→</span> <span class="n">x</span> <span class="err">⊔</span> <span class="n">x_1</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">Inf</span> <span class="n">t</span> <span class="bp">≤</span> <span class="n">b</span>
</pre></div>


<p>Any idea for the reason of this behavior?</p>

<a name="160435278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/160435278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#160435278">Simon Hudon (Mar 10 2019 at 22:19)</a>:</h4>
<p>Can you open an issue and put up a MWE? I'll look into it.</p>

<a name="160435569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/160435569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#160435569">Sebastien Gouezel (Mar 10 2019 at 22:27)</a>:</h4>
<p>Done.</p>

<a name="160437932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/160437932" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#160437932">Simon Hudon (Mar 10 2019 at 23:29)</a>:</h4>
<p>If you remove <code>lattice.sup_le_iff</code> from the list, you get the same effect as not having <code>simp only</code>. I don't get why <code>squeeze_simp</code> suggests it. I'll keep working on it</p>

<a name="160438110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/squeeze_simp/near/160438110" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/20539squeezesimp.html#160438110">Mario Carneiro (Mar 10 2019 at 23:35)</a>:</h4>
<p>I'm not sure it is worth trying for 100% fidelity in translating <code>squeeze_simp</code> to an appropriate <code>simp only</code>. The commands are complicated and almost nondeterministic, so I'm not at all surprised that there are edge cases where it doesn't work, and also suggested rewrites that don't need to be in the rewrite list. You should take the output of <code>squeeze_simp</code> as a base for revision rather than an actual reliable representation of what was used.</p>


{% endraw %}
