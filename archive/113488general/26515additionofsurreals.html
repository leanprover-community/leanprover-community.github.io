---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/26515additionofsurreals.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html">addition of surreals</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="166725755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/addition%20of%20surreals/near/166725755" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html#166725755">Scott Morrison (May 28 2019 at 15:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>,</p>
<p>I have a question about your definition of addition for surreal numbers. My student <span class="user-mention" data-user-id="209437">@Isabel Longbottom</span>  has been<br>
trying to use it when working on combinatorial games, and we'd really like to have a siplification lemma<br>
that spells out addition in a more familiar form. We'd like to be able to prove the following lemma:</p>
<div class="codehilite"><pre><span></span>@[simp] lemma add_def {xl xr xL xR yl yr yL yR} :
  add (mk xl xr xL xR) (mk yl yr yL yR) =
    mk (xl ⊕ yl) (xr ⊕ yr)
    (λ xy, sum.cases_on xy (λ x : xl, add (xL x) (mk yl yr yL yR))
                           (λ y : yl, add (mk xl xr xL xR) (yL y)))
    (λ xy, sum.cases_on xy (λ x : xr, add (xR x) (mk yl yr yL yR))
                           (λ y : yr, add (mk xl xr xL xR) (yR y))) := sorry
</pre></div>


<p>immediately after the definition of <code>add</code> (say at <a href="https://github.com/leanprover-community/mathlib/blob/master/src/set_theory/surreal.lean#L189" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/src/set_theory/surreal.lean#L189">l. 189 of <code>surreal.lean</code></a>).</p>
<p>Is it reasonably to want this? How does one prove such a lemma? Neither of us have had much luck...</p>

<a name="166726183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/addition%20of%20surreals/near/166726183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html#166726183">Mario Carneiro (May 28 2019 at 15:12)</a>:</h4>
<p>It should be <code>rfl</code> if you got it right</p>

<a name="166728376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/addition%20of%20surreals/near/166728376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html#166728376">Mario Carneiro (May 28 2019 at 15:37)</a>:</h4>
<p>Or if I got it right... The definition is wrong. Use this instead</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">:</span> <span class="n">pSurreal</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">x</span> <span class="k">with</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span> <span class="n">generalizing</span> <span class="n">y</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">y</span> <span class="k">with</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="n">IHyl</span> <span class="n">IHyr</span><span class="o">,</span>
  <span class="k">have</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">⟨</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">,</span> <span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec</span> <span class="bp">_</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxl</span> <span class="n">i</span> <span class="n">y</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyl</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxr</span> <span class="n">i</span> <span class="n">y</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyr</span> <span class="n">i</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">pSurreal</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">add</span><span class="bp">⟩</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">add_def</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">}</span> <span class="o">:</span>
    <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="bp">=</span>
    <span class="n">mk</span> <span class="o">(</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">)</span> <span class="o">(</span><span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">xl</span><span class="o">,</span> <span class="n">xL</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span> <span class="o">:</span> <span class="n">yl</span><span class="o">,</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yL</span> <span class="n">y</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">xr</span><span class="o">,</span> <span class="n">xR</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span> <span class="o">:</span> <span class="n">yr</span><span class="o">,</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yR</span> <span class="n">y</span><span class="o">))</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>

<a name="166728822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/addition%20of%20surreals/near/166728822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html#166728822">Mario Carneiro (May 28 2019 at 15:41)</a>:</h4>
<p>By the way, I diagnosed this by adding some names for the intermediate functions and proving the equation lemmas for them, then using <code>congr</code> on the target lemma to see what went wrong</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">add2</span>
  <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="o">:</span> <span class="n">xl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">xR</span> <span class="o">:</span> <span class="n">xr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span>
  <span class="o">(</span><span class="n">IHxl</span> <span class="o">:</span> <span class="n">xl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">IHxr</span> <span class="o">:</span> <span class="n">xr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span>
  <span class="o">{</span><span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">yL</span> <span class="o">:</span> <span class="n">yl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">yR</span> <span class="o">:</span> <span class="n">yr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span>
  <span class="o">(</span><span class="n">IHyl</span> <span class="o">:</span> <span class="n">yl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">IHyr</span> <span class="o">:</span> <span class="n">yr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">:</span> <span class="n">pSurreal</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">,</span> <span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">,</span>
  <span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxl</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyl</span> <span class="n">i</span><span class="o">),</span>
  <span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxr</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyr</span> <span class="n">i</span><span class="o">)</span><span class="bp">⟩</span>

<span class="n">def</span> <span class="n">add1</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="o">:</span> <span class="n">xl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">xR</span> <span class="o">:</span> <span class="n">xr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span>
  <span class="o">(</span><span class="n">IHxl</span> <span class="o">:</span> <span class="n">xl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">IHxr</span> <span class="o">:</span> <span class="n">xr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">:</span> <span class="n">pSurreal</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">y</span> <span class="k">with</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="n">IHyl</span> <span class="n">IHyr</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">⟨</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">,</span> <span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="bp">_</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxl</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyl</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxr</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyr</span> <span class="n">i</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="c">/-</span><span class="cm">- The sum of `x = {xL | xR}` and `y = {yL | yR}` is `{xL + y, x + yL | xR + y, x + yR}`. -/</span>
<span class="n">def</span> <span class="n">add</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">:</span> <span class="n">pSurreal</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">x</span> <span class="k">with</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">y</span> <span class="k">with</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="n">IHyl</span> <span class="n">IHyr</span><span class="o">,</span>
  <span class="n">refine</span> <span class="bp">⟨</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">,</span> <span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec</span> <span class="bp">_</span> <span class="bp">_⟩</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxl</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyl</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHxr</span> <span class="n">i</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">exact</span> <span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">IHyr</span> <span class="n">i</span> <span class="o">}</span>
<span class="kn">end</span>

<span class="kn">instance</span> <span class="o">:</span> <span class="n">has_add</span> <span class="n">pSurreal</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">add</span><span class="bp">⟩</span>

<span class="kn">lemma</span> <span class="n">add_def2</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">}</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">add1</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span> <span class="o">(</span><span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="bp">=</span>
  <span class="n">add2</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span> <span class="n">yL</span> <span class="n">yR</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">add1</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span> <span class="o">(</span><span class="n">yL</span> <span class="n">i</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">add1</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">IHxl</span> <span class="n">IHxr</span> <span class="o">(</span><span class="n">yR</span> <span class="n">i</span><span class="o">))</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">add_def1</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">y</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">add1</span> <span class="n">xL</span> <span class="n">xR</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">xL</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">xR</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="n">y</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">add_def</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">}</span> <span class="o">:</span>
    <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="bp">=</span>
    <span class="n">mk</span> <span class="o">(</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">)</span> <span class="o">(</span><span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">xl</span><span class="o">,</span> <span class="n">xL</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span> <span class="o">:</span> <span class="n">yl</span><span class="o">,</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yL</span> <span class="n">y</span><span class="o">))</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">xy</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">xr</span><span class="o">,</span> <span class="n">xR</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span>
                           <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span> <span class="o">:</span> <span class="n">yr</span><span class="o">,</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yR</span> <span class="n">y</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">add_def1</span><span class="o">,</span> <span class="n">add_def2</span><span class="o">,</span> <span class="n">add2</span><span class="o">],</span>
  <span class="n">congr</span><span class="bp">;</span> <span class="n">funext</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">funext</span> <span class="n">j</span><span class="o">,</span> <span class="n">dsimp</span><span class="o">,</span> <span class="n">rw</span> <span class="n">add_def1</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="166732847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/addition%20of%20surreals/near/166732847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html#166732847">Mario Carneiro (May 28 2019 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Actually, if you really want a nice equation lemma for this, I recommend the following:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">addL</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="o">:</span> <span class="n">xl</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">xy</span> <span class="o">:</span> <span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">)</span> <span class="o">:</span> <span class="n">pSurreal</span> <span class="o">:=</span>
<span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">xL</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yL</span> <span class="n">i</span><span class="o">)</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">addL_inl</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">xl</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">addL</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">xL</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">addL_inr</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">yl</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">addL</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yL</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="n">def</span> <span class="n">addR</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span><span class="o">)</span> <span class="o">(</span><span class="n">xR</span> <span class="o">:</span> <span class="n">xr</span> <span class="bp">→</span> <span class="n">pSurreal</span><span class="o">)</span> <span class="o">(</span><span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">xy</span> <span class="o">:</span> <span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">)</span> <span class="o">:</span> <span class="n">pSurreal</span> <span class="o">:=</span>
<span class="n">sum</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">xy</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">xR</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yR</span> <span class="n">i</span><span class="o">)</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">addR_inl</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">xr</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">addR</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">xR</span> <span class="n">i</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">addR_inr</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span><span class="o">}</span> <span class="o">(</span><span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">yr</span><span class="o">)</span> <span class="o">:</span>
  <span class="bp">@</span><span class="n">addR</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">yR</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">add_def</span> <span class="o">{</span><span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">mk</span> <span class="n">xl</span> <span class="n">xr</span> <span class="n">xL</span> <span class="n">xR</span> <span class="bp">+</span> <span class="n">mk</span> <span class="n">yl</span> <span class="n">yr</span> <span class="n">yL</span> <span class="n">yR</span> <span class="bp">=</span>
  <span class="n">mk</span> <span class="o">(</span><span class="n">xl</span> <span class="err">⊕</span> <span class="n">yl</span><span class="o">)</span> <span class="o">(</span><span class="n">xr</span> <span class="err">⊕</span> <span class="n">yr</span><span class="o">)</span> <span class="o">(</span><span class="n">addL</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">(</span><span class="n">addR</span> <span class="n">xL</span> <span class="n">xR</span> <span class="n">yL</span> <span class="n">yR</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>

<a name="166734625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/addition%20of%20surreals/near/166734625" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/26515additionofsurreals.html#166734625">Floris van Doorn (May 28 2019 at 16:40)</a>:</h4>
<p>Oh sorry, I made a mistake when reviewing your PR, I thought these definitions were definitionally equal. My bad!</p>


{% endraw %}
