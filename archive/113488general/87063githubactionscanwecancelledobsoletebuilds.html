---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html">github actions: can we cancelled obsolete builds?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="191703501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703501">Scott Morrison (Mar 25 2020 at 05:55)</a>:</h4>
<p>Hmm... the new <code>leanproject up</code> and faster CI is amazing, but it's so good it's causing a problem. I'm happily relying on github to build branches for me rather than compiling them completely locally, and I'm even jumping back and forth between branches working on whatever is available while CI works on other branches. The result, however, is that I'm spamming github with new commits.</p>

<a name="191703507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703507" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703507">Scott Morrison (Mar 25 2020 at 05:55)</a>:</h4>
<p>I only just realised, per <a href="https://github.com/leanprover-community/mathlib/actions" title="https://github.com/leanprover-community/mathlib/actions">https://github.com/leanprover-community/mathlib/actions</a>, that making a new commit on a branch doesn't cancel the build running on the old commit.</p>

<a name="191703509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703509" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703509">Scott Morrison (Mar 25 2020 at 05:55)</a>:</h4>
<p>And so I'm causing a lot of work for github actions. :-)</p>

<a name="191703510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703510" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703510">Scott Morrison (Mar 25 2020 at 05:55)</a>:</h4>
<p>Is there any hope of cancelling builds for obsolete commits?</p>

<a name="191703579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703579" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703579">Scott Morrison (Mar 25 2020 at 05:57)</a>:</h4>
<p>It seems <a href="https://github.community/t5/GitHub-Actions/Github-actions-Cancel-redundant-builds/td-p/29549" title="https://github.community/t5/GitHub-Actions/Github-actions-Cancel-redundant-builds/td-p/29549">https://github.community/t5/GitHub-Actions/Github-actions-Cancel-redundant-builds/td-p/29549</a> is about this.</p>

<a name="191703584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703584">Scott Morrison (Mar 25 2020 at 05:57)</a>:</h4>
<p>and someone says it is scriptable: <a href="https://github.community/t5/GitHub-Actions/Github-actions-Cancel-redundant-builds/m-p/44690/highlight/true#M5869" title="https://github.community/t5/GitHub-Actions/Github-actions-Cancel-redundant-builds/m-p/44690/highlight/true#M5869">https://github.community/t5/GitHub-Actions/Github-actions-Cancel-redundant-builds/m-p/44690/highlight/true#M5869</a></p>

<a name="191703645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191703645" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191703645">Scott Morrison (Mar 25 2020 at 05:59)</a>:</h4>
<p>and maybe <a href="https://github.com/marketplace/actions/workflow-run-cleanup-action" title="https://github.com/marketplace/actions/workflow-run-cleanup-action">https://github.com/marketplace/actions/workflow-run-cleanup-action</a> is a solution?</p>

<a name="191704479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191704479" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191704479">Scott Morrison (Mar 25 2020 at 06:20)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/issues/2235" title="https://github.com/leanprover-community/mathlib/issues/2235">#2235</a>, seems to work great!</p>

<a name="191708206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191708206" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191708206">Johan Commelin (Mar 25 2020 at 07:39)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Right now I see 3 builds in action on that PR. So it doesn't seem to cancel them...</p>

<a name="191709447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709447">Rob Lewis (Mar 25 2020 at 07:56)</a>:</h4>
<p>I'm not sure this is a good idea. Often I'd like the earlier builds to finish, just to see if there are errors I didn't anticipate in the newer commits.</p>

<a name="191709498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709498" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709498">Rob Lewis (Mar 25 2020 at 07:57)</a>:</h4>
<p>Note that we don't upload olean caches if there's a new commit when the build finishes.</p>

<a name="191709815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709815" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709815">Mario Carneiro (Mar 25 2020 at 08:01)</a>:</h4>
<p>Even so, it might be nice to have a way to manually cancel a build</p>

<a name="191709919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709919" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709919">Johan Commelin (Mar 25 2020 at 08:02)</a>:</h4>
<p>There is already a manual way</p>

<a name="191709940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709940" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709940">Rob Lewis (Mar 25 2020 at 08:02)</a>:</h4>
<p>Of course you can manually cancel a build.</p>

<a name="191709944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709944" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709944">Johan Commelin (Mar 25 2020 at 08:02)</a>:</h4>
<p>Just go to the page of the build, and click cancel</p>

<a name="191709958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191709958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191709958">Bryan Gin-ge Chen (Mar 25 2020 at 08:02)</a>:</h4>
<p>Another point: I think we have <a href="https://help.github.com/en/actions/getting-started-with-github-actions/about-github-actions#usage-limits" title="https://help.github.com/en/actions/getting-started-with-github-actions/about-github-actions#usage-limits">a limit of 20 concurrent jobs</a>. So far the most I've seen running at one time is around 17. However, if we switch community Lean to github actions, then we will probably run into problems.</p>

<a name="191713302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191713302" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191713302">Rob Lewis (Mar 25 2020 at 08:41)</a>:</h4>
<p>I think I posted something along these lines a few weeks ago and then forgot about it: the PR builds aren't doing anything for us, are they? They test a merge commit that will never be checked out, and Mergify makes sure that the one merge commit that matters gets tested (as a push build).</p>

<a name="191713325"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191713325" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191713325">Rob Lewis (Mar 25 2020 at 08:41)</a>:</h4>
<p>The PR builds only matter for PRs that come from an external repo with Actions disabled.</p>

<a name="191713424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191713424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191713424">Rob Lewis (Mar 25 2020 at 08:42)</a>:</h4>
<p>There are other reasons to avoid external PRs as much as possible, and if we get them, we can just ask the author to enable Actions. It's simple to do.</p>

<a name="191713460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191713460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191713460">Rob Lewis (Mar 25 2020 at 08:42)</a>:</h4>
<p>No configuration needed because the Actions config is part of the repo.</p>

<a name="191713522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191713522" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191713522">Rob Lewis (Mar 25 2020 at 08:43)</a>:</h4>
<p>This should be as effective at cutting down the number of builds, and less disruptive than auto cancelling obsolete ones.</p>

<a name="191714978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191714978" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191714978">Gabriel Ebner (Mar 25 2020 at 08:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110596">Rob Lewis</span> <a href="#narrow/stream/113488-general/topic/github.20actions.3A.20can.20we.20cancelled.20obsolete.20builds.3F/near/191709498" title="#narrow/stream/113488-general/topic/github.20actions.3A.20can.20we.20cancelled.20obsolete.20builds.3F/near/191709498">said</a>:</p>
<blockquote>
<p>Note that we don't upload olean caches if there's a new commit when the build finishes.</p>
</blockquote>
<p>I'd like to revisit this decision once we have the garbage collection script set up.  I'm regularly running into the situation where I'd like to have oleans for old revisions and I'd be happy to <code>git reset --hard HEAD^^ &amp;&amp; leanproject get-cache</code> for lack of better tooling.  But it's vexing when you're waiting for the CI build to finish and somebody pushes a fix for a typo and now you have to wait again.</p>

<a name="191715135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191715135" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191715135">Rob Lewis (Mar 25 2020 at 09:00)</a>:</h4>
<p>Fair enough. Once garbage collection is running we can delete those builds quickly, after a day or two.</p>

<a name="191717903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/github%20actions%3A%20can%20we%20cancelled%20obsolete%20builds%3F/near/191717903" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87063githubactionscanwecancelledobsoletebuilds.html#191717903">Scott Morrison (Mar 25 2020 at 09:26)</a>:</h4>
<p>Okay, I will close my "cancel obsolete builds" PR, which looked like trouble anyway.</p>


{% endraw %}

{% include archive_update.html %}