---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/69128canmetadef.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html">can meta `def`?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="133394258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394258">Johan Commelin (Sep 05 2018 at 18:40)</a>:</h4>
<p>Can you have meta code that writes definitions and lemmas for you? Probably yes, and this is how things like <code>to_additive</code> work. Is that right?</p>

<a name="133394409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394409">Johan Commelin (Sep 05 2018 at 18:42)</a>:</h4>
<p>Is this somehow what <code>add_decl</code> is for?</p>

<a name="133394637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394637" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394637">Simon Hudon (Sep 05 2018 at 18:46)</a>:</h4>
<p>Yes it is</p>

<a name="133394664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394664" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394664">Johan Commelin (Sep 05 2018 at 18:47)</a>:</h4>
<p>Ok cool! I could imagine some uses for it.</p>

<a name="133394687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394687" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394687">Johan Commelin (Sep 05 2018 at 18:47)</a>:</h4>
<p>For example, you define multiplication of matrices, and immediately afterwards, there is a simp-lemma <code>mul_val</code>. This happens a lot. Couldn't we auto-generate those?</p>

<a name="133394756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394756" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394756">Johan Commelin (Sep 05 2018 at 18:48)</a>:</h4>
<p>I feel like at least half of the simp lemmas after definitions could be auto-generated.</p>

<a name="133394817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394817" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394817">Johan Commelin (Sep 05 2018 at 18:50)</a>:</h4>
<p>Here is a claim: every lemma that is proved by <code>rfl</code> is a good candidate for being auto-generated.</p>

<a name="133394857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394857" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394857">Simon Hudon (Sep 05 2018 at 18:50)</a>:</h4>
<p>Yes, they can be generated. But could it be that you could get rid of the lemmas altogether by tagging your definition as <code>simp</code>?</p>

<a name="133394898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133394898" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133394898">Johan Commelin (Sep 05 2018 at 18:50)</a>:</h4>
<p>Hmm, I think usually there is notation introduced in between.</p>

<a name="133395156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395156">Simon Hudon (Sep 05 2018 at 18:54)</a>:</h4>
<p>But the notation doesn't affect rewriting.</p>

<a name="133395204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395204">Johan Commelin (Sep 05 2018 at 18:55)</a>:</h4>
<p>Hmm... then I'm just really confused.</p>

<a name="133395224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395224" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395224">Johan Commelin (Sep 05 2018 at 18:56)</a>:</h4>
<p>Take <a href="https://github.com/leanprover-community/mathlib/blob/noetherian/ring_theory/ideals.lean#L176" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/noetherian/ring_theory/ideals.lean#L176">https://github.com/leanprover-community/mathlib/blob/noetherian/ring_theory/ideals.lean#L176</a> for example.</p>

<a name="133395268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395268">Johan Commelin (Sep 05 2018 at 18:56)</a>:</h4>
<p>Those lines have completely predictable names (even to me), and are completely boring statements.</p>

<a name="133395286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395286" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395286">Johan Commelin (Sep 05 2018 at 18:56)</a>:</h4>
<p>I would definitely forget to write them, until I need the after 50 other lines, and then only write half of them.</p>

<a name="133395396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395396" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395396">Johan Commelin (Sep 05 2018 at 18:58)</a>:</h4>
<p>Do you think stuff like this could be automated?</p>

<a name="133395464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395464" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395464">Johan Commelin (Sep 05 2018 at 18:59)</a>:</h4>
<p>Maybe the question is to general...</p>

<a name="133395514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395514">Simon Hudon (Sep 05 2018 at 19:00)</a>:</h4>
<p>I think the issue there is the combination of <code>coe</code> (which comes from a type class) and its underlying definition.</p>

<a name="133395533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395533">Johan Commelin (Sep 05 2018 at 19:00)</a>:</h4>
<p>At least I got an answer to the original question. And I am glad that it was positive. I'll keep it in mind, because I'm sure it will come in handy at some point.</p>

<a name="133395540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395540">Simon Hudon (Sep 05 2018 at 19:00)</a>:</h4>
<p>It is not as trivial as I thought but there might be something to do with it.</p>

<a name="133395641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395641" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395641">Simon Hudon (Sep 05 2018 at 19:02)</a>:</h4>
<p>In general, maybe the question is to do <code>simp</code> lemmas from a type class instance which is just built on top of stand alone definitions</p>

<a name="133395779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395779" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395779">Simon Hudon (Sep 05 2018 at 19:04)</a>:</h4>
<p>If you have </p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="o">:</span> <span class="n">my_class</span> <span class="n">my_type</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">op</span> <span class="o">:=</span> <span class="n">my_type</span><span class="bp">.</span><span class="n">op</span> <span class="o">}</span>
</pre></div>


<p>we can take all the equations of <code>my_type.op</code>, replace the occurrences of <code>my_type.op</code> with <code>my_class.op</code> and label the result as <code>simp</code></p>

<a name="133395833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395833" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395833">Johan Commelin (Sep 05 2018 at 19:05)</a>:</h4>
<p>Right. That sounds useful. But I don't know what the experts think (-;</p>

<a name="133395896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133395896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133395896">Simon Hudon (Sep 05 2018 at 19:06)</a>:</h4>
<p>More import still: does it seem like a generalization of the problem you were asking about?</p>

<a name="133396014"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133396014" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133396014">Johan Commelin (Sep 05 2018 at 19:08)</a>:</h4>
<p>Yes, I think so... although there might also be other cases. For example <a href="https://github.com/leanprover/mathlib/pull/316/files#diff-dcac36203421953a8cefa07fecd35a79R71" target="_blank" title="https://github.com/leanprover/mathlib/pull/316/files#diff-dcac36203421953a8cefa07fecd35a79R71">https://github.com/leanprover/mathlib/pull/316/files#diff-dcac36203421953a8cefa07fecd35a79R71</a> might be enhanced to also define a functor along the way.</p>

<a name="133396029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133396029" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133396029">Johan Commelin (Sep 05 2018 at 19:08)</a>:</h4>
<p>But I'm not suggesting that these are special cases of one sort of automation.</p>

<a name="133396047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133396047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133396047">Johan Commelin (Sep 05 2018 at 19:09)</a>:</h4>
<p>It is just that they could both benefit from some <code>add_decl</code> if I'm not mistaken.</p>

<a name="133396183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133396183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133396183">Simon Hudon (Sep 05 2018 at 19:11)</a>:</h4>
<p>If you want, I can walk you through the construction of the solution I suggested and then we can see if something similar can be done for your second example</p>

<a name="133396356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133396356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133396356">Johan Commelin (Sep 05 2018 at 19:14)</a>:</h4>
<p>Ok, would definitely like to do that. But maybe not tonight (-; I need to catch up with some sleep, so I'll be gone in a couple of minutes.</p>

<a name="133396393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133396393" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133396393">Simon Hudon (Sep 05 2018 at 19:15)</a>:</h4>
<p>Sure, let me know when you're ready and I'll give you a hand</p>

<a name="133397167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/can%20meta%20%60def%60%3F/near/133397167" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/69128canmetadef.html#133397167">Johannes Hölzl (Sep 05 2018 at 19:28)</a>:</h4>
<p>Just for your information: Isabelle has a tool called <code>lift_definition</code> which lifts a term along subtypes / quotients / other relations etc.<br>
If one wants to define a function <code>lift f : {a : A // p a} -&gt; {b : B // q b}</code>, it provides one with the following two goals:<br>
the function itself: <code>f : A -&gt; B</code> and a proof <code>forall a : A, p a -&gt; q (f b)</code>. The nice thing is that this also works for quotients, but in Isabelle this is done by assuming that there is a canonical projection (i.e. <code>quot.out</code>) which we may want to avoid, and instead use a more generic lifting constant.</p>
<p>My idea for a lift function would be: get typing information (which includes the information for which types the representation should change) and the term to lift. Then it puts <code>lift</code> or <code>cases</code> around the term to translate into the other type. All further proofs are left as subgoals to the user. Finally it produces the constant itself, and a rewrite rule which adds coercions etc at all places necessary to remove all lift constants.</p>


{% endraw %}
