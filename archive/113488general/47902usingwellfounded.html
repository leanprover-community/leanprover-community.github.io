---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/47902usingwellfounded.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html">using_well_founded</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="132934326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132934326" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132934326">Edward Ayers (Aug 28 2018 at 20:34)</a>:</h4>
<p>I'm looking at RB trees again. I found a really good implementation in Coq that I am copying over to Lean: <a href="https://github.com/coq/coq/blob/a1fc621b943dbf904705dc88ed27c26daf4c5e72/theories/MSets/MSetRBT.v" target="_blank" title="https://github.com/coq/coq/blob/a1fc621b943dbf904705dc88ed27c26daf4c5e72/theories/MSets/MSetRBT.v">https://github.com/coq/coq/blob/a1fc621b943dbf904705dc88ed27c26daf4c5e72/theories/MSets/MSetRBT.v</a><br>
Here is the start of my code:<br>
<a href="https://github.com/EdAyers/mathlib/blob/rb/data/rb.lean" target="_blank" title="https://github.com/EdAyers/mathlib/blob/rb/data/rb.lean">https://github.com/EdAyers/mathlib/blob/rb/data/rb.lean</a><br>
My problem is that it can't prove that my definition of <code>append</code> is terminating automatically. Is there a quick fix for this kind of thing or am I going to have to use well_founded.fix? I can't figure out how to use the <code>using_well_founded</code> keyword.</p>

<a name="132934439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132934439" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132934439">Kevin Buzzard (Aug 28 2018 at 20:36)</a>:</h4>
<p>Did you look at the docs at <a href="https://github.com/EdAyers/mathlib/blob/rb/docs/extras/well_founded_recursion.md" target="_blank" title="https://github.com/EdAyers/mathlib/blob/rb/docs/extras/well_founded_recursion.md">https://github.com/EdAyers/mathlib/blob/rb/docs/extras/well_founded_recursion.md</a> ?</p>

<a name="132934463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132934463" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132934463">Edward Ayers (Aug 28 2018 at 20:37)</a>:</h4>
<p>Ah thanks I haven't read that one yet</p>

<a name="132934551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132934551" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132934551">Kevin Buzzard (Aug 28 2018 at 20:38)</a>:</h4>
<p>I'm not saying it solves your problem, but it does have a bunch of cool tricks.</p>

<a name="132934673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132934673" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132934673">Edward Ayers (Aug 28 2018 at 20:41)</a>:</h4>
<p>One of the things it can't show is</p>
<div class="codehilite"><pre><span></span><span class="err">⊢</span> <span class="n">tr</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">α</span> <span class="n">lr</span> <span class="bp">&lt;</span> <span class="n">tr</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">α</span> <span class="n">ll</span> <span class="bp">+</span> <span class="o">(</span><span class="n">tr</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">α</span> <span class="n">lr</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">)</span>
</pre></div>


<p>Is there a tactic that will solve that instantaneously?</p>

<a name="132940133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132940133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132940133">Patrick Massot (Aug 28 2018 at 20:51)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib-nursery/blob/master/src/tactic/monotonicity/interactive.lean#L571-L595" target="_blank" title="https://github.com/leanprover-community/mathlib-nursery/blob/master/src/tactic/monotonicity/interactive.lean#L571-L595">https://github.com/leanprover-community/mathlib-nursery/blob/master/src/tactic/monotonicity/interactive.lean#L571-L595</a> presumably</p>

<a name="132940151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132940151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132940151">Patrick Massot (Aug 28 2018 at 20:52)</a>:</h4>
<p>not yet in mathlib, but you can temporarily add a dependency to this repo</p>

<a name="132940196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132940196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132940196">Patrick Massot (Aug 28 2018 at 20:52)</a>:</h4>
<p>What's the problem with corelib rbtrees?</p>

<a name="132940302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132940302" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132940302">Edward Ayers (Aug 28 2018 at 20:54)</a>:</h4>
<p>Corelib rbtrees don't have <code>erase</code></p>

<a name="132940317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132940317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132940317">Edward Ayers (Aug 28 2018 at 20:55)</a>:</h4>
<p>And there are no proofs about them.</p>

<a name="132940341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132940341" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132940341">Patrick Massot (Aug 28 2018 at 20:55)</a>:</h4>
<p>oh</p>

<a name="132941632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132941632" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132941632">Edward Ayers (Aug 28 2018 at 21:19)</a>:</h4>
<p>I fixed this by adding my own has_well_founded instance</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">custom_wf</span> <span class="o">:</span> <span class="n">has_well_founded</span> <span class="o">(</span><span class="n">tr</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">tr</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">has_well_founded_of_has_sizeof</span> <span class="o">(</span><span class="n">tr</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">tr</span> <span class="n">α</span><span class="o">)</span>
</pre></div>

<a name="132941692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132941692" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132941692">Edward Ayers (Aug 28 2018 at 21:20)</a>:</h4>
<p>Before it was using wf using lexical ordering which was throwing it.</p>

<a name="132941711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132941711" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132941711">Edward Ayers (Aug 28 2018 at 21:20)</a>:</h4>
<p>at least I think that's why</p>

<a name="132952390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132952390" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132952390">Leonardo de Moura (Aug 28 2018 at 23:07)</a>:</h4>
<p><span class="user-mention" data-user-id="121918">@Edward Ayers</span> The proofs are here <a href="https://github.com/leanprover/lean/tree/master/library/data/rbtree" target="_blank" title="https://github.com/leanprover/lean/tree/master/library/data/rbtree">https://github.com/leanprover/lean/tree/master/library/data/rbtree</a></p>

<a name="132953705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132953705" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132953705">Kevin Buzzard (Aug 28 2018 at 23:32)</a>:</h4>
<p>(deleted)</p>

<a name="132953908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/using_well_founded/near/132953908" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/47902usingwellfounded.html#132953908">Edward Ayers (Aug 28 2018 at 23:36)</a>:</h4>
<p>thanks Leo! sorry I didn't spot them.</p>


{% endraw %}
