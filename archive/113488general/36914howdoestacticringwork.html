---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/36914howdoestacticringwork.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html">how does tactic.ring work?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="127888870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888870" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888870">Kevin Buzzard (Jun 11 2018 at 08:28)</a>:</h4>
<p>I have read through programming in Lean a couple of times and now wonder if it's time I started reading something else. I decided to read the ring tactic (not least because it failed to prove something relatively simple the last time I tried to use it and I'd rather fix it myself than pester Mario, not that I have any idea about how far I need to go before I am anywhere close to being able to fix it).</p>

<a name="127888871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888871" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888871">Kevin Buzzard (Jun 11 2018 at 08:28)</a>:</h4>
<p>Anyway, I started to read it:</p>

<a name="127888874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888874" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888874">Kevin Buzzard (Jun 11 2018 at 08:28)</a>:</h4>
<p><a href="https://github.com/kbuzzard/mathlib/blob/tactic_doc/docs/ring_tactic.rst" target="_blank" title="https://github.com/kbuzzard/mathlib/blob/tactic_doc/docs/ring_tactic.rst">https://github.com/kbuzzard/mathlib/blob/tactic_doc/docs/ring_tactic.rst</a></p>

<a name="127888882"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888882" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888882">Kevin Buzzard (Jun 11 2018 at 08:28)</a>:</h4>
<p>There are my comments on the first 30 or so lines, plus a long intro summarising programming in lean</p>

<a name="127888901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888901" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888901">Kevin Buzzard (Jun 11 2018 at 08:29)</a>:</h4>
<p>There's a link to programming in lean: <a href="https://leanprover.github.io/programming_in_lean/programming_in_lean.pdf" target="_blank" title="https://leanprover.github.io/programming_in_lean/programming_in_lean.pdf">https://leanprover.github.io/programming_in_lean/programming_in_lean.pdf</a></p>

<a name="127888951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888951" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888951">Kevin Buzzard (Jun 11 2018 at 08:30)</a>:</h4>
<p>Here's Patrick's secret gem: <a href="https://hanoifabs.files.wordpress.com/2018/05/slides.pdf" target="_blank" title="https://hanoifabs.files.wordpress.com/2018/05/slides.pdf">https://hanoifabs.files.wordpress.com/2018/05/slides.pdf</a> (thanks Johannes)</p>

<a name="127888964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888964" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888964">Kevin Buzzard (Jun 11 2018 at 08:30)</a>:</h4>
<p>and that is pretty much every online resource for Lean tactics. Here's the file I want to understand:</p>

<a name="127888974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888974" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888974">Kevin Buzzard (Jun 11 2018 at 08:31)</a>:</h4>
<p><a href="https://github.com/leanprover/mathlib/blob/master/tactic/ring.lean" target="_blank" title="https://github.com/leanprover/mathlib/blob/master/tactic/ring.lean">https://github.com/leanprover/mathlib/blob/master/tactic/ring.lean</a></p>

<a name="127888989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127888989" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127888989">Kevin Buzzard (Jun 11 2018 at 08:31)</a>:</h4>
<p>if anyone wants to help me understand it, they're welcome to edit the rst file. Note: I wrote <code>ring_ractic.rst</code> in sphinx not markdown. It's still human-readable and pretty easy to pick up.</p>

<a name="127893407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127893407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127893407">Johan Commelin (Jun 11 2018 at 10:42)</a>:</h4>
<p>Typo: "especially if one does it within Lean (thus gaining the ability to hover over or click on functions and see their type, definition and so on)." &lt;-- you mean VScode instead of Lean, right?<br>
Another typo: "Note that evem though" &lt;-- s/evem/even/</p>

<a name="127896619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127896619" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127896619">Kevin Buzzard (Jun 11 2018 at 12:15)</a>:</h4>
<p>Thanks. I had a look through all of tactic.ring and really it doesn't look too bad. I'm currently reading <a href="http://www.cs.ru.nl/~freek/courses/tt-2014/read/10.1.1.61.3041.pdf" target="_blank" title="http://www.cs.ru.nl/~freek/courses/tt-2014/read/10.1.1.61.3041.pdf">http://www.cs.ru.nl/~freek/courses/tt-2014/read/10.1.1.61.3041.pdf</a> Assia's take on the matter (which I think was Mario's source for his code)</p>

<a name="127907285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127907285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127907285">Kevin Buzzard (Jun 11 2018 at 16:25)</a>:</h4>
<p>in fact I know it was Mario's source for the code because I've just noticed that it says this in the comments at the top.</p>

<a name="127945351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945351">Kevin Buzzard (Jun 12 2018 at 09:41)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">ring</span>
<span class="kn">variables</span> <span class="o">(</span><span class="n">R</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">R</span><span class="o">]</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">R</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span><span class="o">))))</span> <span class="bp">=</span>
  <span class="n">b</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">3</span> <span class="bp">*</span> <span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">+</span> <span class="mi">3</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">ring</span><span class="o">,</span>
  <span class="c1">-- goal now (b * a + (2 * b * a + 3 * b ^ 2)) * a + b ^ 3 = (3 * b * a + 3 * b ^ 2) * a + b ^ 3</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="c1">-- goal now (b * a + (2 * b * a + 3 * b ^ 2)) * a = (3 * b * a + 3 * b ^ 2) * a</span>
  <span class="n">ring</span> <span class="c1">-- works</span>
<span class="kn">end</span>
</pre></div>

<a name="127945353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945353" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945353">Kevin Buzzard (Jun 12 2018 at 09:41)</a>:</h4>
<div class="codehilite"><pre><span></span>elaboration: tactic execution took 2.23s
num. allocated objects:  8522
num. allocated closures: 2163
 2229ms   100.0%   scope_trace
 2229ms   100.0%   tactic.istep._lambda_1
 2229ms   100.0%   tactic.istep
 2229ms   100.0%   tactic.step
 2229ms   100.0%   _interaction._lambda_2
 1987ms    89.1%   interaction_monad_orelse
 1929ms    86.5%   tactic.ring.eval
 1156ms    51.9%   tactic.interactive.ring1
 1156ms    51.9%   tactic.interactive.ring._lambda_1
 1156ms    51.9%   tactic.interactive.ring
 1057ms    47.4%   tactic.ring.eval_mul
</pre></div>

<a name="127945354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945354" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945354">Kevin Buzzard (Jun 12 2018 at 09:41)</a>:</h4>
<p>etc etc</p>

<a name="127945358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945358" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945358">Kevin Buzzard (Jun 12 2018 at 09:41)</a>:</h4>
<p>This tactic doesn't quite work yet as far as I can see.</p>

<a name="127945366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945366">Kevin Buzzard (Jun 12 2018 at 09:42)</a>:</h4>
<p>(noticable pause in <code>ring</code> whilst it's failing to prove it the first time)</p>

<a name="127945407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945407">Kevin Buzzard (Jun 12 2018 at 09:42)</a>:</h4>
<p>But I want to fix it.</p>

<a name="127945415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945415" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945415">Kevin Buzzard (Jun 12 2018 at 09:42)</a>:</h4>
<p>I re-read the "rings done right" paper and I understood _much_ more of it this time around.</p>

<a name="127945427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945427">Kevin Buzzard (Jun 12 2018 at 09:43)</a>:</h4>
<p>One insight which dawned on me is that there are two completely different issues involved with writing a ring tactic. Maybe everyone else is aware of this.</p>

<a name="127945430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945430">Kevin Buzzard (Jun 12 2018 at 09:43)</a>:</h4>
<p>Let me explain my understanding of what the ring tactic does.</p>

<a name="127945444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945444" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945444">Kevin Buzzard (Jun 12 2018 at 09:43)</a>:</h4>
<p>Let's say <code>d : int</code> and we want to prove <code>d^2 + 2*d + 1 = (d+1)^2</code></p>

<a name="127945497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945497">Kevin Buzzard (Jun 12 2018 at 09:44)</a>:</h4>
<p>If we want to prove this using <code>ring</code> then we are saying "this is not true because of something specific to int, this is a general fact about rings"</p>

<a name="127945501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945501" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945501">Kevin Buzzard (Jun 12 2018 at 09:44)</a>:</h4>
<p>So what we actually want to do is to prove that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mi>X</mi><mo>+</mo><mn>1</mn><mo>=</mo><mo>(</mo><mi>X</mi><mo>+</mo><mn>1</mn><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">X^2+2X+1=(X+1)^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mbin">+</span><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span> in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="double-struck">Z</mi></mrow><mo>[</mo><mi>X</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\mathbb{Z}[X]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathbb">Z</span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">]</span></span></span></span></p>

<a name="127945513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945513">Kevin Buzzard (Jun 12 2018 at 09:45)</a>:</h4>
<p>and then deduce our goal by specialising to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi><mo>=</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">X=d</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mrel">=</span><span class="mord mathit">d</span></span></span></span></p>

<a name="127945521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945521">Kevin Buzzard (Jun 12 2018 at 09:45)</a>:</h4>
<p>This makes it clear what we have to do here.</p>

<a name="127945565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945565" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945565">Kevin Buzzard (Jun 12 2018 at 09:46)</a>:</h4>
<p>First we need to build a new type in Lean corresponding to polynomials in one variable</p>

<a name="127945572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945572" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945572">Kevin Buzzard (Jun 12 2018 at 09:46)</a>:</h4>
<p>or more generally, if we want to prove stuff like <code>(a+b)^2=a^2+2*a*b+b^2</code> for ints a,b</p>

<a name="127945576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945576" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945576">Kevin Buzzard (Jun 12 2018 at 09:46)</a>:</h4>
<p>we will need polynomials in a finite set of variables.</p>

<a name="127945580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945580">Kevin Buzzard (Jun 12 2018 at 09:46)</a>:</h4>
<p>Of course Lean has these.</p>

<a name="127945588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945588" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945588">Kevin Buzzard (Jun 12 2018 at 09:47)</a>:</h4>
<p>Once we have this new type, we need to prove an "evaluation theorem", saying that if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>X</mi><mo>)</mo><mo>=</mo><mi>g</mi><mo>(</mo><mi>X</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(X)=g(X)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span> in our polynomial ring</p>

<a name="127945589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945589" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945589">Kevin Buzzard (Jun 12 2018 at 09:47)</a>:</h4>
<p>then <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>d</mi><mo>)</mo><mo>=</mo><mi>g</mi><mo>(</mo><mi>d</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(d)=g(d)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mclose">)</span></span></span></span> in int</p>

<a name="127945634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945634" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945634">Kevin Buzzard (Jun 12 2018 at 09:48)</a>:</h4>
<p>Along the way it would be natural to prove things like <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>d</mi><mo>)</mo><mo>+</mo><mi>g</mi><mo>(</mo><mi>d</mi><mo>)</mo><mo>=</mo><mo>(</mo><mi>f</mi><mo>+</mo><mi>g</mi><mo>)</mo><mo>(</mo><mi>d</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(d)+g(d)=(f+g)(d)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mclose">)</span><span class="mrel">=</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathit">d</span><span class="mclose">)</span></span></span></span> and so on</p>

<a name="127945646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945646">Kevin Buzzard (Jun 12 2018 at 09:49)</a>:</h4>
<p>So we define our new polynomial type, define evaluation, prove nice properties about the evaluation map</p>

<a name="127945648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945648" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945648">Kevin Buzzard (Jun 12 2018 at 09:49)</a>:</h4>
<p>and now all that's left is the following problem:</p>

<a name="127945650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945650">Kevin Buzzard (Jun 12 2018 at 09:49)</a>:</h4>
<p>given <code>d^2+2*d+1</code> with <code>d : int</code></p>

<a name="127945653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945653" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945653">Kevin Buzzard (Jun 12 2018 at 09:49)</a>:</h4>
<p>we need to manufacture <code>X^2+2*X+1</code> in our polynomial ring type.</p>

<a name="127945714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945714" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945714">Kevin Buzzard (Jun 12 2018 at 09:50)</a>:</h4>
<p>And for this we really need to take apart <code>d^2+2*d+1</code> and see how it is built from <code>d</code> and stuff that has analogues in the polynomial ring.</p>

<a name="127945719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945719" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945719">Kevin Buzzard (Jun 12 2018 at 09:50)</a>:</h4>
<p>(+,^,2,1)</p>

<a name="127945734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945734">Kevin Buzzard (Jun 12 2018 at 09:51)</a>:</h4>
<p>and I think that it's at this point that the non-tactic-user gets stuck.</p>

<a name="127945904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945904" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945904">Kevin Buzzard (Jun 12 2018 at 09:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Assume Lean has a working polynomial ring type <code>ZX</code> (there are some kicking around, but perhaps none in mathlib) representing polynomials with integer coefficients in one variable <code>X</code>.  Am I right in thinking that it doesn't even make sense to ask for a function (in Lean's sense) which sends <code>d^2+2*d+1</code> to <code>X^2+2*X+1</code> where <code>d : int</code> is some variable? I can't even imagine what the domain of such a function would be. On the other hand, would I be able to write a tactic which took the expression <code>d^2+2*d+1</code> as an input and spat out <code>X^2+2*X+1</code>?</p>

<a name="127945920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127945920" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127945920">Kevin Buzzard (Jun 12 2018 at 09:57)</a>:</h4>
<p>Or is life not even that easy?</p>

<a name="127947136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127947136" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127947136">Scott Morrison (Jun 12 2018 at 10:34)</a>:</h4>
<p>certainly given <code>d^2+2*d+1</code> as an <code>expr</code> (and let's say <code>d</code> is also given, as an <code>expr</code>), in meta land we can construct <code>X^2+2*X+1</code>.</p>

<a name="127947142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127947142" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127947142">Scott Morrison (Jun 12 2018 at 10:35)</a>:</h4>
<p>(Mario's implementation does clever things, including a representation of sparse polynomials, but if you just want the stupid version I could probably manage that function.)</p>

<a name="127950108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127950108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127950108">Simon Hudon (Jun 12 2018 at 12:04)</a>:</h4>
<p>Is this simply renaming variables in the goal?</p>

<a name="127950557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127950557" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127950557">Scott Morrison (Jun 12 2018 at 12:16)</a>:</h4>
<p>Sorry, the example wasn't very helpful: I just meant, determine if some expression is in fact a polynomial in some other expr, and if so, present it as such in some form (list of coefficients, map of coefficients, etc).</p>

<a name="127951731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951731" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951731">Kevin Buzzard (Jun 12 2018 at 12:47)</a>:</h4>
<blockquote>
<p>Is this simply renaming variables in the goal?</p>
</blockquote>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> No I think it's more. X is a genuine polynomial variable, we have a type <code>ZX</code> with an inclusion from int into ZX and also some element <code>X : ZX</code> which is not in the image of <code>int</code>, it's an abstract polynomial variable</p>

<a name="127951740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951740" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951740">Kevin Buzzard (Jun 12 2018 at 12:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> do we _have_ to do this in meta-land?</p>

<a name="127951793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951793">Simon Hudon (Jun 12 2018 at 12:48)</a>:</h4>
<p>ah! i see. So a kind of parser.</p>

<a name="127951794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951794" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951794">Kevin Buzzard (Jun 12 2018 at 12:48)</a>:</h4>
<p>I can see that Mario's implementation uses "Horner form" of a polynomial, so sparse polys are handled better.</p>

<a name="127951798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951798" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951798">Kevin Buzzard (Jun 12 2018 at 12:48)</a>:</h4>
<p>Yes, I was interested in building the stupid version of tactic.ring</p>

<a name="127951805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951805" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951805">Simon Hudon (Jun 12 2018 at 12:48)</a>:</h4>
<p>Yes, I think it has to be in meta because you need access to the <code>expr</code> syntax tree</p>

<a name="127951812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951812" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951812">Kevin Buzzard (Jun 12 2018 at 12:48)</a>:</h4>
<p>What I see in Mario's file seems to me to be a construction of an abstract polynomial ring but completely in meta-land</p>

<a name="127951818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951818" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951818">Kevin Buzzard (Jun 12 2018 at 12:49)</a>:</h4>
<p>Here is a concrete question.</p>

<a name="127951823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951823" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951823">Kevin Buzzard (Jun 12 2018 at 12:49)</a>:</h4>
<p>Would it be possible to just define the polynomial ring Z[X] in "normal" Lean</p>

<a name="127951830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951830" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951830">Kevin Buzzard (Jun 12 2018 at 12:49)</a>:</h4>
<p>e.g. in a non-efficient way, using lists for coefficients</p>

<a name="127951837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951837" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951837">Simon Hudon (Jun 12 2018 at 12:49)</a>:</h4>
<p>I believe so</p>

<a name="127951841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951841">Kevin Buzzard (Jun 12 2018 at 12:49)</a>:</h4>
<p>and then write a much simpler tactic than <code>tactic/ring.lean</code></p>

<a name="127951893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951893">Kevin Buzzard (Jun 12 2018 at 12:50)</a>:</h4>
<p>which can prove statements of the form "forall d : int, (d+1)^3=d^3+3d^2+3d+1"</p>

<a name="127951901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951901" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951901">Kevin Buzzard (Jun 12 2018 at 12:50)</a>:</h4>
<p>by temporarily dipping into meta-land to construct the polynomials (X+1)^3 and X^3+3X^2+3X+1</p>

<a name="127951904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951904" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951904">Kevin Buzzard (Jun 12 2018 at 12:50)</a>:</h4>
<p>and then checking that they're equal in Z[X]</p>

<a name="127951907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951907" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951907">Kevin Buzzard (Jun 12 2018 at 12:50)</a>:</h4>
<p>and then evaluating at d</p>

<a name="127951914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951914" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951914">Kevin Buzzard (Jun 12 2018 at 12:50)</a>:</h4>
<p>and deducing the result?</p>

<a name="127951927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951927" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951927">Kevin Buzzard (Jun 12 2018 at 12:51)</a>:</h4>
<p>Or is it an essential part of the tactic.ring tactic that one builds some version of Z[X] in meta-land?</p>

<a name="127951988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127951988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127951988">Kevin Buzzard (Jun 12 2018 at 12:52)</a>:</h4>
<p>It seems to me that Mario writes <code>horner</code> in normal-land and proves some lemmas about it in normal-land</p>

<a name="127952002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952002">Kevin Buzzard (Jun 12 2018 at 12:53)</a>:</h4>
<p>but the key facts are things like <code>eval_add</code>, which is meta</p>

<a name="127952175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952175" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952175">Kevin Buzzard (Jun 12 2018 at 12:57)</a>:</h4>
<p><code>eval_add</code> seems to be some sort of theorem of the form "if this expr represents f and this expr represents g, then I will return an expr plus a proof that it is the evaluation of f plus the evaluation of g"</p>

<a name="127952239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952239">Kevin Buzzard (Jun 12 2018 at 12:58)</a>:</h4>
<p>I was wondering whether one could instead use a non-expr version</p>

<a name="127952242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952242" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952242">Simon Hudon (Jun 12 2018 at 12:58)</a>:</h4>
<p>Because <code>expr</code> is in meta land, you can't do any of that stuff in non-meta land</p>

<a name="127952247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952247" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952247">Kevin Buzzard (Jun 12 2018 at 12:58)</a>:</h4>
<p>right</p>

<a name="127952253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952253" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952253">Kevin Buzzard (Jun 12 2018 at 12:58)</a>:</h4>
<p>but if I had a tactic which took d^2+2*d+1</p>

<a name="127952259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952259">Kevin Buzzard (Jun 12 2018 at 12:59)</a>:</h4>
<p>and returned X^2+2*X+1</p>

<a name="127952261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952261">Simon Hudon (Jun 12 2018 at 12:59)</a>:</h4>
<p>I see ok yes that's possible</p>

<a name="127952267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952267" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952267">Simon Hudon (Jun 12 2018 at 12:59)</a>:</h4>
<p>That's called a proof by reflection</p>

<a name="127952270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952270">Kevin Buzzard (Jun 12 2018 at 12:59)</a>:</h4>
<p>plus a proof that X^2+X+1 evaluated at d was d^2+2*d+1</p>

<a name="127952294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952294" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952294">Kevin Buzzard (Jun 12 2018 at 12:59)</a>:</h4>
<p>then it seems to me that there's a chance that I can prove d^2+2*d+1=(d+1)^2 using this tactic</p>

<a name="127952373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952373">Kevin Buzzard (Jun 12 2018 at 13:00)</a>:</h4>
<p>because I feed in both sides to the tactic</p>

<a name="127952376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952376">Kevin Buzzard (Jun 12 2018 at 13:00)</a>:</h4>
<p>prove they're equal in <code>ZX</code></p>

<a name="127952382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952382" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952382">Kevin Buzzard (Jun 12 2018 at 13:00)</a>:</h4>
<p>and deduce that their valuations are equal</p>

<a name="127952390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952390" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952390">Kevin Buzzard (Jun 12 2018 at 13:00)</a>:</h4>
<p>I am trying to get as much of the proof out of meta-land as I can</p>

<a name="127952404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952404">Reid Barton (Jun 12 2018 at 13:01)</a>:</h4>
<p>Regarding lands, have you looked at the slides on metaprogramming <a href="https://hanoifabs.files.wordpress.com/2018/05/slides.pdf" target="_blank" title="https://hanoifabs.files.wordpress.com/2018/05/slides.pdf">https://hanoifabs.files.wordpress.com/2018/05/slides.pdf</a>?</p>

<a name="127952408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952408">Reid Barton (Jun 12 2018 at 13:01)</a>:</h4>
<p>In particular page 4</p>

<a name="127952433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952433">Kevin Buzzard (Jun 12 2018 at 13:01)</a>:</h4>
<p>This is part of the reason I'm thinking about this now</p>

<a name="127952485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952485" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952485">Kevin Buzzard (Jun 12 2018 at 13:02)</a>:</h4>
<p>I have looked through all of tactic/ring.lean and all of a sudden it doesn't look as intimidating as it used ti</p>

<a name="127952486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952486">Kevin Buzzard (Jun 12 2018 at 13:02)</a>:</h4>
<p>to</p>

<a name="127952586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952586">Kevin Buzzard (Jun 12 2018 at 13:04)</a>:</h4>
<p><a href="https://github.com/kbuzzard/mathlib/blob/ring_tactic_comments/tactic/ring.lean" target="_blank" title="https://github.com/kbuzzard/mathlib/blob/ring_tactic_comments/tactic/ring.lean">https://github.com/kbuzzard/mathlib/blob/ring_tactic_comments/tactic/ring.lean</a></p>

<a name="127952590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952590" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952590">Reid Barton (Jun 12 2018 at 13:04)</a>:</h4>
<p>If you don't need access to meta-land features like general recursion or <code>expr</code> then you can stay in normal-land; and surely the theory of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="double-struck">Z</mi></mrow><mo>[</mo><mi>X</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\mathbb{Z}[X]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathbb">Z</span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">]</span></span></span></span> doesn't need these things. On the other hand, you may want to avoid using noncomputable things if you want your tactic to, for example, be able to decide whether two polynomials in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="double-struck">Z</mi></mrow><mo>[</mo><mi>X</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">\mathbb{Z}[X]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord"><span class="mord mathbb">Z</span></span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mclose">]</span></span></span></span> are equal so that it can decide whether to succeed or fail.</p>

<a name="127952593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952593">Kevin Buzzard (Jun 12 2018 at 13:04)</a>:</h4>
<p>I am trying to write a comment about every definition and theorem in that link</p>

<a name="127952613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952613" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952613">Kevin Buzzard (Jun 12 2018 at 13:05)</a>:</h4>
<p>So one can certainly make Z[X], indeed it's been done several times although I don't think it's in mathlib yet</p>

<a name="127952618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952618">Kevin Buzzard (Jun 12 2018 at 13:05)</a>:</h4>
<p>The problem is the function sending d^2+2d+1 to X^2+2X+1</p>

<a name="127952671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952671" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952671">Reid Barton (Jun 12 2018 at 13:06)</a>:</h4>
<p>Right, so I guess the approach used here by <code>ring</code> is to represent a variable (which is basically something the tactic can't break down into further ring operations) by its <code>expr</code></p>

<a name="127952678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952678" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952678">Kevin Buzzard (Jun 12 2018 at 13:07)</a>:</h4>
<p>right</p>

<a name="127952679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952679" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952679">Reid Barton (Jun 12 2018 at 13:07)</a>:</h4>
<p>Here the variable is simply <code>d</code>, but it could have been more complicated, e.g. <code>sin t</code></p>

<a name="127952681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952681" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952681">Kevin Buzzard (Jun 12 2018 at 13:07)</a>:</h4>
<p>right</p>

<a name="127952683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952683" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952683">Kevin Buzzard (Jun 12 2018 at 13:07)</a>:</h4>
<p>or there could be several variables</p>

<a name="127952755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952755" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952755">Reid Barton (Jun 12 2018 at 13:09)</a>:</h4>
<p>So that must be why the <code>destruct_ty</code> thing is in <code>meta</code>, though if you wanted it to be in normal-land, you could probably just parameterize it on the expression type.</p>

<a name="127952758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952758" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952758">Reid Barton (Jun 12 2018 at 13:09)</a>:</h4>
<p>BTW, <code>_ty</code> probably just stands for "type"</p>

<a name="127952829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952829" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952829">Kevin Buzzard (Jun 12 2018 at 13:11)</a>:</h4>
<p>So completely independent of the ring tactic</p>

<a name="127952830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952830" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952830">Kevin Buzzard (Jun 12 2018 at 13:11)</a>:</h4>
<p>there is this horner thing</p>

<a name="127952832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952832" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952832">Kevin Buzzard (Jun 12 2018 at 13:11)</a>:</h4>
<p>and what seems to be going on there</p>

<a name="127952834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952834" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952834">Kevin Buzzard (Jun 12 2018 at 13:11)</a>:</h4>
<p>is that (and this is Assia's insight, or her joint insight with her co-author)</p>

<a name="127952844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952844" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952844">Kevin Buzzard (Jun 12 2018 at 13:11)</a>:</h4>
<p>storing polynomials as lists of coefficients might suck</p>

<a name="127952888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952888" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952888">Kevin Buzzard (Jun 12 2018 at 13:12)</a>:</h4>
<p>especially if you want to work out x^100 * x^100 without doing 10000 computations</p>

<a name="127952898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952898" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952898">Kevin Buzzard (Jun 12 2018 at 13:12)</a>:</h4>
<p>so they store e.g. x^100+3x^2+7 as (1*x^98+3)*x^2+7</p>

<a name="127952903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952903" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952903">Kevin Buzzard (Jun 12 2018 at 13:12)</a>:</h4>
<p>iterating the "x maps to a*x^n+b" map</p>

<a name="127952918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952918">Kevin Buzzard (Jun 12 2018 at 13:13)</a>:</h4>
<p>and so this is some sort of normal form for polynomials</p>

<a name="127952922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952922" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952922">Kevin Buzzard (Jun 12 2018 at 13:13)</a>:</h4>
<p>which we could call "horner normal form"</p>

<a name="127952925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952925" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952925">Kevin Buzzard (Jun 12 2018 at 13:13)</a>:</h4>
<p>and if you store polynomials in this way then it's a PITA to add or multiply them</p>

<a name="127952929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952929" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952929">Kevin Buzzard (Jun 12 2018 at 13:13)</a>:</h4>
<p>but this is OK because somehow this isn't the bottleneck</p>

<a name="127952978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952978" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952978">Reid Barton (Jun 12 2018 at 13:14)</a>:</h4>
<p>I see, and <code>eval_add</code> is basically implementing addition of polynomials in this form, it looks like?</p>

<a name="127952979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952979">Kevin Buzzard (Jun 12 2018 at 13:14)</a>:</h4>
<p>So one could envisage writing a second ring tactic which (a) was far less efficient and (b) worked in some situations where Mario's doesn't (because Mario's is currently buggy)</p>

<a name="127952984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127952984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127952984">Kevin Buzzard (Jun 12 2018 at 13:14)</a>:</h4>
<p>where you just use lists for coefficients</p>

<a name="127953003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953003" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953003">Kevin Buzzard (Jun 12 2018 at 13:15)</a>:</h4>
<p>and then the resulting tactic file would have this extra obfuscating layer of difficulty removed</p>

<a name="127953012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953012">Kevin Buzzard (Jun 12 2018 at 13:15)</a>:</h4>
<p>and this was what got me into wondering whether I could even just use one of the already-existing polynomial ring Lean implementations</p>

<a name="127953016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953016" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953016">Kevin Buzzard (Jun 12 2018 at 13:15)</a>:</h4>
<p>instead of making Z[X] in meta-land</p>

<a name="127953098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953098">Kevin Buzzard (Jun 12 2018 at 13:17)</a>:</h4>
<blockquote>
<p>I see, and <code>eval_add</code> is basically implementing addition of polynomials in this form, it looks like?</p>
</blockquote>
<p>Yes, it's perhaps doing something clever like not just implementing addition, it's also collecting the proofs that addition commutes with evaluation, but the five lemmas before <code>eval_add</code> are precisely the five lemmas you need to add polynomials in "Horner form"</p>

<a name="127953111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953111" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953111">Kevin Buzzard (Jun 12 2018 at 13:18)</a>:</h4>
<p>You add <code>ax^n+b</code> and <code>a'x^n'+b'</code></p>

<a name="127953152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953152" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953152">Kevin Buzzard (Jun 12 2018 at 13:18)</a>:</h4>
<p>where a and a' are allowed to be polynomials in horner form</p>

<a name="127953158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953158">Kevin Buzzard (Jun 12 2018 at 13:18)</a>:</h4>
<p>and you have to do the three cases n&lt;n', n=n', n&gt;n'</p>

<a name="127953162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953162">Kevin Buzzard (Jun 12 2018 at 13:18)</a>:</h4>
<p>and then also you have to add <code>ax^n+b</code> to c where c is a constant</p>

<a name="127953163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953163" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953163">Kevin Buzzard (Jun 12 2018 at 13:18)</a>:</h4>
<p>both ways around</p>

<a name="127953168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953168" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953168">Kevin Buzzard (Jun 12 2018 at 13:18)</a>:</h4>
<p>and there's some implicit inductive type horner_form</p>

<a name="127953182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953182">Kevin Buzzard (Jun 12 2018 at 13:19)</a>:</h4>
<p>which is defined by: a constant is in horner_form, and if a is in horner_form then so is a*x^n+b</p>

<a name="127953187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953187" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953187">Kevin Buzzard (Jun 12 2018 at 13:19)</a>:</h4>
<p>and then every polynomial has a canonical horner form</p>

<a name="127953198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953198" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953198">Kevin Buzzard (Jun 12 2018 at 13:19)</a>:</h4>
<p>and also perhaps some non-canonical ones</p>

<a name="127953343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953343" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953343">Kevin Buzzard (Jun 12 2018 at 13:22)</a>:</h4>
<p>I haven't got down as far as <code>normalize</code> but this might be the function which puts something in horner form into its normalised state (which you need because you need an algorithm for figuring out when two polynomials are equal)</p>

<a name="127953437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953437" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953437">Reid Barton (Jun 12 2018 at 13:25)</a>:</h4>
<blockquote>
<p>and this was what got me into wondering whether I could even just use one of the already-existing polynomial ring Lean implementations</p>
</blockquote>
<p>I don't see why not. Probably you can even use the one in <code>linear_algebra.multivariate_polynomial</code></p>

<a name="127953586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953586">Kevin Buzzard (Jun 12 2018 at 13:29)</a>:</h4>
<p>You understand that I am not looking for some sort of uber-efficient ring tactic, like the one Mario wrote. I am trying to see in some sense what the minimal amount of work would be, if I wanted to write a more inefficient ring tactic of my own</p>

<a name="127953590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953590" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953590">Kevin Buzzard (Jun 12 2018 at 13:29)</a>:</h4>
<p>and the more I can get out of meta-land the better</p>

<a name="127953599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953599" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953599">Kevin Buzzard (Jun 12 2018 at 13:29)</a>:</h4>
<p>Even for just equations involving one unknown, I would be interested</p>

<a name="127953672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953672">Kevin Buzzard (Jun 12 2018 at 13:30)</a>:</h4>
<p>not least because <code>example (d : ℕ) : d^2+2*d+1=(d+1)^2 := by ring </code> currently fails and rather than pestering Mario I thought it would be an interesting exercise to try and work out why.</p>

<a name="127953697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127953697" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127953697">Reid Barton (Jun 12 2018 at 13:31)</a>:</h4>
<p>Yes, I think a <code>ring</code> tactic optimized for simplicity would be valuable as a demonstration of how to write similar tactics, as well.</p>

<a name="127954108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954108">Kevin Buzzard (Jun 12 2018 at 13:43)</a>:</h4>
<p>Well maybe that's where this thread is going.</p>

<a name="127954256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954256">Mario Carneiro (Jun 12 2018 at 13:47)</a>:</h4>
<p>I'm not sure you can actually save that much work with a dumber <code>ring</code> tactic</p>

<a name="127954307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954307" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954307">Mario Carneiro (Jun 12 2018 at 13:48)</a>:</h4>
<p>Probably using dense polynomial representation is a bit easier, but I don't think proof by reflection is easier (although more of it can be verified)</p>

<a name="127954313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954313" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954313">Mario Carneiro (Jun 12 2018 at 13:48)</a>:</h4>
<p>but precisely because more of it is verified, there is more work to do</p>

<a name="127954331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954331" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954331">Mario Carneiro (Jun 12 2018 at 13:49)</a>:</h4>
<p>If <code>expr</code> was not meta, almost all of the ring tactic could be non-meta</p>

<a name="127954389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954389" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954389">Simon Hudon (Jun 12 2018 at 13:50)</a>:</h4>
<p>Do you know if there's any plan to make <code>expr</code> non-meta?</p>

<a name="127954397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954397" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954397">Mario Carneiro (Jun 12 2018 at 13:51)</a>:</h4>
<p>I have not investigated the <code>ring</code> bug, but one way to find out what is happening is to insert type checks in <code>eval_add</code> and such</p>

<a name="127954407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954407">Reid Barton (Jun 12 2018 at 13:51)</a>:</h4>
<p>By "simple", I really mean "easy to understand"</p>

<a name="127954409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954409">Reid Barton (Jun 12 2018 at 13:51)</a>:</h4>
<p>not necessarily short</p>

<a name="127954412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954412" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954412">Mario Carneiro (Jun 12 2018 at 13:51)</a>:</h4>
<p>There is no plan to make <code>expr</code> non-meta, and in fact I attempted such a plan and was rebuffed several months ago</p>

<a name="127954463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954463" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954463">Mario Carneiro (Jun 12 2018 at 13:52)</a>:</h4>
<p>The likely alternative is to have a mirror copy of <code>expr</code> that is non-meta</p>

<a name="127954469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954469">Mario Carneiro (Jun 12 2018 at 13:52)</a>:</h4>
<p>which would have to avoid certain meta things like macros</p>

<a name="127954787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954787" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954787">Kevin Buzzard (Jun 12 2018 at 14:01)</a>:</h4>
<blockquote>
<p>I'm not sure you can actually save that much work with a dumber <code>ring</code> tactic</p>
</blockquote>
<p>Yes, as Reid says, I'm not worried about work, I'm attempting to understand tactics in a way other than "read Programming In Lean again".</p>

<a name="127954848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954848" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954848">Kevin Buzzard (Jun 12 2018 at 14:02)</a>:</h4>
<p>The only other way I can think of is "read some tactic code and see if you can understand it, and see what questions arise because of it"</p>

<a name="127954852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954852" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954852">Kevin Buzzard (Jun 12 2018 at 14:02)</a>:</h4>
<p>and that's why I find myself in this thread</p>

<a name="127954862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954862" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954862">Kevin Buzzard (Jun 12 2018 at 14:03)</a>:</h4>
<p>One question: which is best? Documenting ring.lean like this <a href="https://github.com/kbuzzard/mathlib/blob/ring_tactic_comments/tactic/ring.lean" target="_blank" title="https://github.com/kbuzzard/mathlib/blob/ring_tactic_comments/tactic/ring.lean">https://github.com/kbuzzard/mathlib/blob/ring_tactic_comments/tactic/ring.lean</a></p>

<a name="127954873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954873">Kevin Buzzard (Jun 12 2018 at 14:03)</a>:</h4>
<p>or writing a stand-alone file with comments like this <a href="https://github.com/kbuzzard/mathlib/blob/tactic_doc/docs/ring_tactic.rst" target="_blank" title="https://github.com/kbuzzard/mathlib/blob/tactic_doc/docs/ring_tactic.rst">https://github.com/kbuzzard/mathlib/blob/tactic_doc/docs/ring_tactic.rst</a></p>

<a name="127954883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954883">Kevin Buzzard (Jun 12 2018 at 14:03)</a>:</h4>
<p>I currently find myself doing both</p>

<a name="127954892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954892">Kevin Buzzard (Jun 12 2018 at 14:03)</a>:</h4>
<p>As long as I get to the bottom using one method, I am sure I will have learnt a lot</p>

<a name="127954939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954939" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954939">Kevin Buzzard (Jun 12 2018 at 14:04)</a>:</h4>
<p>Currently the "adding comments to ring.lean" approach is winning</p>

<a name="127954988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127954988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127954988">Kevin Buzzard (Jun 12 2018 at 14:05)</a>:</h4>
<p>but the waffle above about writing a simpler version -- which to be honest could I think turn into a great tutorial on how to write tactics, if we implement polynomials in one variable using some dumb list method or, even better, perhaps using some already-implemented method</p>

<a name="127955058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127955058" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127955058">Kevin Buzzard (Jun 12 2018 at 14:06)</a>:</h4>
<p>Maybe that's the goal of this thread. To write an  as-stupid-as-possible ring tactic which attempts to have as little in meta-land as possible, and then stick it up on my blog as some sort of tactic tutorial as an alternative for people to read</p>

<a name="127955071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127955071" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127955071">Kevin Buzzard (Jun 12 2018 at 14:07)</a>:</h4>
<p>Next term I'll be supervising a Masters project on how to write tactics so I'd better get my act together and learn it myself</p>

<a name="127955085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127955085" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127955085">Kevin Buzzard (Jun 12 2018 at 14:07)</a>:</h4>
<p>The student in question is currently doing an internship at INRIA learning how to do it in Coq so I'm hoping that they will learn quickly and then teach me</p>

<a name="127957753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127957753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127957753">Mario Carneiro (Jun 12 2018 at 15:01)</a>:</h4>
<p>Maybe this will help: There is an implicit inductive type <code>horner_form_expr</code> with the following definition:</p>
<div class="codehilite"><pre><span></span>meta inductive horner_form_expr : Type
| const : expr → horner_form_expr
| horner (a : horner_form_expr) (x : expr) (n : nat) (b : horner_form_expr) : horner_form_expr
</pre></div>


<p>The job of <code>eval_add</code> and the other definitions is to rewrite any <code>expr</code> into a <code>horner_form_expr</code>. However, since <code>horner_form_expr</code> can be represented as an <code>expr</code>, the actual inductive type is omitted to avoid the overhead of converting back and forth. Furthermore, there is a normal form requirement, that says that the <code>x</code> expression must be lex_lt less than any other expressions in <code>x</code> slots of the <code>b</code> subtree.</p>

<a name="127957847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127957847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127957847">Mario Carneiro (Jun 12 2018 at 15:03)</a>:</h4>
<p><code>destruct</code> is effectively the <code>cases_on</code> for this inductive type</p>

<a name="127959658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959658" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959658">Kevin Buzzard (Jun 12 2018 at 15:38)</a>:</h4>
<p>Right -- I had basically figured this out. But you see, in some educational blog post about this stuff you could put this type in, and furthermore make it work in a more stupid way using lists of coefficients. What I am still not clear about is whethet you can get away with making it not meta (and hence get away with not actually writing it at all, because it's already written)</p>

<a name="127959693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959693">Kevin Buzzard (Jun 12 2018 at 15:39)</a>:</h4>
<p>Because you're in meta-land you can just not even define the type, you can <code>destruct</code> it _assuming_ that it's in this form, and if it's not then big deal, things have gone wrong, just return <code>none</code></p>

<a name="127959786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959786" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959786">Mario Carneiro (Jun 12 2018 at 15:40)</a>:</h4>
<p>You can't make it non-meta and still retain the <code>x</code> payloads, which have to be kept as is as exprs</p>

<a name="127959808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959808" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959808">Kevin Buzzard (Jun 12 2018 at 15:41)</a>:</h4>
<p>My idea was to have a meta function sending d^2+2d+1 to X^2+2X+1</p>

<a name="127959809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959809" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959809">Mario Carneiro (Jun 12 2018 at 15:41)</a>:</h4>
<p>unless maybe you write them down somewhere else and only keep pointers to them in your non-meta data structure (i.e. indexes into a list of exprs)</p>

<a name="127959864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959864">Mario Carneiro (Jun 12 2018 at 15:42)</a>:</h4>
<p>which I guess is similar to your Z[X] suggestion</p>

<a name="127959867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959867" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959867">Kevin Buzzard (Jun 12 2018 at 15:42)</a>:</h4>
<p>The tactic would only work for goals with one unknown</p>

<a name="127959874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959874" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959874">Mario Carneiro (Jun 12 2018 at 15:42)</a>:</h4>
<p>but you have to remember these are multivariate polynomials</p>

<a name="127959877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959877" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959877">Kevin Buzzard (Jun 12 2018 at 15:42)</a>:</h4>
<p>I know yours are</p>

<a name="127959881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959881" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959881">Kevin Buzzard (Jun 12 2018 at 15:42)</a>:</h4>
<p>but I am suggesting writing a simplified version</p>

<a name="127959895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959895">Kevin Buzzard (Jun 12 2018 at 15:43)</a>:</h4>
<p>I want to isolate the "now here we have to write some meta stuff" and make it as small as possible</p>

<a name="127959898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959898" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959898">Mario Carneiro (Jun 12 2018 at 15:43)</a>:</h4>
<p>If you take <code>d</code> as an input, then there are lots of bad exprs now</p>

<a name="127959906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959906" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959906">Mario Carneiro (Jun 12 2018 at 15:43)</a>:</h4>
<p>In my approach, there aren't any bad exprs because anything it doesn't understand becomes a new atom</p>

<a name="127959948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959948">Kevin Buzzard (Jun 12 2018 at 15:44)</a>:</h4>
<p>I know your approach is better at getting things done</p>

<a name="127959956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959956" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959956">Kevin Buzzard (Jun 12 2018 at 15:44)</a>:</h4>
<p>I am happy to let both d and Z be inputs</p>

<a name="127959964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959964" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959964">Mario Carneiro (Jun 12 2018 at 15:44)</a>:</h4>
<p>but you want to have only one atom</p>

<a name="127959966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959966" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959966">Kevin Buzzard (Jun 12 2018 at 15:44)</a>:</h4>
<p>right</p>

<a name="127959969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959969" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959969">Kevin Buzzard (Jun 12 2018 at 15:44)</a>:</h4>
<p>and I want to store polynomials as lists</p>

<a name="127959974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959974" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959974">Kevin Buzzard (Jun 12 2018 at 15:44)</a>:</h4>
<p>these facts are not unrelated</p>

<a name="127959987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127959987" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127959987">Mario Carneiro (Jun 12 2018 at 15:44)</a>:</h4>
<p>what happens if I pass <code>d^2+x</code> to your function?</p>

<a name="127960000"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960000" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960000">Kevin Buzzard (Jun 12 2018 at 15:45)</a>:</h4>
<p>my function will fail</p>

<a name="127960005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960005" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960005">Kevin Buzzard (Jun 12 2018 at 15:45)</a>:</h4>
<p>because my function is there to teach people how to write tactics</p>

<a name="127960006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960006">Kevin Buzzard (Jun 12 2018 at 15:45)</a>:</h4>
<p>not to actually be used in the wild</p>

<a name="127960013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960013" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960013">Kevin Buzzard (Jun 12 2018 at 15:45)</a>:</h4>
<p>I am writing code for a completely different reason to probably any code you ever wrote</p>

<a name="127960015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960015" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960015">Kevin Buzzard (Jun 12 2018 at 15:45)</a>:</h4>
<p>I am writing code to teach my students that tactics are not scary</p>

<a name="127960060"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960060" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960060">Kevin Buzzard (Jun 12 2018 at 15:46)</a>:</h4>
<p>which is not the impression you get when reading PIL</p>

<a name="127960068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960068" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960068">Mario Carneiro (Jun 12 2018 at 15:46)</a>:</h4>
<p>Okay, let me think about this</p>

<a name="127960076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960076" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960076">Mario Carneiro (Jun 12 2018 at 15:46)</a>:</h4>
<p>In the mean time, the <code>ring</code> bug has been fixed.</p>

<a name="127960078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960078" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960078">Kevin Buzzard (Jun 12 2018 at 15:47)</a>:</h4>
<p>:D</p>

<a name="127960086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960086" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960086">Kevin Buzzard (Jun 12 2018 at 15:47)</a>:</h4>
<p>OK so forget this thread, main goal achieved ;-)</p>

<a name="127960091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960091" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960091">Mario Carneiro (Jun 12 2018 at 15:47)</a>:</h4>
<p>The problem was in <code>horner_add_horner_lt</code> (and <code>gt</code>). Suppose we are adding <code>(a1 * x^n1 + b1) + (a2 * x^n2 + b2)</code> where <code>n1 &gt; n2</code></p>

<a name="127960097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960097">Kevin Buzzard (Jun 12 2018 at 15:47)</a>:</h4>
<p>dammit I even looked at that function!</p>

<a name="127960099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960099" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960099">Mario Carneiro (Jun 12 2018 at 15:47)</a>:</h4>
<p>It's funny, the theorem is not wrong</p>

<a name="127960146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960146" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960146">Mario Carneiro (Jun 12 2018 at 15:48)</a>:</h4>
<p>but it doesn't normalize like it should</p>

<a name="127960148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960148" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960148">Kevin Buzzard (Jun 12 2018 at 15:48)</a>:</h4>
<p>in fact that's exactly the point I'm up to</p>

<a name="127960156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960156">Kevin Buzzard (Jun 12 2018 at 15:48)</a>:</h4>
<p><code>/-- This non-meta theorem just says a₁x^n₁+b₁+a₂x^(n₁+k)+b₂=(a₂x^k+a₁)x^n₁+(b₁+b₂) -/</code></p>

<a name="127960189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960189" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960189">Andrew Ashworth (Jun 12 2018 at 15:49)</a>:</h4>
<p>I think this is a great idea. It took me some time to understand reflection in Lean. Unfortunately, translating Chlipala's section on it (in CPDT) from Coq to Lean is quite difficult. So a "Lean-first" tutorial would be great.</p>

<a name="127960192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960192" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960192">Mario Carneiro (Jun 12 2018 at 15:49)</a>:</h4>
<p>The current implementation normalizes <code>b1 + b2 = b'</code>, calculates <code>k</code> such that <code>n2 + k = n1</code>, and then outputs the normal form <code>(a1 * x^k + a2) * x^n2 + b'</code></p>

<a name="127960249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960249" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960249">Kevin Buzzard (Jun 12 2018 at 15:50)</a>:</h4>
<p>yeah (modulo the fact that the (1,2) notation is switched in this thread from the conventions used in the actual code)</p>

<a name="127960250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960250" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960250">Mario Carneiro (Jun 12 2018 at 15:50)</a>:</h4>
<p>However, <code>a1 * x^k + a2</code> is not necessarily in normal form</p>

<a name="127960258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960258">Kevin Buzzard (Jun 12 2018 at 15:50)</a>:</h4>
<p>because x might not be lt the monomials showing up in a1?</p>

<a name="127960276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960276" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960276">Mario Carneiro (Jun 12 2018 at 15:51)</a>:</h4>
<p>Yes. In particular, <code>x</code> might appear in <code>a2</code></p>

<a name="127960282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960282" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960282">Kevin Buzzard (Jun 12 2018 at 15:51)</a>:</h4>
<p>or a1</p>

<a name="127960285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960285">Kevin Buzzard (Jun 12 2018 at 15:51)</a>:</h4>
<p>;-)</p>

<a name="127960288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960288">Mario Carneiro (Jun 12 2018 at 15:51)</a>:</h4>
<p>that's okay</p>

<a name="127960331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960331" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960331">Kevin Buzzard (Jun 12 2018 at 15:52)</a>:</h4>
<p>not when you switch it so your algebra is correct ;-)</p>

<a name="127960352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960352">Kevin Buzzard (Jun 12 2018 at 15:52)</a>:</h4>
<p>[you only did half the editing job]</p>

<a name="127960365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960365">Mario Carneiro (Jun 12 2018 at 15:52)</a>:</h4>
<p>the whole point of factorizing <code>a1 * x^k + a2</code> is that <code>a2</code> has no <code>x</code>'s and <code>a1</code> has all the high order terms</p>

<a name="127960372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960372" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960372">Kevin Buzzard (Jun 12 2018 at 15:53)</a>:</h4>
<p>a2 * x^k + a1</p>

<a name="127960388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960388" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960388">Kevin Buzzard (Jun 12 2018 at 15:53)</a>:</h4>
<p>I think this part of the thread is now beyond saving</p>

<a name="127960396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960396" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960396">Kevin Buzzard (Jun 12 2018 at 15:54)</a>:</h4>
<p>but I think we both know what the other is saying :-)</p>

<a name="127960460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960460">Mario Carneiro (Jun 12 2018 at 15:55)</a>:</h4>
<p>fixed</p>

<a name="127960468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960468" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960468">Mario Carneiro (Jun 12 2018 at 15:55)</a>:</h4>
<p>I actually noticed the problem in <code>gt</code>, but I was translating to the symmetric version and got confused</p>

<a name="127960525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960525" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960525">Mario Carneiro (Jun 12 2018 at 15:56)</a>:</h4>
<p>(in this thread, that's not the bug)</p>

<a name="127960552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960552">Kevin Buzzard (Jun 12 2018 at 15:57)</a>:</h4>
<p>[I posted my docstring for <code>lt</code>, but you are talking about <code>gt</code>, so now all is right with the world]</p>

<a name="127960559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960559" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960559">Kevin Buzzard (Jun 12 2018 at 15:57)</a>:</h4>
<p>Right, so let's focus on <code>gt</code></p>

<a name="127960560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960560">Mario Carneiro (Jun 12 2018 at 15:57)</a>:</h4>
<p>the bug is that since both <code>a1</code> and <code>a2</code> can contain <code>x</code>, we have a separate subproblem now, to normalize <code>(a1 * x^k + 0) + a2 = a'</code> and then output <code>a' * x^n2+ b'</code></p>

<a name="127960566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960566" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960566">Kevin Buzzard (Jun 12 2018 at 15:57)</a>:</h4>
<p><code>/-- This non-meta theorem just says a₁x^(n₂+k)+b₁+a₂x^n₂+b₂=(a₁x^k+a₂)x^n₂+(b₁+b₂) -/</code></p>

<a name="127960611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960611">Mario Carneiro (Jun 12 2018 at 15:58)</a>:</h4>
<p>so I did that and now it works</p>

<a name="127960615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960615" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960615">Mario Carneiro (Jun 12 2018 at 15:58)</a>:</h4>
<p>I'm compiling now, I'll post it soon</p>

<a name="127960626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960626" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960626">Kevin Buzzard (Jun 12 2018 at 15:58)</a>:</h4>
<p>I would have liked to find this bug</p>

<a name="127960636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960636" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960636">Kevin Buzzard (Jun 12 2018 at 15:59)</a>:</h4>
<p>Because you're in meta mode you don't have to be super-anal about making sure everything is in canonical form</p>

<a name="127960648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960648" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960648">Kevin Buzzard (Jun 12 2018 at 15:59)</a>:</h4>
<p>you just write procedural code which is supposed to do it</p>

<a name="127960715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960715" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960715">Kevin Buzzard (Jun 12 2018 at 16:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110025">@Andrew Ashworth</span> I did the introductory compiler exercise in CPDT, in Lean, over the weekend.</p>

<a name="127960717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960717">Mario Carneiro (Jun 12 2018 at 16:00)</a>:</h4>
<p>I'll help you with a tutorial ring tactic later</p>

<a name="127960732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960732">Mario Carneiro (Jun 12 2018 at 16:01)</a>:</h4>
<p>But one thing to be careful about is if you do too much non-meta, you might actually end up writing a tactic that does proof by reflection which is a completely different method</p>

<a name="127960757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960757" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960757">Kevin Buzzard (Jun 12 2018 at 16:01)</a>:</h4>
<p>reflection is _different_? I thought that it was somehow some fundamental principle which was used everywhere?</p>

<a name="127960760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960760" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960760">Mario Carneiro (Jun 12 2018 at 16:01)</a>:</h4>
<p><code>ring</code> is an example of how to write tactics that build proofs by induction, but it's hard to do that non-meta</p>

<a name="127960901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960901" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960901">Mario Carneiro (Jun 12 2018 at 16:04)</a>:</h4>
<p>One way to see the difference is in the proof: A tactic that does proofs by meta-induction produces proofs that get longer as the theorem gets harder to prove, but a proof by reflection is relatively short, with the generated proof being proportional to the <em>statement</em> in length</p>

<a name="127960916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960916" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960916">Mario Carneiro (Jun 12 2018 at 16:05)</a>:</h4>
<p>Proofs by reflection are characterized by a "heavy" <code>rfl</code> proof somewhere in the middle</p>

<a name="127960934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960934" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960934">Mario Carneiro (Jun 12 2018 at 16:05)</a>:</h4>
<p><code>ring</code> produces no heavy steps, every single theorem applied exactly matches the type it should have</p>

<a name="127960981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127960981" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127960981">Mario Carneiro (Jun 12 2018 at 16:06)</a>:</h4>
<p>so the kernel never has to do any definitional reduction</p>

<a name="127961459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127961459" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127961459">Kevin Buzzard (Jun 12 2018 at 16:16)</a>:</h4>
<p>This is all very instructive and quite different from the PIL stuff which, inevitably,  is skewed towards CS applications</p>

<a name="127964820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127964820" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127964820">Mario Carneiro (Jun 12 2018 at 17:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Here's a toy version of <code>ring</code> that works using computational reflection:</p>
<div class="codehilite"><pre><span></span>import tactic.basic data.num.lemmas

namespace ring_tac
open tactic

@[derive has_reflect]
inductive ring_expr : Type
| add : ring_expr → ring_expr → ring_expr
| mul : ring_expr → ring_expr → ring_expr
| const : znum → ring_expr
| X : ring_expr

meta def reflect_expr (X : expr) : expr → option ring_expr
| `(%%e₁ + %%e₂) := do
  p₁ ← reflect_expr e₁,
  p₂ ← reflect_expr e₂,
  return (ring_expr.add p₁ p₂)
| `(%%e₁ * %%e₂) := do
  p₁ ← reflect_expr e₁,
  p₂ ← reflect_expr e₂,
  return (ring_expr.mul p₁ p₂)
| e := if e = X then return ring_expr.X else
  do n ← expr.to_int e,
     return (ring_expr.const (znum.of_int&#39; n))

def poly := list znum

def poly.add : poly → poly → poly := λ _ _, []
def poly.mul : poly → poly → poly := λ _ _, []
def poly.const : znum → poly := sorry
def poly.X : poly := sorry

def to_poly : ring_expr → poly
| (ring_expr.add e₁ e₂) := (to_poly e₁).add (to_poly e₂)
| (ring_expr.mul e₁ e₂) := (to_poly e₁).mul (to_poly e₂)
| (ring_expr.const z) := poly.const z
| ring_expr.X := poly.X

def poly.eval {α} [comm_ring α] (X : α) : poly → α
| [] := 0
| (n::l) := n + X * poly.eval l

@[simp] theorem poly.eval_add {α} [comm_ring α] (X : α) : ∀ p₁ p₂ : poly,
  (p₁.add p₂).eval X = p₁.eval X + p₂.eval X := sorry

@[simp] theorem poly.eval_mul {α} [comm_ring α] (X : α) : ∀ p₁ p₂ : poly,
  (p₁.mul p₂).eval X = p₁.eval X * p₂.eval X := sorry

@[simp] theorem poly.eval_const {α} [comm_ring α] (X : α) : ∀ n : znum,
  (poly.const n).eval X = n := sorry

@[simp] theorem poly.eval_X {α} [comm_ring α] (X : α) : poly.X.eval X = X := sorry

def ring_expr.eval {α} [comm_ring α] (X : α) : ring_expr → α
| (ring_expr.add e₁ e₂) := e₁.eval + e₂.eval
| (ring_expr.mul e₁ e₂) := e₁.eval * e₂.eval
| (ring_expr.const z) := z
| ring_expr.X := X

theorem to_poly_eval {α} [comm_ring α] (X : α) (e) : (to_poly e).eval X = e.eval X :=
by induction e; simp [to_poly, ring_expr.eval, *]

theorem main_thm {α} [comm_ring α] (X : α) (e₁ e₂) {x₁ x₂}
  (H : to_poly e₁ = to_poly e₂) (R1 : e₁.eval X = x₁) (R2 : e₂.eval X = x₂) : x₁ = x₂ :=
by rw [← R1, ← R2, ← to_poly_eval, H, to_poly_eval]

meta def ring_tac (X : pexpr) : tactic unit := do
  X ← to_expr X,
  `(%%x₁ = %%x₂) ← target,
  r₁ ← reflect_expr X x₁,
  r₂ ← reflect_expr X x₂,
  let e₁ : expr := reflect r₁,
  let e₂ : expr := reflect r₂,
  `[refine main_thm %%X %%e₁ %%e₂ rfl _ _],
  all_goals `[simp only [ring_expr.eval,
    znum.cast_pos, znum.cast_neg, znum.cast_zero&#39;,
    pos_num.cast_bit0, pos_num.cast_bit1,
    pos_num.cast_one&#39;]]

example (x : ℤ) : (x + 1) * (x + 1) = x*x+2*x+1 :=
by do ring_tac ```(x)

end ring_tac
</pre></div>

<a name="127964879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127964879" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127964879">Mario Carneiro (Jun 12 2018 at 17:34)</a>:</h4>
<p>I have left the exercise of defining <code>poly.add</code>, <code>poly.mul</code>, <code>poly.const</code> and <code>poly.X</code>, and proving correctness of the functions in the <code>eval_*</code> theorems (all non-meta), to you.</p>

<a name="127964910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127964910" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127964910">Mario Carneiro (Jun 12 2018 at 17:35)</a>:</h4>
<p>Here the "heavy <code>rfl</code>" step is the <code>rfl</code> proof in <code>main_thm</code></p>

<a name="127964970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127964970" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127964970">Mario Carneiro (Jun 12 2018 at 17:36)</a>:</h4>
<p>you will need the mathlib update that just appeared</p>

<a name="127971021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127971021" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127971021">Kevin Buzzard (Jun 12 2018 at 19:47)</a>:</h4>
<p>wooah many thanks Mario!</p>

<a name="127972171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127972171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127972171">Kevin Buzzard (Jun 12 2018 at 20:11)</a>:</h4>
<p><code>example (a b : int) : (a+b)^11=a^11 + 11*b*a^10 + 55*b^2*a^9 + 165*b^3*a^8 + 330*b^4*a^7 + 462*b^5*a^6 + 462*b^6*a^5 + 330*b^7*a^4 + 165*b^8*a^3 + 55*b^9*a^2 + 11*b^10*a + b^11:= by ring</code></p>

<a name="127972173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127972173" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127972173">Kevin Buzzard (Jun 12 2018 at 20:11)</a>:</h4>
<p>but 12 times out :-)</p>

<a name="127972177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127972177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127972177">Kevin Buzzard (Jun 12 2018 at 20:11)</a>:</h4>
<p>[this is of course the official ring, not the one above]</p>

<a name="127972228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127972228" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127972228">Kevin Buzzard (Jun 12 2018 at 20:12)</a>:</h4>
<p><code>example (a b : int) : (a+b)^12=a^12 + 12*b*a^11 + 66*b^2*a^10 + 220*b^3*a^9 + 495*b^4*a^8 + 792*b^5*a^7 + 924*b^6*a^6 + 792*b^7*a^5 + 495*b^8*a^4 + 220*b^9*a^3 + 66*b^10*a^2 + 12*b^11*a + b^12:= by ring -- deterministic timeout</code></p>

<a name="127973037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127973037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127973037">Johan Commelin (Jun 12 2018 at 20:31)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> So you need to teach <code>ring</code> about Chris's binomial theorem!</p>

<a name="127977028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127977028" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127977028">Kevin Buzzard (Jun 12 2018 at 22:07)</a>:</h4>
<p>Well, I'm not sure I would use Lean to check the binomial theorem for n=12 :-)</p>

<a name="127977076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127977076" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127977076">Kevin Buzzard (Jun 12 2018 at 22:08)</a>:</h4>
<p>Ironically I fired up pari-gp and computed (a+b)^12 in a gazillionth of a second and then cut and pasted the output into Lean in order to see if it could do something which I already had a much better tool for.</p>

<a name="127979328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979328" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979328">Kevin Buzzard (Jun 12 2018 at 23:06)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">basic</span> <span class="n">data</span><span class="bp">.</span><span class="n">num</span><span class="bp">.</span><span class="n">lemmas</span> <span class="n">analysis</span><span class="bp">.</span><span class="n">real</span>

<span class="kn">namespace</span> <span class="n">ring_tac</span>
<span class="kn">open</span> <span class="n">tactic</span>

<span class="c1">-- why this line?</span>
<span class="bp">@</span><span class="o">[</span><span class="n">derive</span> <span class="n">has_reflect</span><span class="o">]</span>
<span class="kn">inductive</span> <span class="n">ring_expr</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="bp">|</span> <span class="n">add</span> <span class="o">:</span> <span class="n">ring_expr</span> <span class="bp">→</span> <span class="n">ring_expr</span> <span class="bp">→</span> <span class="n">ring_expr</span>
<span class="bp">|</span> <span class="n">mul</span> <span class="o">:</span> <span class="n">ring_expr</span> <span class="bp">→</span> <span class="n">ring_expr</span> <span class="bp">→</span> <span class="n">ring_expr</span>
<span class="bp">|</span> <span class="n">const</span> <span class="o">:</span> <span class="n">znum</span> <span class="bp">→</span> <span class="n">ring_expr</span>
<span class="bp">|</span> <span class="n">X</span> <span class="o">:</span> <span class="n">ring_expr</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">reflect_expr</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">expr</span><span class="o">)</span> <span class="o">:</span> <span class="n">expr</span> <span class="bp">→</span> <span class="n">option</span> <span class="n">ring_expr</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">e₁</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">e₂</span><span class="o">)</span> <span class="o">:=</span> <span class="n">do</span>
  <span class="n">p₁</span> <span class="err">←</span> <span class="n">reflect_expr</span> <span class="n">e₁</span><span class="o">,</span>
  <span class="n">p₂</span> <span class="err">←</span> <span class="n">reflect_expr</span> <span class="n">e₂</span><span class="o">,</span>
  <span class="n">return</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">add</span> <span class="n">p₁</span> <span class="n">p₂</span><span class="o">)</span>
<span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">e₁</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">e₂</span><span class="o">)</span> <span class="o">:=</span> <span class="n">do</span>
  <span class="n">p₁</span> <span class="err">←</span> <span class="n">reflect_expr</span> <span class="n">e₁</span><span class="o">,</span>
  <span class="n">p₂</span> <span class="err">←</span> <span class="n">reflect_expr</span> <span class="n">e₂</span><span class="o">,</span>
  <span class="n">return</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">mul</span> <span class="n">p₁</span> <span class="n">p₂</span><span class="o">)</span>
<span class="bp">|</span> <span class="n">e</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">e</span> <span class="bp">=</span> <span class="n">X</span> <span class="k">then</span> <span class="n">return</span> <span class="n">ring_expr</span><span class="bp">.</span><span class="n">X</span> <span class="k">else</span>
  <span class="n">do</span> <span class="n">n</span> <span class="err">←</span> <span class="n">expr</span><span class="bp">.</span><span class="n">to_int</span> <span class="n">e</span><span class="o">,</span>
     <span class="n">return</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">const</span> <span class="o">(</span><span class="n">znum</span><span class="bp">.</span><span class="n">of_int&#39;</span> <span class="n">n</span><span class="o">))</span>

<span class="c1">-- mathlib/data/num has znum and stuff like znum.of_int&#39; (see above)</span>
<span class="n">def</span> <span class="n">poly</span> <span class="o">:=</span> <span class="n">list</span> <span class="n">znum</span>
<span class="c1">-- but why use it?</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">add</span> <span class="o">:</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">poly</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="n">g</span> <span class="o">:=</span> <span class="n">g</span>
<span class="bp">|</span> <span class="n">f</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">f</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="bp">::</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="bp">::</span> <span class="n">g&#39;</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">::</span> <span class="n">poly</span><span class="bp">.</span><span class="n">add</span> <span class="n">f&#39;</span> <span class="n">g&#39;</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">poly</span><span class="bp">.</span><span class="n">zero_add</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">poly</span><span class="o">)</span> <span class="o">:</span> <span class="n">poly</span><span class="bp">.</span><span class="n">add</span> <span class="o">[]</span> <span class="n">p</span> <span class="bp">=</span> <span class="n">p</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">induction</span> <span class="n">p</span><span class="bp">;</span><span class="n">refl</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">smul</span> <span class="o">:</span> <span class="n">znum</span> <span class="bp">→</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">poly</span>
<span class="bp">|</span> <span class="bp">_</span> <span class="o">[]</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="n">z</span> <span class="o">(</span><span class="n">a</span> <span class="bp">::</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">z</span> <span class="bp">*</span> <span class="n">a</span><span class="o">)</span> <span class="bp">::</span> <span class="n">poly</span><span class="bp">.</span><span class="n">smul</span> <span class="n">z</span> <span class="n">f&#39;</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">mul</span> <span class="o">:</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">poly</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="bp">_</span> <span class="o">:=</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">a</span> <span class="bp">::</span> <span class="n">f&#39;</span><span class="o">)</span> <span class="n">g</span> <span class="o">:=</span> <span class="n">poly</span><span class="bp">.</span><span class="n">add</span> <span class="o">(</span><span class="n">poly</span><span class="bp">.</span><span class="n">smul</span> <span class="n">a</span> <span class="n">g</span><span class="o">)</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">::</span> <span class="o">(</span><span class="n">poly</span><span class="bp">.</span><span class="n">mul</span> <span class="n">f&#39;</span> <span class="n">g</span><span class="o">))</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">const</span> <span class="o">:</span> <span class="n">znum</span> <span class="bp">→</span> <span class="n">poly</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">z</span><span class="o">,</span> <span class="o">[</span><span class="n">z</span><span class="o">]</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">X</span> <span class="o">:</span> <span class="n">poly</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span>

<span class="n">def</span> <span class="n">to_poly</span> <span class="o">:</span> <span class="n">ring_expr</span> <span class="bp">→</span> <span class="n">poly</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">add</span> <span class="n">e₁</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e₁</span><span class="o">)</span><span class="bp">.</span><span class="n">add</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e₂</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">mul</span> <span class="n">e₁</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e₁</span><span class="o">)</span><span class="bp">.</span><span class="n">mul</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e₂</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">z</span><span class="o">)</span> <span class="o">:=</span> <span class="n">poly</span><span class="bp">.</span><span class="n">const</span> <span class="n">z</span>
<span class="bp">|</span> <span class="n">ring_expr</span><span class="bp">.</span><span class="n">X</span> <span class="o">:=</span> <span class="n">poly</span><span class="bp">.</span><span class="n">X</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">n</span><span class="bp">::</span><span class="n">l</span><span class="o">)</span> <span class="o">:=</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">X</span> <span class="bp">*</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">l</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_zero</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">[]</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_add</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">p₁</span> <span class="n">p₂</span> <span class="o">:</span> <span class="n">poly</span><span class="o">,</span>
  <span class="o">(</span><span class="n">p₁</span><span class="bp">.</span><span class="n">add</span> <span class="n">p₂</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">p₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">+</span> <span class="n">p₂</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">p₁</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">p₁</span> <span class="k">with</span> <span class="n">h₁</span> <span class="n">t₁</span> <span class="n">H</span><span class="o">,</span>
    <span class="c1">-- base case</span>
    <span class="n">intros</span><span class="o">,</span><span class="n">simp</span> <span class="o">[</span><span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">],</span>
  <span class="c1">-- inductive step</span>
  <span class="n">intro</span> <span class="n">p₂</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">p₂</span> <span class="k">with</span> <span class="n">h₂</span> <span class="n">t₂</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">poly</span><span class="bp">.</span><span class="n">add</span><span class="o">],</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">poly</span><span class="bp">.</span><span class="n">add</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="n">H</span> <span class="n">t₂</span><span class="o">),</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">]</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_mul_zero</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">poly</span><span class="o">)</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">(</span><span class="n">poly</span><span class="bp">.</span><span class="n">mul</span> <span class="n">f</span> <span class="o">[])</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">f</span> <span class="k">with</span> <span class="n">h</span> <span class="n">t</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">refl</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">mul</span> <span class="n">poly</span><span class="bp">.</span><span class="n">smul</span> <span class="n">poly</span><span class="bp">.</span><span class="n">add</span> <span class="n">poly</span><span class="bp">.</span><span class="n">mul</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span><span class="n">simp</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_smul</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">z</span> <span class="o">:</span> <span class="n">znum</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">poly</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">(</span><span class="n">poly</span><span class="bp">.</span><span class="n">smul</span> <span class="n">z</span> <span class="n">f</span><span class="o">)</span> <span class="bp">=</span> <span class="n">z</span> <span class="bp">*</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="n">f</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">induction</span> <span class="n">f</span> <span class="k">with</span> <span class="n">h</span> <span class="n">t</span> <span class="n">H</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="n">poly</span><span class="bp">.</span><span class="n">smul</span><span class="o">,</span><span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span><span class="n">mul_zero</span><span class="o">],</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">smul</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">simp</span> <span class="o">[</span><span class="n">mul_add</span><span class="o">,</span><span class="n">znum</span><span class="bp">.</span><span class="n">cast_mul</span><span class="o">,</span><span class="n">mul_assoc</span><span class="o">,</span><span class="n">mul_comm</span><span class="o">]</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_mul</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">p₁</span> <span class="n">p₂</span> <span class="o">:</span> <span class="n">poly</span><span class="o">,</span>
  <span class="o">(</span><span class="n">p₁</span><span class="bp">.</span><span class="n">mul</span> <span class="n">p₂</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">p₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">*</span> <span class="n">p₂</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">p₁</span><span class="o">,</span><span class="n">induction</span> <span class="n">p₁</span> <span class="k">with</span> <span class="n">h₁</span> <span class="n">t₁</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">poly</span><span class="bp">.</span><span class="n">mul</span><span class="o">],</span>
  <span class="n">intro</span> <span class="n">p₂</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">mul</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_add</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">H</span> <span class="n">p₂</span><span class="o">,</span><span class="n">znum</span><span class="bp">.</span><span class="n">cast_zero</span><span class="o">,</span><span class="n">zero_add</span><span class="o">,</span><span class="n">add_mul</span><span class="o">,</span><span class="n">poly</span><span class="bp">.</span><span class="n">eval_smul</span><span class="o">,</span><span class="n">mul_assoc</span><span class="o">]</span>
<span class="kn">end</span>


<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_const</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="o">:</span> <span class="n">znum</span><span class="o">,</span>
  <span class="o">(</span><span class="n">poly</span><span class="bp">.</span><span class="n">const</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">n</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">const</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span><span class="n">simp</span>
<span class="kn">end</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">theorem</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_X</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">poly</span><span class="bp">.</span><span class="n">X</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">X</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span><span class="n">simp</span>
<span class="kn">end</span>


<span class="n">def</span> <span class="n">ring_expr</span><span class="bp">.</span><span class="kn">eval</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">ring_expr</span> <span class="bp">→</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">add</span> <span class="n">e₁</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">:=</span> <span class="n">e₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="bp">+</span> <span class="n">e₂</span><span class="bp">.</span><span class="kn">eval</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">mul</span> <span class="n">e₁</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">:=</span> <span class="n">e₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="bp">*</span> <span class="n">e₂</span><span class="bp">.</span><span class="kn">eval</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">ring_expr</span><span class="bp">.</span><span class="n">const</span> <span class="n">z</span><span class="o">)</span> <span class="o">:=</span> <span class="n">z</span>
<span class="bp">|</span> <span class="n">ring_expr</span><span class="bp">.</span><span class="n">X</span> <span class="o">:=</span> <span class="n">X</span>

<span class="kn">theorem</span> <span class="n">to_poly_eval</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">e</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">induction</span> <span class="n">e</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">to_poly</span><span class="o">,</span> <span class="n">ring_expr</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span> <span class="bp">*</span><span class="o">]</span>

<span class="kn">theorem</span> <span class="n">main_thm</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">e₁</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">{</span><span class="n">x₁</span> <span class="n">x₂</span><span class="o">}</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">to_poly</span> <span class="n">e₁</span> <span class="bp">=</span> <span class="n">to_poly</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">(</span><span class="n">R1</span> <span class="o">:</span> <span class="n">e₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">x₁</span><span class="o">)</span> <span class="o">(</span><span class="n">R2</span> <span class="o">:</span> <span class="n">e₂</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">x₂</span><span class="o">)</span> <span class="o">:</span> <span class="n">x₁</span> <span class="bp">=</span> <span class="n">x₂</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">R1</span><span class="o">,</span> <span class="err">←</span> <span class="n">R2</span><span class="o">,</span> <span class="err">←</span> <span class="n">to_poly_eval</span><span class="o">,</span> <span class="n">H</span><span class="o">,</span> <span class="n">to_poly_eval</span><span class="o">]</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">ring_tac</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">pexpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span> <span class="n">do</span>
  <span class="n">X</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="n">X</span><span class="o">,</span>
  <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">x₁</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">x₂</span><span class="o">)</span> <span class="err">←</span> <span class="n">target</span><span class="o">,</span>
  <span class="n">r₁</span> <span class="err">←</span> <span class="n">reflect_expr</span> <span class="n">X</span> <span class="n">x₁</span><span class="o">,</span>
  <span class="n">r₂</span> <span class="err">←</span> <span class="n">reflect_expr</span> <span class="n">X</span> <span class="n">x₂</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">e₁</span> <span class="o">:</span> <span class="n">expr</span> <span class="o">:=</span> <span class="n">reflect</span> <span class="n">r₁</span><span class="o">,</span>
  <span class="k">let</span> <span class="n">e₂</span> <span class="o">:</span> <span class="n">expr</span> <span class="o">:=</span> <span class="n">reflect</span> <span class="n">r₂</span><span class="o">,</span>
  <span class="bp">`</span><span class="o">[</span><span class="n">refine</span> <span class="n">main_thm</span> <span class="err">%%</span><span class="n">X</span> <span class="err">%%</span><span class="n">e₁</span> <span class="err">%%</span><span class="n">e₂</span> <span class="n">rfl</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">],</span>
  <span class="n">all_goals</span> <span class="bp">`</span><span class="o">[</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">ring_expr</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
    <span class="n">znum</span><span class="bp">.</span><span class="n">cast_pos</span><span class="o">,</span> <span class="n">znum</span><span class="bp">.</span><span class="n">cast_neg</span><span class="o">,</span> <span class="n">znum</span><span class="bp">.</span><span class="n">cast_zero&#39;</span><span class="o">,</span>
    <span class="n">pos_num</span><span class="bp">.</span><span class="n">cast_bit0</span><span class="o">,</span> <span class="n">pos_num</span><span class="bp">.</span><span class="n">cast_bit1</span><span class="o">,</span>
    <span class="n">pos_num</span><span class="bp">.</span><span class="n">cast_one&#39;</span><span class="o">]]</span>

<span class="kn">theorem</span> <span class="n">X</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="mi">2</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">do</span> <span class="n">ring_tac</span> <span class="bp">```</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>

<span class="bp">#</span><span class="kn">print</span> <span class="n">axioms</span> <span class="n">X</span>

<span class="kn">end</span> <span class="n">ring_tac</span>
</pre></div>

<a name="127979329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979329" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979329">Kevin Buzzard (Jun 12 2018 at 23:06)</a>:</h4>
<p>Did my homework</p>

<a name="127979333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979333">Kevin Buzzard (Jun 12 2018 at 23:06)</a>:</h4>
<p>I feel like an UG again</p>

<a name="127979394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979394">Kevin Buzzard (Jun 12 2018 at 23:08)</a>:</h4>
<p>Notes: I had to introduce poly.smul (scalar multiplication of poly by znum) for definition of multiplication. I really tried to make simp do most of the work in general but I still had to do a lot of unfolding before I could get it going.</p>

<a name="127979395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979395" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979395">Kenny Lau (Jun 12 2018 at 23:08)</a>:</h4>
<p>did you just write a tactic?</p>

<a name="127979401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979401">Kevin Buzzard (Jun 12 2018 at 23:08)</a>:</h4>
<p>Not really</p>

<a name="127979405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979405" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979405">Kevin Buzzard (Jun 12 2018 at 23:08)</a>:</h4>
<p>in the sense that no code I wrote started with <code>meta</code></p>

<a name="127979408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979408">Kevin Buzzard (Jun 12 2018 at 23:09)</a>:</h4>
<p>but check it out</p>

<a name="127979412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979412" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979412">Kevin Buzzard (Jun 12 2018 at 23:09)</a>:</h4>
<p>barely any code at all has <code>meta</code></p>

<a name="127979416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979416">Kevin Buzzard (Jun 12 2018 at 23:09)</a>:</h4>
<p>Just <code>reflect_expr</code> at the very top, and <code>ring_tac</code> at the very bottom. Mario wrote both of those</p>

<a name="127979480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979480">Kevin Buzzard (Jun 12 2018 at 23:10)</a>:</h4>
<p>Kenny here's the strat: to prove that for d : int we have (d+1)^2=d^2+2*d+1 we first prove that in a polynomial ring we have (X+1)^2=X^2+2X+1 and then deduce</p>

<a name="127979481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979481" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979481">Kevin Buzzard (Jun 12 2018 at 23:10)</a>:</h4>
<p>The problem is that if Lean just sees (d+1)^2 it can't create (X+1)^2</p>

<a name="127979489"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979489" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979489">Kevin Buzzard (Jun 12 2018 at 23:11)</a>:</h4>
<p>so this part you have to do in meta-land</p>

<a name="127979491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979491" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979491">Kevin Buzzard (Jun 12 2018 at 23:11)</a>:</h4>
<p>but it's only this part</p>

<a name="127979496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979496">Kevin Buzzard (Jun 12 2018 at 23:11)</a>:</h4>
<p>unsurprisingly, this is what <code>reflect_expr</code> does</p>

<a name="127979537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979537" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979537">Kevin Buzzard (Jun 12 2018 at 23:12)</a>:</h4>
<p>So there's a basic one-variable ring tactic with a very small amount of meta indeed, and the meta is really not hard to comprehend. I mean, it might be hard to write, but it's not at all hard to read.</p>

<a name="127979539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979539" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979539">Kevin Buzzard (Jun 12 2018 at 23:12)</a>:</h4>
<p>I'll write a blog post explaining it but now it's bed time. Once again many thanks Mario.</p>

<a name="127979604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/127979604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#127979604">Kevin Buzzard (Jun 12 2018 at 23:14)</a>:</h4>
<p>Just to be clear <span class="user-mention" data-user-id="110064">@Kenny Lau</span> the code I posted does seem to be a fully working baby <code>ring</code></p>

<a name="128000038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000038" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000038">Kevin Buzzard (Jun 13 2018 at 09:55)</a>:</h4>
<p>Actually it doesn't work in all cases, because there is currently no "canonical form" lemma. The polynomials <code>[1]</code> and <code>[1,0]</code> (=0*x+1) are different.</p>

<a name="128000106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000106" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000106">Kevin Buzzard (Jun 13 2018 at 09:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Here are the three questions I have about this project, which basically came up when trying to write a blog post. The first two are trivial for you: what is <code>@[derive has_reflect]</code> and why <code>znum</code> rather than <code>int</code>?</p>

<a name="128000111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000111" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000111">Kevin Buzzard (Jun 13 2018 at 09:57)</a>:</h4>
<p>The third is a bit more annoying. Because there is no algorithm to put polynomials (= lists of znums) into "canonical form", <code>example (x : ℤ) : (x + 1) + ((-1)*x + 1) = 2 := by do ring_tac ```(x) </code> fails</p>

<a name="128000156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000156">Kevin Buzzard (Jun 13 2018 at 09:58)</a>:</h4>
<p>I think this is because the polynomials <code>[2,0]</code> and <code>[2]</code> are considered distinct.</p>

<a name="128000158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000158">Kevin Buzzard (Jun 13 2018 at 09:58)</a>:</h4>
<p>Aah, I think I can fix this.</p>

<a name="128000161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000161" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000161">Kevin Buzzard (Jun 13 2018 at 09:58)</a>:</h4>
<p>I think I write some "canonical_form" function</p>

<a name="128000162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000162">Kevin Buzzard (Jun 13 2018 at 09:58)</a>:</h4>
<p>(not in meta land)</p>

<a name="128000171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000171">Kevin Buzzard (Jun 13 2018 at 09:59)</a>:</h4>
<p>and redefine add so that it puts the polynomial into canonical form afterwards.</p>

<a name="128000180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128000180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128000180">Kevin Buzzard (Jun 13 2018 at 09:59)</a>:</h4>
<p>yeah yeah OK I think I can do this one.</p>

<a name="128001631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001631" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001631">Mario Carneiro (Jun 13 2018 at 10:36)</a>:</h4>
<blockquote>
<p>Why <code>@[derive has_reflect]</code></p>
</blockquote>
<p>This one is easy: otherwise you don't have a <code>reflect</code> instance for <code>ring_expr</code>. This function is used explicitly in <code>ring_tac</code>; the idea is that if <code>A</code> is a reflectable type then <code>reflect (a : A)</code> is an expr that denotes the same value as <code>a</code></p>

<a name="128001637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001637" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001637">Mario Carneiro (Jun 13 2018 at 10:36)</a>:</h4>
<p>so for example <code>list</code> has a reflect that just turns each cons into a <code>expr.app ``list.cons a l</code></p>

<a name="128001644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001644" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001644">Mario Carneiro (Jun 13 2018 at 10:37)</a>:</h4>
<p>and <code>nat</code> has a reflect that produces <code>bit0</code> and <code>bit1</code> expressions (which when printed appear as the number being denoted)</p>

<a name="128001686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001686" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001686">Mario Carneiro (Jun 13 2018 at 10:38)</a>:</h4>
<p>But not all types have a reflect; in particular quotients and other things that make different expressions equal according to lean don't have a reflect, since you would have to open up the quotient to get the element to print</p>

<a name="128001696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001696" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001696">Mario Carneiro (Jun 13 2018 at 10:39)</a>:</h4>
<p>In this case it is needed because <code>reflect_expr</code> produces a <code>ring_expr</code>, not an <code>expr</code> denoting a <code>ring_expr</code></p>

<a name="128001746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001746" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001746">Mario Carneiro (Jun 13 2018 at 10:40)</a>:</h4>
<p>I think in this case you could skip the extra step and just produce an expr directly, but that would be less structured and more meta</p>

<a name="128001856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001856" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001856">Mario Carneiro (Jun 13 2018 at 10:44)</a>:</h4>
<blockquote>
<p>Why <code>znum</code></p>
</blockquote>
<p>This one is more subtle, and actually I knew you would ask this question and I used it in part to prompt the question. You can view this as an efficiency move, but when there is an exponential performance gap I think it is close enough to essential to teach directly. Whenever you use proof by reflection, it is absolutely essential that you do everything you can to make the computation simple and direct, because you will be working with a fairly heavy handicap. A big no-no is using <code>nat</code> and <code>int</code> anywhere in your computation, because (as Seul has discovered) this works in unary and there is nothing you can do to prevent this when computing in the kernel</p>

<a name="128001891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001891" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001891">Mario Carneiro (Jun 13 2018 at 10:45)</a>:</h4>
<p>This is in fact the raison d'etre for the <code>num</code> type - it allows for performing <em>kernel computations</em> on naturals and integers, with enough lemmas to relate them back to the more traditional <code>nat</code> type.</p>

<a name="128001947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128001947" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128001947">Mario Carneiro (Jun 13 2018 at 10:47)</a>:</h4>
<p>It's a bit of a delicate move, since <code>int</code> and <code>nat</code> are in fact the more efficient ones in VM computations, so you want to convert from <code>int</code> to <code>znum</code> when storing the numbers inside the kernel data structure (<code>ring_expr</code>), but not before</p>

<a name="128002085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128002085" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128002085">Mario Carneiro (Jun 13 2018 at 10:51)</a>:</h4>
<blockquote>
<p>The third is a bit more annoying. Because there is no algorithm to put polynomials (= lists of znums) into "canonical form", example (x : ℤ) : (x + 1) + ((-1)*x + 1) = 2 := by do ring_tac ```(x) fails</p>
</blockquote>
<p>I noticed this as well with your definition of <code>poly.add</code>. But there is actually another solution, which might be easier than applying a function that strips the high zeros after every operation. That is, define</p>
<div class="codehilite"><pre><span></span>def poly.is_eq : poly -&gt; poly -&gt; bool := sorry
</pre></div>


<p>so that trailing zeros are ignored in the equality test, and then replace <code>to_poly e1 = to_poly e2</code> with <code>poly.is_eq (to_poly e1) (to_poly e2)</code> in the <code>main_thm</code> and prove it with this (weaker) assumption</p>

<a name="128005278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128005278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128005278">Andrew Ashworth (Jun 13 2018 at 12:19)</a>:</h4>
<p>So, if I defined a new poly type quotiented with this equality relation, I'd have to explicitly define my denotation function? That doesn't sound so bad, I think... or would the kernel get stuck trying to reduce it?</p>

<a name="128005285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128005285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128005285">Andrew Ashworth (Jun 13 2018 at 12:19)</a>:</h4>
<p>maybe I should just try it out with the helpful reflection template that's just been posted :)</p>

<a name="128015942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128015942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128015942">Kevin Buzzard (Jun 13 2018 at 16:03)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="o">:</span> <span class="n">list</span> <span class="n">znum</span> <span class="bp">-&gt;</span> <span class="n">list</span> <span class="n">znum</span> <span class="bp">-&gt;</span> <span class="n">bool</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">[]</span> <span class="o">:=</span> <span class="n">tt</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="o">(</span><span class="n">h₂</span> <span class="bp">::</span> <span class="n">t₂</span><span class="o">)</span> <span class="o">:=</span> <span class="k">if</span> <span class="o">(</span><span class="n">h₂</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="k">then</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="o">[]</span> <span class="n">t₂</span> <span class="k">else</span> <span class="n">ff</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">h₁</span> <span class="bp">::</span> <span class="n">t₁</span><span class="o">)</span> <span class="o">[]</span> <span class="o">:=</span> <span class="k">if</span> <span class="o">(</span><span class="n">h₁</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="k">then</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="n">t₁</span> <span class="o">[]</span> <span class="k">else</span> <span class="n">ff</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">h₁</span> <span class="bp">::</span> <span class="n">t₁</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="bp">::</span> <span class="n">t₂</span><span class="o">)</span> <span class="o">:=</span> <span class="k">if</span> <span class="o">(</span><span class="n">h₁</span> <span class="bp">=</span> <span class="n">h₂</span><span class="o">)</span> <span class="k">then</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="n">t₁</span> <span class="n">t₂</span> <span class="k">else</span> <span class="n">ff</span>

<span class="n">def</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="o">:</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">poly</span> <span class="bp">→</span> <span class="n">bool</span> <span class="o">:=</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span>
</pre></div>

<a name="128015985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128015985" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128015985">Kevin Buzzard (Jun 13 2018 at 16:04)</a>:</h4>
<p>[recursion on poly doesn't seem to work]</p>

<a name="128015998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128015998" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128015998">Kevin Buzzard (Jun 13 2018 at 16:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">poly</span><span class="bp">.</span><span class="n">eval_is_eq</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">{</span><span class="n">p₁</span> <span class="n">p₂</span> <span class="o">:</span> <span class="n">poly</span><span class="o">}</span> <span class="o">:</span>
  <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="n">p₁</span> <span class="n">p₂</span> <span class="bp">→</span> <span class="n">p₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">p₂</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">revert</span> <span class="n">p₂</span><span class="o">,</span>
  <span class="n">induction</span> <span class="n">p₁</span> <span class="k">with</span> <span class="n">h₁</span> <span class="n">t₁</span> <span class="n">H₁</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">p₂</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">induction</span> <span class="n">p₂</span> <span class="k">with</span> <span class="n">h₁</span> <span class="n">t₁</span> <span class="n">H₂</span><span class="o">,</span><span class="n">refl</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
    <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">split_ifs</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span><span class="n">swap</span><span class="o">,</span><span class="n">cases</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span><span class="err">←</span><span class="n">H₂</span> <span class="n">H</span><span class="o">],</span>
    <span class="n">simp</span><span class="o">,</span>
  <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">p₂</span> <span class="n">H</span><span class="o">,</span>
    <span class="n">induction</span> <span class="n">p₂</span> <span class="k">with</span> <span class="n">h₂</span> <span class="n">t₂</span> <span class="n">H₂</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
      <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">split_ifs</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span><span class="n">swap</span><span class="o">,</span><span class="n">cases</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span><span class="n">H₁</span> <span class="n">H</span><span class="o">],</span>
      <span class="n">simp</span>
    <span class="o">},</span>
    <span class="o">{</span> <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="kn">eval</span><span class="o">,</span>
      <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq_aux</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">split_ifs</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span><span class="n">swap</span><span class="o">,</span><span class="n">cases</span> <span class="n">H</span><span class="o">,</span>
      <span class="n">unfold</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="n">at</span> <span class="n">H₂</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="n">h</span><span class="o">,</span><span class="n">H₁</span> <span class="n">H</span><span class="o">]</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></div>

<a name="128016003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128016003" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128016003">Kevin Buzzard (Jun 13 2018 at 16:04)</a>:</h4>
<p>and then all we need is</p>

<a name="128016019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128016019" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128016019">Kevin Buzzard (Jun 13 2018 at 16:05)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">main_thm</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">X</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">e₁</span> <span class="n">e₂</span><span class="o">)</span> <span class="o">{</span><span class="n">x₁</span> <span class="n">x₂</span><span class="o">}</span>
  <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">poly</span><span class="bp">.</span><span class="n">is_eq</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e₁</span><span class="o">)</span> <span class="o">(</span><span class="n">to_poly</span> <span class="n">e₂</span><span class="o">))</span> <span class="o">(</span><span class="n">R1</span> <span class="o">:</span> <span class="n">e₁</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">x₁</span><span class="o">)</span> <span class="o">(</span><span class="n">R2</span> <span class="o">:</span> <span class="n">e₂</span><span class="bp">.</span><span class="kn">eval</span> <span class="n">X</span> <span class="bp">=</span> <span class="n">x₂</span><span class="o">)</span> <span class="o">:</span> <span class="n">x₁</span> <span class="bp">=</span> <span class="n">x₂</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">R1</span><span class="o">,</span> <span class="err">←</span> <span class="n">R2</span><span class="o">,</span> <span class="err">←</span> <span class="n">to_poly_eval</span><span class="o">,</span><span class="n">poly</span><span class="bp">.</span><span class="n">eval_is_eq</span> <span class="n">X</span> <span class="n">H</span><span class="o">,</span> <span class="n">to_poly_eval</span><span class="o">]</span>
</pre></div>

<a name="128016043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128016043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128016043">Kevin Buzzard (Jun 13 2018 at 16:05)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="n">x</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="mi">2</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="mi">1</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">do</span> <span class="n">ring_tac</span> <span class="bp">```</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">+</span> <span class="o">((</span><span class="bp">-</span><span class="mi">1</span><span class="o">)</span><span class="bp">*</span><span class="n">x</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">2</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">do</span> <span class="n">ring_tac</span> <span class="bp">```</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</pre></div>

<a name="128016051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128016051" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128016051">Kevin Buzzard (Jun 13 2018 at 16:05)</a>:</h4>
<p>they both work :-)</p>

<a name="128034425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128034425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128034425">Mario Carneiro (Jun 13 2018 at 22:56)</a>:</h4>
<p>I wouldn't recommend using a quotient, although it probably won't hurt</p>

<a name="128034426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128034426" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128034426">Mario Carneiro (Jun 13 2018 at 22:56)</a>:</h4>
<p>The VM can erase that stuff but the kernel has to deal with it all</p>

<a name="128034427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128034427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128034427">Mario Carneiro (Jun 13 2018 at 22:56)</a>:</h4>
<p>if you keep all the functions simple and nondependent, the kernel doesn't have to carry around all the proof garbage</p>

<a name="128034428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128034428" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128034428">Mario Carneiro (Jun 13 2018 at 22:56)</a>:</h4>
<p>for the reason of "working with a handicap" I mentioned</p>

<a name="128034990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128034990" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128034990">Mario Carneiro (Jun 13 2018 at 23:11)</a>:</h4>
<p>Your definition didn't work on <code>poly</code> because it uses well founded recursion, which is another kernel no-no (it has to unfold the well foundedness proofs)</p>

<a name="128034994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128034994" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128034994">Mario Carneiro (Jun 13 2018 at 23:11)</a>:</h4>
<p>Try this instead:</p>
<div class="codehilite"><pre><span></span>def poly.is_zero : poly → bool
| [] := tt
| (h :: t) := (h = 0) &amp;&amp; poly.is_zero t

def poly.is_eq : poly → poly → bool
| l₁ [] := poly.is_zero l₁
| [] l₂ := poly.is_zero l₂
| (h₁ :: t₁) (h₂ :: t₂) := if (h₁ = h₂) then poly.is_eq t₁ t₂ else ff
</pre></div>


<p>(sorry for all the proof obligations!)</p>

<a name="128035061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128035061" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128035061">Mario Carneiro (Jun 13 2018 at 23:13)</a>:</h4>
<p>(Alternatively, if you defined subtraction or an equivalent you could use only <code>is_zero</code> and define <code>is_eq</code> by <code>(p1 - p2).is_zero</code>)</p>

<a name="128050689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128050689" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128050689">Kevin Buzzard (Jun 14 2018 at 07:07)</a>:</h4>
<p>Why bool and not Prop?</p>

<a name="128050810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128050810" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128050810">Moses Schönfinkel (Jun 14 2018 at 07:11)</a>:</h4>
<p>He did it on purpose to prompt this question! ;)</p>

<a name="128054279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128054279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128054279">Kevin Buzzard (Jun 14 2018 at 08:52)</a>:</h4>
<p><a href="https://xenaproject.wordpress.com/2018/06/13/ab3/" target="_blank" title="https://xenaproject.wordpress.com/2018/06/13/ab3/">https://xenaproject.wordpress.com/2018/06/13/ab3/</a></p>

<a name="128054290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128054290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128054290">Kevin Buzzard (Jun 14 2018 at 08:53)</a>:</h4>
<p>Comments welcome. That's how some baby version of tactic.ring works, at least. And of course many thanks to Mario, without whom that little project would have taken far longer to complete.</p>

<a name="128054294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128054294" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128054294">Kevin Buzzard (Jun 14 2018 at 08:53)</a>:</h4>
<p>I know the post is mega-long but I am not sure I care.</p>

<a name="128054577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128054577" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128054577">Johan Commelin (Jun 14 2018 at 09:01)</a>:</h4>
<p>This is chapter 3 of your book?</p>

<a name="128059587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128059587" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128059587">Andrew Ashworth (Jun 14 2018 at 11:23)</a>:</h4>
<p>I read and enjoyed your blog post! My only comment is perhaps you might have a further reading section. It would be a good place to link <a href="http://adam.chlipala.net/cpdt/html/Reflection.html" target="_blank" title="http://adam.chlipala.net/cpdt/html/Reflection.html">http://adam.chlipala.net/cpdt/html/Reflection.html</a> and <a href="https://softwarefoundations.cis.upenn.edu/vfa-current/Decide.html#lab185" target="_blank" title="https://softwarefoundations.cis.upenn.edu/vfa-current/Decide.html#lab185">https://softwarefoundations.cis.upenn.edu/vfa-current/Decide.html#lab185</a> for people who are trying to seriously write a reflective tactic (although, unfortunately, you have to read Coq to understand what's going on... but I think at this stage of Lean's popularity, this is somewhat necessary regardless in the tactics game). Also, minor nitpick, but <code>znum</code> is only uber-efficient when it is used in <code>rfl</code> proofs, otherwise <code>int</code> has special fast support</p>

<a name="128067635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128067635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128067635">Kevin Buzzard (Jun 14 2018 at 14:31)</a>:</h4>
<p>Many thanks Andrew. I am not a computer scientist as I'm sure you know and I don't really know about references. I have looked, briefly, at both of the things you mention, but I have never really substantially engaged with them -- I tend to stop reading when things get "too CS" because they become less relevant to what I am trying to do in Lean. Thanks for the nitpick too.</p>

<a name="128067751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128067751" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128067751">Mario Carneiro (Jun 14 2018 at 14:33)</a>:</h4>
<blockquote>
<p>Why bool and not Prop?</p>
</blockquote>
<p>Because you can't compute with Props. You could get roughly the same behavior by using <code>decidable p</code> instead of <code>bool</code> (+ soundness proof), but since there are more dependency tricks there I suspect it's marginally slower than using bool (but not by any large margin).</p>

<a name="128067896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128067896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128067896">Mario Carneiro (Jun 14 2018 at 14:36)</a>:</h4>
<p>In this case, the bool definition functions both as the relation itself and its decidability proof. If you wanted to use decidable, then, it would be two definitions and a soundness proof</p>

<a name="128074464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/how%20does%20tactic.ring%20work%3F/near/128074464" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/36914howdoestacticringwork.html#128074464">Kevin Buzzard (Jun 14 2018 at 17:03)</a>:</h4>
<blockquote>
<p>This is chapter 3 of your book?</p>
</blockquote>
<p>I am not sure if this is book material.</p>


{% endraw %}
