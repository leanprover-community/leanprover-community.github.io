---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/00248multiset.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html">multiset</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="129522842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129522842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129522842">Kevin Buzzard (Jul 12 2018 at 08:02)</a>:</h4>
<p><span class="user-mention" data-user-id="120469">@Ellen Arlt</span> and I are putting <code>multiset.lean</code> through its paces.</p>
<p>Q1) This is perhaps a question about general lean/mathlib conventions disguised as a question about multisets. We have been working with multisets of size 0 and 1 and proving basic API lemmas. Initially I was using <code>∅</code> to denote the empty multiset (this is defined in mathlib, it's not my definition). I was surprised to find that <code>multiset.card (∅ : multiset α) = 0</code> was not a simp lemma (its proof is <code>rfl</code> but it can still be a simp lemma, right?) so I went to data.multiset to decide where to add it. And there I found that <code>multiset.card (0  : multiset α) = 0</code> <em>was</em> a simp lemma:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">multiset</span>

<span class="kn">variable</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>

<span class="kn">example</span>  <span class="o">:</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="err">∅</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="err">∅</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span> <span class="c1">-- fails</span>
</pre></div>


<p>Is this an example of the "pecking order" CS thing? Does it say "yes, <code>∅</code> and <code>0</code> are the same multiset, but if you need to refer to this multiset then mathlib asks that you use <code>0</code>"? If I'm right, how is one supposed to figure this sort of thing out? The hard way, like I did?</p>
<p>Q2) <code>multiset.strong_induction_on</code> gives me a way of defining functions on multisets. But I am having trouble proving anything at all about such functions. I think I need some sensible eliminators for <code>multiset.strong_induction_on</code>, ideally the one that says that the function defined by <code>multiset.strong_induction_on</code> can be computed on a multiset if I can tell you its values on all proper subsets of the multiset. No doubt this eliminator is "there already" in some form -- but I don't know how to get to it.</p>

<a name="129522923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129522923" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129522923">Mario Carneiro (Jul 12 2018 at 08:04)</a>:</h4>
<p>This is a "pecking order" thing. I was remiss in not including a simp lemma <code>(∅ : multiset α) = 0</code> but it would have conveyed this intent well</p>

<a name="129522982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129522982" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129522982">Mario Carneiro (Jul 12 2018 at 08:06)</a>:</h4>
<p>Alternatively, in hindsight perhaps it would have been better to make <code>∅</code> the primary one, since multisets have "set" in the name (as opposed to calling them <code>free_abelian_group</code> where <code>0</code> would be more natural)</p>

<a name="129523047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523047" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523047">Sebastian Ullrich (Jul 12 2018 at 08:08)</a>:</h4>
<p>Just idle speculation, I suppose in a future unbundled class hierarchy we would rather have an instance <code>is_zero ∅ (multiset a)</code> instead of <code>has_zero (multiset a)</code>?</p>

<a name="129523056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523056" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523056">Sebastian Ullrich (Jul 12 2018 at 08:08)</a>:</h4>
<p>So that there is no <code>(0  : multiset α)</code></p>

<a name="129523067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523067" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523067">Mario Carneiro (Jul 12 2018 at 08:09)</a>:</h4>
<p>I suppose that depends on whether we want to use <code>0</code> as notation</p>

<a name="129523070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523070" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523070">Mario Carneiro (Jul 12 2018 at 08:09)</a>:</h4>
<p>like I said, it makes sense if you want to use <code>multiset</code> as a free group generator</p>

<a name="129523118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523118" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523118">Kevin Buzzard (Jul 12 2018 at 08:10)</a>:</h4>
<p>A related question is what I should be using for <code>{c}</code> = <code>c :: 0</code> = <code>c :: ∅</code>. Who is top of the tree here?</p>

<a name="129523122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523122">Mario Carneiro (Jul 12 2018 at 08:10)</a>:</h4>
<p><code>c::0</code> is used exclusively for singleton on <code>multiset</code></p>

<a name="129523196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523196">Mario Carneiro (Jul 12 2018 at 08:12)</a>:</h4>
<p>For Q2, you can use this theorem:</p>
<div class="codehilite"><pre><span></span>theorem strong_induction_eq {p : multiset α → Sort*}
  (s : multiset α) (H) : @strong_induction_on _ p s H =
    H s (λ t h, @strong_induction_on _ p t H) :=
by rw [strong_induction_on]
</pre></div>


<p>but the built in equation is also usable, as I did in the proof here</p>

<a name="129523214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523214" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523214">Kevin Buzzard (Jul 12 2018 at 08:13)</a>:</h4>
<p><code>c :: 0</code> -- Yes, I had spotted this. So I should always use this notation? I noticed in practice that if one sticks to the notation which is top of the tree, then random stuff just "worked better", e.g. I had a <code>split_ifs</code> nightmare scenario when all of a sudden I had four goals; I traced this back to "sometimes using 0 and sometimes emptyset" and when I started being consistent (initially with the wrong choice!) things got better.</p>

<a name="129523222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523222" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523222">Mario Carneiro (Jul 12 2018 at 08:13)</a>:</h4>
<p>yes, that's the name of the game</p>

<a name="129523226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523226" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523226">Mario Carneiro (Jul 12 2018 at 08:13)</a>:</h4>
<p>These conventions are debatable, but the most important thing is to be consistent about them</p>

<a name="129523266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523266">Kevin Buzzard (Jul 12 2018 at 08:14)</a>:</h4>
<p>As for built in equations for arbitrary definitions, I only noticed that they existed about 20 minutes ago ;-) Thanks <span class="user-mention" data-user-id="110026">@Simon Hudon</span> !</p>

<a name="129523271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523271" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523271">Mario Carneiro (Jul 12 2018 at 08:14)</a>:</h4>
<p>the built in equations are much more important for wf definitions, since they are often not by <code>rfl</code></p>

<a name="129523288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523288">Mario Carneiro (Jul 12 2018 at 08:15)</a>:</h4>
<p>(they are by rfl in theory, but this is where lean breaks from the theory so it proves them automatically instead)</p>

<a name="129523333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523333">Kevin Buzzard (Jul 12 2018 at 08:16)</a>:</h4>
<p>Conventions: I guess the second most important thing is to convey the conventions to your users. I am beginning to realise that these subtleties can actually be read off relatively easily by just reading the source. Presumably sometimes there is a genuine CS reason for choosing one over the other and sometimes it's just a fairly arbitrary choice.</p>

<a name="129523337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129523337" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129523337">Kevin Buzzard (Jul 12 2018 at 08:16)</a>:</h4>
<p>I currently spend three days a week surrounded by about 10 students most of whom know no Lean at all, and I am still amazed by how much their completely basic questions can teach me.</p>

<a name="129524684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129524684" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129524684">Patrick Massot (Jul 12 2018 at 08:48)</a>:</h4>
<p>Does it give more momentum to your book writing effort?</p>

<a name="129524832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129524832" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129524832">Kevin Buzzard (Jul 12 2018 at 08:52)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">v_empty</span> <span class="o">:</span> <span class="n">value_aux</span> <span class="mi">0</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">value_aux</span><span class="o">,</span> <span class="c1">-- strong_induction hell</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span> <span class="c1">-- goal now one page long</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span> <span class="c1">-- goal now two pages long</span>
  <span class="n">dsimp</span><span class="o">,</span> <span class="c1">-- goal now one line long and doesn&#39;t mention induction</span>
  <span class="bp">...</span>
</pre></div>

<a name="129524833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129524833" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129524833">Kevin Buzzard (Jul 12 2018 at 08:52)</a>:</h4>
<p>:-)</p>

<a name="129525185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525185" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525185">Kevin Buzzard (Jul 12 2018 at 09:02)</a>:</h4>
<p>No -- in fact I spend all my time trying to answer their questions :-) What gives me momentum is that I give one Lean talk per week, and figuring out what to talk about seems to be the same as figuring out what I need to write about next. I am a terrible writer :-/ I am far too verbose. I need a good editor.</p>

<a name="129525186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525186" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525186">Kevin Buzzard (Jul 12 2018 at 09:02)</a>:</h4>
<p>The main function (<code>value_aux</code>) that I'm dealing with here is defined using two applications of <code>multiset.strong_induction_on</code>. The above lemma evaluates it on the empty set. To evaluate it on a singleton my code looks like</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">v_one_chain</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">value_aux</span> <span class="o">(</span><span class="n">c</span> <span class="bp">::</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">value_aux</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="c1">-- sanity prevails</span>
</pre></div>


<p>I am just over the moon that I can actually do things now, although I'm not entirely sure I like my <code>simp</code> style and the intermediate goals are huge.</p>

<a name="129525210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525210" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525210">Patrick Massot (Jul 12 2018 at 09:03)</a>:</h4>
<p>Do you know if <code>simp</code> always does the same thing here?</p>

<a name="129525257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525257" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525257">Sean Leather (Jul 12 2018 at 09:04)</a>:</h4>
<p><code>set_option trace.simplify.rewrite true</code> is your friend.</p>

<a name="129525281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525281" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525281">Patrick Massot (Jul 12 2018 at 09:05)</a>:</h4>
<p>If it happens to do always the same thing you can either write a new lemma or a specialized tactic</p>

<a name="129525381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525381">Kevin Buzzard (Jul 12 2018 at 09:08)</a>:</h4>
<p>I love the way that at 9:02am (UK time) I was <em>completely stuck</em> and now at 10:06am I have made huge progress in both my understanding of Lean and of the dots and boxes API. <span class="user-mention" data-user-id="110045">@Sean Leather</span> and <span class="user-mention" data-user-id="110031">@Patrick Massot</span> I'm sure you're right -- I should figure out exactly what <code>simp</code> is doing. But I am now too busy excitedly proving all the trivial lemmas that Ellen wanted :-)</p>

<a name="129525383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525383">Mario Carneiro (Jul 12 2018 at 09:08)</a>:</h4>
<p>You want to write an equation lemma for <code>value_aux</code>, similar to <code>strong_induction_eq</code></p>

<a name="129525411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525411" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525411">Kevin Buzzard (Jul 12 2018 at 09:09)</a>:</h4>
<p>How do I write an equation lemma? Is that just a useful lemma, possibly tagged simp, and called something like <code>value_aux.equation_37</code>?</p>

<a name="129525459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525459" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525459">Mario Carneiro (Jul 12 2018 at 09:10)</a>:</h4>
<p>Nothing special, you don't get to write equation lemmas like lean does</p>

<a name="129525460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525460">Mario Carneiro (Jul 12 2018 at 09:10)</a>:</h4>
<p>you just give it a regular name and refer to it directly</p>

<a name="129525466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525466" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525466">Mario Carneiro (Jul 12 2018 at 09:11)</a>:</h4>
<p>I would probably call it <code>value_aux_eq</code></p>

<a name="129525525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525525" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525525">Sean Leather (Jul 12 2018 at 09:13)</a>:</h4>
<p>As I understand it, an equation lemma would be what you get (or want) naturally for each constructor of an inductive data type. The equation lemma spells out the equation to reduce/simplify the constructor application. Of course, your type doesn't have to be inductive, nor does it need to have more than one constructor, for you to have an equation lemma. It's really just a name for a particular kind of equality.</p>

<a name="129525911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525911" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525911">Mario Carneiro (Jul 12 2018 at 09:22)</a>:</h4>
<p>Well, more precisely, you get an equation lemma for each branch of a definition. If it's a straight definition X = Y then you get just one equation, but if it is defined by cases or induction on an inductive type then you get an equation for each constructor, as you say</p>

<a name="129525924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129525924" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129525924">Sean Leather (Jul 12 2018 at 09:22)</a>:</h4>
<p>Right, forgot about about that.</p>

<a name="129566679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129566679" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129566679">Kevin Buzzard (Jul 12 2018 at 22:22)</a>:</h4>
<p>So I had real trouble emulating <code>simp</code> and removing it from the middle of my proofs -- I think it was even rewriting things like <code>lam (h : a \in c :: 0)</code> to <code>lam (h : a = c)</code> and my conv-fu wasn't strong enough. Chris convinced me to try rolling my own inductive definition -- he said it was so that my equation lemmas would be nicer, but I was motivated because I'd never done this sort of thing before. But I'm using induction twice: I am defining a function <code>value : multiset nat -&gt; multiset nat -&gt; nat</code> with the idea being that if I input <code>C</code> and <code>L</code> then I should be able to assume I can evaluate <code>value</code> at <code>C.erase c L</code> and <code>C L.erase l</code> with c in C and l in L. I should say that Chris' docs in the mathlib docs dir were invaluable.</p>
<p>So I got it working, but here's the epilogue: I think the equation compiler might be performing a dangerous simp which I have no way of stopping. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> am I right? (this was the theory Chris and I came up with). Here's something which doesn't work:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">multiset</span>

<span class="kn">definition</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">N_min</span> <span class="o">:</span> <span class="n">multiset</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="n">sorry</span>

<span class="n">def</span> <span class="n">value_aux&#39;</span> <span class="o">:</span> <span class="n">multiset</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">multiset</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="n">C</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">N_min</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">pmap</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">C</span><span class="o">),</span>
<span class="c1">--        have multiset.card (C.erase a) &lt; multiset.card C,</span>
<span class="c1">--          from multiset.card_lt_of_lt (multiset.erase_lt.2 h),</span>
        <span class="k">have</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="n">C</span><span class="bp">.</span><span class="n">erase</span> <span class="n">a</span><span class="o">)</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">L</span><span class="o">,</span>
          <span class="k">from</span> <span class="n">add_lt_add_right</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">card_lt_of_lt</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">erase_lt</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">))</span> <span class="bp">_</span><span class="o">,</span>
        <span class="n">a</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">int</span><span class="bp">.</span><span class="n">nat_abs</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">-</span> <span class="n">value_aux&#39;</span> <span class="o">(</span><span class="n">C</span><span class="bp">.</span><span class="n">erase</span> <span class="n">a</span><span class="o">)</span> <span class="n">L</span><span class="o">))</span>
        <span class="n">C</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span><span class="n">id</span><span class="o">)</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">pmap</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">L</span><span class="o">),</span>
<span class="c1">--        have multiset.card (L.erase a) &lt; multiset.card L,</span>
<span class="c1">--          from multiset.card_lt_of_lt (multiset.erase_lt.2 h),</span>
        <span class="k">have</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">erase</span> <span class="n">L</span> <span class="n">a</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">L</span><span class="o">,</span>
          <span class="k">from</span> <span class="n">add_lt_add_left</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">card_lt_of_lt</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">erase_lt</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">))</span> <span class="bp">_</span><span class="o">,</span>
        <span class="n">a</span> <span class="bp">-</span> <span class="mi">4</span> <span class="bp">+</span><span class="n">int</span><span class="bp">.</span><span class="n">nat_abs</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">-</span> <span class="n">value_aux&#39;</span> <span class="n">C</span> <span class="o">(</span><span class="n">L</span><span class="bp">.</span><span class="n">erase</span> <span class="n">a</span><span class="o">)))</span>
        <span class="n">L</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span><span class="n">id</span><span class="o">))</span>
<span class="n">using_well_founded</span> <span class="o">{</span><span class="n">rel_tac</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">`</span><span class="o">[</span><span class="n">exact</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">measure_wf</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">CL</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">CL</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">CL</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">⟩</span><span class="o">]}</span>
</pre></div>


<p>This is mostly noise -- the key thing to see is that I am taking as input two multisets, I am defining <code>value_aux</code> on the pair <code>C L</code> by a function which involves evaluating it on pairs <code>C' L</code> and <code>C L'</code> with <code>C'&lt;C</code> and <code>L'&lt;L</code> resp. The tactic I tell Lean to use to prove well-foundedness is, I think, the function sending <code>C L</code> to <code>card C + card L</code> (there's a <code>psigma</code> type involved, hopefully I got it right). The not-commented-out <code>have</code>s insert precisely what Lean needs to see a proof of, if I've understood things correctly. However the code above does not compile -- the equation compiler complains:</p>
<div class="codehilite"><pre><span></span>The nested exception contains the failure state for the decreasing tactic.
nested exception message:
failed
state:
value_aux&#39; : (Σ&#39; (a : multiset ℕ), multiset ℕ) → ℕ,
C L : multiset ℕ,
a : ℕ,
h : a ∈ C,
this : multiset.card (multiset.erase C a) + multiset.card L &lt; multiset.card C + multiset.card L
⊢ multiset.card (multiset.erase C a) &lt; multiset.card C
</pre></div>


<p>Now that looks strange to me, because if I've understood correctly, <code>this</code> is <em>precisely</em> what the equation compiler wanted to see a proof of. Chris conjectures that <code>simp</code> got applied before <code>assumption</code>.  If I comment out the <code>have/from</code> pairs and replace with the commented-out ones, the code compiles fine (and my equation lemmas don't mention <code>multiset.rec</code> :-) ). Chris points out that if the behaviour of <code>simp</code> changes in the future, then my code breaks in a really obscure way and there's little I can do about it. Have we understood what's going on correctly?</p>

<a name="129568895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129568895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129568895">Chris Hughes (Jul 12 2018 at 23:06)</a>:</h4>
<p>Here's a method that avoids the simplifier</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">value_aux&#39;</span> <span class="o">(</span><span class="n">N_min</span> <span class="o">:</span> <span class="n">multiset</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">multiset</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="n">multiset</span> <span class="bp">ℕ</span> <span class="bp">→</span> <span class="bp">ℕ</span>
<span class="bp">|</span> <span class="n">C</span> <span class="n">L</span> <span class="o">:=</span> <span class="n">N_min</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">pmap</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">C</span><span class="o">),</span>
<span class="c1">--        have multiset.card (C.erase a) &lt; multiset.card C,</span>
<span class="c1">--          from multiset.card_lt_of_lt (multiset.erase_lt.2 h),</span>
        <span class="k">have</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="n">C</span><span class="bp">.</span><span class="n">erase</span> <span class="n">a</span><span class="o">)</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">L</span> <span class="bp">&lt;</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">L</span><span class="o">,</span>
          <span class="k">from</span> <span class="n">add_lt_add_right</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">card_lt_of_lt</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">erase_lt</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">))</span> <span class="bp">_</span><span class="o">,</span>
        <span class="n">a</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">int</span><span class="bp">.</span><span class="n">nat_abs</span> <span class="o">(</span><span class="mi">2</span> <span class="bp">-</span> <span class="n">value_aux&#39;</span> <span class="o">(</span><span class="n">C</span><span class="bp">.</span><span class="n">erase</span> <span class="n">a</span><span class="o">)</span> <span class="n">L</span><span class="o">))</span>
        <span class="n">C</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span><span class="n">id</span><span class="o">)</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">pmap</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">a</span> <span class="err">∈</span> <span class="n">L</span><span class="o">),</span>
<span class="c1">--        have multiset.card (L.erase a) &lt; multiset.card L,</span>
<span class="c1">--          from multiset.card_lt_of_lt (multiset.erase_lt.2 h),</span>
        <span class="k">have</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">erase</span> <span class="n">L</span> <span class="n">a</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">C</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">L</span><span class="o">,</span>
          <span class="k">from</span> <span class="n">add_lt_add_left</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">card_lt_of_lt</span> <span class="o">(</span><span class="n">multiset</span><span class="bp">.</span><span class="n">erase_lt</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">))</span> <span class="bp">_</span><span class="o">,</span>
        <span class="n">a</span> <span class="bp">-</span> <span class="mi">4</span> <span class="bp">+</span><span class="n">int</span><span class="bp">.</span><span class="n">nat_abs</span> <span class="o">(</span><span class="mi">4</span> <span class="bp">-</span> <span class="n">value_aux&#39;</span> <span class="n">C</span> <span class="o">(</span><span class="n">L</span><span class="bp">.</span><span class="n">erase</span> <span class="n">a</span><span class="o">)))</span>
        <span class="n">L</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span><span class="n">id</span><span class="o">))</span>
<span class="n">using_well_founded</span> <span class="o">{</span><span class="n">dec_tac</span> <span class="o">:=</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">assumption</span><span class="o">,</span> <span class="n">rel_tac</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">`</span><span class="o">[</span><span class="n">exact</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="n">measure_wf</span>
  <span class="o">(</span><span class="bp">λ</span> <span class="n">CL</span><span class="o">,</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">CL</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">+</span> <span class="n">multiset</span><span class="bp">.</span><span class="n">card</span> <span class="n">CL</span><span class="bp">.</span><span class="n">snd</span><span class="o">)</span><span class="bp">⟩</span><span class="o">]}</span>
</pre></div>

<a name="129568913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129568913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129568913">Chris Hughes (Jul 12 2018 at 23:07)</a>:</h4>
<p>I changed the <code>dec_tac</code> at the bottom</p>

<a name="129575356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129575356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129575356">Mario Carneiro (Jul 13 2018 at 01:59)</a>:</h4>
<p>Yes, the standard fix when the default dec_tac is being stupid is to replace it with <code>tactic.assumption</code> like chris did</p>

<a name="129575360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129575360" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129575360">Mario Carneiro (Jul 13 2018 at 02:00)</a>:</h4>
<p>Actually the default dec_tac doesn't use simp, it is a custom tactic that does a few heuristic rules to do with <a href="http://nat.lt" target="_blank" title="http://nat.lt">nat.lt</a></p>

<a name="129575413"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129575413" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129575413">Mario Carneiro (Jul 13 2018 at 02:00)</a>:</h4>
<p>it is <code>default_dec_tac</code> in <code>well_founded_tactics.lean</code></p>

<a name="129575582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129575582" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129575582">Mario Carneiro (Jul 13 2018 at 02:06)</a>:</h4>
<p>But I'm confused what the issue was that caused you to move away from the original version</p>

<a name="129585358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129585358" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129585358">Kevin Buzzard (Jul 13 2018 at 07:22)</a>:</h4>
<p>Short answer: I wanted to get rid of the dangerous simps and this approach ("start again") would have the advantage that it (a) might solve this and (b) would also teach me something (slightly complicated use of equation compiler). </p>
<p>Long technical answer: Your original fix was fine modulo these dangerous simps. I was just talking to Chris about it and he said "why did you even use <code>multiset.strong_induction_on</code> when you could use the equation compiler?" and because I couldn't get rid of my dangerous <code>simp</code> and because I'd never used <code>using_well_founded</code> before I thought I'd give it a go to teach myself something (which turns out to be pretty easy to understand modulo the <code>lam _ _, </code>[exact` bit, which I'm leaving as a black box). Chris pointed out that one only had to use the equation compiler once, whereas I was using strong induction twice, so I felt that rewriting this was somehow going in the right direction.</p>
<p>An example (two examples) of the dangerous simp in my original code looks like this: note that this is with <code>value_aux</code>, the version of my function which uses strong induction twice per application (as opposed to <code>value_aux'</code> above). </p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">v_one_chain</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≥</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:</span> <span class="n">value_aux</span> <span class="o">(</span><span class="n">c</span> <span class="bp">::</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">value_aux</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="k">show</span> <span class="mi">2</span> <span class="bp">+</span> <span class="o">(</span><span class="n">c</span> <span class="bp">-</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">=</span> <span class="n">c</span><span class="o">,</span> <span class="c1">-- irritating-to-Patrick goal (c is a nat)</span>
  <span class="n">rw</span> <span class="n">add_comm</span><span class="o">,</span><span class="n">refine</span> <span class="n">nat</span><span class="bp">.</span><span class="n">sub_add_cancel</span> <span class="bp">_</span><span class="o">,</span>
  <span class="n">exact</span> <span class="n">le_trans</span> <span class="o">(</span><span class="k">show</span> <span class="mi">2</span> <span class="bp">≤</span> <span class="mi">3</span><span class="o">,</span> <span class="k">by</span> <span class="n">exact</span> <span class="n">dec_trivial</span><span class="o">)</span> <span class="n">h</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>


<p>This uses Mario's eliminator for <code>strong_induction_on</code> and compiles fine. The issue of course is with the simps in the middle. Replacing the first <code>simp</code> with <code>dsimp</code> breaks the code. Before the first simp is applied, the goal is <a href="https://gist.github.com/kbuzzard/d9f70ae02b5861bbce0f8d958e16619a" target="_blank" title="https://gist.github.com/kbuzzard/d9f70ae02b5861bbce0f8d958e16619a">https://gist.github.com/kbuzzard/d9f70ae02b5861bbce0f8d958e16619a</a> and after it's applied, the goal becomes (the still quite long) <a href="https://gist.github.com/kbuzzard/07495e93ed94b3d4e5bfd4015a52914f" target="_blank" title="https://gist.github.com/kbuzzard/07495e93ed94b3d4e5bfd4015a52914f">https://gist.github.com/kbuzzard/07495e93ed94b3d4e5bfd4015a52914f</a> . These goals are too big for my liking and the direct approach seemed like it would be likely to make them smaller. There are <code>strong_induction_on</code>s around in these goals but the rewrites won't work without the first <code>simp</code>. Sean suggested <code>set_option trace.simplify.rewrite true</code> and the output of that on the first dangerous <code>simp</code> is <a href="https://gist.github.com/kbuzzard/1a01ad2bc29aad1c257452c4d2d894d5" target="_blank" title="https://gist.github.com/kbuzzard/1a01ad2bc29aad1c257452c4d2d894d5">https://gist.github.com/kbuzzard/1a01ad2bc29aad1c257452c4d2d894d5</a> . I am certainly not a world expert in trace outputs, but I was interpreting the first line <code>0. [simplify.rewrite] [multiset.mem_singleton]: a ∈ c :: 0 ==&gt; a = c</code> of that trace output as meaning "first we replace that <code>mem</code> term with an <code>eq</code> term" but as far as I could see the only occurrences of <code>a ∈ c :: 0</code> were in terms like <code>(λ (a : ℕ) (h : a ∈ c :: 0), ...</code> and I could not do that rewrite with my bare hands (maybe I am just lame at <code>conv</code> but OTOH rewriting the type of a term is probably a dangerous business). In short, I couldn't remove the dangerous simp so I thought I'd try another approach.</p>

<a name="129585364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129585364" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129585364">Kevin Buzzard (Jul 13 2018 at 07:23)</a>:</h4>
<blockquote>
<p>Actually the default dec_tac doesn't use simp, it is a custom tactic that does a few heuristic rules to do with <a href="http://nat.lt" target="_blank" title="http://nat.lt">nat.lt</a></p>
</blockquote>
<p>PS that's good to know. Thanks. <span class="user-mention" data-user-id="110044">@Chris Hughes</span> it wasn't using <code>simp</code> after all. PPS I think <a href="https://nat.lt" target="_blank" title="https://nat.lt">https://nat.lt</a> is in Lithuanian.</p>

<a name="129586991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129586991" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129586991">Mario Carneiro (Jul 13 2018 at 08:03)</a>:</h4>
<p>I think you may not have understood my suggestion to write an equation lemma</p>

<a name="129587226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587226" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587226">Mario Carneiro (Jul 13 2018 at 08:10)</a>:</h4>
<p>Here is a version of <code>value_aux'</code> that uses <code>strong_induction_on</code> for its definition (presumably this looks like your original definition, although you didn't show it here):</p>
<div class="codehilite"><pre><span></span>def value_aux (N_min : multiset ℕ → ℕ) (C : multiset ℕ) : multiset ℕ → ℕ :=
multiset.strong_induction_on C $ λ C IH₁ L,
multiset.strong_induction_on L $ λ L IH₂,
N_min (
  multiset.pmap
    (λ a (h : a ∈ C),
      a - 2 + int.nat_abs (2 - IH₁ (C.erase a) (multiset.erase_lt.2 h) L))
    C (λ _, id) +
  multiset.pmap
    (λ a (h : a ∈ L),
      a - 4 + int.nat_abs (4 - IH₂ (L.erase a) (multiset.erase_lt.2 h)))
    L (λ _,id))
</pre></div>

<a name="129587227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587227">Kevin Buzzard (Jul 13 2018 at 08:10)</a>:</h4>
<p>[equation lemma] For sure that is true. Probably my question immediately after your comment indicated this. Sometimes I do stuff to learn more</p>

<a name="129587233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587233" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587233">Kevin Buzzard (Jul 13 2018 at 08:10)</a>:</h4>
<p>Yes, it looks pretty much like that</p>

<a name="129587242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587242" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587242">Kevin Buzzard (Jul 13 2018 at 08:10)</a>:</h4>
<p>except I used <code>C2</code> instead of <code>C</code> and <code>L2</code> instead of <code>L</code> because I am scared of free and bound variables having the same name</p>

<a name="129587260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587260" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587260">Mario Carneiro (Jul 13 2018 at 08:12)</a>:</h4>
<p>This is the equation lemma corresponding to that definition</p>
<div class="codehilite"><pre><span></span>theorem value_aux_eq (N_min : multiset ℕ → ℕ) (C L : multiset ℕ) :
  value_aux N_min C L = N_min (
    multiset.pmap
      (λ a (h : a ∈ C),
        a - 2 + int.nat_abs (2 - value_aux N_min (C.erase a) L))
      C (λ _, id) +
    multiset.pmap
      (λ a (h : a ∈ L),
        a - 4 + int.nat_abs (4 - value_aux N_min C (L.erase a)))
      L (λ _,id)) := sorry
</pre></div>

<a name="129587306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587306" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587306">Kevin Buzzard (Jul 13 2018 at 08:12)</a>:</h4>
<p>I don't understand your application of the "equation lemma" function.</p>

<a name="129587310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587310" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587310">Mario Carneiro (Jul 13 2018 at 08:12)</a>:</h4>
<p>(Actually, you can simplify the <code>pmap</code> away the way it's been written here, since <code>h</code> is no longer used)</p>

<a name="129587311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587311" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587311">Kevin Buzzard (Jul 13 2018 at 08:12)</a>:</h4>
<p>Is there an equation lemma corresponding to every definition?</p>

<a name="129587317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587317">Kevin Buzzard (Jul 13 2018 at 08:12)</a>:</h4>
<p>What is "the equation lemma corresponding to nat"?</p>

<a name="129587323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587323">Kevin Buzzard (Jul 13 2018 at 08:13)</a>:</h4>
<p>or "the equation lemma corresponding to quotient.sound" etc etc.</p>

<a name="129587327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587327">Mario Carneiro (Jul 13 2018 at 08:13)</a>:</h4>
<p>Informally, an "equation lemma" says that a definition is what it was defined to be</p>

<a name="129587334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587334" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587334">Mario Carneiro (Jul 13 2018 at 08:13)</a>:</h4>
<p><code>nat</code> and <code>quotient.sound</code> don't have equation lemmas because they are constants, not defs</p>

<a name="129587341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587341" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587341">Kevin Buzzard (Jul 13 2018 at 08:13)</a>:</h4>
<p><code>real</code>?</p>

<a name="129587346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587346">Kevin Buzzard (Jul 13 2018 at 08:13)</a>:</h4>
<p><code>def f : nat -&gt; nat := lam x, x + 3</code>?</p>

<a name="129587347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587347">Mario Carneiro (Jul 13 2018 at 08:13)</a>:</h4>
<p>It has an equation lemma, although you would rarely use it</p>

<a name="129587388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587388" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587388">Mario Carneiro (Jul 13 2018 at 08:14)</a>:</h4>
<p>that definitely does</p>

<a name="129587394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587394">Kevin Buzzard (Jul 13 2018 at 08:14)</a>:</h4>
<p>it's something like "forall x , f x = x + 3"?</p>

<a name="129587398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587398">Mario Carneiro (Jul 13 2018 at 08:14)</a>:</h4>
<p>yes</p>

<a name="129587400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587400" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587400">Kevin Buzzard (Jul 13 2018 at 08:14)</a>:</h4>
<p>Maybe I don't understand the _point_ then.</p>

<a name="129587403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587403">Kevin Buzzard (Jul 13 2018 at 08:14)</a>:</h4>
<p>Is it tagged as a simp lemma?</p>

<a name="129587406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587406">Kevin Buzzard (Jul 13 2018 at 08:14)</a>:</h4>
<p>Who is using these equation lemmas?</p>

<a name="129587407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587407">Mario Carneiro (Jul 13 2018 at 08:14)</a>:</h4>
<p>sometimes it's a simp lemma</p>

<a name="129587410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587410" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587410">Kevin Buzzard (Jul 13 2018 at 08:15)</a>:</h4>
<p>?!</p>

<a name="129587415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587415" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587415">Kevin Buzzard (Jul 13 2018 at 08:15)</a>:</h4>
<p>Who makes the decision?</p>

<a name="129587416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587416">Mario Carneiro (Jul 13 2018 at 08:15)</a>:</h4>
<p>it gets used whenever you "unfold the definition"</p>

<a name="129587420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587420" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587420">Kevin Buzzard (Jul 13 2018 at 08:15)</a>:</h4>
<p>Aah!</p>

<a name="129587425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587425">Kevin Buzzard (Jul 13 2018 at 08:15)</a>:</h4>
<p>When I use unfold, sometimes it says that <code>simp</code> failed</p>

<a name="129587427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587427" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587427">Mario Carneiro (Jul 13 2018 at 08:15)</a>:</h4>
<p>some definitions are marked <code>@[simp]</code> meaning that their equation lemmas are simp lemmas</p>

<a name="129587434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587434">Kevin Buzzard (Jul 13 2018 at 08:16)</a>:</h4>
<p>You can tag a definition with simp? I am not sure I ever internalised that</p>

<a name="129587478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587478">Mario Carneiro (Jul 13 2018 at 08:16)</a>:</h4>
<p>like list.append</p>
<div class="codehilite"><pre><span></span>@[simp] protected def append : list α → list α → list α
| []       l := l
| (h :: s) t := h :: (append s t)
</pre></div>

<a name="129587481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587481" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587481">Mario Carneiro (Jul 13 2018 at 08:16)</a>:</h4>
<p>This marks this definition's two (!) equation lemmas as simp lemmas</p>

<a name="129587493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587493" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587493">Kevin Buzzard (Jul 13 2018 at 08:17)</a>:</h4>
<p>I can see all the equation lemmas with <code>#print prefix list.append</code> perhaps</p>

<a name="129587498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587498" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587498">Mario Carneiro (Jul 13 2018 at 08:17)</a>:</h4>
<p>yes</p>

<a name="129587503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587503" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587503">Kevin Buzzard (Jul 13 2018 at 08:17)</a>:</h4>
<p>So I must confess that I've never really understood the output of that sort of command.</p>

<a name="129587504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587504">Kevin Buzzard (Jul 13 2018 at 08:17)</a>:</h4>
<p>We have <code>_main</code>, <code>_main._meta_aux</code> etc</p>

<a name="129587506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587506" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587506">Kevin Buzzard (Jul 13 2018 at 08:17)</a>:</h4>
<p>it's quite intimidating</p>

<a name="129587508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587508" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587508">Mario Carneiro (Jul 13 2018 at 08:17)</a>:</h4>
<p>But sometimes lean doesn't generate equation lemmas the way you would like them, so you have to write your own, and that's my point</p>

<a name="129587596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587596">Kevin Buzzard (Jul 13 2018 at 08:18)</a>:</h4>
<p>I am still missing a big issue</p>

<a name="129587600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587600">Kevin Buzzard (Jul 13 2018 at 08:18)</a>:</h4>
<p>OK so I wrote my function</p>

<a name="129587603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587603" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587603">Kevin Buzzard (Jul 13 2018 at 08:18)</a>:</h4>
<p>and the equation lemmas are all wrong</p>

<a name="129587606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587606">Kevin Buzzard (Jul 13 2018 at 08:18)</a>:</h4>
<p>so I need to write another one.</p>

<a name="129587613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587613" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587613">Mario Carneiro (Jul 13 2018 at 08:19)</a>:</h4>
<p>For example, here's another way to write list.append</p>
<div class="codehilite"><pre><span></span>def list.append&#39; {α} (l₁ l₂ : list α) : list α :=
list.rec_on l₁ l₂ (λ a l₁ IH, a :: IH)
</pre></div>

<a name="129587614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587614">Kevin Buzzard (Jul 13 2018 at 08:19)</a>:</h4>
<p>OK so I wrote one: "<code>theorem X : f x = g x -- this is the equation lemma I want</code>"</p>

<a name="129587617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587617">Kevin Buzzard (Jul 13 2018 at 08:19)</a>:</h4>
<p>that's a lemma</p>

<a name="129587618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587618">Kevin Buzzard (Jul 13 2018 at 08:19)</a>:</h4>
<p>Is it an equation lemma?</p>

<a name="129587620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587620" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587620">Mario Carneiro (Jul 13 2018 at 08:19)</a>:</h4>
<p>the equation lemmas are not what we would like</p>
<div class="codehilite"><pre><span></span>#print prefix list.append&#39;
-- list.append&#39; : Π {α : Type u_1}, list α → list α → list α
-- list.append&#39;.equations._eqn_1 : ∀ {α : Type u_1} (l₁ l₂ : list α),
--   list.append&#39; l₁ l₂ = list.rec_on l₁ l₂ (λ (a : α) (l₁ IH : list α), a :: IH)
</pre></div>

<a name="129587662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587662">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>why not?</p>

<a name="129587669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587669" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587669">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>What's wrong with them?</p>

<a name="129587672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587672" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587672">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>I don't understand several things</p>

<a name="129587680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587680">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>"equation lemmas are used in unfold"</p>

<a name="129587681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587681" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587681">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>"sometimes they're simp lemmas"</p>

<a name="129587684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587684" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587684">Mario Carneiro (Jul 13 2018 at 08:20)</a>:</h4>
<p>While it is true that append is equal to that rec_on mess, that's not what I want to see</p>

<a name="129587687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587687" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587687">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>"they're generated automatically"</p>

<a name="129587692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587692" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587692">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>that's about all I know</p>

<a name="129587693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587693">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>about equation lemmas</p>

<a name="129587694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587694" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587694">Kevin Buzzard (Jul 13 2018 at 08:20)</a>:</h4>
<p>I am missing some fundamental point about why they exist and why they're important</p>

<a name="129587705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587705" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587705">Kevin Buzzard (Jul 13 2018 at 08:21)</a>:</h4>
<p>"if you write a definition, Lean generates a bunch of lemmas with obscure names"</p>

<a name="129587706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587706" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587706">Mario Carneiro (Jul 13 2018 at 08:21)</a>:</h4>
<p>what I want to see are the things that the definition is trying to say, namely <code>list.append [] l = l</code> and <code>list.append (a::l) l' = a :: list.append l l'</code></p>

<a name="129587710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587710" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587710">Mario Carneiro (Jul 13 2018 at 08:21)</a>:</h4>
<p>This is really important for controlling the complexity of statements</p>

<a name="129587714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587714" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587714">Kevin Buzzard (Jul 13 2018 at 08:21)</a>:</h4>
<p>"if you write the definition differently, you might get different lemmas, and Mario can see that this might cause problems but Kevin still has no understanding of when equation lemmas are used so doesn't care what these auto-generated lemmas are"</p>

<a name="129587753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587753">Mario Carneiro (Jul 13 2018 at 08:22)</a>:</h4>
<p>if every time you used <code>nat.add</code> it unfolded to its definition it would be utterly unreadable</p>

<a name="129587756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587756" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587756">Kevin Buzzard (Jul 13 2018 at 08:22)</a>:</h4>
<p>it can't unfold</p>

<a name="129587760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587760" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587760">Kevin Buzzard (Jul 13 2018 at 08:22)</a>:</h4>
<p>oh wit</p>

<a name="129587761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587761" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587761">Kevin Buzzard (Jul 13 2018 at 08:22)</a>:</h4>
<p>oh wait</p>

<a name="129587766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587766" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587766">Kevin Buzzard (Jul 13 2018 at 08:22)</a>:</h4>
<p>is <code>nat.add</code> one of these things whose definition is not what I think it is?</p>

<a name="129587771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587771" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587771">Kevin Buzzard (Jul 13 2018 at 08:22)</a>:</h4>
<p>Is it not 0 -&gt; x, succ y -&gt; succ (x+y)?</p>

<a name="129587783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587783" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587783">Mario Carneiro (Jul 13 2018 at 08:23)</a>:</h4>
<p>really making progress in this proof:</p>
<div class="codehilite"><pre><span></span>example (x : ℕ) : 0 + x = 0 :=
begin
  dsimp only [(+)], delta nat.add,
-- ⊢ nat.brec_on x
--       (λ (a : ℕ) (_F : nat.below (λ (a : ℕ), ℕ → ℕ) a) (a_1 : ℕ),
--          (λ (a a_1 : ℕ) (_F : nat.below (λ (a : ℕ), ℕ → ℕ) a_1),
--             nat.cases_on a_1 (λ (_F : nat.below (λ (a : ℕ), ℕ → ℕ) 0), id_rhs ℕ a)
--               (λ (a_1 : ℕ) (_F : nat.below (λ (a : ℕ), ℕ → ℕ) (nat.succ a_1)),
--                  id_rhs ℕ (nat.succ ((_F.fst).fst a)))
--               _F)
--            a_1
--            a
--            _F)
--       0 =
--     0
end
</pre></div>

<a name="129587788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587788">Kevin Buzzard (Jul 13 2018 at 08:23)</a>:</h4>
<p>I'm already lost, apparently it's <code>nat.add._main</code></p>

<a name="129587790"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587790" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587790">Kevin Buzzard (Jul 13 2018 at 08:23)</a>:</h4>
<p>that does not look good</p>

<a name="129587794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587794" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587794">Mario Carneiro (Jul 13 2018 at 08:23)</a>:</h4>
<p>If <code>simp</code> did this Leo would be fired by now</p>

<a name="129587847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587847">Kevin Buzzard (Jul 13 2018 at 08:24)</a>:</h4>
<p>The problem has occurred because <code>nat.add</code> is for some reason defined in a stupid way</p>

<a name="129587858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587858" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587858">Kevin Buzzard (Jul 13 2018 at 08:24)</a>:</h4>
<p>I fixed this up in my blog IIRC</p>

<a name="129587861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587861" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587861">Mario Carneiro (Jul 13 2018 at 08:24)</a>:</h4>
<p>no, the problem has occurred because I unfolded the definition without folding it back up again</p>

<a name="129587877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587877" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587877">Kevin Buzzard (Jul 13 2018 at 08:25)</a>:</h4>
<p>Does the equation compiler create that monstrosity?</p>

<a name="129587879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587879" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587879">Mario Carneiro (Jul 13 2018 at 08:25)</a>:</h4>
<p>Even if I defined <code>nat.add</code> the simple way, it would still not be pretty to look at</p>

<a name="129587885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587885" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587885">Kevin Buzzard (Jul 13 2018 at 08:25)</a>:</h4>
<p>oh holy moley</p>

<a name="129587887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587887">Mario Carneiro (Jul 13 2018 at 08:25)</a>:</h4>
<p>I want to see <code>0 + x</code> not <code>nat.rec bla bla</code></p>

<a name="129587893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587893">Kevin Buzzard (Jul 13 2018 at 08:25)</a>:</h4>
<p><code>nat.add</code> is defined sensibly in <code>core.lean</code></p>

<a name="129587913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587913">Kevin Buzzard (Jul 13 2018 at 08:26)</a>:</h4>
<p>what has the equation compiler done??</p>

<a name="129587936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587936" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587936">Mario Carneiro (Jul 13 2018 at 08:26)</a>:</h4>
<p>The equation lemmas say things like <code>x + succ y = succ (x + y)</code></p>

<a name="129587941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587941" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587941">Kevin Buzzard (Jul 13 2018 at 08:26)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">namespace</span> <span class="n">nat</span>
  <span class="kn">protected</span> <span class="n">def</span> <span class="n">add</span> <span class="o">:</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">nat</span> <span class="bp">→</span> <span class="n">nat</span>
  <span class="bp">|</span> <span class="n">a</span>  <span class="n">zero</span>     <span class="o">:=</span> <span class="n">a</span>
  <span class="bp">|</span> <span class="n">a</span>  <span class="o">(</span><span class="n">succ</span> <span class="n">b</span><span class="o">)</span> <span class="o">:=</span> <span class="n">succ</span> <span class="o">(</span><span class="n">add</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span>
</pre></div>

<a name="129587945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587945">Kevin Buzzard (Jul 13 2018 at 08:26)</a>:</h4>
<p>That got turned into the monstrosity</p>

<a name="129587949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587949" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587949">Mario Carneiro (Jul 13 2018 at 08:26)</a>:</h4>
<p>this is true by rfl, but the really important thing is that the RHS does not have <code>nat.rec</code> in it</p>

<a name="129587960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587960">Mario Carneiro (Jul 13 2018 at 08:26)</a>:</h4>
<p>or <code>nat.brec_on</code> or its cousins</p>

<a name="129587973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587973">Kevin Buzzard (Jul 13 2018 at 08:27)</a>:</h4>
<p>Right -- Chris was stressing the importance of getting away from <code>multiset.rec</code></p>

<a name="129587994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587994" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587994">Kevin Buzzard (Jul 13 2018 at 08:27)</a>:</h4>
<p>which I had in my initial equation lemmas for the value function</p>

<a name="129587998"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129587998" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129587998">Mario Carneiro (Jul 13 2018 at 08:27)</a>:</h4>
<p>In fact, you could say that's the main purpose of equation lemmas, to hide recursors</p>

<a name="129588018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588018" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588018">Kevin Buzzard (Jul 13 2018 at 08:27)</a>:</h4>
<p>actually it's even worse, my equation lemmas for value have strong induction in</p>

<a name="129588062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588062" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588062">Kevin Buzzard (Jul 13 2018 at 08:28)</a>:</h4>
<div class="codehilite"><pre><span></span>value_aux.equations._eqn_1 : ∀ (C : multiset ℕ),
  value_aux C =
    multiset.strong_induction_on C
      (λ (C2 : multiset ℕ) (HC : Π (t : multiset ℕ), t &lt; C2 → multiset ℕ → ℕ) (L : multiset ℕ),
         multiset.strong_induction_on L
           (λ (L2 : multiset ℕ) (HL : Π (t : multiset ℕ), t &lt; L2 → ℕ),
              multiset.N_min
                (multiset.pmap
                     (λ (a : ℕ) (h : a ∈ C2), a - 2 + int.nat_abs (2 - ↑(HC (multiset.erase C2 a) _ L2)))
                     C2
                     _ +
                   multiset.pmap
                     (λ (a : ℕ) (h : a ∈ L2), a - 4 + int.nat_abs (4 - ↑(HL (multiset.erase L2 a) _)))
                     L2
                     _)))
</pre></div>

<a name="129588080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588080">Kevin Buzzard (Jul 13 2018 at 08:28)</a>:</h4>
<p>Can you tell me a formal definition of which parts of the output of <code>#print prefix value_aux</code> are the equation lemmas?</p>

<a name="129588084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588084" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588084">Kevin Buzzard (Jul 13 2018 at 08:28)</a>:</h4>
<p>Is it precisely those which start <code>value_aux.equation...</code>?</p>

<a name="129588095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588095" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588095">Mario Carneiro (Jul 13 2018 at 08:29)</a>:</h4>
<p>yes, those are the automatically generated equation lemmas</p>

<a name="129588097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588097">Kevin Buzzard (Jul 13 2018 at 08:29)</a>:</h4>
<p>because I have other things like the stunning observation <code>value_aux._proof_4 : ∀ (L2 : multiset ℕ) (_x : ℕ), _x ∈ L2 → _x ∈ L2</code></p>

<a name="129588103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588103" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588103">Kevin Buzzard (Jul 13 2018 at 08:29)</a>:</h4>
<p>Is that an equation lemma?</p>

<a name="129588109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588109">Kevin Buzzard (Jul 13 2018 at 08:29)</a>:</h4>
<p>I don't know what I'd do without that lemma</p>

<a name="129588114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588114" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588114">Mario Carneiro (Jul 13 2018 at 08:30)</a>:</h4>
<p>those are extracting proof terms inside non-proof terms for performance</p>

<a name="129588166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588166" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588166">Kevin Buzzard (Jul 13 2018 at 08:30)</a>:</h4>
<p>but not equation lemmas.</p>

<a name="129588167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588167" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588167">Mario Carneiro (Jul 13 2018 at 08:30)</a>:</h4>
<p>the extraction code isn't so bright</p>

<a name="129588176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588176" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588176">Mario Carneiro (Jul 13 2018 at 08:30)</a>:</h4>
<p>equation lemmas are equations</p>

<a name="129588181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588181" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588181">Kevin Buzzard (Jul 13 2018 at 08:30)</a>:</h4>
<p>OK so when I make a new definition, Lean makes some equation lemmas, and we've seen examples where these lemmas are in some sense unusable</p>

<a name="129588183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588183" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588183">Mario Carneiro (Jul 13 2018 at 08:31)</a>:</h4>
<p>right</p>

<a name="129588189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588189" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588189">Kevin Buzzard (Jul 13 2018 at 08:31)</a>:</h4>
<p>so now all I need to know is</p>

<a name="129588193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588193" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588193">Kevin Buzzard (Jul 13 2018 at 08:31)</a>:</h4>
<p>(1) what is actually using them and (2) how to write better ones</p>

<a name="129588196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588196">Mario Carneiro (Jul 13 2018 at 08:31)</a>:</h4>
<p>When you write a definition you should already have in mind what its equation lemmas are</p>

<a name="129588202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588202">Mario Carneiro (Jul 13 2018 at 08:31)</a>:</h4>
<p>In this case, you knew you wanted <code>value_aux</code> to depend on itself at other values</p>

<a name="129588203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588203" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588203">Kevin Buzzard (Jul 13 2018 at 08:32)</a>:</h4>
<p>If we go back to <code>nat.add</code> I can see <code>x + succ y = succ (x + y)</code> would be the sort of thing that as an end user I would simply _assume_ was true by <code>rfl</code>, given the definition</p>

<a name="129588249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588249" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588249">Mario Carneiro (Jul 13 2018 at 08:32)</a>:</h4>
<p>which is where something like this comes from</p>
<div class="codehilite"><pre><span></span>theorem value_aux_eq (N_min : multiset ℕ → ℕ) (C L : multiset ℕ) :
  value_aux N_min C L = N_min (
    C.map (λ a, a - 2 + int.nat_abs (2 - value_aux N_min (C.erase a) L)) +
    C.map (λ a, a - 4 + int.nat_abs (4 - value_aux N_min C (L.erase a)))) := sorry
</pre></div>

<a name="129588256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588256">Kevin Buzzard (Jul 13 2018 at 08:32)</a>:</h4>
<p>Right -- I feel like I want that theorem to be true by <code>rfl</code></p>

<a name="129588258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588258">Kevin Buzzard (Jul 13 2018 at 08:32)</a>:</h4>
<p>because in my non-CS mathematical mind that is "exactly how I defined the function"</p>

<a name="129588265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588265">Kevin Buzzard (Jul 13 2018 at 08:33)</a>:</h4>
<p>that theorem is "true by definition"</p>

<a name="129588266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588266">Mario Carneiro (Jul 13 2018 at 08:33)</a>:</h4>
<p>exactly</p>

<a name="129588272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588272" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588272">Kevin Buzzard (Jul 13 2018 at 08:33)</a>:</h4>
<p>but funnily enough I don't see it in my list of equation lemmas</p>

<a name="129588277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588277" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588277">Mario Carneiro (Jul 13 2018 at 08:33)</a>:</h4>
<p>Half of the work is taking your "definition" and turning it into something lean will accept, and the other half is getting back to the original thing you wanted to call the definition</p>

<a name="129588318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588318" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588318">Mario Carneiro (Jul 13 2018 at 08:34)</a>:</h4>
<p>that latter step is the equation lemma</p>

<a name="129588327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588327">Kevin Buzzard (Jul 13 2018 at 08:34)</a>:</h4>
<p>I had never remotely comprehended this.</p>

<a name="129588329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588329" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588329">Kevin Buzzard (Jul 13 2018 at 08:34)</a>:</h4>
<p>I thought that "Lean did the second part automatically"</p>

<a name="129588331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588331" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588331">Mario Carneiro (Jul 13 2018 at 08:34)</a>:</h4>
<p>it does, for the most part</p>

<a name="129588351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588351">Mario Carneiro (Jul 13 2018 at 08:34)</a>:</h4>
<p>but it's not perfect, it doesn't accept every definitionesque thing mathematicians dream up</p>

<a name="129588352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588352">Kevin Buzzard (Jul 13 2018 at 08:35)</a>:</h4>
<p>OK so let's say I can prove the lemma which I thought should be <code>rfl</code> but which wasn't.</p>

<a name="129588361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588361">Kevin Buzzard (Jul 13 2018 at 08:35)</a>:</h4>
<p>Is it just a case of making sure that lemma is called <code>value_aux.equations._eqn_2</code>?</p>

<a name="129588373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588373">Mario Carneiro (Jul 13 2018 at 08:35)</a>:</h4>
<p>Unfortunately, lean doesn't let you install your own equation lemmas like that</p>

<a name="129588414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588414" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588414">Kevin Buzzard (Jul 13 2018 at 08:36)</a>:</h4>
<p>OK so we're back to (1) I don't know how to make a lemma into an equation lemma and (2) I don't know exactly what is using the equation lemmas and when</p>

<a name="129588416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588416">Mario Carneiro (Jul 13 2018 at 08:36)</a>:</h4>
<p>when you right your own equation lemma, it's just a theorem, an equality you can use in rewrite and simp</p>

<a name="129588417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588417" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588417">Kevin Buzzard (Jul 13 2018 at 08:36)</a>:</h4>
<p>and rfl</p>

<a name="129588420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588420" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588420">Kevin Buzzard (Jul 13 2018 at 08:36)</a>:</h4>
<p>because equation lemmas are true by definition, right? :-)</p>

<a name="129588421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588421">Mario Carneiro (Jul 13 2018 at 08:36)</a>:</h4>
<p>If you prove it by <code>rfl</code> you can also use it in <code>dsimp</code></p>

<a name="129588424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588424">Mario Carneiro (Jul 13 2018 at 08:36)</a>:</h4>
<p>Sometimes it's <code>rfl</code> sometimes not</p>

<a name="129588425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588425">Kevin Buzzard (Jul 13 2018 at 08:37)</a>:</h4>
<p>If it's not <code>rfl</code> then Lean made a mistake</p>

<a name="129588430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588430">Kevin Buzzard (Jul 13 2018 at 08:37)</a>:</h4>
<p>because the equation lemmas are the things which are true by definition</p>

<a name="129588433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588433">Mario Carneiro (Jul 13 2018 at 08:37)</a>:</h4>
<p>for more elaborate definitional mechanisms, DTT doesn't recognize it as definitional but you can still prove it with some work</p>

<a name="129588436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588436" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588436">Kevin Buzzard (Jul 13 2018 at 08:37)</a>:</h4>
<p>OK</p>

<a name="129588478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588478">Kevin Buzzard (Jul 13 2018 at 08:38)</a>:</h4>
<p>so now I proved a lemma, the proof unfortunately wasn't <code>rfl</code>, I want to use it everywhere because in my brain the lemma is "true by definition of the object".</p>

<a name="129588480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588480">Kevin Buzzard (Jul 13 2018 at 08:38)</a>:</h4>
<p>Now what?</p>

<a name="129588483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588483" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588483">Mario Carneiro (Jul 13 2018 at 08:38)</a>:</h4>
<p>In particular, I doubt <code>value_aux_eq</code> is true by <code>rfl</code>, particularly when I changed the <code>pmap</code> to <code>map</code></p>

<a name="129588488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588488" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588488">Kevin Buzzard (Jul 13 2018 at 08:38)</a>:</h4>
<p>Yes i can quite believe it's not</p>

<a name="129588493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588493" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588493">Kevin Buzzard (Jul 13 2018 at 08:38)</a>:</h4>
<p>not least because <code>value_aux</code> uses <code>multiset.strong_induction_on</code> <em>twice</em></p>

<a name="129588497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588497">Mario Carneiro (Jul 13 2018 at 08:38)</a>:</h4>
<p>but it is nevertheless "the way we want it to unfold" so we treat it as the equation lemma</p>

<a name="129588499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588499" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588499">Kevin Buzzard (Jul 13 2018 at 08:39)</a>:</h4>
<p>"so we treat it as the equation lemma" is the bit I don't get</p>

<a name="129588508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588508" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588508">Kevin Buzzard (Jul 13 2018 at 08:39)</a>:</h4>
<p>Are you just saying "prove a lemma and then occasionally <code>rw</code> with it"?</p>

<a name="129588512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588512" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588512">Mario Carneiro (Jul 13 2018 at 08:39)</a>:</h4>
<p>It just means we use that theorem when we would otherwise "unfold <code>value_aux</code>"</p>

<a name="129588521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588521">Kevin Buzzard (Jul 13 2018 at 08:39)</a>:</h4>
<p>So </p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">v_one_chain</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≥</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:</span> <span class="n">value_aux</span> <span class="o">(</span><span class="n">c</span> <span class="bp">::</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">unfold</span> <span class="n">value_aux</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">rw</span> <span class="n">strong_induction_eq</span><span class="o">,</span>
  <span class="n">simp</span><span class="o">,</span>
<span class="bp">...</span>
</pre></div>


<p>is not the right approach?</p>

<a name="129588566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588566" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588566">Mario Carneiro (Jul 13 2018 at 08:40)</a>:</h4>
<p>no</p>

<a name="129588568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588568">Kevin Buzzard (Jul 13 2018 at 08:40)</a>:</h4>
<p>even though I have the right equation lemma?</p>

<a name="129588570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588570" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588570">Kevin Buzzard (Jul 13 2018 at 08:40)</a>:</h4>
<p>(I assume I do, I think you wrote it)</p>

<a name="129588588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588588" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588588">Mario Carneiro (Jul 13 2018 at 08:40)</a>:</h4>
<p>you want to use the equation lemma for <code>value_aux</code>, not the equation lemma for <code>strong_induction_on</code></p>

<a name="129588593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588593">Mario Carneiro (Jul 13 2018 at 08:40)</a>:</h4>
<p>you will use the latter to prove the former</p>

<a name="129588597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588597" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588597">Kevin Buzzard (Jul 13 2018 at 08:41)</a>:</h4>
<p>aah</p>

<a name="129588613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588613" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588613">Kevin Buzzard (Jul 13 2018 at 08:41)</a>:</h4>
<p>aah I was thinking "Mario said to use an equation lemma, I don't know what that is, I think Mario wrote it for me, I'll just use that"</p>

<a name="129588682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588682" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588682">Kevin Buzzard (Jul 13 2018 at 08:42)</a>:</h4>
<p>So an equation lemma is just a lemma, with no magic properties, it doesn't have to have a weird name like <code>foo._equation_7_main_sunfold</code></p>

<a name="129588688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588688" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588688">Mario Carneiro (Jul 13 2018 at 08:43)</a>:</h4>
<p>no, that's just the usual name for lean's autogenerated equation lemmas</p>

<a name="129588691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588691" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588691">Kevin Buzzard (Jul 13 2018 at 08:43)</a>:</h4>
<p>what makes it an equation lemma is that it represents a fact which the end user would like to think was "true by definition"</p>

<a name="129588696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588696" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588696">Kevin Buzzard (Jul 13 2018 at 08:43)</a>:</h4>
<p>if they were a wooly thinker, like e.g. a pure mathematician</p>

<a name="129588701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588701" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588701">Mario Carneiro (Jul 13 2018 at 08:43)</a>:</h4>
<p>those get some special magic, like being able to write <code>simp [f]</code> instead of <code>simp [f.equations_1]</code></p>

<a name="129588706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588706" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588706">Kevin Buzzard (Jul 13 2018 at 08:43)</a>:</h4>
<p>Yes, I learnt that yesterday</p>

<a name="129588752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588752">Kevin Buzzard (Jul 13 2018 at 08:44)</a>:</h4>
<p>OK so let me step back and try to wrap up</p>

<a name="129588761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588761" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588761">Kevin Buzzard (Jul 13 2018 at 08:44)</a>:</h4>
<p>When I write a definition, I might want to consider what the fundamental properties of that definition are -- the things which <em>should</em> be "true by definition"</p>

<a name="129588768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588768" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588768">Kevin Buzzard (Jul 13 2018 at 08:44)</a>:</h4>
<p>or "true because it's completely obvious"</p>

<a name="129588781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588781" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588781">Kevin Buzzard (Jul 13 2018 at 08:45)</a>:</h4>
<p>and then I might want to look at the subset of the output of <code>#print prefix foo</code> consisting only of things which have the string "equation" in them</p>

<a name="129588789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588789" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588789">Kevin Buzzard (Jul 13 2018 at 08:45)</a>:</h4>
<p>and I might want to just check that everything I want to be "true by definition" is there</p>

<a name="129588797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588797" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588797">Mario Carneiro (Jul 13 2018 at 08:45)</a>:</h4>
<p>The autogenerated equation lemmas are easy to predict without looking at them like that</p>

<a name="129588801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588801" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588801">Kevin Buzzard (Jul 13 2018 at 08:45)</a>:</h4>
<p>and if it's not then I might want to make a note of this, prove the remaining facts, and then spend the rest of my life rewriting with them</p>

<a name="129588845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588845" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588845">Sean Leather (Jul 13 2018 at 08:46)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Perhaps “true by the definition you wished it had”? “True because it's obvious” is maybe too generous in what it allows.</p>

<a name="129588846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588846">Kevin Buzzard (Jul 13 2018 at 08:46)</a>:</h4>
<blockquote>
<p>The autogenerated equation lemmas are easy to predict without looking at them like that</p>
</blockquote>
<p>says someone who has probably looked at the code which generates them</p>

<a name="129588847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588847">Mario Carneiro (Jul 13 2018 at 08:46)</a>:</h4>
<p>for each branch of the definition, each <code>:=</code>, you get a lemma saying your definition applied to those arguments gives the RHS</p>

<a name="129588859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588859">Kevin Buzzard (Jul 13 2018 at 08:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110045">@Sean Leather</span> that's a better way of phrasing it. My definition of value by "induction on (induction on ...)" was never going to create the lemma I wanted</p>

<a name="129588880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588880" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588880">Kevin Buzzard (Jul 13 2018 at 08:47)</a>:</h4>
<p>but on the other hand there was clearly a definition which in some sense I "wished I had written"</p>

<a name="129588887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588887">Kevin Buzzard (Jul 13 2018 at 08:47)</a>:</h4>
<p>and that was precisely the definition I _did_ write yesterday, using the equation compiler</p>

<a name="129588931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588931">Kevin Buzzard (Jul 13 2018 at 08:48)</a>:</h4>
<p>So all this stinks. There are things which should be true by <code>rfl</code> but which I can't prove with <code>rfl</code></p>

<a name="129588932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588932" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588932">Mario Carneiro (Jul 13 2018 at 08:48)</a>:</h4>
<p>One place where you might be surprised is in definitions with wildcards</p>
<div class="codehilite"><pre><span></span>def X {α} : list α → list α → list α
| [] _ := []
| _ [] := []
| x y := x
#print prefix X
-- X.equations._eqn_1 : ∀ {α : Type u_1}, X list.nil list.nil = list.nil
-- X.equations._eqn_2 : ∀ {α : Type u_1} (hd : α) (tl : list α), X list.nil (hd :: tl) = list.nil
-- X.equations._eqn_3 : ∀ {α : Type u_1} (hd : α) (tl : list α), X (hd :: tl) list.nil = list.nil
-- X.equations._eqn_4 : ∀ {α : Type u_1} (hd : α) (tl : list α) (hd_1 : α) (tl_1 : list α), X (hd :: tl) (hd_1 :: tl_1) = hd :: tl
</pre></div>

<a name="129588944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588944" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588944">Mario Carneiro (Jul 13 2018 at 08:48)</a>:</h4>
<p>notice that <code>X x y = x</code> is not an equation lemma since it has to do some case splits first</p>

<a name="129588952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588952" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588952">Kevin Buzzard (Jul 13 2018 at 08:49)</a>:</h4>
<p>right</p>

<a name="129588953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588953">Kevin Buzzard (Jul 13 2018 at 08:49)</a>:</h4>
<p>that all makes sense to me</p>

<a name="129588957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588957" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588957">Kevin Buzzard (Jul 13 2018 at 08:49)</a>:</h4>
<p>that's a lemma, that X x y = x</p>

<a name="129588976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129588976" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129588976">Kevin Buzzard (Jul 13 2018 at 08:50)</a>:</h4>
<p>actually it's perhaps not even true but I see your point whether or not this example is exactly right</p>

<a name="129589020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589020" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589020">Kevin Buzzard (Jul 13 2018 at 08:50)</a>:</h4>
<p>So I prove this lemma by cases on x</p>

<a name="129589033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589033" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589033">Kevin Buzzard (Jul 13 2018 at 08:50)</a>:</h4>
<p>and then I decree in my head that this is an equation lemma</p>

<a name="129589045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589045" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589045">Mario Carneiro (Jul 13 2018 at 08:51)</a>:</h4>
<p>Maybe a better example of an equation lemma for this one is <code>X [] y = []</code> and <code>X x [] = []</code></p>

<a name="129589054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589054">Mario Carneiro (Jul 13 2018 at 08:51)</a>:</h4>
<p>Neither of these is true by rfl</p>

<a name="129589055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589055">Kevin Buzzard (Jul 13 2018 at 08:51)</a>:</h4>
<p>yes</p>

<a name="129589063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589063">Kevin Buzzard (Jul 13 2018 at 08:51)</a>:</h4>
<p>both proof by cases</p>

<a name="129589069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589069">Kevin Buzzard (Jul 13 2018 at 08:51)</a>:</h4>
<p>These look like simp lemmas to me</p>

<a name="129589076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589076" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589076">Mario Carneiro (Jul 13 2018 at 08:51)</a>:</h4>
<p>They are that too</p>

<a name="129589080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589080" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589080">Kevin Buzzard (Jul 13 2018 at 08:51)</a>:</h4>
<p>So an equation lemma seems to me to have no formal definition</p>

<a name="129589082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589082" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589082">Mario Carneiro (Jul 13 2018 at 08:51)</a>:</h4>
<p>equation lemmas are often good simp lemmas</p>

<a name="129589123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589123" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589123">Kevin Buzzard (Jul 13 2018 at 08:52)</a>:</h4>
<p>it's "something which the user is clearly going to need again and again"</p>

<a name="129589129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589129">Kevin Buzzard (Jul 13 2018 at 08:52)</a>:</h4>
<p>so should probably be proved immediately after the definition</p>

<a name="129589134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589134" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589134">Mario Carneiro (Jul 13 2018 at 08:52)</a>:</h4>
<p>but sometimes they would lead to infinite unfolding, like the equation lemma for <code>value_aux</code></p>

<a name="129589143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589143" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589143">Kevin Buzzard (Jul 13 2018 at 08:52)</a>:</h4>
<p>I think nat is well-founded</p>

<a name="129589148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589148" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589148">Mario Carneiro (Jul 13 2018 at 08:52)</a>:</h4>
<p>equation lemmas for wf definitions often have that problem</p>

<a name="129589161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589161" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589161">Mario Carneiro (Jul 13 2018 at 08:53)</a>:</h4>
<p><code>gcd x y</code> unfolds forever when given <em>variable</em> <code>x</code> and <code>y</code></p>

<a name="129589173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589173" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589173">Kevin Buzzard (Jul 13 2018 at 08:53)</a>:</h4>
<p>Oh!</p>

<a name="129589177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589177">Mario Carneiro (Jul 13 2018 at 08:53)</a>:</h4>
<p>it doesn't matter that nat is well founded</p>

<a name="129589180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589180">Kevin Buzzard (Jul 13 2018 at 08:53)</a>:</h4>
<p>Oh you're absolutely right!</p>

<a name="129589195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589195" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589195">Mario Carneiro (Jul 13 2018 at 08:53)</a>:</h4>
<p>because these are open terms</p>

<a name="129589197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589197" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589197">Kevin Buzzard (Jul 13 2018 at 08:53)</a>:</h4>
<p>We're not doing case splits on constructors for multiset or whatever</p>

<a name="129589205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589205">Kevin Buzzard (Jul 13 2018 at 08:53)</a>:</h4>
<p>oh so that lemma is actually quite dangerous!</p>

<a name="129589246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589246" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589246">Kevin Buzzard (Jul 13 2018 at 08:54)</a>:</h4>
<p>Shall I make it a simp lemma?</p>

<a name="129589257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589257" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589257">Mario Carneiro (Jul 13 2018 at 08:54)</a>:</h4>
<p>yes, you only want to use it with <code>rw</code> or <code>simp {single_pass := tt}</code></p>

<a name="129589266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589266">Kevin Buzzard (Jul 13 2018 at 08:54)</a>:</h4>
<p>right</p>

<a name="129589273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589273" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589273">Mario Carneiro (Jul 13 2018 at 08:54)</a>:</h4>
<p>it should definitely not be a simp lemma</p>

<a name="129589278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589278">Kevin Buzzard (Jul 13 2018 at 08:54)</a>:</h4>
<p>right!</p>

<a name="129589302"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589302" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589302">Kevin Buzzard (Jul 13 2018 at 08:55)</a>:</h4>
<p>I gave an entire lecture on functions last Monday</p>

<a name="129589305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589305">Kevin Buzzard (Jul 13 2018 at 08:55)</a>:</h4>
<p>I feel like I could give another one now</p>

<a name="129589309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589309">Mario Carneiro (Jul 13 2018 at 08:55)</a>:</h4>
<p>:)</p>

<a name="129589315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589315" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589315">Kevin Buzzard (Jul 13 2018 at 08:55)</a>:</h4>
<p>Many thanks as ever Mario.</p>

<a name="129589518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129589518" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129589518">Kevin Buzzard (Jul 13 2018 at 08:59)</a>:</h4>
<p>What's nice about zulip rather than IRL meetings is that now I understand much better I can just read through the thread again with the benefit of hindsight and try to catch extra subtleties.</p>

<a name="129590094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/multiset/near/129590094" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/00248multiset.html#129590094">Kevin Buzzard (Jul 13 2018 at 09:12)</a>:</h4>
<blockquote>
<p>Half of the work is taking your "definition" and turning it into something lean will accept, and the other half is getting back to the original thing you wanted to call the definition</p>
</blockquote>
<p>This is somehow the key point. I have quite a flexible way of thinking about definitions and their basic properties, I guess because mathematicians are trained like that. Some properties of a definition are so completely basic that I think I've got into the habit of simply <em>assuming</em> that they will be (a) true and (b) <code>rfl</code>. For simple functions this might well be the case. For more complex definitions which need some bending to shove into Lean, life might not be so easy. I have a definition by induction on two variables, and Mario's equation lemma is exactly how I am thinking the definition "works". I shove the definition into Lean in perhaps an inelegant way ("Mario wrote <code>multiset.strong_induction_on</code> and I can apply it twice, that'll do") and now I need to be aware of the fact that Lean's understanding of the function is now quite far from my intuitive idea of how it works, and it should now be a top priority to sort this situation out by proving the lemmas which say that the definition behaves the way I expect it to. If I'm writing some API then I might want to consider proving these so-called "equation lemmas" -- this is an informal definition and it seems to mean "the lemmas which an end user might expect to be true by definition, whether or not they are true by <code>rfl</code>" -- immediately after the definition of the function. Some might already be there with exotic names with <code>_</code>s in, and the ones that are not should be written as a matter of priority or other mathematicians will not be able to use the function in the intuitive way which they would like to.</p>


{% endraw %}
