---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/46415tacticsfornumbers.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html">tactics for numbers</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="172855120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855120">Johan Commelin (Aug 09 2019 at 14:21)</a>:</h4>
<p>I'm about to leave on vacation (-; If anyone happens to get bored during the holidays, here is a little silly idea for a tactic. We discussed these kind of issues before, but maybe not exactly this.<br>
(Ooh, and the <code>norm_cast</code> bundle is really fantastic, it makes life a lot easier!)<br>
Suppose that <code>n : int</code> and <code>h : n ≥ 0</code>.<br>
Then every mathematician (and especially if they are new to Lean) wants to say <code>n : nat</code>. But that is not possible.<br>
So I wish for a tactic</p>
<div class="codehilite"><pre><span></span><span class="n">lift_int_to_nat</span> <span class="n">h</span> <span class="o">(</span><span class="k">with</span> <span class="n">name</span><span class="o">)</span><span class="err">?</span><span class="bp">`</span>
</pre></div>


<p>that will create a new <code>N : nat</code> and a proof <code>hN : n = (N : int)</code>.</p>

<a name="172855200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855200">Johan Commelin (Aug 09 2019 at 14:22)</a>:</h4>
<p>Extra goodies: figure out if <code>n</code> is an atom, and if so call <code>subst n</code> afterwards.</p>

<a name="172855236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855236" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855236">Johan Commelin (Aug 09 2019 at 14:22)</a>:</h4>
<p>Also, that goodie should automatically re-use the name of the atom for the new <code>nat</code> (so <code>n</code> in this example).</p>

<a name="172855272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855272" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855272">Johan Commelin (Aug 09 2019 at 14:23)</a>:</h4>
<p>The <code>N : nat</code> could be defined as <code>n.nat_abs</code>.</p>

<a name="172855296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855296" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855296">Johan Commelin (Aug 09 2019 at 14:23)</a>:</h4>
<p>We could have similar tactics <code>lift_rat_to_int</code> and maybe <code>lift_rat_to_nat</code>.</p>

<a name="172855348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855348">Johan Commelin (Aug 09 2019 at 14:24)</a>:</h4>
<p>Maybe they all be bundled into one super-tactic.</p>

<a name="172855362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172855362" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172855362">Johan Commelin (Aug 09 2019 at 14:24)</a>:</h4>
<p>Also: suggestions for better names are very welcome!</p>

<a name="172875576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172875576" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172875576">Mario Carneiro (Aug 09 2019 at 18:21)</a>:</h4>
<p>isn't this just <code>cases</code> on an appropriate theorem?</p>

<a name="172875693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172875693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172875693">Mario Carneiro (Aug 09 2019 at 18:22)</a>:</h4>
<p>and you can do the other stuff with <code>rcases</code> or <code>obtain</code></p>

<a name="172891021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172891021" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172891021">Floris van Doorn (Aug 09 2019 at 21:35)</a>:</h4>
<p>You mean something like this?</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">n</span> <span class="n">m</span> <span class="n">k</span> <span class="o">:</span> <span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">hk</span> <span class="o">:</span> <span class="n">k</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">≥</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">m</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">lift</span> <span class="n">n</span> <span class="n">to</span> <span class="bp">ℕ</span> <span class="kn">using</span> <span class="n">h</span><span class="o">,</span> <span class="c1">-- new goal: ↑n = m</span>
  <span class="n">lift</span> <span class="n">m</span> <span class="n">to</span> <span class="bp">ℕ</span><span class="o">,</span> <span class="c1">-- new goals: ↑n = ↑m and m ≥ 0</span>
  <span class="n">lift</span> <span class="o">(</span><span class="n">k</span> <span class="bp">+</span> <span class="err">↑</span><span class="n">n</span><span class="o">)</span> <span class="n">to</span> <span class="bp">ℕ</span> <span class="kn">using</span> <span class="n">hk</span> <span class="k">with</span> <span class="n">l</span> <span class="n">hl</span><span class="o">,</span> <span class="c1">-- new assumptions: l : ℕ and hl : ↑l = k + ↑n</span>
<span class="kn">end</span>
</pre></div>


<p>I'm currently cleaning up my tactic.<br>
Mario is right that it's basically just <code>cases</code> on an appropriate theorem, but it's useful to have syntax that is a shortcut for that.</p>

<a name="172891164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172891164" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172891164">Floris van Doorn (Aug 09 2019 at 21:37)</a>:</h4>
<p>In the back-end there is the following class you have to provide an instance for:</p>
<div class="codehilite"><pre><span></span>class can_lift (α : Type u) (β : Type v) : Type (max u v) :=
(coe : α → β)
(cond : β → Prop)
(prf : ∀(y : β), cond y → ∃(x : α), coe x = y)
</pre></div>


<p>The instance I needed to provide for my previous tactic script (to lift from <code>ℤ</code> to <code>ℕ</code>) is: </p>
<div class="codehilite"><pre><span></span>@[can_lift_simp] instance : can_lift ℕ ℤ :=
⟨coe, λ n, n ≥ 0, λ n hn, ⟨n.nat_abs, int.nat_abs_of_nonneg hn⟩⟩
</pre></div>

<a name="172895197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172895197" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172895197">Floris van Doorn (Aug 09 2019 at 22:41)</a>:</h4>
<p>What is the canonical way to make an expression application in tactic mode?</p>
<ul>
<li>If I do</li>
</ul>
<div class="codehilite"><pre><span></span>my_expr ← mk_app `can_lift.prf [new_tp, old_tp, inst, e, prf]
</pre></div>


<p>then I get an error, saying it cannot unify the type of <code>prf</code> with the expected type. It seems that <code>mk_app</code> is doing this unification in the "wrong order", because it doesn't seem to know the other arguments to <code>can_lift.prf</code> yet (which it needs to do the unification).</p>
<ul>
<li>If I do</li>
</ul>
<div class="codehilite"><pre><span></span>let my_expr := `(@can_lift.prf.{0 0} %%new_tp %%old_tp %%inst %%e %%prf),
</pre></div>


<p>I have to manually check that this type-checks (which is fine, I guess). I also need to figure out the universe levels myself (is there an easier way than doing <code>infer_type</code> on my types, and then match the result with <code>expr.sort u</code>?)</p>

<a name="172895345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172895345" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172895345">Floris van Doorn (Aug 09 2019 at 22:43)</a>:</h4>
<p>My mostly complete tactic is here: <a href="https://github.com/leanprover-community/mathlib/blob/lift_to/src/tactic/lift_to.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/lift_to/src/tactic/lift_to.lean">https://github.com/leanprover-community/mathlib/blob/lift_to/src/tactic/lift_to.lean</a></p>

<a name="172896025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172896025" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172896025">Kevin Buzzard (Aug 09 2019 at 22:54)</a>:</h4>
<p>I don't think Johan will be looking at the chat for about two weeks :-) But I'm sure he'll be very grateful! I love the way that people just do stuff for other people here.</p>

<a name="172896086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172896086" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172896086">Kevin Buzzard (Aug 09 2019 at 22:55)</a>:</h4>
<p>I guess it's because lean is fun. The Imperial guy seemed very impressed with the community's efforts on the 1988 IMO problem, although I don't know how much he understood...</p>

<a name="172899270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172899270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172899270">Scott Morrison (Aug 09 2019 at 23:57)</a>:</h4>
<p>This looks really cool, and I love the user experience!</p>

<a name="172937545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172937545" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172937545">Floris van Doorn (Aug 10 2019 at 19:41)</a>:</h4>
<p>PR'd the tactic: <a href="https://github.com/leanprover-community/mathlib/issues/1315" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/1315">#1315</a></p>

<a name="172948968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactics%20for%20numbers/near/172948968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46415tacticsfornumbers.html#172948968">Floris van Doorn (Aug 11 2019 at 02:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>: Yeah, I also like that about this community. </p>
<p>I also think that it is really valuable to have these kinds of tactics that make common patterns more convenient to do (other examples include <code>rcases</code>, <code>rintro</code>, <code>simpa</code>, <code>norm_cast</code>, <code>norm_num</code>, and many more).</p>
<p>Lastly, it is good for me to regularly work on short projects. When I only work on long-term projects, I sometimes lose track of the reasons that they are important.</p>


{% endraw %}

{% include archive_update.html %}