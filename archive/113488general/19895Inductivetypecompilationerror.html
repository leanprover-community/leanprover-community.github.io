---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/19895Inductivetypecompilationerror.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html">Inductive type compilation error</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="157408201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408201" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408201">Jesse Michael Han (Feb 02 2019 at 05:12)</a>:</h4>
<p>What's up with the following error? The presence of the <code>complete_boolean_algebra</code> instance in the following code</p>
<div class="codehilite"><pre><span></span><span class="kn">universe</span> <span class="n">u</span>

<span class="kn">inductive</span> <span class="n">B_name</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="n">complete_boolean_algebra</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">u</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="c1">-- complains only if complete_boolean_algebra instance is there</span>
<span class="bp">|</span> <span class="n">mk</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="o">(</span><span class="n">B_name</span> <span class="bp">×</span> <span class="n">β</span><span class="o">))</span> <span class="o">:</span> <span class="n">B_name</span>
</pre></div>


<p>results in the following error message:</p>
<div class="codehilite"><pre><span></span><span class="mi">23</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span> <span class="n">nested</span> <span class="kn">inductive</span> <span class="n">type</span> <span class="n">compiled</span> <span class="n">to</span> <span class="n">invalid</span> <span class="kn">inductive</span> <span class="n">type</span>
<span class="n">nested</span> <span class="n">exception</span> <span class="n">message</span><span class="o">:</span>
<span class="n">type</span> <span class="n">mismatch</span> <span class="n">at</span> <span class="kn">definition</span> <span class="err">&#39;</span><span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">sizeof_spec&#39;</span><span class="o">,</span> <span class="n">has</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">complete_boolean_algebra</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">β_inst_inst</span> <span class="o">:</span> <span class="n">has_sizeof</span> <span class="n">β</span><span class="o">]</span>
  <span class="o">(</span><span class="n">fst</span> <span class="o">:</span> <span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">B_name</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span><span class="o">)</span> <span class="o">(</span><span class="n">snd</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span>
    <span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">β_inst_inst</span> <span class="o">(</span><span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">mk</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">fst</span> <span class="n">snd</span><span class="o">)</span> <span class="bp">=</span>
      <span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">β_inst_inst</span> <span class="o">(</span><span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">mk</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">fst</span> <span class="n">snd</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="bp">∀</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">[</span><span class="bp">_</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">complete_boolean_algebra</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">β_inst_inst</span> <span class="o">:</span> <span class="n">has_sizeof</span> <span class="n">β</span><span class="o">]</span>
  <span class="o">(</span><span class="n">fst</span> <span class="o">:</span> <span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">B_name</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span><span class="o">)</span> <span class="o">(</span><span class="n">snd</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span>
    <span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">sizeof</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">β_inst_inst</span> <span class="o">(</span><span class="bp">_</span><span class="n">nest_1_1</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">B_name</span><span class="bp">.</span><span class="n">mk</span> <span class="n">β</span> <span class="bp">_</span><span class="n">inst_1</span> <span class="n">fst</span> <span class="n">snd</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">+</span> <span class="n">sizeof</span> <span class="n">snd</span>
</pre></div>

<a name="157408397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408397" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408397">Mario Carneiro (Feb 02 2019 at 05:17)</a>:</h4>
<p>That's a nested inductive type</p>

<a name="157408398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408398">Mario Carneiro (Feb 02 2019 at 05:17)</a>:</h4>
<p>these aren't compiled very well</p>

<a name="157408442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408442" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408442">Jesse Michael Han (Feb 02 2019 at 05:18)</a>:</h4>
<p>Does the presence of the <code>complete_boolean_algebra</code> instance make it nested, or is it nested because of the type of the constructor <code>mk</code>?</p>

<a name="157408453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408453" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408453">Mario Carneiro (Feb 02 2019 at 05:19)</a>:</h4>
<p>an isomorphic regular inductive is</p>
<div class="codehilite"><pre><span></span>inductive B_name (β : Type u) [complete_boolean_algebra β] : Type (u+1) -- complains only if complete_boolean_algebra instance is there
| mk (α : Type u) (A : α → B_name) (B : α → β) : B_name
</pre></div>

<a name="157408497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408497">Mario Carneiro (Feb 02 2019 at 05:20)</a>:</h4>
<p>it's the fact that you used a product of some type that hasn't been constructed yet</p>

<a name="157408519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408519">Jesse Michael Han (Feb 02 2019 at 05:21)</a>:</h4>
<p>I see... I guess it's "simpler" to just specify two simultaneous values instead of specifying a pair as a value</p>

<a name="157408520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408520" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408520">Jesse Michael Han (Feb 02 2019 at 05:21)</a>:</h4>
<p>Thanks for clarifying!</p>

<a name="157408617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Inductive%20type%20compilation%20error/near/157408617" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/19895Inductivetypecompilationerror.html#157408617">Mario Carneiro (Feb 02 2019 at 05:24)</a>:</h4>
<p>Well, it's mostly the fact that inductives have a strict specification on what is allowed in the constructors, and other inductive types aren't in that specification. Lean has a trick for compiling them anyway, but it's complicated and not completely correct in some edge cases</p>


{% endraw %}
