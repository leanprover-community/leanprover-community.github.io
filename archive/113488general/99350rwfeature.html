---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/99350rwfeature.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html">rw feature</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="132628472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132628472" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132628472">Kevin Buzzard (Aug 23 2018 at 09:54)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">H2</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">c</span><span class="o">))</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="o">(</span><span class="n">H2</span> <span class="n">H</span><span class="o">)</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span> <span class="c1">-- does nothing</span>
  <span class="n">exact</span> <span class="n">H</span> <span class="c1">-- fails</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">H2</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">c</span><span class="o">))</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">H&#39;</span> <span class="o">:=</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="n">H2</span> <span class="n">H&#39;</span><span class="o">)</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span> <span class="c1">-- works fine</span>
  <span class="n">exact</span> <span class="n">H</span>
<span class="kn">end</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">H2</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">a</span> <span class="bp">=</span> <span class="n">c</span><span class="o">))</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="n">H&#39;</span> <span class="o">:=</span> <span class="n">H</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">(</span><span class="n">H2</span> <span class="n">H</span><span class="o">)</span> <span class="n">at</span> <span class="n">H&#39;</span><span class="o">,</span> <span class="c1">-- works fine</span>
  <span class="n">exact</span> <span class="n">H&#39;</span>
<span class="kn">end</span>
</pre></div>


<p>Is this a bug, or is it not a good idea to let rewrites affect hypotheses which are used to construct the term being rewritten? (or both?)</p>

<a name="132628548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132628548" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132628548">Kevin Buzzard (Aug 23 2018 at 09:56)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">false</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">rw</span> <span class="n">H</span> <span class="n">at</span> <span class="n">H</span><span class="o">,</span> <span class="c1">-- I would expect H to become b = b...</span>
  <span class="n">sorry</span>
<span class="kn">end</span>
</pre></div>

<a name="132628571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132628571" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132628571">Kevin Buzzard (Aug 23 2018 at 09:57)</a>:</h4>
<p>[PS this is not frivolous -- I just attempted to do a rewrite on a term which I had used to explicitly fill in something which type class inference couldn't infer, and it silently failed]</p>

<a name="132639780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132639780" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132639780">Simon Hudon (Aug 23 2018 at 14:11)</a>:</h4>
<p>I think <code>rw</code> does not rewrite the assumptions themselves because if you have:</p>
<div class="codehilite"><pre><span></span>h0 : a = b,
h1 : a = c
...
</pre></div>


<p><code>rw h0 at *</code> would transform <code>h0</code> into <code>b = b</code> and then <code>rw</code> would not be able to rewrite <code>h1</code>.</p>

<a name="132639895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132639895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132639895">Simon Hudon (Aug 23 2018 at 14:13)</a>:</h4>
<p>I suspect the developers consciously decided to not let <code>rw</code> rewrite assumptions using themselves as a rule. If the assumptions eventually get reshuffled, the design of <code>rw</code> makes the re-execution of the same proof less surprising. Does <code>simp</code> or <code>dsimp</code> help in your situation?</p>

<a name="132639964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132639964" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132639964">Kevin Buzzard (Aug 23 2018 at 14:14)</a>:</h4>
<p>I did exactly what I suggested in my original post -- I just introduced a new hypothesis which was by definition the old one :-)</p>

<a name="132640206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132640206" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132640206">Simon Hudon (Aug 23 2018 at 14:20)</a>:</h4>
<p>Ah ok, I thought it might fit in a more complex situation. So it would rank as "annoying", I assume</p>

<a name="132640291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132640291" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132640291">Kevin Buzzard (Aug 23 2018 at 14:21)</a>:</h4>
<p>Yeah, I'm helping undergraduates to write code and today has been quite an annoying day for some reason, I've had to introduce several workarounds for things.</p>

<a name="132640475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rw%20feature/near/132640475" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/99350rwfeature.html#132640475">Simon Hudon (Aug 23 2018 at 14:24)</a>:</h4>
<p>I think that happens a lot in any programming language: with time, you start instinctively avoiding the pain points and then the newcomers run right into them</p>


{% endraw %}
