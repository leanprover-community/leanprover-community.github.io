---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/65884segfault.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html">segfault</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="131243767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131243767" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131243767">Rob Lewis (Aug 11 2018 at 01:16)</a>:</h4>
<p>I just managed to crash Lean, and realized it's been quite a while since the last time!</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">wlog</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">wlog</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span> <span class="kn">using</span> <span class="o">[</span><span class="n">x</span> <span class="n">x</span><span class="o">],</span>
<span class="kn">end</span>
</pre></div>

<a name="131243856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131243856" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131243856">Rob Lewis (Aug 11 2018 at 01:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> This isn't really your problem in the end, but maybe it's possible to work around in <code>wlog</code>?</p>

<a name="131244268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131244268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131244268">Kevin Buzzard (Aug 11 2018 at 01:22)</a>:</h4>
<p>Oh nice! I absolutely agree -- Lean has been super-stable since they fixed some memory leak several months ago, it's been a joy to use. I do get the occasional segfault, almost always because my input file is garbage (e.g. I'm deleting hundreds of lines of a file and Lean just started to read a file which starts in the middle of a proof, or possibly even the middle of a word), and furthermore I've never been able to reproduce. It's very rare to get a reproducible segfault nowadays. I can reproduce here BTW.</p>

<a name="131833394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833394">Mario Carneiro (Aug 11 2018 at 02:26)</a>:</h4>
<p>Found it</p>
<div class="codehilite"><pre><span></span>open tactic
example (x : ℕ) : true :=
by do x ← get_local `x, revert_lst [x, x]
</pre></div>

<a name="131833409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833409">Mario Carneiro (Aug 11 2018 at 02:27)</a>:</h4>
<p>don't revert the same variable twice, I guess</p>

<a name="131833419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833419" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833419">Kevin Buzzard (Aug 11 2018 at 02:27)</a>:</h4>
<p>I remember my mother telling me that as a child</p>

<a name="131833424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833424">Mario Carneiro (Aug 11 2018 at 02:27)</a>:</h4>
<p>note that using <code>revert x</code> twice causes a regular error in the second call</p>

<a name="131833506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833506" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833506">Kevin Buzzard (Aug 11 2018 at 02:29)</a>:</h4>
<p><code>revert_lst</code> has no docstring :-(</p>

<a name="131833511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833511" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833511">Mario Carneiro (Aug 11 2018 at 02:29)</a>:</h4>
<p>presumably it reverts a list</p>

<a name="131833614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131833614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131833614">Kevin Buzzard (Aug 11 2018 at 02:31)</a>:</h4>
<p>or a <code>lst</code></p>

<a name="131842254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/131842254" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#131842254">Simon Hudon (Aug 11 2018 at 05:35)</a>:</h4>
<blockquote>
<p>don't revert the same variable twice, I guess</p>
</blockquote>
<p>I'll do what I want!</p>

<a name="133463161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133463161" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133463161">Kevin Buzzard (Sep 07 2018 at 05:18)</a>:</h4>
<p>another wloggy segfault:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">wlog</span>

<span class="kn">example</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">):</span> <span class="n">false</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">wlog</span> <span class="n">h</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">m</span><span class="o">,</span> <span class="c1">-- segv</span>
<span class="kn">end</span>
</pre></div>


<p>(as you can guess this is the first time I used wlog, I was just trying things out)</p>

<a name="133463196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133463196" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133463196">Simon Hudon (Sep 07 2018 at 05:19)</a>:</h4>
<p>Dang! I don't remember putting segfault as one of the features</p>

<a name="133463264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133463264" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133463264">Simon Hudon (Sep 07 2018 at 05:20)</a>:</h4>
<p>Can you edit the <code>mathlib</code> sources?</p>

<a name="133464351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464351">Mario Carneiro (Sep 07 2018 at 05:40)</a>:</h4>
<p>fixed</p>

<a name="133464363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464363">Simon Hudon (Sep 07 2018 at 05:40)</a>:</h4>
<p>What was the issue?</p>

<a name="133464406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464406">Mario Carneiro (Sep 07 2018 at 05:41)</a>:</h4>
<p>it triggered the <code>x &lt;= y</code> special case and assumed <code>n + n</code> was a variable</p>

<a name="133464424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464424">Mario Carneiro (Sep 07 2018 at 05:41)</a>:</h4>
<p>I am not sure what happened after that, but possibly this got passed into <code>revert</code></p>

<a name="133464482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464482" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464482">Mario Carneiro (Sep 07 2018 at 05:42)</a>:</h4>
<p>that's what caused the last segfault, at least</p>

<a name="133464486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464486">Simon Hudon (Sep 07 2018 at 05:42)</a>:</h4>
<p>I see. That was not a source of segfault I thought of</p>

<a name="133464510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464510" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464510">Simon Hudon (Sep 07 2018 at 05:42)</a>:</h4>
<p>Did you add Kevin's example to the test suite?</p>

<a name="133464520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464520" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464520">Mario Carneiro (Sep 07 2018 at 05:43)</a>:</h4>
<p>I think <code>wlog</code> parsing is currently way too complicated. It should be broken up and documented</p>

<a name="133464532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464532" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464532">Simon Hudon (Sep 07 2018 at 05:43)</a>:</h4>
<p>That makes sense, I really don't understand the tactic anymore.</p>

<a name="133464737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464737">Mario Carneiro (Sep 07 2018 at 05:46)</a>:</h4>
<p>This test fails now:</p>
<div class="codehilite"><pre><span></span>example {x y z : ℕ} : true :=
begin
  suffices : false, trivial,
  wlog h : x ≤ y + z,
  { guard_target x ≤ y + z ∨ x ≤ z + y,
    admit },
  { guard_hyp h := x ≤ y + z,
    guard_target false,
    admit }
end
</pre></div>


<p>what the heck is this supposed to do?</p>

<a name="133464783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464783" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464783">Simon Hudon (Sep 07 2018 at 05:47)</a>:</h4>
<p>Can you show the state right after <code>wlog</code>?</p>

<a name="133464784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464784" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464784">Mario Carneiro (Sep 07 2018 at 05:47)</a>:</h4>
<p>it fails</p>

<a name="133464841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464841">Mario Carneiro (Sep 07 2018 at 05:48)</a>:</h4>
<p>the error is <code>To generate cases at least two permutations are required, i.e. `using [x y, y x]` or exactly 0 or 2 variables</code> but the problem is that the given pattern <code>x ≤ y + z</code> has 3 variables</p>

<a name="133464866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464866" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464866">Simon Hudon (Sep 07 2018 at 05:48)</a>:</h4>
<p>It tries to prove false just to make sure that no call to <code>trivial</code> or assumption finishes the goal before we can see the result</p>

<a name="133464900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464900" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464900">Simon Hudon (Sep 07 2018 at 05:49)</a>:</h4>
<p>Ah I see. That's from when we only considered two variables</p>

<a name="133464914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464914" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464914">Simon Hudon (Sep 07 2018 at 05:49)</a>:</h4>
<p>It guessed <code>x</code> and <code>y</code>.</p>

<a name="133464971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464971" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464971">Mario Carneiro (Sep 07 2018 at 05:50)</a>:</h4>
<p>My question is, what is this supposed to do in the first place? It used to just take the last two variables and permute them, as you can see from the asserted target</p>

<a name="133464977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464977" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464977">Simon Hudon (Sep 07 2018 at 05:50)</a>:</h4>
<p>I'm surprised it hasn't failed before</p>

<a name="133464999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133464999" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133464999">Mario Carneiro (Sep 07 2018 at 05:50)</a>:</h4>
<p>It was previously just matching the list of variables against <code>(x :: y :: _)</code> i.e. &gt;= 2 vars, take the first 2</p>

<a name="133465010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465010" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465010">Mario Carneiro (Sep 07 2018 at 05:51)</a>:</h4>
<p>I changed this to <code>[x, y]</code> and now this test fails</p>

<a name="133465041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465041">Simon Hudon (Sep 07 2018 at 05:51)</a>:</h4>
<p>Why are you changing it to <code>[x,y]</code>?</p>

<a name="133465126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465126" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465126">Simon Hudon (Sep 07 2018 at 05:53)</a>:</h4>
<p>You were the one suggesting we guess the last two variables of the pattern.</p>

<a name="133465136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465136" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465136">Mario Carneiro (Sep 07 2018 at 05:53)</a>:</h4>
<p>No, that's what it was doing before I touched it</p>

<a name="133465154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465154" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465154">Mario Carneiro (Sep 07 2018 at 05:54)</a>:</h4>
<p>I don't understand why the code is written that way, but there is a test asserting this behavior</p>

<a name="133465303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465303">Simon Hudon (Sep 07 2018 at 05:56)</a>:</h4>
<p>I'm looking at master right now and what I see is <code>(x :: y :: _)</code>, not <code>[x, y]</code></p>

<a name="133465862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133465862" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133465862">Mario Carneiro (Sep 07 2018 at 06:05)</a>:</h4>
<p><a href="https://github.com/leanprover/mathlib/blob/master/tactic/wlog.lean#L203" target="_blank" title="https://github.com/leanprover/mathlib/blob/master/tactic/wlog.lean#L203">https://github.com/leanprover/mathlib/blob/master/tactic/wlog.lean#L203</a></p>

<a name="133466307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466307" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466307">Simon Hudon (Sep 07 2018 at 06:12)</a>:</h4>
<p>My mistake, I must have done something wrong</p>

<a name="133466314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466314" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466314">Simon Hudon (Sep 07 2018 at 06:12)</a>:</h4>
<p>What happens if you switch it back to <code>(x :: y :: _)</code>?</p>

<a name="133466399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466399">Mario Carneiro (Sep 07 2018 at 06:14)</a>:</h4>
<p>then it works, although the behavior in that case is peculiar</p>

<a name="133466434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466434">Mario Carneiro (Sep 07 2018 at 06:15)</a>:</h4>
<p>it just permutes the last two variables discovered in the term, which is a bit weirdly nondeterministic</p>

<a name="133466559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466559" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466559">Simon Hudon (Sep 07 2018 at 06:17)</a>:</h4>
<p>What would you expect it to do in this case?</p>

<a name="133466711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466711" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466711">Mario Carneiro (Sep 07 2018 at 06:19)</a>:</h4>
<p>fail, or do all permutations of the n variables</p>

<a name="133466801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466801" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466801">Johan Commelin (Sep 07 2018 at 06:20)</a>:</h4>
<p>permutations are now in mathlib. Does that help?</p>

<a name="133466835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466835" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466835">Johan Commelin (Sep 07 2018 at 06:21)</a>:</h4>
<p>Ooh, wait. They were already for a long time... it is the signs that are new.</p>

<a name="133466842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133466842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133466842">Mario Carneiro (Sep 07 2018 at 06:21)</a>:</h4>
<p>we already had <code>list.permutations</code></p>

<a name="133467037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467037">Simon Hudon (Sep 07 2018 at 06:24)</a>:</h4>
<p>I'm not sure if you recall but we have had that conversation before. You were in favor of guessing the variables, I was in favor of requiring that the user specify them</p>

<a name="133467099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467099" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467099">Mario Carneiro (Sep 07 2018 at 06:25)</a>:</h4>
<p>Actually both options are available here</p>

<a name="133467319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467319" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467319">Mario Carneiro (Sep 07 2018 at 06:28)</a>:</h4>
<p>honestly I have no idea why it's so complicated. 2 variables seems to be special cased in the parsing, so <code>wlog h : x ≤ y + z using x y z</code> just fails (previously it would just permute <code>x</code> and <code>y</code>)</p>

<a name="133467406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467406">Mario Carneiro (Sep 07 2018 at 06:29)</a>:</h4>
<p>Part of the problem is that I don't know the specification of the tactic, and the code is so ad hoc it's hard to tell what is intended and what is accident</p>

<a name="133467904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467904" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467904">Simon Hudon (Sep 07 2018 at 06:35)</a>:</h4>
<p>It's probably that I started it intending to support only two variables and <span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> probably didn't want to disturb too much</p>

<a name="133467916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467916" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467916">Simon Hudon (Sep 07 2018 at 06:35)</a>:</h4>
<p>Do you want to settle on a specification now?</p>

<a name="133467987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133467987" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133467987">Mario Carneiro (Sep 07 2018 at 06:36)</a>:</h4>
<p>I'm trying to get one out of the docstring now</p>

<a name="133468471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133468471" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133468471">Mario Carneiro (Sep 07 2018 at 06:43)</a>:</h4>
<p>There are I guess 24 combinations resulting from the parse:</p>
<div class="codehilite"><pre><span></span>wlog h? (: pat)? (:= r)? (using x y z)?
wlog h? (: pat)? (:= r)? (using [x y z, z y x])?
</pre></div>


<ul>
<li><code>h</code> is just a name. If it is omitted, the default name is <code>case</code> (Although from the code it looks like if <code>r</code> is the name of a local constant then it is renamed to <code>h</code>?)</li>
</ul>

<a name="133468600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133468600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133468600">Mario Carneiro (Sep 07 2018 at 06:46)</a>:</h4>
<ul>
<li>If <code>pat</code> and <code>r</code> are both omitted there is an error</li>
<li>If <code>pat</code> is given but not <code>r</code> it becomes a subgoal</li>
<li>If <code>r</code> is given but not <code>pat</code> it is reconstructed as the first disjunct of <code>r</code>'s type</li>
</ul>

<a name="133468776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133468776" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133468776">Mario Carneiro (Sep 07 2018 at 06:49)</a>:</h4>
<ul>
<li>If <code>using</code> list is omitted it is inferred as the set of distinct variables in <code>pat</code></li>
<li>If <code>using</code> is a list of variables then all permutations of those variables are considered</li>
<li>If <code>using</code> is a nonempty list of permutations then the first permutation is considered as the list of variables (and the rest must actually be permutations)</li>
<li>If <code>using</code> is an empty list of permutations it is treated as omitted</li>
</ul>

<a name="133469008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469008" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469008">Mario Carneiro (Sep 07 2018 at 06:52)</a>:</h4>
<p>Oh, I think this is the justification for the last two variables thing:</p>
<div class="codehilite"><pre><span></span>(4) `wlog : R x y using x y` and `wlog : R x y`
  Produces the case `R x y ∨ R y x`. If `R` is ≤, then the disjunction discharged using linearity.
  If `using x y` is avoided then `x` and `y` are the last two variables appearing in the
  expression `R x y`. -/
</pre></div>

<a name="133469052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469052" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469052">Simon Hudon (Sep 07 2018 at 06:53)</a>:</h4>
<p>Yes, I think that was the entirety of the docstring before Johannes worked on <code>wlog</code></p>

<a name="133469109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469109">Mario Carneiro (Sep 07 2018 at 06:54)</a>:</h4>
<p>I guess this is to allow for when the relation is itself parameterized in some variables</p>

<a name="133469133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469133">Mario Carneiro (Sep 07 2018 at 06:54)</a>:</h4>
<p>I wonder whether we can use type information to eliminate some permutations</p>

<a name="133469134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469134" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469134">Simon Hudon (Sep 07 2018 at 06:54)</a>:</h4>
<p>I think we can map those notations to a set of core parameters. Sometimes they are specified by the user, sometimes they have to be guessed. Working from there, we should say how they are guessed and what is done with those core parameters.</p>

<a name="133469179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469179" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469179">Mario Carneiro (Sep 07 2018 at 06:55)</a>:</h4>
<p>There is already a notion of core parameters, I think, which are used in <code>tactic.wlog</code> (noninteractive)</p>

<a name="133469201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469201" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469201">Simon Hudon (Sep 07 2018 at 06:55)</a>:</h4>
<p>Ah good so now we're only struggling with parsing / guessing</p>

<a name="133469273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469273" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469273">Simon Hudon (Sep 07 2018 at 06:56)</a>:</h4>
<p>Actually <code>R x y</code> was just a way of writing <code>x ≤ y</code> while not involving a specific relation.</p>

<a name="133469274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469274" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469274">Mario Carneiro (Sep 07 2018 at 06:56)</a>:</h4>
<p>Right, the parser is the behemoth</p>

<a name="133469287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469287" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469287">Mario Carneiro (Sep 07 2018 at 06:56)</a>:</h4>
<p>I think there was some example where a relation like <code>x = y [mod n]</code> came up</p>

<a name="133469307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469307" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469307">Mario Carneiro (Sep 07 2018 at 06:57)</a>:</h4>
<p>but even <code>has_le.le</code> can use variables, like the type or instance - we don't want to permute these</p>

<a name="133469395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469395" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469395">Simon Hudon (Sep 07 2018 at 06:58)</a>:</h4>
<p>That's true</p>

<a name="133469448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469448">Mario Carneiro (Sep 07 2018 at 06:59)</a>:</h4>
<p>I was thinking we can use permutations for which the permuted relation is well typed, but this has exponential growth for large relations</p>

<a name="133469562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469562">Mario Carneiro (Sep 07 2018 at 07:01)</a>:</h4>
<p>Alternatively, we can require that permuted variables have the same type as each other, but maybe there are counterexamples where you permute a&lt;-&gt;b and c&lt;-&gt;d where <code>c : T a</code> and <code>d : T b</code></p>

<a name="133469606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133469606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133469606">Mario Carneiro (Sep 07 2018 at 07:01)</a>:</h4>
<p>then again, in this case you will certainly be providing the permutation list explicitly so we don't have to guess it</p>

<a name="133470142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133470142" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133470142">Mario Carneiro (Sep 07 2018 at 07:11)</a>:</h4>
<p>actually, <code>tactic.wlog</code> is also doing some fancy footwork, and it has no segfault protection of its own</p>

<a name="133470276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133470276" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133470276">Mario Carneiro (Sep 07 2018 at 07:13)</a>:</h4>
<p>The signature is</p>
<div class="codehilite"><pre><span></span>meta def wlog (vars&#39; : list expr) (h_cases fst_case : expr) (perms : list (list expr)) : tactic unit
</pre></div>


<p>where <code>vars'</code> is the set of variables being permuted, <code>h_cases</code> is a local constant with the proof of the disjunction, <code>fst_case</code> is the pattern (with variables in the same order as the first permutation), and <code>perms</code> is a list of permutations of <code>vars'</code></p>

<a name="133471151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133471151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133471151">Kevin Buzzard (Sep 07 2018 at 07:28)</a>:</h4>
<p>Is there a case for splitting off the case of two variables and having two tactics? What I actually want to do is <code>wlog degree f ≤ degree g</code>. Is that not possible? (my goal is symmetric in the polynomials <code>f</code> and <code>g</code>).</p>

<a name="133471336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133471336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133471336">Mario Carneiro (Sep 07 2018 at 07:31)</a>:</h4>
<p>It is possible, indeed the default behavior of wlog should do what you want</p>

<a name="133471354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133471354" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133471354">Mario Carneiro (Sep 07 2018 at 07:31)</a>:</h4>
<p>if not, just put <code>using f g</code> at the end</p>

<a name="133471434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133471434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133471434">Mario Carneiro (Sep 07 2018 at 07:32)</a>:</h4>
<p>This example blows my mind:</p>
<div class="codehilite"><pre><span></span>  have h : p n i ∨ p i m ∨ p m i, from sorry,
  wlog : p n i := h using n m i,
</pre></div>


<p>It infers the permutation list <code>[n m i, i m n, m i n]</code></p>

<a name="133471727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133471727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133471727">Mario Carneiro (Sep 07 2018 at 07:38)</a>:</h4>
<p>Oh! The example (and tactic) is actually broken, the test doesn't actually finish the proof so it doesn't notice</p>

<a name="133472124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/segfault/near/133472124" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/65884segfault.html#133472124">Simon Hudon (Sep 07 2018 at 07:46)</a>:</h4>
<p>It's sometimes baffling how much we can live with bugs in proof tactics</p>


{% endraw %}
