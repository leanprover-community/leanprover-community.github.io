---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/72177cacheolean.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html">cache-olean</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="163469844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/163469844" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#163469844">Jeremy Avigad (Apr 16 2019 at 13:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> <code>cache-olean</code> doesn't seem to be working for me. I am on branch <code>lean-3.4.2</code>, I fetched and merged the latest version, and did this:</p>
<div class="codehilite"><pre><span></span>avigad@avigad-ThinkPad-T460:~/projects/mathlib$ cache-olean --fetch
No github section found in &#39;git config&#39;
Querying GitHub...
Downloading nightly...
... successfully extracted olean archive.
avigad@avigad-ThinkPad-T460:~/projects/mathlib$ lean --make
</pre></div>


<p>It is recompiling the whole library. That shouldn't happen, should it? Can you tell if I am doing something wrong?</p>

<a name="163478705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/163478705" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#163478705">Simon Hudon (Apr 16 2019 at 15:17)</a>:</h4>
<p>That certainly shouldn't happen</p>

<a name="163478786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/163478786" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#163478786">Simon Hudon (Apr 16 2019 at 15:18)</a>:</h4>
<p>what if you do <code>cache-olean --fetch</code> and <code>leanpkg build</code> instead?</p>

<a name="165144336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165144336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165144336">Johan Commelin (May 08 2019 at 08:30)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> I just want to give you a very big Thank You <span aria-label="trademark" class="emoji emoji-2122" role="img" title="trademark">:trademark:</span>. Using <code>update-mathlib</code> and <code>cache-olean</code> has made development so much smoother. It is so much easier to switch branches, and add quick contributions. Kudos!</p>

<a name="165177803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165177803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165177803">Simon Hudon (May 08 2019 at 16:24)</a>:</h4>
<p>I'm really glad it helps :)</p>

<a name="165177915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165177915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165177915">Chris Hughes (May 08 2019 at 16:26)</a>:</h4>
<p>What is <code>cache-olean</code>? How do I find out how to use it?</p>

<a name="165178027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165178027" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165178027">Bryan Gin-ge Chen (May 08 2019 at 16:27)</a>:</h4>
<p>It looks like it's documented here: <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/howto-contribute.md#caching-compilation" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/howto-contribute.md#caching-compilation">https://github.com/leanprover-community/mathlib/blob/master/docs/howto-contribute.md#caching-compilation</a></p>

<a name="165179945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165179945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165179945">Chris Hughes (May 08 2019 at 16:52)</a>:</h4>
<p>I get this error</p>
<div class="codehilite"><pre><span></span>dyn894-237:mathlib chrishughes$ cache-olean --fetch
Info: No github section found in &#39;git config&#39;, we will use GitHub with no authentication
Querying GitHub...
Error: no nightly archive found
no cache found
</pre></div>

<a name="165180084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180084" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180084">Simon Hudon (May 08 2019 at 16:54)</a>:</h4>
<p>Did you cache a build?</p>

<a name="165180103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180103" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180103">Chris Hughes (May 08 2019 at 16:54)</a>:</h4>
<p>How do I do that?</p>

<a name="165180111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180111" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180111">Chris Hughes (May 08 2019 at 16:55)</a>:</h4>
<p>I was on the <code>master</code> branch</p>

<a name="165180181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180181" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180181">Simon Hudon (May 08 2019 at 16:55)</a>:</h4>
<p>If you want to use the nightly, switch to the head of <code>lean-3.4.2</code></p>

<a name="165180314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180314" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180314">Chris Hughes (May 08 2019 at 16:57)</a>:</h4>
<p>And it works for my community branches right? How do I do that?</p>

<a name="165180351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180351">Chris Hughes (May 08 2019 at 16:57)</a>:</h4>
<p><code>lean-3.4.2</code> works by the way. Thanks.</p>

<a name="165180614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180614" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180614">Simon Hudon (May 08 2019 at 17:00)</a>:</h4>
<p>For your branches, you build it first, then you call <code>cache-olean</code> and it will cache your build. When you switch to another branch and then come back, git will restore your binaries and you can pick up where you left off</p>

<a name="165180620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180620" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180620">Johan Commelin (May 08 2019 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> When we switch over to the archives on Scott's server you will have "nightlies" for every commit of every branch. Scott is polling github every minute, and then he just needs to compile. If I understand the setup correctly...</p>

<a name="165180627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165180627" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165180627">Simon Hudon (May 08 2019 at 17:00)</a>:</h4>
<p>It is still not connected to Scott's server</p>

<a name="165202745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165202745" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165202745">Floris van Doorn (May 08 2019 at 21:27)</a>:</h4>
<p>I tried using <code>cache-olean</code>, and it works for me. However, I'm on a Windows computer and configured git with <code>autocrlf = true</code>, so that my line endings are CRLF locally (that was what I was advised when I started using git). Running <code>cache-olean</code> changes all my line-endings to LF, and after doing <code>git checkout -- .</code> I think that Lean will try to rebuild the whole library from scratch.</p>
<p>Should I just burn down my whole git repository to the ground and reclone it using <code>autocrlf = false</code> or is there a simpler workaround? (I don't think that any of the programs I use care whether the line endings are CRLF or LF.)</p>

<a name="165204526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165204526">Simon Hudon (May 08 2019 at 21:50)</a>:</h4>
<p>I remember seeing a commit that does what you describe but I can't seem to find it. I think <span class="user-mention" data-user-id="110087">@Scott Morrison</span> helped with this.</p>

<a name="165204732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165204732">Bryan Gin-ge Chen (May 08 2019 at 21:53)</a>:</h4>
<p>Does <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>'s fix to lean 3.4.2 <a href="https://github.com/leanprover/lean/commit/92826917a252a6092cffaf5fc5f1acb1f8cef379" target="_blank" title="https://github.com/leanprover/lean/commit/92826917a252a6092cffaf5fc5f1acb1f8cef379">here</a> apply to this problem or not?</p>

<a name="165204847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165204847">Simon Hudon (May 08 2019 at 21:55)</a>:</h4>
<p>It looks like it would. <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> can you confirm that it actually causes you to recompile?</p>

<a name="165204980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165204980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165204980">Floris van Doorn (May 08 2019 at 21:57)</a>:</h4>
<p>It did. The following finishes in a couple of seconds:</p>
<div class="codehilite"><pre><span></span>git checkout blessed/lean-3.4.2
cache-olean --fetch
leanpkg build
</pre></div>


<p>The following ran for a couple of minutes until I killed it:</p>
<div class="codehilite"><pre><span></span>git checkout blessed/lean-3.4.2
cache-olean --fetch
git status
git checkout -- .
leanpkg build
</pre></div>

<a name="165205211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165205211" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165205211">Floris van Doorn (May 08 2019 at 22:00)</a>:</h4>
<p>I did change my <code>autocrlf</code> setting to false, and that works well.</p>

<a name="165903108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165903108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165903108">Rob Lewis (May 17 2019 at 14:09)</a>:</h4>
<p>I'm finally getting around to setting up <code>cache-olean</code>. After moving scripts to their own repo, the install directions need to be updated, but that's easy enough. More worrying, I got this trace checking out a branch. Any idea what's up here?</p>
<div class="codehilite"><pre><span></span>Trying to fetch cached olean
Querying remote Mathlib cache...
Error: revision not found
Info: No github section found in &#39;git config&#39;, we will use GitHub with no authentication
Querying GitHub...
Downloading nightly...
Traceback (most recent call last):
  File &quot;/home/rob/.mathlib/bin/cache-olean&quot;, line 145, in &lt;module&gt;
    fetch_mathlib(asset)
  File &quot;/home/rob/.mathlib/bin/cache-olean&quot;, line 104, in fetch_mathlib
    f.write(req.data)
TypeError: __exit__() takes 1 positional argument but 4 were given
</pre></div>

<a name="165903722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165903722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165903722">Rob Lewis (May 17 2019 at 14:16)</a>:</h4>
<p>As for updating the docs. Perhaps <code>setup_dev_scripts.sh</code> should be moved back to mathlib, and should check mathlib-scripts on Github for the scripts it needs to download?</p>

<a name="165919243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919243" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165919243">Simon Hudon (May 17 2019 at 17:25)</a>:</h4>
<p>It's curious. The line info in this error is not consistent with the version in <code>mathlib-tools</code>. Are you sure you have a recent version?</p>

<a name="165919430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165919430">Rob Lewis (May 17 2019 at 17:27)</a>:</h4>
<p>I'm not at the office anymore so I can't check until Monday, but I think so... I had a fresh checkout of <code>mathlib-tools</code> for moving your PR over from mathlib.</p>

<a name="165919503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919503" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165919503">Rob Lewis (May 17 2019 at 17:28)</a>:</h4>
<p>Maybe not though. I'll check next week.</p>

<a name="165919519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165919519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165919519">Simon Hudon (May 17 2019 at 17:28)</a>:</h4>
<p>Ok, please keep me posted.</p>

<a name="165927504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165927504">Floris van Doorn (May 17 2019 at 19:02)</a>:</h4>
<p>Lately, whenever I run <code>cache-olean --fetch</code> I get an error that no nightly archive is found. This happens when I am on the master branch of mathlib-community (and also if I'm a couple commits behind master - is there a delay in the availability of binaries?).</p>
<div class="codehilite"><pre><span></span>Floris@MSI MINGW64 /d/projects/mathlib (master)
$ cache-olean --fetch
Info: No github section found in &#39;git config&#39;, we will use GitHub with no authentication
Querying GitHub...
Error: no nightly archive found
no cache found
</pre></div>

<a name="165927779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927779" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165927779">Floris van Doorn (May 17 2019 at 19:05)</a>:</h4>
<p>Oh wait, I forgot you had to be on the <code>lean-3.4.2</code> branch. Is this what <a href="https://github.com/leanprover-community/mathlib-tools/pull/2" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/2">https://github.com/leanprover-community/mathlib-tools/pull/2</a> is implementing?</p>

<a name="165927871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927871" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165927871">Simon Hudon (May 17 2019 at 19:06)</a>:</h4>
<blockquote>
<p>I forgot you had to be on the lean-3.4.2 branch</p>
</blockquote>
<p>That's right</p>

<a name="165927927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/165927927" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#165927927">Simon Hudon (May 17 2019 at 19:07)</a>:</h4>
<blockquote>
<p>Is this what <a href="https://github.com/leanprover-community/mathlib-tools/pull/2" target="_blank" title="https://github.com/leanprover-community/mathlib-tools/pull/2">https://github.com/leanprover-community/mathlib-tools/pull/2</a> is implementing?</p>
</blockquote>
<p>That's a project that Scott and I are working on so that you can get a binary for every commit. It's not there yet.</p>

<a name="166483007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/cache-olean/near/166483007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/72177cacheolean.html#166483007">Johan Commelin (May 24 2019 at 19:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> <span class="user-mention" data-user-id="110087">@Scott Morrison</span> Any progress here?</p>


{% endraw %}

{% include archive_update.html %}