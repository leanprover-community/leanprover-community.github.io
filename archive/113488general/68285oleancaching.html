---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/68285oleancaching.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html">olean caching</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="135366355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366355">Simon Hudon (Oct 07 2018 at 21:27)</a>:</h4>
<p>I just created a PR to get <code>git</code> to preserve your <code>olean</code> files and restore them when you switch branches. I'd like to know if it works for people. Please let me know if you try it and if it helps.</p>

<a name="135366398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366398">Kenny Lau (Oct 07 2018 at 21:28)</a>:</h4>
<p>:D</p>

<a name="135366500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366500" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366500">Simon Hudon (Oct 07 2018 at 21:32)</a>:</h4>
<p>In particular, I'd like to know if it needs to be adapter for windows because I use shell scripts</p>

<a name="135366580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366580">Patrick Massot (Oct 07 2018 at 21:34)</a>:</h4>
<p>If you manage to allow us to switch mathlib branches back and forth without recompiling I phone the inquisition.</p>

<a name="135366585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366585" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366585">Simon Hudon (Oct 07 2018 at 21:34)</a>:</h4>
<p>Let me just delete a branch, one sec</p>

<a name="135366589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366589" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366589">Patrick Massot (Oct 07 2018 at 21:34)</a>:</h4>
<p>That would be one sorcery prowess too many for your own good.</p>

<a name="135366693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366693">Simon Hudon (Oct 07 2018 at 21:38)</a>:</h4>
<p>Can the quota be negotiated?</p>

<a name="135366699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366699">Simon Hudon (Oct 07 2018 at 21:39)</a>:</h4>
<p>If you want to try it before the branch is merged, here are the files</p>
<p><a href="/user_uploads/3121/KxJGKo8Df8IDgnEp7wUA57ar/cache_olean.zip" target="_blank" title="cache_olean.zip">cache_olean.zip</a></p>

<a name="135366707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366707" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366707">Simon Hudon (Oct 07 2018 at 21:39)</a>:</h4>
<p>You unzip them in your mathlib directory and call <code>./install_hooks.sh</code></p>

<a name="135366752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366752">Patrick Massot (Oct 07 2018 at 21:40)</a>:</h4>
<p>I'll negociate for you if you manage to convince Travis to put mathlib olean for linux somewhere git will find them each we git pull mathlib</p>

<a name="135366768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366768" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366768">Simon Hudon (Oct 07 2018 at 21:41)</a>:</h4>
<p>What it does is:</p>
<p>* when you commit, it makes a copy of your olean files<br>
  * when you checkout a branch, it checks if a cache exists for that branch and restores it if one exists<br>
  * when you rebase a branch A on top of branch B, it caches the files of A and restores the files of B</p>

<a name="135366769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366769" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366769">Kenny Lau (Oct 07 2018 at 21:41)</a>:</h4>
<p>just the olean files?</p>

<a name="135366770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366770" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366770">Simon Hudon (Oct 07 2018 at 21:41)</a>:</h4>
<p>Yes, just the olean files</p>

<a name="135366815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366815" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366815">Simon Hudon (Oct 07 2018 at 21:42)</a>:</h4>
<blockquote>
<p>I'll negociate for you if you manage to convince Travis to put mathlib olean for linux somewhere git will find them each we git pull mathlib</p>
</blockquote>
<p>That's a tall order. You're asking for a complete new feature, all I did was a small hack :P</p>

<a name="135366831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366831" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366831">Simon Hudon (Oct 07 2018 at 21:43)</a>:</h4>
<p>Actually ... that's feasible</p>

<a name="135366894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366894">Simon Hudon (Oct 07 2018 at 21:44)</a>:</h4>
<p>Actually, I think doing it half-way is more than half-way useful</p>

<a name="135366921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366921" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366921">Simon Hudon (Oct 07 2018 at 21:45)</a>:</h4>
<p>Do you guys feel like giving it a spin?</p>

<a name="135366972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366972" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366972">Patrick Massot (Oct 07 2018 at 21:47)</a>:</h4>
<p>I'll definitely try tomorrow, but I really need to go to bed now</p>

<a name="135366985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135366985" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135366985">Simon Hudon (Oct 07 2018 at 21:47)</a>:</h4>
<p>I thought you enjoyed working with Lean</p>

<a name="135367104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135367104" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135367104">Simon Hudon (Oct 07 2018 at 21:51)</a>:</h4>
<p>Sleep well :)</p>

<a name="135368285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135368285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135368285">Bryan Gin-ge Chen (Oct 07 2018 at 22:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Does this work the same way for packages that include <code>mathlib</code> as a dependency?</p>

<a name="135368290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135368290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135368290">Bryan Gin-ge Chen (Oct 07 2018 at 22:33)</a>:</h4>
<p>Wait, maybe that question doesn't make sense.</p>

<a name="135368396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135368396" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135368396">Simon Hudon (Oct 07 2018 at 22:36)</a>:</h4>
<p>You can make it work in that situation I believe. Once you configured the package, go in <code>_target/deps/mathlib</code> and call <code>./install_hooks.sh</code>. If different versions of the same package use different branches of mathlib, switching between the versions of your package might get cheaper (we'd have to test it to make sure)</p>

<a name="135368397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135368397" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135368397">Bryan Gin-ge Chen (Oct 07 2018 at 22:36)</a>:</h4>
<div class="codehilite"><pre><span></span>hint: The &#39;.git/hooks/post-checkout&#39; hook was ignored because it&#39;s not set as executable.
hint: You can disable this warning with `git config advice.ignoredHook false`.
</pre></div>


<p>Should I change the permissions on these files?</p>

<a name="135368405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135368405" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135368405">Simon Hudon (Oct 07 2018 at 22:37)</a>:</h4>
<p>Yes good idea. And I'll make fixes to the scripts</p>

<a name="135369137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369137" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369137">Simon Hudon (Oct 07 2018 at 23:00)</a>:</h4>
<p>Any luck?</p>

<a name="135369336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369336">Bryan Gin-ge Chen (Oct 07 2018 at 23:08)</a>:</h4>
<p>I've been switching back and forth between <code>master</code> and <code>tutorials</code> and running <code>lean --make</code> and each time it does a full rebuild. If I do <code>lean --make</code> does that force a rebuild no matter what?</p>

<a name="135369338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369338" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369338">Bryan Gin-ge Chen (Oct 07 2018 at 23:08)</a>:</h4>
<p>I'm on my macbook.</p>

<a name="135369347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369347">Scott Morrison (Oct 07 2018 at 23:09)</a>:</h4>
<p>No, it doesn't/</p>

<a name="135369392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369392" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369392">Bryan Gin-ge Chen (Oct 07 2018 at 23:10)</a>:</h4>
<p>Hmm, my master was out of date. Let me try again.</p>

<a name="135369401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369401">Scott Morrison (Oct 07 2018 at 23:11)</a>:</h4>
<p>The problem is likely that master has introduced changes to stuff way down the dependency tree.</p>

<a name="135369406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369406">Scott Morrison (Oct 07 2018 at 23:11)</a>:</h4>
<p>If you rebase tutorial onto master it should make life better.</p>

<a name="135369458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369458">Bryan Gin-ge Chen (Oct 07 2018 at 23:13)</a>:</h4>
<p>I think I see what you're saying, but shouldn't caching all the olean files associated to a given commit also preserve the build status?</p>

<a name="135369461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369461" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369461">Simon Hudon (Oct 07 2018 at 23:14)</a>:</h4>
<p>It should. Can you <code>ls .bin/branches</code> and tell me what you get?</p>

<a name="135369505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369505" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369505">Bryan Gin-ge Chen (Oct 07 2018 at 23:14)</a>:</h4>
<p>Where's <code>.bin</code>?</p>

<a name="135369569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135369569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135369569">Bryan Gin-ge Chen (Oct 07 2018 at 23:17)</a>:</h4>
<p>Oh I see, I guess <code>.bin</code> somehow hasn't been created.</p>

<a name="135370095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135370095" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135370095">Simon Hudon (Oct 07 2018 at 23:34)</a>:</h4>
<p>It is created when you commit or rebase. You can also manually call <code>.git/hooks/cache_olean.sh</code></p>

<a name="135371074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371074">Bryan Gin-ge Chen (Oct 08 2018 at 00:02)</a>:</h4>
<p>I ran <code>cache_olean.sh</code> after building on tutorials and master, and the olean files seem to be in .bin/branches/ but running lean --make still starts a rebuild.</p>

<a name="135371280"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371280" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371280">Simon Hudon (Oct 08 2018 at 00:08)</a>:</h4>
<p>What if you run <code>restore_olean.sh</code> before rebuilding?</p>

<a name="135371281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371281" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371281">Scott Morrison (Oct 08 2018 at 00:08)</a>:</h4>
<blockquote>
<p>./install_hooks.sh <br>
cp: .git/hooks: Not a directory</p>
</blockquote>

<a name="135371293"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371293" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371293">Scott Morrison (Oct 08 2018 at 00:09)</a>:</h4>
<p>Just needs a <code>mkdir -p .git/hooks</code> in <code>install_hooks.sh</code>.</p>

<a name="135371296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371296" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371296">Bryan Gin-ge Chen (Oct 08 2018 at 00:09)</a>:</h4>
<p>I tried running <code>restore_olean.sh</code> and it's rebuilding again.</p>

<a name="135371359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371359" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371359">Scott Morrison (Oct 08 2018 at 00:11)</a>:</h4>
<p>I pushed a commit that fixes this.</p>

<a name="135371360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371360" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371360">Simon Hudon (Oct 08 2018 at 00:11)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> Can you check what the time stamp is on the most recently modified file in <code>.bin/branches/tutorial</code>? I'm assuming that's the one you're trying to cache.</p>

<a name="135371362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371362" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371362">Simon Hudon (Oct 08 2018 at 00:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> You're too fast! Thanks!</p>

<a name="135371403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371403">Scott Morrison (Oct 08 2018 at 00:12)</a>:</h4>
<p>Ah, but I fixed the wrong problem.</p>

<a name="135371406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371406">Scott Morrison (Oct 08 2018 at 00:12)</a>:</h4>
<p>The actual problem is that I don't have a .git directory.</p>

<a name="135371409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371409">Scott Morrison (Oct 08 2018 at 00:12)</a>:</h4>
<p>I have a .git file, because I'm using a submodule.</p>

<a name="135371412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371412" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371412">Scott Morrison (Oct 08 2018 at 00:12)</a>:</h4>
<p>Crap...</p>

<a name="135371419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371419" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371419">Scott Morrison (Oct 08 2018 at 00:12)</a>:</h4>
<p>This is not going to affect many people at all, but I guess I want a fix myself. :-)</p>

<a name="135371422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371422" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371422">Simon Hudon (Oct 08 2018 at 00:12)</a>:</h4>
<p>Darn! How come you work without git?</p>

<a name="135371433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371433">Scott Morrison (Oct 08 2018 at 00:13)</a>:</h4>
<p>The problem is that I work with git for _everything_. My entire home directory is a giant git repository, and everything else is a git submodule, so things get synchronised between my computers.</p>

<a name="135371473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371473" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371473">Simon Hudon (Oct 08 2018 at 00:14)</a>:</h4>
<p>Actually, if you go in <code>_target/deps/mathlib</code> and call <code>install_hooks.sh</code> there, I'm hoping that will do the job</p>

<a name="135371478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371478">Scott Morrison (Oct 08 2018 at 00:14)</a>:</h4>
<p>Well, but I mostly want this for mathlib itself.</p>

<a name="135371479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371479" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371479">Scott Morrison (Oct 08 2018 at 00:14)</a>:</h4>
<p>Switching between branches that touch tactic/basic.lean is unpleasant...</p>

<a name="135371534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371534">Bryan Gin-ge Chen (Oct 08 2018 at 00:16)</a>:</h4>
<p>The timestamps all seem to be from when I ran <code>cache_olean.sh</code>.</p>

<a name="135371560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371560">Scott Morrison (Oct 08 2018 at 00:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>, why do you put <code>cache_olean.sh</code> and <code>restore_olean.sh</code> in the <code>.git/hooks</code> directory, rather than leaving them in the root directory?</p>

<a name="135371597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371597" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371597">Simon Hudon (Oct 08 2018 at 00:18)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> That is useful information. I'll look into preserving time stamps properly</p>

<a name="135371606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371606">Simon Hudon (Oct 08 2018 at 00:19)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I want to be able to use the hooks even on branches where the files aren't in the repo</p>

<a name="135371621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371621" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371621">Scott Morrison (Oct 08 2018 at 00:19)</a>:</h4>
<p>Ah, good point.</p>

<a name="135371622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371622" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371622">Bryan Gin-ge Chen (Oct 08 2018 at 00:19)</a>:</h4>
<p>The timestamps of the <code>.lean</code> files are bumped when I checkout a new branch. So do we need the timestamps of the olean files to be more recent than that?</p>

<a name="135371782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371782" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371782">Simon Hudon (Oct 08 2018 at 00:24)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> do you mean that the .lean timestamps are set to the time at which you checkout the files?</p>

<a name="135371788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371788">Bryan Gin-ge Chen (Oct 08 2018 at 00:25)</a>:</h4>
<p>Yes.</p>

<a name="135371797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371797" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371797">Simon Hudon (Oct 08 2018 at 00:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Maybe there's a way to include a search step at the beginning of the script to climb up the directory structure until a <code>.git</code> is found.</p>

<a name="135371843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371843" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371843">Simon Hudon (Oct 08 2018 at 00:26)</a>:</h4>
<p><span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> What platform are you on?</p>

<a name="135371844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371844" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371844">Scott Morrison (Oct 08 2018 at 00:26)</a>:</h4>
<p>There's a nice fix, almost pushed.</p>

<a name="135371847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371847">Scott Morrison (Oct 08 2018 at 00:26)</a>:</h4>
<p><code>git rev-parse --git-dir</code> tells you where your <code>.git</code> directory really is.</p>

<a name="135371856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371856" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371856">Scott Morrison (Oct 08 2018 at 00:27)</a>:</h4>
<p>e.g. for me: <code>/Users/scott/.git/modules/projects/lean/mathlib</code></p>

<a name="135371910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371910" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371910">Scott Morrison (Oct 08 2018 at 00:29)</a>:</h4>
<p>Okay, pushed that change.</p>

<a name="135371918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371918">Scott Morrison (Oct 08 2018 at 00:29)</a>:</h4>
<p>I think we need more hooks. I want my olean files cached even if we don't  make a commit!</p>

<a name="135371919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371919" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371919">Simon Hudon (Oct 08 2018 at 00:29)</a>:</h4>
<p>Thanks! Did you put that <code>.git</code> dir in a variable?</p>

<a name="135371922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371922" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371922">Scott Morrison (Oct 08 2018 at 00:29)</a>:</h4>
<p>e.g. I never commit to master, but I want a cache.</p>

<a name="135371923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371923" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371923">Simon Hudon (Oct 08 2018 at 00:29)</a>:</h4>
<p>Yeah, me too! I haven't found a good hook for that</p>

<a name="135371959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371959" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371959">Scott Morrison (Oct 08 2018 at 00:30)</a>:</h4>
<p>I just have <code>GITDIR=`git rev-parse --git-dir</code> in most of the scripts.</p>

<a name="135371971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371971" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371971">Scott Morrison (Oct 08 2018 at 00:30)</a>:</h4>
<p>What if when we checkout, we _first_ restore, _then_ cache.</p>

<a name="135371973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371973">Simon Hudon (Oct 08 2018 at 00:30)</a>:</h4>
<p>I think we might need to get <code>leanpkg</code> or, emacs / VS code to do that after you build</p>

<a name="135371974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371974" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371974">Bryan Gin-ge Chen (Oct 08 2018 at 00:30)</a>:</h4>
<p>macOS. Not all of the .lean files have their timestamps bumped, but the ones that don't exist in <code>master</code> certainly do.</p>

<a name="135371977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371977" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371977">Scott Morrison (Oct 08 2018 at 00:30)</a>:</h4>
<p>If there was something to restore, then it just harmlessly puts it back again.</p>

<a name="135371978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371978" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371978">Scott Morrison (Oct 08 2018 at 00:30)</a>:</h4>
<p>But if there was nothing to restore, then we build a cache?</p>

<a name="135371979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371979">Scott Morrison (Oct 08 2018 at 00:30)</a>:</h4>
<p>hmm...</p>

<a name="135371980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371980">Scott Morrison (Oct 08 2018 at 00:30)</a>:</h4>
<p>no</p>

<a name="135371996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135371996" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135371996">Scott Morrison (Oct 08 2018 at 00:31)</a>:</h4>
<p>because that cache will be wrong. :-)</p>

<a name="135372054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372054">Bryan Gin-ge Chen (Oct 08 2018 at 00:33)</a>:</h4>
<p>All the files that are changed between branches have their timestamps set to the time I do the checkout.</p>

<a name="135372179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372179" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372179">Scott Morrison (Oct 08 2018 at 00:37)</a>:</h4>
<p>What if on every checkout we:<br>
1) run cache before checkout (saving the state of the branch we're leaving)</p>

<a name="135372180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372180">Scott Morrison (Oct 08 2018 at 00:37)</a>:</h4>
<p>2) run restore after checkout</p>

<a name="135372181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372181" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372181">Scott Morrison (Oct 08 2018 at 00:37)</a>:</h4>
<p>3) run cache after that</p>

<a name="135372182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372182">Simon Hudon (Oct 08 2018 at 00:37)</a>:</h4>
<p>What a bummer. I found this information here. <a href="https://confluence.atlassian.com/bbkb/preserving-file-timestamps-with-git-and-mercurial-781386524.html" target="_blank" title="https://confluence.atlassian.com/bbkb/preserving-file-timestamps-with-git-and-mercurial-781386524.html">https://confluence.atlassian.com/bbkb/preserving-file-timestamps-with-git-and-mercurial-781386524.html</a></p>
<p>It recommends a certain build system as a solution</p>

<a name="135372223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372223" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372223">Simon Hudon (Oct 08 2018 at 00:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> run cache after the restore or after build?</p>

<a name="135372227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372227">Scott Morrison (Oct 08 2018 at 00:38)</a>:</h4>
<p>I was thinking just immediately after the restore.</p>

<a name="135372229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372229" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372229">Scott Morrison (Oct 08 2018 at 00:38)</a>:</h4>
<p>This has the effect of actually creating the cache merely by checking out.</p>

<a name="135372240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372240" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372240">Scott Morrison (Oct 08 2018 at 00:39)</a>:</h4>
<p>Otherwise I don't see how a cache for master will ever be created</p>

<a name="135372244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372244" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372244">Bryan Gin-ge Chen (Oct 08 2018 at 00:39)</a>:</h4>
<p>Could we just <code>touch</code> all the <code>.olean</code> files right before restoring?</p>

<a name="135372295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372295" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372295">Scott Morrison (Oct 08 2018 at 00:40)</a>:</h4>
<p>I think the problem is that risk making things worse.</p>

<a name="135372296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372296" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372296">Simon Hudon (Oct 08 2018 at 00:40)</a>:</h4>
<p>Yeah</p>

<a name="135372301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372301" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372301">Scott Morrison (Oct 08 2018 at 00:40)</a>:</h4>
<p>(deleted)</p>

<a name="135372304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372304" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372304">Scott Morrison (Oct 08 2018 at 00:41)</a>:</h4>
<p>(deleted)</p>

<a name="135372307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372307" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372307">Simon Hudon (Oct 08 2018 at 00:41)</a>:</h4>
<p>What I'm thinking of is, after a checkout, look at each lean file and set its time stamp to that of the latest commit that changed it</p>

<a name="135372309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372309">Scott Morrison (Oct 08 2018 at 00:41)</a>:</h4>
<p>oof...</p>

<a name="135372341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372341" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372341">Scott Morrison (Oct 08 2018 at 00:42)</a>:</h4>
<p>(Presumably you mean to the time stamp of the corresponding olean file.)</p>

<a name="135372349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372349" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372349">Reid Barton (Oct 08 2018 at 00:42)</a>:</h4>
<p>What if you just don't use <code>cp -a</code>?</p>

<a name="135372408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372408">Simon Hudon (Oct 08 2018 at 00:44)</a>:</h4>
<p>The olean files will all be interpreted as up-to-date but some might not be</p>

<a name="135372469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372469" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372469">Simon Hudon (Oct 08 2018 at 00:46)</a>:</h4>
<blockquote>
<p>(Presumably you mean to the time stamp of the corresponding olean file.)</p>
</blockquote>
<p>No. For any source file we need to determine if we need to rebuild it. One information we need is when we last built it which is why we shouldn't overwrite the time stamp of the olean file. The other one is when we last change it which is why we wouldn't want git to overwrite the time stamp of a file but it does.</p>

<a name="135372480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135372480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135372480">Simon Hudon (Oct 08 2018 at 00:47)</a>:</h4>
<p>I think we'd like to know if the file was built since the last commit that changed it</p>

<a name="135386341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135386341" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135386341">Scott Morrison (Oct 08 2018 at 07:58)</a>:</h4>
<p>This olean caching stuff is really important, and I will be super happy if we can get it working smoothly. I'm not sure I can help at the moment with the timestamp issues, but let me know if there's anything I can do.</p>

<a name="135386369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135386369" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135386369">Scott Morrison (Oct 08 2018 at 07:59)</a>:</h4>
<p>I hope one day we could even build a distributed cache; I could certainly contribute CPU cycles building olean files for central distribution.</p>

<a name="135407646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135407646" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135407646">Simon Hudon (Oct 08 2018 at 14:37)</a>:</h4>
<p>I'll keep at it</p>

<a name="135420726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135420726" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135420726">Chris Hughes (Oct 08 2018 at 18:34)</a>:</h4>
<p>I just have 17 copies of mathlib saved, so I never have to switch branches.</p>

<a name="135420896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135420896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135420896">Johan Commelin (Oct 08 2018 at 18:37)</a>:</h4>
<p>Diskspace is cheap...</p>

<a name="135421237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135421237" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135421237">Simon Hudon (Oct 08 2018 at 18:42)</a>:</h4>
<p>I used to work like that. As the number of branches changes, I find it hard to manage</p>

<a name="135451769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451769" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451769">Tobias Grosser (Oct 09 2018 at 08:14)</a>:</h4>
<p>Interesting. I am not really up-to-speed here, but i might be interesting to look at existing tools which address these issues.</p>

<a name="135451775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451775">Tobias Grosser (Oct 09 2018 at 08:14)</a>:</h4>
<p>Specifically, there is 'ninja' a very fast alternative for make.</p>

<a name="135451788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451788">Tobias Grosser (Oct 09 2018 at 08:15)</a>:</h4>
<p>And 'ccache' which caches the compilation of C/C++ files.</p>

<a name="135451800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451800" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451800">Tobias Grosser (Oct 09 2018 at 08:15)</a>:</h4>
<p>If lean would have a way to export the "include" files, it might be possible to adapt these tools (or use at least their design).</p>

<a name="135451863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451863" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451863">Tobias Grosser (Oct 09 2018 at 08:16)</a>:</h4>
<p>My feeling is that connecting .olean files to git branches is pretty fragile "hacky".</p>

<a name="135451886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451886">Tobias Grosser (Oct 09 2018 at 08:17)</a>:</h4>
<p>Hashing the source files and having a proxy for returning the right source file in case a hash is already known is a strategy that works well in the OS projects I have been working on.</p>

<a name="135451892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451892">Mario Carneiro (Oct 09 2018 at 08:17)</a>:</h4>
<p>lean already uses ninja for compilation</p>

<a name="135451958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451958">Mario Carneiro (Oct 09 2018 at 08:18)</a>:</h4>
<p>You would have to hash the file plus the hashes of dependent files, git-style</p>

<a name="135451968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135451968" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135451968">Tobias Grosser (Oct 09 2018 at 08:19)</a>:</h4>
<p>Right. The ccache docu explains well what is needed to do this kind of caching.</p>

<a name="135452307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452307" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452307">Tobias Grosser (Oct 09 2018 at 08:24)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> , are you saying lean is using 'ninja' for compiling the lean binary, or is it called as part of 'lean --make'?</p>

<a name="135452480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452480">Gabriel Ebner (Oct 09 2018 at 08:29)</a>:</h4>
<p>ninja can optionally be used to compile lean itself.  lean --make doesn't use ninja (the equivalent linja tool in Lean 2 did though).  Ninja doesn't do anything more fancy than lean --make, I believe.  (Does ninja use content hashes or modification times?)  Something like ccache might be interesting when switching between branches.</p>

<a name="135452491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452491" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452491">Tobias Grosser (Oct 09 2018 at 08:29)</a>:</h4>
<p>Also, to get the dependent files lean already has a command '--deps'.</p>

<a name="135452558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452558" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452558">Tobias Grosser (Oct 09 2018 at 08:30)</a>:</h4>
<p>Ninja does not do anything more fancy than lean --make, I assume.</p>

<a name="135452561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452561" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452561">Tobias Grosser (Oct 09 2018 at 08:30)</a>:</h4>
<p>However, it is _very_ fast.</p>

<a name="135452568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452568" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452568">Tobias Grosser (Oct 09 2018 at 08:31)</a>:</h4>
<p>in checking if files have been modified.</p>

<a name="135452580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452580">Gabriel Ebner (Oct 09 2018 at 08:31)</a>:</h4>
<p>That is pretty much the least expensive part of running <code>lean --make</code> though.</p>

<a name="135452581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452581" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452581">Tobias Grosser (Oct 09 2018 at 08:31)</a>:</h4>
<p>This does not matter for the perf problems we have today, but I feel it will matter in the future.</p>

<a name="135452640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452640" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452640">Mario Carneiro (Oct 09 2018 at 08:32)</a>:</h4>
<p>the problem is that the usual dependency analysis will say that too many files are affected and compile them all</p>

<a name="135452658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452658" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452658">Tobias Grosser (Oct 09 2018 at 08:33)</a>:</h4>
<p>Right, it's more a difference between 5 seconds and 0.01 second on clean builds. It really improves productivity on large C++ code bases and might be useful for lean as well (especially if we interactively want to update proofs).</p>

<a name="135452665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452665" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452665">Tobias Grosser (Oct 09 2018 at 08:33)</a>:</h4>
<p>Right. Most of likely requires changes in lean proper.</p>

<a name="135452711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452711" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452711">Mario Carneiro (Oct 09 2018 at 08:34)</a>:</h4>
<p>0.01 second vs 1 second to tell me that nothing needs doing doesn't seem so useful</p>

<a name="135452724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452724" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452724">Mario Carneiro (Oct 09 2018 at 08:34)</a>:</h4>
<p>but if you could reason that most of the library is unaffected by a new theorem in <code>logic.basic</code> that would be a HUGE gain</p>

<a name="135452727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452727">Mario Carneiro (Oct 09 2018 at 08:34)</a>:</h4>
<p>like an hour compilation</p>

<a name="135452737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452737" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452737">Tobias Grosser (Oct 09 2018 at 08:35)</a>:</h4>
<p>I mean these are orthogonal.</p>

<a name="135452748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452748" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452748">Mario Carneiro (Oct 09 2018 at 08:35)</a>:</h4>
<p>is it? I'm talking about proper caching and dependency analysis</p>

<a name="135452800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452800" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452800">Tobias Grosser (Oct 09 2018 at 08:36)</a>:</h4>
<p>You need all a) proper dependency analysis, b) good caching, c) worry about how to check if files have changed.</p>

<a name="135452808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452808" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452808">Tobias Grosser (Oct 09 2018 at 08:36)</a>:</h4>
<p>ninja is really good in minimizing file IO and stat calls to very quickly check for c)</p>

<a name="135452818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452818" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452818">Mario Carneiro (Oct 09 2018 at 08:37)</a>:</h4>
<p>If there were thousands of files then I can see this being a problem</p>

<a name="135452822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452822">Mario Carneiro (Oct 09 2018 at 08:37)</a>:</h4>
<p>but at that point total compile times will dwarf all of this</p>

<a name="135452860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452860" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452860">Gabriel Ebner (Oct 09 2018 at 08:38)</a>:</h4>
<p>In server mode we don't even do any file IO?  We actually have a precomputed dependency graph.</p>

<a name="135452893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452893">Tobias Grosser (Oct 09 2018 at 08:39)</a>:</h4>
<p>But it does not help with a) and b).</p>

<a name="135452900"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452900" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452900">Tobias Grosser (Oct 09 2018 at 08:39)</a>:</h4>
<p>I see.</p>

<a name="135452946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452946" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452946">Tobias Grosser (Oct 09 2018 at 08:40)</a>:</h4>
<p>So my feeling is at some point we would just need proper caching in server mode.</p>

<a name="135452960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135452960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135452960">Tobias Grosser (Oct 09 2018 at 08:40)</a>:</h4>
<p>Which would be a lean specific thing, that just needs to be implemented, right?</p>

<a name="135479143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135479143" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135479143">Sebastian Ullrich (Oct 09 2018 at 15:49)</a>:</h4>
<p>"just"</p>

<a name="135479146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135479146" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135479146">Sebastian Ullrich (Oct 09 2018 at 15:49)</a>:</h4>
<p>:)</p>

<a name="135500213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500213" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500213">Simon Hudon (Oct 09 2018 at 21:25)</a>:</h4>
<p>I have created a branch of <code>ccache</code> to try and add support for Lean. I saw an issue discussion that suggests that it might be a simple business so I thought I'd try it out: <a href="https://github.com/leanprover-community/ccache" target="_blank" title="https://github.com/leanprover-community/ccache">https://github.com/leanprover-community/ccache</a></p>

<a name="135500355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500355">Sebastian Ullrich (Oct 09 2018 at 21:27)</a>:</h4>
<p>Wow, I've been thinking about doing this for a long time, but didn't think anyone would ever actually go ahead with it...</p>

<a name="135500422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500422" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500422">Sebastian Ullrich (Oct 09 2018 at 21:28)</a>:</h4>
<p>Though are you sure you don't want to modify <a href="https://github.com/mozilla/sccache" target="_blank" title="https://github.com/mozilla/sccache">https://github.com/mozilla/sccache</a> instead :) ?</p>

<a name="135500445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500445">Sebastian Ullrich (Oct 09 2018 at 21:28)</a>:</h4>
<p>(No idea if it would actually be easier, just newer code base, cloud support, and my preference for Rust)</p>

<a name="135500578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500578" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500578">Simon Hudon (Oct 09 2018 at 21:30)</a>:</h4>
<p>That sounds like an even more useful tool. I don't know what it would take to adapt though</p>

<a name="135500603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500603" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500603">Simon Hudon (Oct 09 2018 at 21:31)</a>:</h4>
<p>Do I understand correctly that it allows sharing binaries between team members or community members?</p>

<a name="135500732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500732" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500732">Sebastian Ullrich (Oct 09 2018 at 21:33)</a>:</h4>
<p>I assume it's intended for sharing with trusted team members. Securing public r/w access to some cloud storage doesn't sound like a simple issue.</p>

<a name="135500844"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500844" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500844">Simon Hudon (Oct 09 2018 at 21:35)</a>:</h4>
<p>I think I'll put that issue aside to handle a simpler problem :)</p>

<a name="135500878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500878" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500878">Patrick Massot (Oct 09 2018 at 21:36)</a>:</h4>
<p>Sounds like an important issues, I've seen people discussing assuming <code>nat = int</code>, they probably shouldn't be trusted</p>

<a name="135500931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135500931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135500931">Kenny Lau (Oct 09 2018 at 21:36)</a>:</h4>
<p>how about we remove <code>*.olean</code> from <code>gitignore</code>?</p>

<a name="135501059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501059" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501059">Simon Hudon (Oct 09 2018 at 21:40)</a>:</h4>
<p>It is a big no-no. We don't want to keep the history of those files, we just want appropriate binaries. Keeping those binaries will make <code>git</code> slower and will make merging more complicated.</p>

<a name="135501140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501140" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501140">Chris Hughes (Oct 09 2018 at 21:41)</a>:</h4>
<p>Also <code>olean</code> is OS dependent</p>

<a name="135501243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501243" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501243">Simon Hudon (Oct 09 2018 at 21:43)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> it looks like <code>sccache</code> works with Lean out of the box. You just call <code>sccache leanpkg build</code>. Does that make sense to you?</p>

<a name="135501295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501295" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501295">Sebastian Ullrich (Oct 09 2018 at 21:44)</a>:</h4>
<p>I have no idea. Does it look like it actually does anything?</p>

<a name="135501320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501320" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501320">Sebastian Ullrich (Oct 09 2018 at 21:45)</a>:</h4>
<p>(<span class="user-mention" data-user-id="110044">@Chris Hughes</span> It's not, AFAIK. Though it will be architecture-dependent in Lean 4)</p>

<a name="135501394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501394">Simon Hudon (Oct 09 2018 at 21:46)</a>:</h4>
<p>It does look like it actually calls <code>leanpkg</code> but I'll have to experiment and see if a cache is created.</p>

<a name="135501476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501476">Sebastian Ullrich (Oct 09 2018 at 21:48)</a>:</h4>
<p>Yes, that would be the important part <span class="emoji emoji-1f603" title="smiley">:smiley:</span></p>

<a name="135501579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135501579" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135501579">Simon Hudon (Oct 09 2018 at 21:50)</a>:</h4>
<p>If it does work out of the box, the next step would be integration: how do we make it invisible to the Lean user</p>

<a name="135502099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135502099" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135502099">Simon Hudon (Oct 09 2018 at 22:00)</a>:</h4>
<p>I think part of it working with <code>leanpkg</code> and <code>elan</code> is to create a symbolic link so that when <code>lean</code> is called, it calls <code>sccache lean</code> instead. <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Does that sound like that could break the build system?</p>

<a name="135502577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135502577" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135502577">Sebastian Ullrich (Oct 09 2018 at 22:09)</a>:</h4>
<p>That could work</p>

<a name="135502811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135502811" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135502811">Simon Hudon (Oct 09 2018 at 22:14)</a>:</h4>
<p>Right now, I put a shell script called <code>~/.sccache/bin/lean</code> that just prints "calling lean" and I put it in my path (I checked with <code>which lean</code>) but <code>leanpkg</code> does not seem to call it</p>

<a name="135503095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503095" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503095">Sebastian Ullrich (Oct 09 2018 at 22:20)</a>:</h4>
<p>oh <a href="https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/bin/leanpkg#L24" target="_blank" title="https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/bin/leanpkg#L24">https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/bin/leanpkg#L24</a></p>

<a name="135503113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503113" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503113">Simon Hudon (Oct 09 2018 at 22:21)</a>:</h4>
<p>So how does <code>elan</code> redirect to the right version of <code>lean</code>?</p>

<a name="135503160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503160">Sebastian Ullrich (Oct 09 2018 at 22:22)</a>:</h4>
<p>It doesn't in that case, it just calls the right version of <code>leanpkg</code> :)</p>

<a name="135503203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503203" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503203">Simon Hudon (Oct 09 2018 at 22:23)</a>:</h4>
<p>argh!</p>

<a name="135503261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503261">Simon Hudon (Oct 09 2018 at 22:24)</a>:</h4>
<p>Any chance we might hard code <code>ccache</code> or <code>sccache</code> into <code>elan</code>?</p>

<a name="135503278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503278" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503278">Sebastian Ullrich (Oct 09 2018 at 22:25)</a>:</h4>
<p>How would that help?</p>

<a name="135503369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503369" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503369">Simon Hudon (Oct 09 2018 at 22:27)</a>:</h4>
<p>Maybe it could call a <code>leanpkg-2</code> bash script instead of <code>leanpkg</code> and also produce the <code>leanpkg-2</code> script so that the paths are set properly (for <code>sccache</code>). I have a feeling that that bash script did not change a lot between versions. Am I right?</p>

<a name="135503577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503577" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503577">Sebastian Ullrich (Oct 09 2018 at 22:30)</a>:</h4>
<p>I see. But if you want to support both <code>sccache leanpkg</code> and <code>sccache lean</code> anyway, are you sure you save any code by making the former call the latter?</p>

<a name="135503683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503683" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503683">Simon Hudon (Oct 09 2018 at 22:32)</a>:</h4>
<p>Actually, what I'd like to do is just replace every call to <code>lean</code> to <code>sccache lean</code>. <code>sccache</code> seems to index its cache by command line arguments.</p>

<a name="135503859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135503859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135503859">Simon Hudon (Oct 09 2018 at 22:35)</a>:</h4>
<p>Actually, it might be enough to have <code>elan</code> rename <code>lean</code> to <code>lean-2</code> and create a bash script <code>lean</code> in its place to call <code>sccache</code> when <code>elan</code> downloads a version of <code>lean</code></p>

<a name="135570892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135570892" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135570892">Simon Hudon (Oct 10 2018 at 21:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> It's starting to look to me like we may have to alter the way <code>lean --make</code> works for either of <code>sccache</code> or <code>ccache</code> to be useable</p>

<a name="135570906"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135570906" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135570906">Sebastian Ullrich (Oct 10 2018 at 21:56)</a>:</h4>
<p>I wouldn't be surprised :)</p>

<a name="135570924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135570924" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135570924">Simon Hudon (Oct 10 2018 at 21:57)</a>:</h4>
<p>Bummer, I was hoping it might be a small(-ish) thing to do</p>

<a name="135571003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135571003" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135571003">Sebastian Ullrich (Oct 10 2018 at 21:59)</a>:</h4>
<p>I was fully prepared that someone might at some point write an alternative <code>leanpkg</code> that fixes many issues with it (and would probably not be written in Lean)</p>

<a name="135571113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135571113" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135571113">Simon Hudon (Oct 10 2018 at 22:01)</a>:</h4>
<p>Is there a way to use <code>lean</code> to export all the dependencies in a project? <code>lean --deps</code> seems to interact poorly with leanpkg.toml files</p>

<a name="135571264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135571264" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135571264">Simon Hudon (Oct 10 2018 at 22:05)</a>:</h4>
<p>If I could use it, maybe I could generate a Makefile (or ninja config?) and that might be a better starting point than <code>lean --make</code></p>

<a name="135571728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135571728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135571728">Sebastian Ullrich (Oct 10 2018 at 22:16)</a>:</h4>
<p>I don't think so, you basically have to parse the file header...</p>

<a name="135614724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135614724" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135614724">Tobias Grosser (Oct 11 2018 at 15:06)</a>:</h4>
<p>+1 for 'ninja + make', at best if it's auto-generated from the lean files.</p>

<a name="135614792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135614792" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135614792">Simon Hudon (Oct 11 2018 at 15:07)</a>:</h4>
<p>The other tool I've heard of is Bazel. Have you heard of it and would you endorse it?</p>

<a name="135615005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615005" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615005">Tobias Grosser (Oct 11 2018 at 15:10)</a>:</h4>
<p>Never used it.</p>

<a name="135615032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615032" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615032">Tobias Grosser (Oct 11 2018 at 15:10)</a>:</h4>
<p>I feel it might be too high level.</p>

<a name="135615039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615039" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615039">Tobias Grosser (Oct 11 2018 at 15:10)</a>:</h4>
<p>In the end we know all dependences.</p>

<a name="135615050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615050">Tobias Grosser (Oct 11 2018 at 15:10)</a>:</h4>
<p>And just want to declare them and execute.</p>

<a name="135615213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615213" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615213">Tobias Grosser (Oct 11 2018 at 15:13)</a>:</h4>
<p>I mean, you might also try to use cmake:<br>
<a href="https://cmake.org/pipermail/cmake/2011-April/043761.html" target="_blank" title="https://cmake.org/pipermail/cmake/2011-April/043761.html">https://cmake.org/pipermail/cmake/2011-April/043761.html</a></p>

<a name="135615236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615236" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615236">Tobias Grosser (Oct 11 2018 at 15:13)</a>:</h4>
<p>Not sure if this makes things easier.</p>

<a name="135615286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615286" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615286">Tobias Grosser (Oct 11 2018 at 15:14)</a>:</h4>
<p>I fell, getting dependences out of lean files is certainly a useful component in any of these tools.</p>

<a name="135615513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615513" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615513">Simon Hudon (Oct 11 2018 at 15:17)</a>:</h4>
<p>In the end, we'll probably need to parse the Lean files ourselves though, no? Unless we can get <code>lean</code> to get them out for us.</p>

<a name="135615802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615802">Simon Hudon (Oct 11 2018 at 15:20)</a>:</h4>
<p>In the meantime, I started a branch in <code>sccache</code> and I talked to the developers on how to support Lean. It sounds doable. I just need to learn a bit more of Rust. And they seem willing to take our patch</p>

<a name="135615854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615854" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615854">Tobias Grosser (Oct 11 2018 at 15:21)</a>:</h4>
<p>Cool. This sounds very exciting, indeed.</p>

<a name="135615893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615893">Tobias Grosser (Oct 11 2018 at 15:21)</a>:</h4>
<p>What is the problem with --deps?</p>

<a name="135615984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135615984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135615984">Reid Barton (Oct 11 2018 at 15:22)</a>:</h4>
<p>As far as I can tell, it just doesn't work properly</p>

<a name="135616006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135616006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135616006">Simon Hudon (Oct 11 2018 at 15:23)</a>:</h4>
<p>I can't get it to work at the scale of a project. It seems to work off of <code>LEAN_PATH</code> which is no longer required (and indeed harmful) to work with <code>leanpkg</code></p>

<a name="135616582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135616582" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135616582">Tobias Grosser (Oct 11 2018 at 15:31)</a>:</h4>
<p>I see. I have no idea of this code, but fixing it seems the most direct thing to do. In fact, does it do a lot more than parsing the imports?</p>

<a name="135616638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135616638" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135616638">Tobias Grosser (Oct 11 2018 at 15:32)</a>:</h4>
<p>AFAIU it should just parse the imports and then print this to stdout in some way.</p>

<a name="135616639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135616639" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135616639">Reid Barton (Oct 11 2018 at 15:32)</a>:</h4>
<p>Simon, have you gotten it to work under any circumstances?</p>

<a name="135617597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135617597" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135617597">Reid Barton (Oct 11 2018 at 15:48)</a>:</h4>
<p>Oh, I figured out why it is broken. It thinks that the presence of both <code>foo.lean</code> and <code>foo.olean</code> means that the import of <code>foo</code> is ambiguous.</p>

<a name="135617619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135617619" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135617619">Reid Barton (Oct 11 2018 at 15:48)</a>:</h4>
<p>So, this is something we could work around (in principle, at least)</p>

<a name="135618364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135618364" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135618364">Simon Hudon (Oct 11 2018 at 16:00)</a>:</h4>
<p>I was actually thinking that temporarily setting <code>LEAN_PATH</code> might fix it but I'm not done experimenting with it</p>

<a name="135618381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135618381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135618381">Reid Barton (Oct 11 2018 at 16:01)</a>:</h4>
<p>I looked at <code>strace -e trace=file</code> output and it's clearly not failing to find the files it's looking for</p>

<a name="135618449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135618449" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135618449">Reid Barton (Oct 11 2018 at 16:02)</a>:</h4>
<p>And it is looking in the correct paths as reported by <code>lean -p</code> (and examining the source seems to indicate that <code>lean -p</code> is using the same path information as <code>lean --deps</code>)</p>

<a name="135618997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135618997" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135618997">Simon Hudon (Oct 11 2018 at 16:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Any chance we may get a fix for <code>lean --deps</code>?</p>

<a name="135619199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619199" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619199">Sebastian Ullrich (Oct 11 2018 at 16:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Yes, I feel that could be a reasonable change. It would be great if you or someone else could investigate fixing it</p>

<a name="135619323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619323">Simon Hudon (Oct 11 2018 at 16:19)</a>:</h4>
<p>Sure I'll look into it. Do you have a suggestion of where I should start?</p>

<a name="135619525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619525" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619525">Sebastian Ullrich (Oct 11 2018 at 16:23)</a>:</h4>
<p>The relevant call should be this one: <a href="https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/src/shell/lean.cpp#L698" target="_blank" title="https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/src/shell/lean.cpp#L698">https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/src/shell/lean.cpp#L698</a></p>

<a name="135619547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619547" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619547">Sebastian Ullrich (Oct 11 2018 at 16:23)</a>:</h4>
<p>Wow, <code>display_deps</code> is still testing for <code>.hlean</code> and <code>.lua</code></p>

<a name="135619731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619731" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619731">Reid Barton (Oct 11 2018 at 16:27)</a>:</h4>
<p>What I have inferred from looking at the source and the strace output: Say the module imports <code>data.rbmap</code>. <code>display_deps</code> calls</p>
<div class="codehilite"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">find_file</span><span class="p">(</span><span class="n">search_path</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">paths</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">base</span><span class="p">,</span> <span class="n">optional</span><span class="o">&lt;</span><span class="kt">unsigned</span><span class="o">&gt;</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">rel</span><span class="p">,</span> <span class="n">name</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">fname</span><span class="p">,</span>
                      <span class="n">std</span><span class="o">::</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="kt">char</span> <span class="k">const</span> <span class="o">*&gt;</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="n">extensions</span><span class="p">)</span> <span class="p">{</span>
</pre></div>


<p>in <code>src/util/lean_path.cpp</code>. That calls <code>file_path</code> just above, because the import is not relative. That one tries each extension in the given list and pushes all the successes into a list of results.</p>

<a name="135619803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619803">Reid Barton (Oct 11 2018 at 16:28)</a>:</h4>
<p>Because both <code>data/rbmap/default.lean</code> and <code>data/rbmap/default.olean</code> are found, that function raises an "ambiguous import" exception. Then <code>display_deps</code> catches the exception and reports an uninformative "file not found" error message.</p>

<a name="135619828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619828" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619828">Reid Barton (Oct 11 2018 at 16:29)</a>:</h4>
<p>You may want to verify this by inserting tracing printfs and/or having <code>display_deps</code> show the original exception</p>

<a name="135619830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619830" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619830">Simon Hudon (Oct 11 2018 at 16:29)</a>:</h4>
<p>Wow! you're fast!</p>

<a name="135619917"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619917" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619917">Sebastian Ullrich (Oct 11 2018 at 16:30)</a>:</h4>
<p>Nice work! This is the code the regular path uses for importing, you may want to adapt that <a href="https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/src/library/module_mgr.cpp" target="_blank" title="https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/src/library/module_mgr.cpp">https://github.com/leanprover/lean/blob/b13ac127fd83f3724d2f096b1fb85dc6b15e3746/src/library/module_mgr.cpp</a></p>

<a name="135619925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135619925" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135619925">Reid Barton (Oct 11 2018 at 16:30)</a>:</h4>
<p>I was just looking into this earlier (see my messages of 42 minutes ago)</p>

<a name="135620046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620046" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620046">Sebastian Ullrich (Oct 11 2018 at 16:32)</a>:</h4>
<p>Note that this code already looks completely different in Lean 4. So fixing this would only make sense if it was a big win for Lean 3 users (which a working <code>sccache</code> would probably be)</p>

<a name="135620153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620153">Simon Hudon (Oct 11 2018 at 16:34)</a>:</h4>
<p>I think it would be. It seems like a small fix on the Lean side and I'm hopeful <code>sccache</code> should be easily ported from Lean 3 to Lean 4 (once it works for Lean 3)</p>

<a name="135620168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620168" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620168">Simon Hudon (Oct 11 2018 at 16:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> Can I leave that fix to you?</p>

<a name="135620573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620573">Reid Barton (Oct 11 2018 at 16:42)</a>:</h4>
<p>I can take a shot at it. We should make sure we have some working setup for <code>sccache</code> before upstreaming the change to Lean though. For testing purposes, you should be able to just remove <code>".olean"</code> from the list of extensions in <code>display_deps</code>.</p>

<a name="135620680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620680" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620680">Simon Hudon (Oct 11 2018 at 16:44)</a>:</h4>
<blockquote>
<p>we have some working setup for sccache before upstreaming the change to Lean though</p>
</blockquote>
<p>I think the fix is usable on its own. Why do you think we should wait?</p>

<a name="135620813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620813" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620813">Reid Barton (Oct 11 2018 at 16:47)</a>:</h4>
<p>Only because Lean 3 is currently in this state where it doesn't change without a particularly good reason</p>

<a name="135620982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135620982" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135620982">Simon Hudon (Oct 11 2018 at 16:50)</a>:</h4>
<p>It makes it harder to progress if we wait for everything to be ready before we push anything. If we do the heavy lifting, I don't think they will begrudge us fixing a problem even if the <code>sccache</code> idea doesn't pan out.</p>

<a name="135624103"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135624103" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135624103">Simon Hudon (Oct 11 2018 at 17:47)</a>:</h4>
<p>I just tried removing <code>.olean</code> from the list in <code>display_deps</code> and it's working. Is that a good enough fix?</p>

<a name="135627574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135627574" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135627574">Reid Barton (Oct 11 2018 at 18:43)</a>:</h4>
<p>It seems like it should be good enough for us, though there could be other bugs lurking underneath. The other question is whether it would break any other users of Lean and specifically of <code>lean --deps</code>. The only way I could imagine the change breaking a working system is if that system uses out-of-tree builds (output <code>.olean</code> files not located in the same place as the corresponding source files) and also relies on <code>.olean</code> files as inputs without corresponding source <code>.lean</code> files. That seems pretty unlikely to me, considering that lean's library itself is not built out-of-tree, so at a minimum the implicit import of <code>init</code> will fail.</p>

<a name="135627687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135627687" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135627687">Simon Hudon (Oct 11 2018 at 18:45)</a>:</h4>
<p>That's also my impression. I wonder if they had anything else in mind when they put <code>.olean</code> in that list.</p>

<a name="135627908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135627908" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135627908">Simon Hudon (Oct 11 2018 at 18:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Here's the fix that did it for me: <a href="https://github.com/cipher1024/lean/commit/d2d81a3539bdf952eaf6126d2be69f2fda0b2f1f" target="_blank" title="https://github.com/cipher1024/lean/commit/d2d81a3539bdf952eaf6126d2be69f2fda0b2f1f">https://github.com/cipher1024/lean/commit/d2d81a3539bdf952eaf6126d2be69f2fda0b2f1f</a></p>

<a name="135628632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135628632" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135628632">Simon Hudon (Oct 11 2018 at 19:02)</a>:</h4>
<p>Also, is <code>--make</code> the only way to produce <code>.olean</code> files? For me, even if I give a file name, it seems to build the whole project. Is there any way around that?</p>

<a name="135628799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135628799" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135628799">Reid Barton (Oct 11 2018 at 19:05)</a>:</h4>
<p>It should only build the file you specify (and its dependencies if necessary)</p>

<a name="135628948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135628948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135628948">Simon Hudon (Oct 11 2018 at 19:08)</a>:</h4>
<p>You're right, I misinterpreted what I saw</p>

<a name="135629007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135629007" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135629007">Simon Hudon (Oct 11 2018 at 19:08)</a>:</h4>
<p>Now with the fix, I managed to build a make file that discovers dependencies and builds what it needs.</p>

<a name="135629452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135629452" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135629452">Tobias Grosser (Oct 11 2018 at 19:15)</a>:</h4>
<p>Nice!</p>

<a name="135629798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135629798" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135629798">Simon Hudon (Oct 11 2018 at 19:21)</a>:</h4>
<p>I decided to go for bare minimum and only use <code>make</code>. We can make it more sophisticated once we see it is working.</p>

<a name="135629867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135629867" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135629867">Tobias Grosser (Oct 11 2018 at 19:22)</a>:</h4>
<p>Seems like a good idea. Looking forward to checkout the make file.</p>

<a name="135631243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135631243" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135631243">Simon Hudon (Oct 11 2018 at 19:45)</a>:</h4>
<p>I'll push it in a branch in a moment. If you have comments, I'd love to hear them</p>

<a name="135631248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135631248" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135631248">Simon Hudon (Oct 11 2018 at 19:45)</a>:</h4>
<p>It won't be functional because I hard coded a path to my Lean version</p>

<a name="135632212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632212" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632212">Sebastian Ullrich (Oct 11 2018 at 20:03)</a>:</h4>
<p>You can use elan to manage your local Lean fork :)</p>

<a name="135632230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632230" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632230">Simon Hudon (Oct 11 2018 at 20:03)</a>:</h4>
<p>Niiice! How?</p>

<a name="135632317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632317" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632317">Sebastian Ullrich (Oct 11 2018 at 20:04)</a>:</h4>
<p><code>elan help toolchain link</code></p>

<a name="135632390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632390" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632390">Sebastian Ullrich (Oct 11 2018 at 20:05)</a>:</h4>
<p>"crate", oops</p>

<a name="135632476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632476">Simon Hudon (Oct 11 2018 at 20:06)</a>:</h4>
<p>Haha! I didn't even notice! I was thinking that you've been pretty thorough in replacing Rust with Lean :)</p>

<a name="135632579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632579" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632579">Simon Hudon (Oct 11 2018 at 20:08)</a>:</h4>
<p>Btw, have you looked at my commit?</p>

<a name="135632845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632845" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632845">Sebastian Ullrich (Oct 11 2018 at 20:12)</a>:</h4>
<p>Yeah, I think it should be fine. You can remove ".lua" too.</p>

<a name="135632879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135632879" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135632879">Simon Hudon (Oct 11 2018 at 20:13)</a>:</h4>
<p>Will do!</p>

<a name="135634431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135634431" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135634431">Simon Hudon (Oct 11 2018 at 20:36)</a>:</h4>
<p>Here we go: <a href="https://github.com/leanprover/lean/pull/1978" target="_blank" title="https://github.com/leanprover/lean/pull/1978">https://github.com/leanprover/lean/pull/1978</a></p>

<a name="135637248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135637248" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135637248">Simon Hudon (Oct 11 2018 at 21:24)</a>:</h4>
<p>Is it possible to use <code>elan</code> to refer to a specific git commit on github?</p>

<a name="135641178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135641178" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135641178">Simon Hudon (Oct 11 2018 at 22:44)</a>:</h4>
<p><span class="user-mention" data-user-id="122318">@Tobias Grosser</span> here is what I did for the Makefile. It generates dependency files for each <code>.lean</code> file before it gets started building any files and the first time you get a lot of error messages because they are missing.</p>
<p><a href="https://github.com/leanprover-community/mathlib/commit/d090d711c0b438223479635b663e720dab2d07e7" target="_blank" title="https://github.com/leanprover-community/mathlib/commit/d090d711c0b438223479635b663e720dab2d07e7">https://github.com/leanprover-community/mathlib/commit/d090d711c0b438223479635b663e720dab2d07e7</a></p>

<a name="135642448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135642448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135642448">Simon Hudon (Oct 11 2018 at 23:10)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> You use emacs right? What do you use for Rust?</p>

<a name="135655934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135655934" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135655934">Tobias Grosser (Oct 12 2018 at 05:45)</a>:</h4>
<p>Nice. </p>
<blockquote>
<p><span class="user-mention" data-user-id="122318">@Tobias Grosser</span> here is what I did for the Makefile. It generates dependency files for each <code>.lean</code> file before it gets started building any files and the first time you get a lot of error messages because they are missing.</p>
<p><a href="https://github.com/leanprover-community/mathlib/commit/d090d711c0b438223479635b663e720dab2d07e7" target="_blank" title="https://github.com/leanprover-community/mathlib/commit/d090d711c0b438223479635b663e720dab2d07e7">https://github.com/leanprover-community/mathlib/commit/d090d711c0b438223479635b663e720dab2d07e7</a></p>
</blockquote>
<p>Now just the sccache needs to work. I feel this might indeed be a great improvement. </p>
<p>Best Tobias</p>

<a name="135919858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135919858" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135919858">Johan Commelin (Oct 16 2018 at 18:33)</a>:</h4>
<p>My laptop just crashed while compiling mathlib. This is the first time it crashed in a couple of years. We really need to make mathlib easier on prehistoric hardware <span class="emoji emoji-1f409" title="dragon">:dragon:</span></p>

<a name="135923867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135923867" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135923867">Simon Hudon (Oct 16 2018 at 19:36)</a>:</h4>
<p>I'm sciencing as fast as I can ... it's coming</p>

<a name="135924071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135924071" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135924071">Kenny Lau (Oct 16 2018 at 19:40)</a>:</h4>
<p>or we can make mathlib compile <em>faster</em></p>

<a name="135924198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/135924198" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#135924198">Simon Hudon (Oct 16 2018 at 19:42)</a>:</h4>
<p>I don't think we should pick just one</p>

<a name="147996200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996200">Scott Morrison (Nov 19 2018 at 21:20)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110026">@Simon Hudon</span>, would you have time to give a status update on <code>sccache</code> integration, in particular pointing out if there are places someone else could help write code/investigate issues/do some research?</p>

<a name="147996348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996348">Simon Hudon (Nov 19 2018 at 21:22)</a>:</h4>
<p>Sure. I can push what I currently have</p>

<a name="147996392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996392" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996392">Simon Hudon (Nov 19 2018 at 21:23)</a>:</h4>
<p>What I did is provide a way for sscache to determine if an olean file is outdated or not through hashing.</p>

<a name="147996477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996477" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996477">Simon Hudon (Nov 19 2018 at 21:24)</a>:</h4>
<p>I'm still struggling to get the tests to pass. I think once that work, we should have a version sscache that can locally cache any lean build we like.</p>

<a name="147996521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996521">Simon Hudon (Nov 19 2018 at 21:24)</a>:</h4>
<p>I wrote a Makefile to take advantage of it and I pushed it on leanprover-community. I also made a patch to lean itself to fix the way it computes dependencies</p>

<a name="147996650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996650">Simon Hudon (Nov 19 2018 at 21:26)</a>:</h4>
<p>After I'm done with this part, one possible extension (if you want to spend the time) is figure out how to get some cloud storage to store a Lean cache. That would involve configuring sccache itself and setting up instructions for people who want to access the cache.</p>

<a name="147996663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/147996663" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#147996663">Simon Hudon (Nov 19 2018 at 21:26)</a>:</h4>
<p>At this point I see that more as goody than as a must have though</p>

<a name="148010429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148010429" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148010429">Scott Morrison (Nov 20 2018 at 01:40)</a>:</h4>
<p>I pushed two minor changes to the <code>build-system</code> branch.</p>

<a name="148089909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148089909" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148089909">Scott Morrison (Nov 21 2018 at 05:39)</a>:</h4>
<p>Where is that "is an olean file outdated, via hashing" code?</p>

<a name="148090026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090026">Scott Morrison (Nov 21 2018 at 05:43)</a>:</h4>
<p>Using timestamps to decide whether to recompile makes life really difficult. Do we know an obstacle (besides patching Lean), to instead have each olean file contain a hash of its source file and of the olean files for each of its imports? To decide if an olean file is stale or not you would read those hash from the olean file, and compare them against the current hashes of those files.</p>

<a name="148090031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090031">Scott Morrison (Nov 21 2018 at 05:43)</a>:</h4>
<p>Once one <code>.lean</code> file changes, this would propagate staleness of all dependent <code>.olean</code> files.</p>

<a name="148090032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090032" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090032">Scott Morrison (Nov 21 2018 at 05:43)</a>:</h4>
<p>And no timestamps would ever be considered.</p>

<a name="148090072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090072" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090072">Scott Morrison (Nov 21 2018 at 05:44)</a>:</h4>
<p>Or, <span class="user-mention" data-user-id="110026">@Simon Hudon</span>, is this what you've already done?</p>

<a name="148090145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090145" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090145">Simon Hudon (Nov 21 2018 at 05:47)</a>:</h4>
<p>That's what I'm working on yes. More exactly, when calling <code>sccache lean --make foo.lean</code>, we get the list of modules imported (directly or indirectly) by <code>foo.lean</code>, we hash all of them (including <code>foo.lean</code>) and recompile only if that hash changes.</p>

<a name="148090216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090216" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090216">Scott Morrison (Nov 21 2018 at 05:49)</a>:</h4>
<p>I see -- you hash the source files of the imports, or the olean files?</p>

<a name="148090260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090260" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090260">Scott Morrison (Nov 21 2018 at 05:50)</a>:</h4>
<p>And this is all being done by the sccache wrapper, with no modification of Lean?</p>

<a name="148090261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090261">Simon Hudon (Nov 21 2018 at 05:50)</a>:</h4>
<p>The sources</p>

<a name="148090263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090263" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090263">Simon Hudon (Nov 21 2018 at 05:50)</a>:</h4>
<p>That's correct</p>

<a name="148090270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090270">Scott Morrison (Nov 21 2018 at 05:50)</a>:</h4>
<p>But won't we then get burnt still by Lean being wrong about what is stale?</p>

<a name="148090279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090279">Simon Hudon (Nov 21 2018 at 05:51)</a>:</h4>
<p>I'd like to hash the olean but all the ways I have thought of are flawed</p>

<a name="148090284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090284" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090284">Simon Hudon (Nov 21 2018 at 05:51)</a>:</h4>
<p>What do you mean?</p>

<a name="148090288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090288">Scott Morrison (Nov 21 2018 at 05:51)</a>:</h4>
<p>Say we have files A &lt; B &lt; C, and A and B are already built correctly, according to their hashes, while C needs to be rebuilt.</p>

<a name="148090292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090292" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090292">Scott Morrison (Nov 21 2018 at 05:51)</a>:</h4>
<p>But suppose the timestamps on A.olean and B.olean are messed up.</p>

<a name="148090339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090339">Scott Morrison (Nov 21 2018 at 05:52)</a>:</h4>
<p>When sccache invokes Lean on C.lean, what is to stop Lean from going and recompiling A and B?</p>

<a name="148090365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090365">Simon Hudon (Nov 21 2018 at 05:54)</a>:</h4>
<p>I don't think this will be happening but I have to double check. Maybe <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> can tell us. If we call <code>lean --make foo.lean</code>, will Lean attempt to rebuild any of the dependencies? If so, is there a way to tell it not to?</p>

<a name="148090473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148090473" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148090473">Simon Hudon (Nov 21 2018 at 05:57)</a>:</h4>
<p>One thing I have considered is to manually set the modification time of the <code>olean</code> files when they don't need to be rebuilt. That should solve the issue.</p>

<a name="148095554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/148095554" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#148095554">Sebastian Ullrich (Nov 21 2018 at 08:27)</a>:</h4>
<p>Yeah, that's what I would have proposed, too</p>

<a name="151848308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/151848308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#151848308">Johan Commelin (Dec 15 2018 at 19:24)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> <span class="user-mention" data-user-id="110026">@Simon Hudon</span> Any updates on the caching front? (Yes, indeed, I thought of it again because I'm currently recompiling... <span class="emoji emoji-1f606" title="lol">:lol:</span>)</p>

<a name="151848324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/151848324" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#151848324">Simon Hudon (Dec 15 2018 at 19:25)</a>:</h4>
<p>Haha! I actually managed to make progress on it today and yesterday. Now I'm testing it and I'm hoping I can roll out a version soon</p>

<a name="151848327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/151848327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#151848327">Johan Commelin (Dec 15 2018 at 19:26)</a>:</h4>
<p>Awesome news!</p>

<a name="152043694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/152043694" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#152043694">Simon Hudon (Dec 17 2018 at 17:16)</a>:</h4>
<p>I managed to build a version that passes all their tests:</p>
<p><a href="https://github.com/leanprover-community/sccache/tree/lean-support-2" target="_blank" title="https://github.com/leanprover-community/sccache/tree/lean-support-2">https://github.com/leanprover-community/sccache/tree/lean-support-2</a></p>

<a name="152043765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/152043765" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#152043765">Simon Hudon (Dec 17 2018 at 17:17)</a>:</h4>
<p>When I try it with my Makefile though, it fails. There seems to be issue with the timing when <code>sccache</code> produces the binaries</p>

<a name="152043832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/olean%20caching/near/152043832" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/68285oleancaching.html#152043832">Simon Hudon (Dec 17 2018 at 17:18)</a>:</h4>
<p>If someone wants to try it for themselves, I can share the Makefile</p>


{% endraw %}
