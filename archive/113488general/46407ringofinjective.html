---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/46407ringofinjective.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html">ring of injective</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="168117263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168117263" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168117263">Johan Commelin (Jun 14 2019 at 08:36)</a>:</h4>
<p>How do I prove this in a one-liner:</p>
<div class="codehilite"><pre><span></span><span class="kn">section</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_add</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_neg</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">β</span><span class="o">]</span>

<span class="n">def</span> <span class="n">comm_ring_of_injective</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">f</span><span class="o">)</span>
  <span class="o">(</span><span class="n">zero</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">one</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">add</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">mul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">neg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="bp">-</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comm_ring</span> <span class="n">α</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine_struct</span> <span class="o">{</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_zero</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_one</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_add</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_mul</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_neg</span> <span class="n">α</span><span class="err">›</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span><span class="n">sorry</span><span class="o">}</span>
<span class="kn">end</span>

<span class="kn">end</span>
</pre></div>

<a name="168118699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168118699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168118699">Johan Commelin (Jun 14 2019 at 09:00)</a>:</h4>
<p>I was hoping that <code>all_goals { intros, apply inj, simp [zero, one, mul, add, neg] },</code> would close most of the goals. But it doesn't...</p>

<a name="168118955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168118955" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168118955">Kevin Buzzard (Jun 14 2019 at 09:04)</a>:</h4>
<p>I guess we have some instance that says that a subgroup of a group is a group. Maybe there is some analogous instance that a subring of a ring is a ring. So you could just use this instance and then <code>transfer</code> the structure over to alpha via the canonical bijection.</p>

<a name="168119402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168119402" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168119402">Johan Commelin (Jun 14 2019 at 09:13)</a>:</h4>
<p>I was hoping there would be a 1-line tactic proof that works with the current state of mathlib... <code>transfer</code> doesn't currently work.</p>

<a name="168119505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168119505" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168119505">Kevin Buzzard (Jun 14 2019 at 09:14)</a>:</h4>
<p>Oh well, stick it on the list at <a href="https://github.com/leanprover-community/mathlib/issues/408" target="_blank" title="https://github.com/leanprover-community/mathlib/issues/408">https://github.com/leanprover-community/mathlib/issues/408</a></p>

<a name="168145955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168145955" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168145955">Johan Commelin (Jun 14 2019 at 15:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> How would you prove this?</p>

<a name="168148914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168148914" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168148914">Kenny Lau (Jun 14 2019 at 16:12)</a>:</h4>
<p>lemme see...</p>

<a name="168151265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168151265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168151265">Kenny Lau (Jun 14 2019 at 16:41)</a>:</h4>
<p>I can't prove it. It's because of <code>+</code> being elaborated differently in the two different contexts.</p>

<a name="168153162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168153162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168153162">Johan Commelin (Jun 14 2019 at 17:04)</a>:</h4>
<p>Huh? This should be provable, right?</p>

<a name="168153371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168153371" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168153371">Kenny Lau (Jun 14 2019 at 17:07)</a>:</h4>
<p>like I can't prove it using tactics</p>

<a name="168153927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168153927" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168153927">Johan Commelin (Jun 14 2019 at 17:14)</a>:</h4>
<p>Any proof is fine... but I expected/hoped that a tactic proof would be way shorter than a term-mode proof</p>

<a name="168153980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168153980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168153980">Kenny Lau (Jun 14 2019 at 17:14)</a>:</h4>
<p>as in I can't prove it using a few lines</p>

<a name="168154138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168154138" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168154138">Johan Commelin (Jun 14 2019 at 17:16)</a>:</h4>
<p>What exactly is the elaboration issue?</p>

<a name="168154459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168154459" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168154459">Kenny Lau (Jun 14 2019 at 17:21)</a>:</h4>
<p>in <code>add</code>, the <code>+</code> is <code>@has_add.add \a _inst_3</code> or something like that</p>

<a name="168154476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168154476" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168154476">Kenny Lau (Jun 14 2019 at 17:21)</a>:</h4>
<p>but in the goals it is <code>@has_add.add \a (semigroup.to_has_add ...)</code> etc</p>

<a name="168154720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168154720" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168154720">Johan Commelin (Jun 14 2019 at 17:25)</a>:</h4>
<p>Hmm, that's sad...</p>

<a name="168154779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168154779" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168154779">Johan Commelin (Jun 14 2019 at 17:26)</a>:</h4>
<p>I also need the dual version, with a surjective map...</p>

<a name="168154797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168154797" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168154797">Johan Commelin (Jun 14 2019 at 17:26)</a>:</h4>
<p>I guess I will just manually proof all the goals</p>

<a name="168155802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168155802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168155802">Andrew Ashworth (Jun 14 2019 at 17:39)</a>:</h4>
<p>I'm just now sort of getting an inkling of why everyone wants a beefed up <code>transfer</code>, since I rarely deal in very abstract types. But I'm unsure of why people think a 1-line proof is possible. For any map between two types equipped with a ring instance you will always have to prove that it is a ring homomorphism, right? Isn't isomorphism in the context of rings an equivalence relation, so you could use the same machinery to reason about them? (sorry if this observation sounds incredibly stupid to those who have spent much more time thinking about this sort of thing)</p>

<a name="168156050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168156050" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168156050">Kevin Buzzard (Jun 14 2019 at 17:42)</a>:</h4>
<p>Mathematicians look at the question and cannot see what the issue is.</p>

<a name="168156117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168156117" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168156117">Kevin Buzzard (Jun 14 2019 at 17:43)</a>:</h4>
<p>alpha is a subset of beta closed under all the operations and it will inherit all of the axioms automatically -- of course it's a ring. What frustrates us is that apparently this is not obvious to computer scientists.</p>

<a name="168156229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168156229" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168156229">Kevin Buzzard (Jun 14 2019 at 17:44)</a>:</h4>
<p>Johan's assumptions identify alpha with a subtype of beta in a way which preserves everything of interest, so whatever is there left to check?</p>

<a name="168156275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168156275" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168156275">Kevin Buzzard (Jun 14 2019 at 17:45)</a>:</h4>
<p>Mathematicians have a zero-line proof that alpha is a ring. In a maths lecture you would just deduce it immediately.</p>

<a name="168156380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168156380" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168156380">Kevin Buzzard (Jun 14 2019 at 17:47)</a>:</h4>
<p>For example <code>f (x + y) = f x + f y</code> and injectivity of <code>f</code> immediately imply associativity of alpha's + because we imagine alpha as literally being a subset of beta with the induced +.</p>

<a name="168157029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168157029" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168157029">Johan Commelin (Jun 14 2019 at 17:55)</a>:</h4>
<p>Here is the one-line maths proof:<br>
"All the data is there, and <code>f</code> is structure preserving. The ring axioms are universal formulas in the language of rings. Since <code>f</code> is injective this means we are done."</p>

<a name="168157150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168157150" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168157150">Johan Commelin (Jun 14 2019 at 17:56)</a>:</h4>
<p>The Lean proof should be</p>
<div class="codehilite"><pre><span></span><span class="n">all_goals</span> <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">apply</span> <span class="n">inj</span><span class="o">,</span> <span class="n">simp</span> <span class="o">[</span><span class="bp">*</span><span class="o">]</span> <span class="o">}</span>
</pre></div>

<a name="168159057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168159057" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168159057">Johan Commelin (Jun 14 2019 at 18:21)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> <code>erw</code> helps. This is what I've got for the surjective variant:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">comm_ring_of_surjective</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">α&#39;</span><span class="o">)</span> <span class="o">(</span><span class="n">sur</span> <span class="o">:</span> <span class="n">surjective</span> <span class="n">f</span><span class="o">)</span>
  <span class="o">(</span><span class="n">zero</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">one</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">add</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">mul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">neg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="bp">-</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comm_ring</span> <span class="n">α&#39;</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine_struct</span> <span class="o">{</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_zero</span> <span class="n">α&#39;</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_one</span> <span class="n">α&#39;</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_add</span> <span class="n">α&#39;</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_mul</span> <span class="n">α&#39;</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_neg</span> <span class="n">α&#39;</span><span class="err">›</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span>
    <span class="n">try</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">a</span><span class="o">,</span> <span class="n">rcases</span> <span class="n">sur</span> <span class="n">a</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="o">},</span>
    <span class="n">try</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">b</span><span class="o">,</span> <span class="n">rcases</span> <span class="n">sur</span> <span class="n">b</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="o">},</span>
    <span class="n">try</span> <span class="o">{</span> <span class="n">intro</span> <span class="n">c</span><span class="o">,</span> <span class="n">rcases</span> <span class="n">sur</span> <span class="n">c</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">c</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="o">},</span>
    <span class="n">repeat</span> <span class="o">{</span> <span class="n">erw</span> <span class="err">←</span> <span class="n">zero</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="err">←</span> <span class="n">one</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="err">←</span> <span class="n">add</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="err">←</span> <span class="n">mul</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="err">←</span> <span class="n">neg</span> <span class="o">},</span>
    <span class="n">try</span> <span class="o">{</span><span class="n">simp</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">,</span> <span class="n">add_mul</span><span class="o">]</span> <span class="o">}</span> <span class="o">},</span>
    <span class="n">rw</span> <span class="n">mul_comm</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="168163715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168163715" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168163715">Kenny Lau (Jun 14 2019 at 19:19)</a>:</h4>
<p>so we should have <code>esimp</code></p>

<a name="168164104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168164104" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168164104">Reid Barton (Jun 14 2019 at 19:24)</a>:</h4>
<p>Sounds eslow</p>

<a name="168164593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168164593" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168164593">Koundinya Vajjha (Jun 14 2019 at 19:31)</a>:</h4>
<p>I never could understand how <code>erw</code> is different from <code>rw</code>.</p>

<a name="168170752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168170752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168170752">Kenny Lau (Jun 14 2019 at 20:51)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">section</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_add</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_neg</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">β</span><span class="o">]</span>

<span class="n">def</span> <span class="n">comm_ring_of_injective</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">f</span><span class="o">)</span>
  <span class="o">(</span><span class="n">zero</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">one</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">add</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">mul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">neg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="bp">-</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comm_ring</span> <span class="n">α</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine_struct</span> <span class="o">{</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_zero</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_one</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_add</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_mul</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_neg</span> <span class="n">α</span><span class="err">›</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">apply</span> <span class="n">inj</span><span class="o">,</span> <span class="n">repeat</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">zero</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="n">one</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="n">add</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="n">mul</span> <span class="bp">&lt;|&gt;</span> <span class="n">erw</span> <span class="n">neg</span> <span class="o">},</span>
    <span class="n">simp</span> <span class="o">[</span><span class="n">mul_assoc</span><span class="o">,</span> <span class="n">mul_add</span><span class="o">,</span> <span class="n">add_mul</span><span class="o">]</span> <span class="o">},</span>
  <span class="n">rw</span> <span class="n">mul_comm</span>
<span class="kn">end</span>

<span class="kn">end</span>
</pre></div>

<a name="168170941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168170941" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168170941">Johan Commelin (Jun 14 2019 at 20:54)</a>:</h4>
<p>Yep, I also found that one.</p>

<a name="168170948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168170948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168170948">Johan Commelin (Jun 14 2019 at 20:54)</a>:</h4>
<p>It's sad that it seems a bit slow...</p>

<a name="168170958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168170958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168170958">Johan Commelin (Jun 14 2019 at 20:54)</a>:</h4>
<p>But it works (-;</p>

<a name="168171158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168171158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168171158">Kenny Lau (Jun 14 2019 at 20:58)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">interactive</span>

<span class="kn">section</span>
<span class="kn">open</span> <span class="n">function</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">has_zero</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_one</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_add</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_mul</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">has_neg</span> <span class="n">α</span><span class="o">]</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">β</span><span class="o">]</span>

<span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="c1">-- elaboration of comm_ring_of_injective took 493ms</span>
<span class="n">def</span> <span class="n">comm_ring_of_injective</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">inj</span> <span class="o">:</span> <span class="n">injective</span> <span class="n">f</span><span class="o">)</span>
  <span class="o">(</span><span class="n">zero</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">one</span> <span class="o">:</span> <span class="n">f</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">add</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span>
  <span class="o">(</span><span class="n">mul</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="n">x</span> <span class="bp">*</span> <span class="n">y</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">f</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">neg</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">x</span><span class="o">},</span> <span class="n">f</span> <span class="o">(</span><span class="bp">-</span><span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">-</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">comm_ring</span> <span class="n">α</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">refine_struct</span> <span class="o">{</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_zero</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_one</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_add</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_mul</span> <span class="n">α</span><span class="err">›</span><span class="o">,</span> <span class="bp">..</span><span class="err">‹</span><span class="n">has_neg</span> <span class="n">α</span><span class="err">›</span> <span class="o">},</span>
  <span class="n">all_goals</span> <span class="o">{</span> <span class="n">intros</span><span class="o">,</span> <span class="n">apply</span> <span class="n">inj</span><span class="o">,</span>
    <span class="n">repeat</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">mul</span> <span class="o">},</span> <span class="n">repeat</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">add</span> <span class="o">},</span> <span class="n">repeat</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">mul</span> <span class="o">},</span>
    <span class="n">try</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">neg</span> <span class="o">},</span> <span class="n">try</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">zero</span> <span class="o">},</span> <span class="n">try</span> <span class="o">{</span> <span class="n">erw</span> <span class="n">one</span> <span class="o">},</span> <span class="o">},</span>
  <span class="n">exacts</span> <span class="o">[</span><span class="n">add_assoc</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">zero_add</span> <span class="bp">_</span><span class="o">,</span> <span class="n">add_zero</span> <span class="bp">_</span><span class="o">,</span> <span class="n">add_left_neg</span> <span class="bp">_</span><span class="o">,</span> <span class="n">add_comm</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span>
    <span class="n">mul_assoc</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">one_mul</span> <span class="bp">_</span><span class="o">,</span> <span class="n">mul_one</span> <span class="bp">_</span><span class="o">,</span> <span class="n">mul_add</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">add_mul</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">mul_comm</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">]</span>
<span class="kn">end</span>

<span class="kn">end</span>
</pre></div>

<a name="168191443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/ring%20of%20injective/near/168191443" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/46407ringofinjective.html#168191443">Jesse Michael Han (Jun 15 2019 at 04:48)</a>:</h4>
<blockquote>
<p>I never could understand how <code>erw</code> is different from <code>rw</code>.</p>
</blockquote>
<p>The source is quite transparent about this:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">rewrite</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">rw_rules</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">location</span><span class="o">)</span> <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">rewrite_cfg</span> <span class="o">:=</span> <span class="o">{})</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">propagate_tags</span> <span class="o">(</span><span class="n">rw_core</span> <span class="n">q</span> <span class="n">l</span> <span class="n">cfg</span><span class="o">)</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">erewrite</span> <span class="o">(</span><span class="n">q</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">rw_rules</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">location</span><span class="o">)</span> <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">rewrite_cfg</span> <span class="o">:=</span> <span class="o">{</span><span class="n">md</span> <span class="o">:=</span> <span class="n">semireducible</span><span class="o">})</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">propagate_tags</span> <span class="o">(</span><span class="n">rw_core</span> <span class="n">q</span> <span class="n">l</span> <span class="n">cfg</span><span class="o">)</span>
</pre></div>


<p>The difference is that <code>rewrite_core</code> is allowed to peek into <code>semireducible</code> definitions, where <code>reducible</code> is the default. This means you need to do less explicit unfolding for your rewrites to succeed, but because more definitions are exposed and unification is expensive, <code>erw</code> can be an order of magnitude slower.</p>


{% endraw %}
