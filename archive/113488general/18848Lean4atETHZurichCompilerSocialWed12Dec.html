---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html">Lean 4 at ETH Zurich Compiler Social - Wed 12. Dec</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="148708913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/148708913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#148708913">Tobias Grosser (Nov 28 2018 at 12:48)</a>:</h4>
<p>Dear all,</p>
<p>I am very pleased to announce that on WEDNESDAY 12th December, we will have on our pre-christmas compiler social as special guest Sebastian Ulrich who presents:</p>
<p>"Towards Lean 4: An Optimized Object Model for an Interactive Theorem Prover"</p>
<p>Lean 4, the next version of the Lean theorem prover, will move most of its frontend code from C++ to Lean itself. To ensure that the resulting code is reasonably efficient, Lean 4 will feature a new code generation backend together with a new object and memory management model. In this talk, I will discuss the general and ITP-specific constraints, such as performance, language interoperability, and startup time, that led us to this model and how we are planning to solve them with it.</p>
<p>Sebastian Ullrich is a second-year PhD student at Gregor Snelting's programming paradigms group at the Karlsruhe Institute of Technology (KIT). He is working on the Lean theorem prover together with Leonardo de Moura (Microsoft Research). Sebastian's research interests are program verification, the design of interactive theorem proving frontends, and macro expansion.</p>
<p><a href="https://www.meetup.com/llvm-compiler-and-code-generation-socials-zurich/events/256742083/" target="_blank" title="https://www.meetup.com/llvm-compiler-and-code-generation-socials-zurich/events/256742083/">https://www.meetup.com/llvm-compiler-and-code-generation-socials-zurich/events/256742083/</a></p>

<a name="148709251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/148709251" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#148709251">Andrew Ashworth (Nov 28 2018 at 12:54)</a>:</h4>
<p>It would be awesome if this was recorded for us poor plebians who cannot fly to Europe :)</p>

<a name="148709436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/148709436" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#148709436">Tobias Grosser (Nov 28 2018 at 12:59)</a>:</h4>
<p>It will (and published if <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> agrees ;-))</p>

<a name="148711866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/148711866" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#148711866">Sebastian Ullrich (Nov 28 2018 at 13:45)</a>:</h4>
<p>Sure thing :)</p>

<a name="151234829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151234829" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151234829">Tobias Grosser (Dec 09 2018 at 20:19)</a>:</h4>
<p>This is happening this Wednesday! We already have 24 people signed up! Whoever is close by is very much invited.</p>

<a name="151506341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151506341" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151506341">Tobias Grosser (Dec 12 2018 at 06:39)</a>:</h4>
<p>This is happening tonight.</p>

<a name="151511026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151511026" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151511026">Kenny Lau (Dec 12 2018 at 08:47)</a>:</h4>
<p>is there livestreaming?</p>

<a name="151512398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151512398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151512398">Tobias Grosser (Dec 12 2018 at 09:16)</a>:</h4>
<p>No.</p>

<a name="151512405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151512405" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151512405">Tobias Grosser (Dec 12 2018 at 09:16)</a>:</h4>
<p>But there will be a recording.</p>

<a name="151776778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151776778" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151776778">Edward Ayers (Dec 14 2018 at 13:51)</a>:</h4>
<p>Any news on when/where the recording is released?</p>

<a name="151803997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/151803997" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#151803997">Tobias Grosser (Dec 14 2018 at 20:49)</a>:</h4>
<p>Beginning next week. Still need to recode it.</p>

<a name="152136573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152136573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152136573">Tobias Grosser (Dec 18 2018 at 20:41)</a>:</h4>
<p><a href="https://www.youtube.com/watch?v=Bv0CXyhbJ5s&amp;feature=youtu.be" target="_blank" title="https://www.youtube.com/watch?v=Bv0CXyhbJ5s&amp;feature=youtu.be">https://www.youtube.com/watch?v=Bv0CXyhbJ5s&amp;feature=youtu.be</a></p>
<div class="youtube-video message_inline_image"><a data-id="Bv0CXyhbJ5s" href="https://www.youtube.com/watch?v=Bv0CXyhbJ5s&amp;feature=youtu.be" target="_blank" title="https://www.youtube.com/watch?v=Bv0CXyhbJ5s&amp;feature=youtu.be"><img src="https://i.ytimg.com/vi/Bv0CXyhbJ5s/default.jpg"></a></div>

<a name="152136583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152136583" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152136583">Tobias Grosser (Dec 18 2018 at 20:41)</a>:</h4>
<p>The upload is fresh so it takes another 30min for the HD version to become public.</p>

<a name="152136699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152136699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152136699">Tobias Grosser (Dec 18 2018 at 20:42)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> for this very interesting talk.</p>

<a name="152141565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152141565" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152141565">Patrick Massot (Dec 18 2018 at 21:56)</a>:</h4>
<p>I think I understood it very superficially, but it was still interesting and fun to watch.</p>

<a name="152165409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152165409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152165409">Kevin Buzzard (Dec 19 2018 at 07:55)</a>:</h4>
<p>My 16 year old son explained parts of it to me. Apparently malloc is expensive</p>

<a name="152165417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152165417" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152165417">Kenny Lau (Dec 19 2018 at 07:56)</a>:</h4>
<p>nah I can do it for free in my computer</p>

<a name="152169287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152169287" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152169287">Kevin Buzzard (Dec 19 2018 at 09:19)</a>:</h4>
<p>I deduce from this that you're probably not paying the electricity bills</p>

<a name="152219193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152219193" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152219193">Scott Morrison (Dec 19 2018 at 22:49)</a>:</h4>
<p>At 44:28, someone in the audiences says "But it can't be after 2019, because [indecipherable]" --- does anyone know that that was?</p>

<a name="152221526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152221526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152221526">Wojciech Nawrocki (Dec 19 2018 at 23:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> regarding the region <code>mmap</code>ing, I presume if you have ASLR on and thus the heap base is randomized, you would indeed get a very low probability of collision, but with systems that always place the heap at the same address (ASLR off in Linux, etc), you'd get a collision every time? Or you could randomize the addresses by manually <code>mmap</code>ing every new region in the first place, using a well-distributed hash function as a postfix for the region address :D But that would introduce severe memory fragmentation and would probably be a nightmare for cross-platform support.</p>

<a name="152224500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152224500" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152224500">Patrick Massot (Dec 20 2018 at 00:35)</a>:</h4>
<blockquote>
<p>At 44:28, someone in the audiences says "But it can't be after 2019, because [indecipherable]" --- does anyone know that that was?</p>
</blockquote>
<p>Because the time line at the beginning says Lean 4 appears in 201X. That's the same remark as always</p>

<a name="152239635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152239635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152239635">Keeley Hoek (Dec 20 2018 at 07:44)</a>:</h4>
<p>What do you mean by "severe memory fragmentation"?</p>

<a name="152261208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152261208" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152261208">Wojciech Nawrocki (Dec 20 2018 at 14:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110111">@Keeley Hoek</span> if they want to have their regions uniformly distributed across the address space so that the probability of collision is low when directly loading them into memory, they will naturally be all over the place, as opposed to the usual behaviour of the heap which just expands by adding more pages into a contiguous region</p>

<a name="152263266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152263266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152263266">Sebastian Ullrich (Dec 20 2018 at 15:24)</a>:</h4>
<p><span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> Ah, I hadn't thought of page table fragmentation before. Not sure if it could become an issue. Anyway, we've thought about collecting all object files of a package into a single big object file. Then you have less fragmentation, even fewer collisions, and more sharing of object graph parts as an added bonus.</p>

<a name="152265125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152265125" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152265125">Wojciech Nawrocki (Dec 20 2018 at 15:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Emacs does something <em>kinda</em> similar, so if you're in need of a good horror story, <a href="https://lwn.net/Articles/707615/" target="_blank" title="https://lwn.net/Articles/707615/">here's theirs</a> :D</p>

<a name="152266381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152266381" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152266381">Sebastian Ullrich (Dec 20 2018 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> Nice. The "portable dumper" proposal indeed sounds quite similar.</p>

<a name="152308943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152308943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152308943">Keeley Hoek (Dec 21 2018 at 04:59)</a>:</h4>
<p>I see. Though, so long as the regions are quite a bit larger than 4Kib, shouldn't there be essentially no performance penalty?</p>

<a name="152319850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152319850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152319850">Tobias Grosser (Dec 21 2018 at 09:56)</a>:</h4>
<p>There is a risk of increased TLB misses, I guess.</p>

<a name="152377478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152377478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152377478">Mario Carneiro (Dec 22 2018 at 06:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> <a href="https://youtu.be/Bv0CXyhbJ5s?t=2307" target="_blank" title="https://youtu.be/Bv0CXyhbJ5s?t=2307">38:27</a></p>
<blockquote>
<p>...and some flags like, does it have a metavariable in there, does it have a parameter. So this is just bookkeeping metadata that we use for optimizations. But the nice thing is that the lean type doesn't have to be this ugly. The lean type just says the const constructor just takes a name and a list of universes, and because all the other data is at the end of the object we can just hide it from lean. So if the compiler tries to access any of these fields it will still use the correct offset.</p>
</blockquote>
<p>I was metaphorically shouting "don't do that" at my monitor when I heard this. This is how you get irreplicable "lean magic" that the compiler does and you (the lean user) can't. I won't insist on changing the way you handle this particular case, but I would much rather you provide the means for users to do the same thing as you are doing in the compiler. In this case, if you wanted to actually write this in lean, the <code>expr</code> type would actually be the full ugly thing with all these fields, but there would be invariants built in (before or after the initial construction) asserting that these metadata fields are correct (i.e. actually track properties they claim to). You write some nice front end constructors like <code>expr.const</code> that automatically populate the metadata fields with the only values they are allowed to have, and a front end recursor that doesn't give you the metadata when you don't care. Then you hook the front end recursor into the equation compiler so that pattern matching is unaffected. (This last part can't currently be done in lean, but this is a nice use case.)</p>
<p>Working in C++ means that you have the ability to "cheat" and hide things from lean. Avoid the temptation, and lean will be better.</p>

<a name="152515840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152515840" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152515840">Sebastian Ullrich (Dec 25 2018 at 15:52)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> These optimizations are completely local to <code>expr.cpp</code>, there isn't a single line in the whole C++ codebase that "cheats" around it. You get exactly the same interface from Lean as you get from C++. The fields really are cheap enough to compute in the <code>expr</code> constructors, and for accessing them we should have primitives just like in Lean 3.</p>

<a name="152517386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152517386" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152517386">Mario Carneiro (Dec 25 2018 at 16:51)</a>:</h4>
<p>I just want lean to get similar kinds of support for being able to define a complicated inner representation and shielding it from outside users as you can do in C++</p>

<a name="152518603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152518603" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152518603">Mario Carneiro (Dec 25 2018 at 17:34)</a>:</h4>
<p>I'm not really opposed to this practice, besides the fact that this makes it necessary to make expr meta, but it's one place to try dogfooding. I'm sure you will have plenty of other examples in lean 4 that will require you to address this though</p>

<a name="152538988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152538988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152538988">Kenny Lau (Dec 26 2018 at 06:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> and how does this work with second incompleteness?</p>

<a name="152540405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Lean%204%20at%20ETH%20Zurich%20Compiler%20Social%20-%20Wed%2012.%20Dec/near/152540405" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/18848Lean4atETHZurichCompilerSocialWed12Dec.html#152540405">Mario Carneiro (Dec 26 2018 at 06:56)</a>:</h4>
<p>huh?</p>


{% endraw %}
