---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/09943updatemathlibandbranches.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html">update-mathlib, and branches</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="162777404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162777404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162777404">Scott Morrison (Apr 07 2019 at 23:14)</a>:</h4>
<p>Am I correct in understanding that we can't use <code>update-mathlib</code> in a project the depends on a branch of <code>mathlib</code>, because travis doesn't post archived <code>olean</code>s for branches?</p>

<a name="162777407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162777407" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162777407">Scott Morrison (Apr 07 2019 at 23:14)</a>:</h4>
<p>If that's the case, I would really like to fix this.</p>

<a name="162777493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162777493" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162777493">Scott Morrison (Apr 07 2019 at 23:17)</a>:</h4>
<p>In particular, I want to be able to try something out in the <code>lean-perfectoid-spaces</code> repository, based on the <code>presheaf</code> branch of mathlib. This branch makes lots of edits to existing files in mathlib, so there's no option to just copy and paste the relevant files into <code>lean-perfectoid-spaces</code>. It seems the only options are: everything waits until the <code>presheaf</code> PR is merged, or give up <code>update-mathlib</code> (and thus not be able to convince Kevin to try things out :-).</p>

<a name="162781874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162781874" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162781874">Simon Hudon (Apr 08 2019 at 01:17)</a>:</h4>
<p>You're right, <code>update-mathlib</code> is only useful with <code>master</code>. That's out of concern for disk space on GitHub</p>

<a name="162782368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782368" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782368">Scott Morrison (Apr 08 2019 at 01:31)</a>:</h4>
<p>Okay! Now I remember we discussed this before, and the proposed solution was that I provide the disk space.</p>

<a name="162782414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782414" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782414">Scott Morrison (Apr 08 2019 at 01:32)</a>:</h4>
<p>If we were going to do this, my preferred method would be that I pull olean archives, rather than having travis directly push them to me.</p>

<a name="162782429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782429" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782429">Scott Morrison (Apr 08 2019 at 01:33)</a>:</h4>
<p>There could still be a webhook (that's a fancy name for making an http request, right? :-) for travis to initiate the pull, I guess.</p>

<a name="162782762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782762" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782762">Simon Hudon (Apr 08 2019 at 01:43)</a>:</h4>
<p>I'm not sure about what you're thinking of. Why would Travis need to pull an archive?</p>

<a name="162782886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782886">Scott Morrison (Apr 08 2019 at 01:46)</a>:</h4>
<p>Sorry, I was thinking the following:<br>
1) When travis finished building a non-<code>master</code> branch, it pushes the olean cache to somewhere on Github<br>
2) It then calls some webhook running on my server etc <code>https://tqft.net/update-olean-caches</code><br>
3) My server then grabs the new archive file full of olean files<br>
4) When people run <code>update-mathlib</code> or <code>cache-olean --fetch</code> on non-master branches, it checks my server<br>
5) We periodically clean out the non-master branches stored on Github</p>

<a name="162782889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782889" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782889">Scott Morrison (Apr 08 2019 at 01:46)</a>:</h4>
<p>Alternatively, we just do 1) and 5), and see if there's enough space on Github. :-)</p>

<a name="162782901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162782901" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162782901">Scott Morrison (Apr 08 2019 at 01:47)</a>:</h4>
<p>I'm aware this may be getting too complicated.</p>

<a name="162783083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783083" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783083">Simon Hudon (Apr 08 2019 at 01:52)</a>:</h4>
<p>It may be easier if we get Travis to push the archives to your server directly in the end. But as an approximation, we can get started with just pushing a nightly build for every commit</p>

<a name="162783100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783100" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783100">Scott Morrison (Apr 08 2019 at 01:53)</a>:</h4>
<p>The thing I was trying to avoid was having to give travis the ability to hack my server. :-)</p>

<a name="162783108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783108" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783108">Scott Morrison (Apr 08 2019 at 01:53)</a>:</h4>
<p>Other alternatives might be to have travis push to amazon S3. (I could certainly pay this this.)</p>

<a name="162783160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783160">Simon Hudon (Apr 08 2019 at 01:54)</a>:</h4>
<p>Maybe we can pool some money for that</p>

<a name="162783179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783179" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783179">Scott Morrison (Apr 08 2019 at 01:55)</a>:</h4>
<p>I already have a process set up to pay for storage of various research data on amazon. It's trivial to include something like this.</p>

<a name="162783249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783249" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783249">Simon Hudon (Apr 08 2019 at 01:57)</a>:</h4>
<p>Cool! Already, the Travis build has github credentials encoded into it but I secured them.</p>

<a name="162783252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783252" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783252">Scott Morrison (Apr 08 2019 at 01:57)</a>:</h4>
<p>oh, okay</p>

<a name="162783306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783306" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783306">Scott Morrison (Apr 08 2019 at 01:58)</a>:</h4>
<p>I'm actually pretty relaxed about my server. :-) If you know how to give credentials to travis in a reasonable way, I can just give you ssh keys or something.</p>

<a name="162783309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783309" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783309">Simon Hudon (Apr 08 2019 at 01:58)</a>:</h4>
<p>But amazon S3 sounds like a good idea. If you give me access, I can get started with that</p>

<a name="162783312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162783312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162783312">Scott Morrison (Apr 08 2019 at 01:58)</a>:</h4>
<p>Ok! I will remember how to add authorisation to a bucket.</p>

<a name="162791783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162791783" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162791783">Kevin Buzzard (Apr 08 2019 at 05:59)</a>:</h4>
<p>PS I don't mind building mathlib; but I wouldn't like to be going around saying "the perfectoid project builds, except we need a branch of mathlib". These mathlib maintainers sometimes make you change your PR's, and then you have to fix a bunch of stuff :P</p>

<a name="162791944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162791944" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162791944">Scott Morrison (Apr 08 2019 at 06:03)</a>:</h4>
<p>I'm not sure this is entirely fair -- it's not like a branch of mathlib is inherently more dangerous than code outside of mathlib entirely! :-) In any case, these PRs seem to be working through the system, and hopefully after those two I can avoid needing to change mathlib files.</p>

<a name="162792072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792072" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792072">Kevin Buzzard (Apr 08 2019 at 06:06)</a>:</h4>
<p>I guess what I mean is "well, we never did this before, it looks new and scary to me"</p>

<a name="162792077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792077" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792077">Kevin Buzzard (Apr 08 2019 at 06:06)</a>:</h4>
<p>It's fear of branches.</p>

<a name="162792079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792079" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792079">Scott Morrison (Apr 08 2019 at 06:06)</a>:</h4>
<p>I'll just experiment in a branch for a moment.</p>

<a name="162792098"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792098" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792098">Kevin Buzzard (Apr 08 2019 at 06:07)</a>:</h4>
<p>But actually I did make a branch of the perfectoid project recently, and after figuring out what the hell was going on with the olean files I did manage to pull off a sane workflow.</p>

<a name="162792155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792155" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792155">Scott Morrison (Apr 08 2019 at 06:08)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>, I've been trying to understand the amazon docs, and things seem to have got more complicated since I last used it... I'm struggling to work out how to just hand you a token that gives read+write access to a specific bucket.</p>

<a name="162792160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792160">Scott Morrison (Apr 08 2019 at 06:09)</a>:</h4>
<p>I've certainly done this in the past, but long in the past.</p>

<a name="162792612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162792612" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162792612">Simon Hudon (Apr 08 2019 at 06:20)</a>:</h4>
<p>I'm not clear on how it works. I'll have a look when I wake up</p>

<a name="162828342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162828342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162828342">Simon Hudon (Apr 08 2019 at 15:42)</a>:</h4>
<p>Here is something that I found in the travis documentation:</p>
<p><a href="https://docs.travis-ci.com/user/deployment/codedeploy/#s3-deployment-or-github-deployment" target="_blank" title="https://docs.travis-ci.com/user/deployment/codedeploy/#s3-deployment-or-github-deployment">https://docs.travis-ci.com/user/deployment/codedeploy/#s3-deployment-or-github-deployment</a></p>

<a name="162828372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162828372" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162828372">Simon Hudon (Apr 08 2019 at 15:43)</a>:</h4>
<p>There's an option for automatically deploying to s3</p>

<a name="162828596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162828596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162828596">Simon Hudon (Apr 08 2019 at 15:45)</a>:</h4>
<p>and this might help too: <a href="https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/" target="_blank" title="https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/">https://aws.amazon.com/blogs/security/wheres-my-secret-access-key/</a></p>

<a name="162829450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/update-mathlib%2C%20and%20branches/near/162829450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/09943updatemathlibandbranches.html#162829450">Simon Hudon (Apr 08 2019 at 15:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Once you find your secret access key, we'll set it up in a travis encrypted environment variable. If you want to send it to me encrypted, I can give you my PGP key</p>


{% endraw %}

{% include archive_update.html %}