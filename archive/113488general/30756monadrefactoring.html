---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/30756monadrefactoring.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html">monad refactoring</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="123127367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123127367" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123127367">Patrick Massot (Mar 01 2018 at 07:45)</a>:</h4>
<p><span class="user-mention" data-user-email="sebasti@nullri.ch" data-user-id="110024">@Sebastian Ullrich</span> woke up with a lot of homework... Does anyone knows whether basic users like me will see any difference after merging this?</p>

<a name="123127532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123127532" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123127532">Simon Hudon (Mar 01 2018 at 07:51)</a>:</h4>
<p>Are you referring to the commits in his own fork?</p>

<a name="123127592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123127592" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123127592">Sean Leather (Mar 01 2018 at 07:53)</a>:</h4>
<p>To avoid ambiguity and for posterity: <a href="https://github.com/leanprover/lean/pull/1881" target="_blank" title="https://github.com/leanprover/lean/pull/1881">https://github.com/leanprover/lean/pull/1881</a></p>

<a name="123127763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123127763" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123127763">Simon Hudon (Mar 01 2018 at 07:58)</a>:</h4>
<p>Thanks <span class="user-mention" data-user-email="sean.leather@gmail.com" data-user-id="110045">@Sean Leather</span></p>

<a name="123127842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123127842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123127842">Sean Leather (Mar 01 2018 at 08:01)</a>:</h4>
<blockquote>
<p>woke up with a lot of homework... Does anyone knows whether basic users like me will see any difference after merging this?</p>
</blockquote>
<p><span class="user-mention" data-user-email="patrickmassot@free.fr" data-user-id="110031">@Patrick Massot</span>: I'm guessing you're referring to Leo's comments, of which there were a lot.</p>

<a name="123127851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123127851" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123127851">Patrick Massot (Mar 01 2018 at 08:01)</a>:</h4>
<p>Yes.</p>

<a name="123128035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128035">Patrick Massot (Mar 01 2018 at 08:06)</a>:</h4>
<p>There are a lot of comments but there is a <em>lot</em> of code in this PR.</p>

<a name="123128054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128054">Mario Carneiro (Mar 01 2018 at 08:07)</a>:</h4>
<p>I'm also curious about this. <span class="user-mention" data-user-email="sebasti@nullri.ch" data-user-id="110024">@Sebastian Ullrich</span> , could you maybe discuss or point to a place where you discuss the purpose of the monad refactoring project? From what little I can garner from Leo's comments, it looks like you are maybe adding more advanced monad features from Haskell like monad transformers, the continuation monad and call/cc?</p>

<a name="123128087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128087">Simon Hudon (Mar 01 2018 at 08:08)</a>:</h4>
<p>I think you'll see a difference (hopefully for the best) if you use Lean to write programs. Otherwise, I don't think you'll see a difference</p>

<a name="123128109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128109">Patrick Massot (Mar 01 2018 at 08:08)</a>:</h4>
<p>It's very hard to resist going to Leo's most cryptic comment and add: "Yeah, I wondered about that too".</p>

<a name="123128115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128115" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128115">Patrick Massot (Mar 01 2018 at 08:08)</a>:</h4>
<p>What do you mean "write program"? Write a tactic?</p>

<a name="123128135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128135" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128135">Simon Hudon (Mar 01 2018 at 08:09)</a>:</h4>
<p>I think not much if you write tactics. More if you use Lean as a functional programming language (with or without much verification)</p>

<a name="123128181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128181" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128181">Patrick Massot (Mar 01 2018 at 08:10)</a>:</h4>
<p>Are there people doing that?</p>

<a name="123128182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128182">Sean Leather (Mar 01 2018 at 08:10)</a>:</h4>
<p>As in I/O?! <span class="emoji emoji-1f631" title="scream">:scream:</span></p>

<a name="123128187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128187" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128187">Simon Hudon (Mar 01 2018 at 08:11)</a>:</h4>
<p>On top of my head, there's me</p>

<a name="123128230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128230" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128230">Simon Hudon (Mar 01 2018 at 08:12)</a>:</h4>
<p>I/O or other kind of code. There's a lot you can do with monads</p>

<a name="123128232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128232" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128232">Simon Hudon (Mar 01 2018 at 08:12)</a>:</h4>
<p>Why do you seem so scared of I/O?</p>

<a name="123128233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128233" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128233">Patrick Massot (Mar 01 2018 at 08:12)</a>:</h4>
<p>Doesn't sound functional to me</p>

<a name="123128234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128234">Sean Leather (Mar 01 2018 at 08:12)</a>:</h4>
<p>I meant, as in writing a “real” program that does I/O, not as in using the <code>io</code> monad... <span class="emoji emoji-1f609" title="wink">:wink:</span></p>

<a name="123128241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128241" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128241">Simon Hudon (Mar 01 2018 at 08:13)</a>:</h4>
<blockquote>
<p>Doesn't sound functional to me</p>
</blockquote>
<p>Why not?</p>

<a name="123128285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128285">Sean Leather (Mar 01 2018 at 08:14)</a>:</h4>
<blockquote>
<p>Why do you seem so scared of I/O?</p>
</blockquote>
<p>Because of the meme that theorem-proving languages are generally only used for proofs and type-checking.</p>

<a name="123128287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128287" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128287">Kevin Buzzard (Mar 01 2018 at 08:14)</a>:</h4>
<blockquote>
<blockquote>
<p>Doesn't sound functional to me</p>
</blockquote>
<p>Why not?</p>
</blockquote>
<p>Every article I read about functional programming makes a huge fuss about i/o. That's probably what he means. In contrast to procedural languages, where the first program you ever see is "print hello world"</p>

<a name="123128290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128290" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128290">Patrick Massot (Mar 01 2018 at 08:14)</a>:</h4>
<p>I thought functional programming swears to be isolated from real world</p>

<a name="123128301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128301" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128301">Sean Leather (Mar 01 2018 at 08:15)</a>:</h4>
<blockquote>
<p>I thought functional programming swears to be isolated from real world</p>
</blockquote>
<p>That's a myth and a well-disproven one at that.</p>

<a name="123128303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128303">Simon Hudon (Mar 01 2018 at 08:15)</a>:</h4>
<p>That was true of Haskell before they invented monads but the <code>io</code> monad makes I/O into a perfectly ok part of pure functional programming.</p>

<a name="123128365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128365">Simon Hudon (Mar 01 2018 at 08:16)</a>:</h4>
<p>Some people write OSs and web servers using purely functional programming. It looks pretty real to me and their users :)</p>

<a name="123128373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128373" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128373">Sean Leather (Mar 01 2018 at 08:17)</a>:</h4>
<p>It's funny how, as you climb up the ladder of high-level programming languages, each level above seems to be less useful than the level you're on, at least until you understand it.</p>

<a name="123128376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128376" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128376">Patrick Massot (Mar 01 2018 at 08:17)</a>:</h4>
<p>What's funny is right now I'm staring at my NodeJS I/O code which doesn't work. I don't know why it insisted trying to read all 29668 files in this directory before starting to work on the first one (and then FATAL ERROR: CALL_AND_RETRY_LAST Allocation failed - JavaScript heap out of memory)</p>

<a name="123128378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128378" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128378">Simon Hudon (Mar 01 2018 at 08:18)</a>:</h4>
<p>Yeah! And as I climb up, I get nervous about climbing down. Everything makes sense up here!</p>

<a name="123128420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128420" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128420">Sean Leather (Mar 01 2018 at 08:18)</a>:</h4>
<p>Yes, you can get complacent with all of the protection you have.</p>

<a name="123128433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128433">Patrick Massot (Mar 01 2018 at 08:19)</a>:</h4>
<p>I love functional programming languages guys. They are brothers to mathematicians. We also think what we do is more powerful and more beautiful than what other do. And normal people think what we do is un-understandable and useless</p>

<a name="123128434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128434">Simon Hudon (Mar 01 2018 at 08:20)</a>:</h4>
<p>I have a friend whom i'm mentoring with Haskell. He works with JavaScript. He's more courageous than me. I don't think I'd want to go back to object oriented programming ... unless it was generated from afull functional specification</p>

<a name="123128479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128479" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128479">Simon Hudon (Mar 01 2018 at 08:20)</a>:</h4>
<p>And we're also insufferable when coming in contact with other communities</p>

<a name="123128484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128484" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128484">Patrick Massot (Mar 01 2018 at 08:21)</a>:</h4>
<p>In my case the trouble is not object oriented programming, it's asynchronicity</p>

<a name="123128485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128485" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128485">Simon Hudon (Mar 01 2018 at 08:21)</a>:</h4>
<p>"You're getting into trouble because your pointers are aliasing each other? How quaint!"</p>

<a name="123128527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128527" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128527">Sean Leather (Mar 01 2018 at 08:22)</a>:</h4>
<p>Aliased pointers in JavaScript? <span class="emoji emoji-1f615" title="confused">:confused:</span></p>

<a name="123128532"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128532" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128532">Simon Hudon (Mar 01 2018 at 08:22)</a>:</h4>
<p>Object oriented programming is supposed to be a solution (some might disagree <em>cough cough</em>) but asynchronicity is an actual programming challenge ... at the center of my research as it happens</p>

<a name="123128538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128538" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128538">Simon Hudon (Mar 01 2018 at 08:23)</a>:</h4>
<blockquote>
<p>Aliased pointers in JavaScript? <span class="emoji emoji-1f615" title="confused">:confused:</span></p>
</blockquote>
<p>References to objects, etc. I'm fairly sure they don't have a complete value semantics</p>

<a name="123128579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128579" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128579">Patrick Massot (Mar 01 2018 at 08:24)</a>:</h4>
<p>It's fun here but I need to take a shower, see you</p>

<a name="123128585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123128585" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123128585">Simon Hudon (Mar 01 2018 at 08:25)</a>:</h4>
<p>Alright! Let's be insufferable later! <span class="emoji emoji-1f601" title="grin">:grin:</span></p>

<a name="123131312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123131312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123131312">Sebastian Ullrich (Mar 01 2018 at 09:58)</a>:</h4>
<p>I'll leave this link as a hint to our motivation... :P <a href="https://github.com/Kha/syntax/blob/master/macro.lean#L5" target="_blank" title="https://github.com/Kha/syntax/blob/master/macro.lean#L5">https://github.com/Kha/syntax/blob/master/macro.lean#L5</a></p>

<a name="123134401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134401">Scott Morrison (Mar 01 2018 at 11:40)</a>:</h4>
<p>Hi <span class="user-mention" data-user-email="sebasti@nullri.ch" data-user-id="110024">@Sebastian Ullrich</span> , is there some explanation I can read of what you did to <code>bind</code>?</p>

<a name="123134448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134448" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134448">Sebastian Ullrich (Mar 01 2018 at 11:42)</a>:</h4>
<p><span class="user-mention" data-user-email="scott@tqft.net" data-user-id="110087">@Scott Morrison</span> Does the test file help? <a href="https://github.com/leanprover/lean/blob/master/tests/lean/run/rebind_bind.lean" target="_blank" title="https://github.com/leanprover/lean/blob/master/tests/lean/run/rebind_bind.lean">https://github.com/leanprover/lean/blob/master/tests/lean/run/rebind_bind.lean</a></p>

<a name="123134454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134454" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134454">Scott Morrison (Mar 01 2018 at 11:42)</a>:</h4>
<p>There are lots of places mathlib has broken, e.g.</p>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">length_bind</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">length</span> <span class="o">(</span><span class="n">bind</span> <span class="n">l</span> <span class="n">f</span><span class="o">)</span> <span class="bp">=</span> <span class="n">sum</span> <span class="o">(</span><span class="n">map</span> <span class="o">(</span><span class="n">length</span> <span class="err">∘</span> <span class="n">f</span><span class="o">)</span> <span class="n">l</span><span class="o">)</span>
</pre></div>

<a name="123134460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134460">Scott Morrison (Mar 01 2018 at 11:43)</a>:</h4>
<p>Where is says</p>
<div class="codehilite"><pre><span></span>type mismatch at application
  l &gt;&gt;= f
term
  f
has type
  α → list β : Type (max u v)
but is expected to have type
  α → list ?m_1 : Type u
</pre></div>

<a name="123134518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134518" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134518">Sebastian Ullrich (Mar 01 2018 at 11:45)</a>:</h4>
<p>Ah, <code>list.bind</code> is <code>protected</code> now, as it should have been from the beginning</p>

<a name="123134572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134572" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134572">Scott Morrison (Mar 01 2018 at 11:46)</a>:</h4>
<p>So it should use ...?</p>

<a name="123134588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134588" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134588">Sebastian Ullrich (Mar 01 2018 at 11:47)</a>:</h4>
<p>You can replace <code>bind</code> with <code>list.bind</code></p>

<a name="123134589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134589" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134589">Scott Morrison (Mar 01 2018 at 11:47)</a>:</h4>
<p>thanks</p>

<a name="123134636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134636" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134636">Sebastian Ullrich (Mar 01 2018 at 11:49)</a>:</h4>
<p>But I would argue that we should usually prefer using the generic operations (i.e. <code>bind</code>/<code>&gt;&gt;=</code> here) even if it means that alpha and beta have to live in the same universe in this case</p>

<a name="123134637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123134637" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123134637">Sebastian Ullrich (Mar 01 2018 at 11:49)</a>:</h4>
<p><span class="user-mention" data-user-email="di.gama@gmail.com" data-user-id="110049">@Mario Carneiro</span> thoughts?</p>

<a name="123135235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123135235" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123135235">Scott Morrison (Mar 01 2018 at 12:09)</a>:</h4>
<p>The other place I'm seeing trouble from the monad refactoring is in mathlib's <code>data/encodable.lean</code>.</p>

<a name="123135285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123135285" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123135285">Scott Morrison (Mar 01 2018 at 12:10)</a>:</h4>
<p>where it looks like the problem is that there are too many <code>bind</code>s available</p>

<a name="123135288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123135288" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123135288">Scott Morrison (Mar 01 2018 at 12:10)</a>:</h4>
<p>and the <code>do</code> notation is now failing as a result.</p>

<a name="123136383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123136383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123136383">Sebastian Ullrich (Mar 01 2018 at 12:47)</a>:</h4>
<p>I guess <code>option.bind</code> should be protected as well? Gaah.</p>

<a name="123140100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123140100" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123140100">Mario Carneiro (Mar 01 2018 at 14:35)</a>:</h4>
<p>The "named" bind is there in part exactly for this universe distinguishing thing. There are times when it matters, and you need the polymorphic version. For most of these operations, there is also a symbol name for them, which is preferred when universes don't matter or you are over a known structure.</p>

<a name="123140604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123140604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123140604">Sebastian Ullrich (Mar 01 2018 at 14:44)</a>:</h4>
<p>Yah, it's the curse of the monad. I'll mark <code>option.bind</code> as protected then.</p>

<a name="123157560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123157560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123157560">Simon Hudon (Mar 01 2018 at 22:14)</a>:</h4>
<p>I took the liberty of commenting on your pull request. Is this the best way to interact on this subject or should I stick to Zulip / Gitter?</p>

<a name="123159187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123159187" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123159187">Sebastian Ullrich (Mar 01 2018 at 23:00)</a>:</h4>
<p>That's fine, I just didn't get to it yet</p>

<a name="123159201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123159201" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123159201">Simon Hudon (Mar 01 2018 at 23:01)</a>:</h4>
<p>No worries. I just don't want to be intrusive by commenting directly on github</p>

<a name="123159573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123159573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123159573">Sebastian Ullrich (Mar 01 2018 at 23:11)</a>:</h4>
<p>I'm happy for any feedback by experienced Haskell programmers, since neither Leo nor me is one of them</p>

<a name="123159859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123159859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123159859">Simon Hudon (Mar 01 2018 at 23:20)</a>:</h4>
<p>Excellent then :) I'll keep them coming. In passing, I am truly amazed by the language that you guys came up with. Learning Haskell was like a religious conversion for me and it ended a three year programming hiatus. Lean is comparing really well</p>

<a name="123160171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/monad%20refactoring/near/123160171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/30756monadrefactoring.html#123160171">Sebastian Ullrich (Mar 01 2018 at 23:30)</a>:</h4>
<p>Thank you <span class="emoji emoji-1f604" title="smile">:smile:</span></p>


{% endraw %}
