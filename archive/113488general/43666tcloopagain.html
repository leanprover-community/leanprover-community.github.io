---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/43666tcloopagain.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html">tc loop again</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="127213712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127213712" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127213712">Patrick Massot (May 28 2018 at 19:02)</a>:</h4>
<p>I tried to define norms on indexed product, but it seems I have a type class loop again. It's dinner time here, but if someone wants to have a look at why <a href="https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/norms.lean#L319" target="_blank" title="https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/norms.lean#L319">https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/norms.lean#L319</a> fails I'd be very grateful</p>

<a name="127213727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127213727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127213727">Nicholas Scheel (May 28 2018 at 19:04)</a>:</h4>
<p>does <code>begin admit end</code> act any differently?</p>

<a name="127220182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127220182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127220182">Patrick Massot (May 28 2018 at 22:27)</a>:</h4>
<p>No. I can replace the infinite loop by weirder error messages using <code>refine</code> but that's all I can get</p>

<a name="127271172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127271172" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127271172">Patrick Massot (May 29 2018 at 22:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> could you have a look at this issue if you have some time please? This only other it depends on is Johannes' <a href="https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/metric_space_fintype_pi.lean" target="_blank" title="https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/metric_space_fintype_pi.lean">https://github.com/PatrickMassot/lean-differential-topology/blob/master/src/metric_space_fintype_pi.lean</a></p>

<a name="127277524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127277524" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127277524">Kevin Buzzard (May 30 2018 at 00:21)</a>:</h4>
<p>This would be so much easier to do if you could minimise</p>

<a name="127277533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127277533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127277533">Kevin Buzzard (May 30 2018 at 00:21)</a>:</h4>
<p>cutting and pasting one file works</p>

<a name="127277569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127277569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127277569">Kevin Buzzard (May 30 2018 at 00:22)</a>:</h4>
<p>even cutting and pasting the file you import would be better than this</p>

<a name="127277583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127277583" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127277583">Kevin Buzzard (May 30 2018 at 00:22)</a>:</h4>
<p>I don't want to dump Johannes' file into the project I have open</p>

<a name="127277586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127277586" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127277586">Kevin Buzzard (May 30 2018 at 00:22)</a>:</h4>
<p>if I put it in scratch then I don't know how to import it</p>

<a name="127277604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127277604" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127277604">Kevin Buzzard (May 30 2018 at 00:23)</a>:</h4>
<p>I mean -- even if it's a huge gist -- for <em>me</em> at least, one file is a whole lot easier than two</p>

<a name="127279386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279386" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279386">Kevin Buzzard (May 30 2018 at 01:09)</a>:</h4>
<p><a href="https://gist.github.com/kbuzzard/e8c1b1ac3d50795b1bdf3094bc823de6" target="_blank" title="https://gist.github.com/kbuzzard/e8c1b1ac3d50795b1bdf3094bc823de6">https://gist.github.com/kbuzzard/e8c1b1ac3d50795b1bdf3094bc823de6</a></p>

<a name="127279387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279387" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279387">Kevin Buzzard (May 30 2018 at 01:09)</a>:</h4>
<p>there's the error</p>

<a name="127279694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279694" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279694">Kevin Buzzard (May 30 2018 at 01:18)</a>:</h4>
<p>so you made all these instances in this file and they are all those terrifying things like normed space to normed group, and then product of normed spaces is a normed space and product of normed groups is a normed group. Are all these safe? Is this unrelated to your problem?</p>

<a name="127279851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279851" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279851">Kevin Buzzard (May 30 2018 at 01:22)</a>:</h4>
<p>Patrick I wrote the error to a file, and then deleted all the lines with failed is_def_eq underneath and now it looks like this:</p>

<a name="127279854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279854" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279854">Mario Carneiro (May 30 2018 at 01:22)</a>:</h4>
<p>The problem is in the very first few lines. </p>
<div class="codehilite"><pre><span></span>[class_instances] (0) ?x_2 : @module ?x_0 (Π (i : ι), E i) ?x_1 := @pi.module ?x_3 ?x_4 ?x_5 ?x_6 ?x_7
[class_instances] (1) ?x_6 : ring ?x_5 := @prod.ring ?x_8 ?x_9 ?x_10 ?x_11
failed is_def_eq
</pre></div>


<p>After matching <code>pi.module</code> for the typeclass, it immediately attempts to resolve <code>?x_6</code>, which is the <code>[ring A]</code> argument</p>

<a name="127279863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279863" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279863">Kevin Buzzard (May 30 2018 at 01:23)</a>:</h4>
<div class="codehilite"><pre><span></span>[class_instances] (8) ?x_70 : @is_absolute_value ℝ real.discrete_linear_ordered_field α
  (@normed_ring.to_ring α (@normed_field.to_normed_ring α _inst_1))
[class_instances] (8) ?x_68 : ring ?x_67 := @cau_seq.ring ?x_74 ?x_75 ?x_76 ?x_77 ?x_78 ?x_79
[class_instances] (9) ?x_75 : discrete_linear_ordered_field ?x_74 := real.discrete_linear_ordered_field
[class_instances] (9) ?x_77 : ring ?x_76 := @normed_ring.to_ring ?x_84 ?x_85
[class_instances] (10) ?x_85 : normed_ring ?x_84 := @normed_field.to_normed_ring ?x_86 ?x_87
[class_instances] (11) ?x_87 : normed_field ?x_86 := _inst_1
[class_instances] (9) ?x_79 : @is_absolute_value ℝ real.discrete_linear_ordered_field α
</pre></div>

<a name="127279864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279864">Kevin Buzzard (May 30 2018 at 01:23)</a>:</h4>
<p>that's the period</p>

<a name="127279867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279867" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279867">Kevin Buzzard (May 30 2018 at 01:23)</a>:</h4>
<p>with the number going up each time</p>

<a name="127279909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279909" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279909">Mario Carneiro (May 30 2018 at 01:24)</a>:</h4>
<p>but since it hasn't figured out <code>?x_5</code> yet, it's on a wild goose chase to come up with a ring, any ring, and it gets caught up in a loop somewhere with some iterating ring construction</p>

<a name="127279918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279918" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279918">Kevin Buzzard (May 30 2018 at 01:24)</a>:</h4>
<p>So the red flag for you is the attempt to prove <code>ring ?x_5</code></p>

<a name="127279923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279923" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279923">Mario Carneiro (May 30 2018 at 01:25)</a>:</h4>
<p>right</p>

<a name="127279936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279936" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279936">Mario Carneiro (May 30 2018 at 01:25)</a>:</h4>
<p>you can see that also in the period; the number is the stack depth, so you can see it's recursing each time on a <code>ring ?</code> goal</p>

<a name="127279984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279984">Kevin Buzzard (May 30 2018 at 01:26)</a>:</h4>
<div class="codehilite"><pre><span></span>[class_instances] (1) ?x_6 : ring ?x_5 := @prod.ring ?x_8 ?x_9 ?x_10 ?x_11
failed is_def_eq
[class_instances] (1) ?x_6 : ring ?x_5 := @normed_ring.to_ring ?x_12 ?x_13
[class_instances] (2) ?x_13 : normed_ring ?x_12 := @normed_field.to_normed_ring ?x_14 ?x_15
[class_instances] (3) ?x_15 : normed_field ?x_14 := _inst_1
</pre></div>

<a name="127279988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279988">Kevin Buzzard (May 30 2018 at 01:27)</a>:</h4>
<p>It looks like it solves it there</p>

<a name="127279992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279992" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279992">Kevin Buzzard (May 30 2018 at 01:27)</a>:</h4>
<p>it can prove it's a ring if it proves it's a normed ring</p>

<a name="127279993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279993" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279993">Kevin Buzzard (May 30 2018 at 01:27)</a>:</h4>
<p>or a normed field</p>

<a name="127279994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279994" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279994">Kevin Buzzard (May 30 2018 at 01:27)</a>:</h4>
<p>and something was a normed field at the time</p>

<a name="127279996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279996" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279996">Mario Carneiro (May 30 2018 at 01:27)</a>:</h4>
<p>it solves a subgoal, but it hasn't solved the main goal</p>

<a name="127279997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127279997" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127279997">Kevin Buzzard (May 30 2018 at 01:27)</a>:</h4>
<p>has it solved ring ?x_5?</p>

<a name="127280041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280041" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280041">Mario Carneiro (May 30 2018 at 01:28)</a>:</h4>
<p>no, the last (1) line is line 27 which is a <code>ring ?x_5</code> goal</p>

<a name="127280053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280053" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280053">Kevin Buzzard (May 30 2018 at 01:29)</a>:</h4>
<p>the line after I quoted</p>

<a name="127280104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280104" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280104">Kevin Buzzard (May 30 2018 at 01:30)</a>:</h4>
<p><code>[class_instances] (1) ?x_6 : ring ?x_5 := @cau_seq.ring ?x_11 ?x_12 ?x_13 ?x_14 ?x_15 ?x_16</code><br>
`</p>

<a name="127280109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280109">Mario Carneiro (May 30 2018 at 01:30)</a>:</h4>
<p>The role of <code>cau_seq.ring</code> here is that it produces a ring from a ring</p>

<a name="127280110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280110" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280110">Kevin Buzzard (May 30 2018 at 01:30)</a>:</h4>
<p>I thought I'd seen the last of it</p>

<a name="127280117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280117" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280117">Mario Carneiro (May 30 2018 at 01:30)</a>:</h4>
<p>so it's building a ring of the form <code>(cau_seq (cau_seq (cau_seq ? ?) ?) ?)</code></p>

<a name="127280136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280136" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280136">Mario Carneiro (May 30 2018 at 01:31)</a>:</h4>
<p>the fault isn't <code>cau_seq</code> though, that was just the first recursing construction it fell upon</p>

<a name="127280137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280137" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280137">Kevin Buzzard (May 30 2018 at 01:31)</a>:</h4>
<p><code>[class_instances] (9) ?x_77 : ring ?x_76 := @cau_seq.ring ?x_83 ?x_84 ?x_85 ?x_86 ?x_87 ?x_88</code></p>

<a name="127280139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280139" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280139">Kevin Buzzard (May 30 2018 at 01:31)</a>:</h4>
<p>There's the last <code>(9)</code></p>

<a name="127280184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280184" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280184">Mario Carneiro (May 30 2018 at 01:32)</a>:</h4>
<p>The real problem is that it's solving <code>ring ?</code></p>

<a name="127280192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280192" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280192">Kevin Buzzard (May 30 2018 at 01:32)</a>:</h4>
<p><code>cau_seq.ring :
  Π {α : Type u_3} [_inst_1 : discrete_linear_ordered_field α] {β : Type u_4} [_inst_2 : ring β] {abv : β → α}
  [_inst_3 : is_absolute_value abv], ring (cau_seq β abv)</code></p>

<a name="127280198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280198" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280198">Kevin Buzzard (May 30 2018 at 01:32)</a>:</h4>
<p>"you give me a ring, I'll give you another ring"</p>

<a name="127280268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280268">Mario Carneiro (May 30 2018 at 01:34)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Why don't out_params work here? Adding <code>out_param</code> to <code>pi.module</code> does not change the order of inference for the arguments</p>

<a name="127280339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280339">Mario Carneiro (May 30 2018 at 01:36)</a>:</h4>
<p>maybe it has to do with the fact that the <code>module</code> argument is in a pi?</p>

<a name="127280417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280417" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280417">Kevin Buzzard (May 30 2018 at 01:39)</a>:</h4>
<p>It's funny that <code>instance product_normed_space : normed_space α (E × F) </code> works</p>

<a name="127280422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280422" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280422">Kevin Buzzard (May 30 2018 at 01:39)</a>:</h4>
<p>but then <code>instance fintype.normed_space {ι : Type*} {E : ι → Type*} [fintype ι] [∀i, normed_space α (E i)]</code> gives him trouble</p>

<a name="127280915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280915">Mario Carneiro (May 30 2018 at 01:52)</a>:</h4>
<p>Here's a minimized version:</p>
<div class="codehilite"><pre><span></span>class ring&#39; (α : Type*).

class module&#39; (α : out_param $ Type*) (β : Type*) [out_param $ ring&#39; α].

class normed_field&#39; (α : Type*) extends ring&#39; α.

class normed_space&#39; (α : out_param $ Type*) (β : Type*) [out_param $ normed_field&#39; α] extends module&#39; α β.

instance pi.module&#39; {I : Type*} {f : I → Type*}
 {α : out_param Type*} [out_param $ ring&#39; α] [∀ i, module&#39; α $ f i] : module&#39; α (Π i : I, f i) :=
sorry

instance loop (α) [ring&#39; α] : ring&#39; (option α) := sorry

set_option trace.class_instances true

instance fintype.normed_space&#39; {α} [normed_field&#39; α]
  {ι : Type*} {E : ι → Type*} [∀i, normed_space&#39; α (E i)] :
  normed_space&#39; α (Πi, E i) :=
⟨_, _⟩
</pre></div>

<a name="127280979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127280979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127280979">Mario Carneiro (May 30 2018 at 01:54)</a>:</h4>
<div class="codehilite"><pre><span></span>[class_instances]  class-instance resolution trace
[class_instances] (0) ?x_2 : @module&#39; ?x_0 (Π (i : ι), E i) ?x_1 := @pi.module&#39; ?x_3 ?x_4 ?x_5 ?x_6 ?x_7
[class_instances] (1) ?x_6 : out_param (ring&#39; ?x_5) := @loop ?x_8 ?x_9
[class_instances] (2) ?x_9 : ring&#39; ?x_8 := @loop ?x_10 ?x_11
[class_instances] (3) ?x_11 : ring&#39; ?x_10 := @loop ?x_12 ?x_13
[class_instances] (4) ?x_13 : ring&#39; ?x_12 := @loop ?x_14 ?x_15
...
</pre></div>

<a name="127286141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127286141" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127286141">Mario Carneiro (May 30 2018 at 04:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110294">@Johannes Hölzl</span> I think we should just abandon the <code>out_param</code> in module and live with having to give the type explicitly in scalar multiplication. It's too brittle and there is very little I can do about these issues without modifying lean.</p>

<a name="127293689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293689" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293689">Patrick Massot (May 30 2018 at 08:56)</a>:</h4>
<p>Thank you very much Mario and Kevin. I understood what was happening, the question is how to solve this (and I also wanted to point out to Sebastian that out_param stuff maybe requires more thinking in Lean 4, I don't know).</p>

<a name="127293699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293699">Patrick Massot (May 30 2018 at 08:57)</a>:</h4>
<p>What confuses me is:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">{</span><span class="n">ι</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">{</span><span class="n">E</span> <span class="o">:</span> <span class="n">ι</span> <span class="bp">→</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">ι</span><span class="o">]</span> <span class="o">[</span><span class="bp">∀</span><span class="n">i</span><span class="o">,</span> <span class="n">vector_space</span> <span class="n">α</span> <span class="o">(</span><span class="n">E</span> <span class="n">i</span><span class="o">)]</span> <span class="o">:</span>
  <span class="n">vector_space</span> <span class="n">α</span> <span class="o">(</span><span class="bp">Π</span><span class="n">i</span><span class="o">,</span> <span class="n">E</span> <span class="n">i</span><span class="o">)</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">apply_instance</span>
</pre></div>


<p>works fine</p>

<a name="127293706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293706" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293706">Patrick Massot (May 30 2018 at 08:57)</a>:</h4>
<p>But the type class mechanism doesn't search for this. Why?</p>

<a name="127293750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293750" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293750">Patrick Massot (May 30 2018 at 08:58)</a>:</h4>
<p>Is there any way I could help the type class search here?</p>

<a name="127293764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293764" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293764">Patrick Massot (May 30 2018 at 08:59)</a>:</h4>
<p><code>vector_space</code> is very closely related to <code>module</code>, the full definition is simply <code>class vector_space (α : out_param $ Type u) (β : Type v) [field α] extends module α β</code></p>

<a name="127293839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293839">Patrick Massot (May 30 2018 at 09:01)</a>:</h4>
<p>but I would still naively expect the search that is currently failing to start by looking for some <code>vector_space α (Πi, E i)</code> rather than <code>@module ?x_0 (Π (i : ι), E i) ?x_1</code></p>

<a name="127293945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127293945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127293945">Patrick Massot (May 30 2018 at 09:04)</a>:</h4>
<p>Note that the working instance here is <code>pi.vector_space</code> whose definition is literally: <code>instance vector_space (α : Type*) [field α] [∀ i, vector_space α $ f i] : vector_space α (Π i : I, f i) :=
{ ..pi.module }</code></p>

<a name="127294838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127294838" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127294838">Sebastian Ullrich (May 30 2018 at 09:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you want</p>
<div class="codehilite"><pre><span></span>instance pi.module&#39; {I : Type*} {f : I → Type*}
 {α : Type*} {r : ring&#39; α} [∀ i, module&#39; α (f i)] : module&#39; α (Π i : I, f i) :=
</pre></div>


<p>?</p>

<a name="127298089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127298089" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127298089">Johannes Hölzl (May 30 2018 at 11:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> this still loops. One problem is that it looks for <code>@module' ?x_0 (Π (i : ι), E i) ?x_1</code> instead of<code>@module' α (Π (i : ι), E i) ?x_1</code> . Then the type class inference loops by making <code>loop</code> steps.</p>

<a name="127298146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127298146" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127298146">Sebastian Ullrich (May 30 2018 at 11:07)</a>:</h4>
<p>It doesn't loop in Mario's example</p>

<a name="127298202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127298202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127298202">Johannes Hölzl (May 30 2018 at 11:09)</a>:</h4>
<p>Ah, sorry, I didn't see that you also changed <code>[ring' α]</code> to <code>{r : ring' α}</code>.</p>

<a name="127298212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127298212" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127298212">Sebastian Ullrich (May 30 2018 at 11:09)</a>:</h4>
<p>Yes, that's the important part :) . <code>instance</code> doesn't do anything special with <code>out_param</code>.</p>

<a name="127298320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127298320" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127298320">Sebastian Ullrich (May 30 2018 at 11:12)</a>:</h4>
<p>The intended meaning behind making it implicit is "don't try to infer an instance at this point, we don't even know α yet".</p>

<a name="127298985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127298985" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127298985">Johannes Hölzl (May 30 2018 at 11:31)</a>:</h4>
<p>Thanks, this is a good explanation. It doesn't work now, but it seams to be a problem that the pi instance can not be applied.</p>

<a name="127349063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tc%20loop%20again/near/127349063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/43666tcloopagain.html#127349063">Patrick Massot (May 31 2018 at 09:08)</a>:</h4>
<p>So, do we have a solution?</p>


{% endraw %}
