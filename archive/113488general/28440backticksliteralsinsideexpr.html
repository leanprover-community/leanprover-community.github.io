---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/28440backticksliteralsinsideexpr.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html">backticks - literals inside expr</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="162996015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996015" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996015">Joseph Corneli (Apr 10 2019 at 11:38)</a>:</h4>
<p>I'm trying to make a variant of one of the tactics in <a href="https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/master/docs/extras/tactic_writing.md">tactic_writing.md</a>.  This example from the documentation works fine:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_eq</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">l</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">l</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>


<p>My proposed variant would pattern-match a quadratic <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">ax^2+bx+c</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="base"><span class="mord mathit">a</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mbin">+</span><span class="mord mathit">b</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">c</span></span></span></span> on the left hand side.  I tried this:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="n">x</span><span class="err">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">B</span> <span class="bp">*</span> <span class="n">x</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x^2 &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">B</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>


<p>Here I get the error:</p>
<blockquote>
<p>unknown identifier ’x’<br>
invalid quotation, unsupported macro ’sorry’</p>
</blockquote>
<p>I also tried this:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">x</span> <span class="err">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">B</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">y</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x^2 &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">B</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>


<blockquote>
<p>equation compiler failed, maximum number of steps (2048) exceeded (possible solution: use ’set_option eqn_compiler.max_steps &lt;new-threshold&gt;’) (use ’set_option trace.eqn_compiler.elim_match true’ for additional details)</p>
</blockquote>

<a name="162996161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996161" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996161">Joseph Corneli (Apr 10 2019 at 11:41)</a>:</h4>
<p>If I remove the <code>^2</code>, the tactic definition is accepted.</p>

<a name="162996362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996362" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996362">Joseph Corneli (Apr 10 2019 at 11:44)</a>:</h4>
<p>But this isn't accepted:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq&#39;&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">x</span> <span class="err">^</span> <span class="err">%%</span><span class="n">e</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">B</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">y</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x^2 &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">B</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>

<a name="162996624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996624" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996624">Keeley Hoek (Apr 10 2019 at 11:48)</a>:</h4>
<p>Curiously, this works:</p>

<a name="162996629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996629" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996629">Keeley Hoek (Apr 10 2019 at 11:48)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pow</span> <span class="err">%%</span><span class="n">n</span> <span class="err">%%</span><span class="n">x</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">B</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">y</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x^2 &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">B</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>

<a name="162996631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996631" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996631">Joseph Corneli (Apr 10 2019 at 11:48)</a>:</h4>
<p>ah!</p>

<a name="162996666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996666" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996666">Keeley Hoek (Apr 10 2019 at 11:49)</a>:</h4>
<p>(But you have to manually write out the pow)</p>

<a name="162996676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996676" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996676">Joseph Corneli (Apr 10 2019 at 11:49)</a>:</h4>
<p>From that, it seems <code>*</code> and <code>+</code> are acceptable as "sugar" inside of such expressions, and <code>^</code> is not...?  Is there a place to find the list of sugared variants?</p>

<a name="162996695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996695" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996695">Joseph Corneli (Apr 10 2019 at 11:50)</a>:</h4>
<p>Anyway thanks for helping me get going here <span class="user-mention" data-user-id="110111">@Keeley Hoek</span></p>

<a name="162996775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996775">Keeley Hoek (Apr 10 2019 at 11:50)</a>:</h4>
<p>I don't think it's so simple, because this compiles as well:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq&#39;&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">x</span> <span class="err">^</span> <span class="err">%%</span><span class="n">e</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x^2 &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>

<a name="162996796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996796">Joseph Corneli (Apr 10 2019 at 11:51)</a>:</h4>
<p><span aria-label="queasy" class="emoji emoji-1f922" role="img" title="queasy">:queasy:</span></p>

<a name="162996908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996908" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996908">Keeley Hoek (Apr 10 2019 at 11:52)</a>:</h4>
<p>Ohk, I think I'm understanding. This is just a guess, but: I think the equation compiler might be doing something crazy like making a pattern for all the possible <code>had_add</code>, etc... instances which it knows about. Or maybe there are just somehow a lot of cases.<br>
Regardless, </p>
<div class="codehilite"><pre><span></span>set_option eqn_compiler.max_steps 10000
</pre></div>


<p>really does make your original code work...</p>

<a name="162996915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996915">Keeley Hoek (Apr 10 2019 at 11:52)</a>:</h4>
<p>:O</p>

<a name="162996967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162996967" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162996967">Joseph Corneli (Apr 10 2019 at 11:53)</a>:</h4>
<p>"When in doubt follow the instructions" ???</p>

<a name="162997065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162997065" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162997065">Keeley Hoek (Apr 10 2019 at 11:53)</a>:</h4>
<p>"And when making wild guesses follow the instructions more"? :D <code>
set_option trace.eqn_compiler.elim_match true</code> lets you see what's actually happening</p>

<a name="162997229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162997229" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162997229">Keeley Hoek (Apr 10 2019 at 11:54)</a>:</h4>
<p>It really is just a massive case bash on all of the <code>expr</code> constructors</p>

<a name="162997334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162997334" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162997334">Joseph Corneli (Apr 10 2019 at 11:56)</a>:</h4>
<p>I'mma let you finish but </p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">eqn_compiler</span><span class="bp">.</span><span class="n">elim_match</span><span class="o">]</span> <span class="n">depth</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="k">match</span> <span class="n">trace_goal_is_quad_eq&#39;&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span><span class="o">[]</span>
   <span class="o">:=</span>
    <span class="o">(</span><span class="n">tactic</span><span class="bp">.</span><span class="n">target</span> <span class="bp">&gt;&gt;=</span>
         <span class="bp">λ</span> <span class="o">(</span><span class="bp">_</span><span class="n">p</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
           <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="bp">_</span><span class="n">a</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
              <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="bp">_</span><span class="n">a</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="n">a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="n">a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                   <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="n">a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                   <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                     <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                     <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                        <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                     <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                        <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                     <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                        <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                     <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a</span> <span class="n">a_a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                        <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a_a</span>
                          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                             <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a</span> <span class="n">a_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                             <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a</span> <span class="n">a_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                             <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                          <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a</span> <span class="n">a_a_a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                             <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a_a_a</span>
                               <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                               <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                               <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                                  <span class="n">ite</span> <span class="o">(</span><span class="n">a_a_a_a</span> <span class="bp">=</span> <span class="n">name</span><span class="bp">.</span><span class="n">mk_string</span> <span class="s2">&quot;eq&quot;</span> <span class="n">name</span><span class="bp">.</span><span class="n">anonymous</span><span class="o">)</span>
                                    <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a_a_1</span>
                                       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span>
                                          <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span>
                                          <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                                          <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a</span> <span class="n">a_a_1_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                          <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a</span> <span class="n">a_a_1_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                          <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                       <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a</span> <span class="n">a_a_1_a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                          <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a_a_1_a</span>
                                            <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span>
                                               <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                            <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span>
                                               <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                            <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                                               <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                            <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a</span> <span class="n">a_a_1_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                               <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                            <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a</span> <span class="n">a_a_1_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span>
                                             <span class="o">(</span><span class="n">a_a_1_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                               <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                            <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a</span> <span class="n">a_a_1_a_a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                               <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a_a_1_a_a</span>
                                                 <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span>
                                                    <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                 <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span>
                                                    <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                 <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                                                    <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                 <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a</span> <span class="n">a_a_1_a_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                    <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                 <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a</span> <span class="n">a_a_1_a_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span>
                                                  <span class="o">(</span><span class="n">a_a_1_a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                    <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span> <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                 <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a</span> <span class="n">a_a_1_a_a_a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                    <span class="n">expr</span><span class="bp">.</span><span class="n">cases_on</span> <span class="n">a_a_1_a_a_a</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="err">…</span> <span class="err">…</span><span class="o">)</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a</span> <span class="o">:</span> <span class="n">level</span><span class="o">),</span> <span class="n">id_rhs</span> <span class="err">…</span> <span class="err">…</span><span class="o">)</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">level</span><span class="o">),</span>
                                                         <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a</span> <span class="n">a_a_1_a_a_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>
                                                       <span class="o">(</span><span class="n">a_a_1_a_a_a_a_2</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                         <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a</span> <span class="n">a_a_1_a_a_a_a_1</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>
                                                       <span class="o">(</span><span class="n">a_a_1_a_a_a_a_2</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                         <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a</span> <span class="n">a_a_1_a_a_a_a_1</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                         <span class="err">…</span> <span class="err">…</span> <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a</span> <span class="n">a_a_1_a_a_a_a_a_1</span> <span class="o">:</span> <span class="err">…</span><span class="o">),</span> <span class="err">…</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>
                                                            <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a_1</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span>
                                                            <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a_2</span> <span class="n">a_a_1_a_a_a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span> <span class="err">…</span> <span class="err">…</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>
                                                            <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a_1</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span>
                                                            <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a_2</span> <span class="n">a_a_1_a_a_a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                              <span class="n">id_rhs</span> <span class="err">…</span> <span class="err">…</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span>
                                                            <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a_1</span> <span class="n">a_a_1_a_a_a_a_a_2</span> <span class="n">a_a_1_a_a_a_a_a_3</span> <span class="o">:</span>
                                                              <span class="n">expr</span><span class="o">),</span>
                                                              <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span>
                                                                <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                           <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a</span> <span class="o">:</span> <span class="n">macro_def</span><span class="o">)</span>
                                                            <span class="o">(</span><span class="n">a_a_1_a_a_a_a_a_1</span> <span class="o">:</span> <span class="n">list</span> <span class="n">expr</span><span class="o">),</span>
                                                              <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span>
                                                                <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">)))</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_1</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span>
                                                       <span class="o">(</span><span class="n">a_a_1_a_a_a_a_2</span> <span class="n">a_a_1_a_a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                         <span class="n">id_rhs</span> <span class="o">(</span><span class="n">tactic</span> <span class="n">unit</span><span class="o">)</span>
                                                           <span class="o">(</span><span class="n">match_failed</span> <span class="n">interaction_monad</span><span class="bp">.</span><span class="n">monad_fail</span><span class="o">))</span>
                                                      <span class="o">(</span><span class="bp">λ</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">a_a_1_a_a_a_a_1</span> <span class="o">:</span> <span class="n">binder_info</span><span class="o">)</span>
                                                       <span class="o">(</span><span class="n">a_a_1_a_a_a_a_2</span> <span class="n">a_a_1_a_a_a_a_3</span> <span class="o">:</span> <span class="n">expr</span><span class="o">),</span>
                                                         <span class="n">id_rhs</span> <span class="o">(</span>
</pre></div>

<a name="162997372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/162997372" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#162997372">Keeley Hoek (Apr 10 2019 at 11:57)</a>:</h4>
<p><code>aaaaaaaaaaaaaaaaaaaaaaa</code> indeed</p>

<a name="163009394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163009394" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163009394">Simon Hudon (Apr 10 2019 at 14:30)</a>:</h4>
<p>Can you try:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq&#39;&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">x</span> <span class="err">^</span> <span class="o">(</span><span class="mi">2</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;x^2 &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">r</span><span class="o">)</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>

<a name="163012177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163012177" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163012177">Joseph Corneli (Apr 10 2019 at 14:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> that one gives me </p>
<blockquote>
<p>equation compiler failed, maximum number of steps (2048) exceeded (possible solution: use 'set_option eqn_compiler.max_steps &lt;new-threshold&gt;') (use 'set_option trace.eqn_compiler.elim_match true' for additional details)</p>
</blockquote>

<a name="163012261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163012261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163012261">Joseph Corneli (Apr 10 2019 at 14:58)</a>:</h4>
<p>I was able to take it apart to this level:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq&#39;&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span><span class="bp">*</span><span class="err">%%</span><span class="n">Q</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">B</span><span class="bp">*</span><span class="err">%%</span><span class="n">L</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">target</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">A</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;/-quadratic part...-/ &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">Q</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;/-...--AND-/ &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">B</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;/-linear part...-/ &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">L</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;/-...--AND-/ &quot;</span>
                     <span class="bp">++</span> <span class="o">(</span><span class="n">to_string</span> <span class="n">C</span><span class="o">)</span> <span class="bp">++</span> <span class="s2">&quot;/-constant part-/ &quot;</span>
   <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
</pre></div>

<a name="163012420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163012420" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163012420">Joseph Corneli (Apr 10 2019 at 15:00)</a>:</h4>
<p>That gave me this debug message:</p>
<blockquote>
<p>Goal is equality between the quadratic a/-quadratic part...-/ has_pow.pow.{0 0} real nat (monoid.has_pow.{0} real real.monoid) x (bit0.{0} nat nat.has_add (has_one.one.{0} nat nat.has_one))/-...--AND-/ b/-linear part...-/ x/-...--AND-/ c/-constant part-/ </p>
</blockquote>
<p>when applied via</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span><span class="n">ℝ</span><span class="o">),</span> <span class="n">a</span><span class="bp">*</span><span class="n">x</span><span class="err">^</span><span class="mi">2</span><span class="bp">+</span><span class="n">b</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="n">c</span> <span class="bp">=</span> <span class="n">a</span><span class="bp">*</span><span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="n">a</span><span class="o">))</span><span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="o">(</span><span class="n">c</span><span class="bp">-</span><span class="n">b</span><span class="err">^</span><span class="mi">2</span><span class="bp">/</span><span class="o">(</span><span class="mi">4</span><span class="bp">*</span><span class="n">a</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span><span class="o">,</span>
  <span class="n">trace_goal_is_quad_eq&#39;&#39;</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="163012546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163012546" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163012546">Simon Hudon (Apr 10 2019 at 15:01)</a>:</h4>
<p>Is 2 supposed to be a natural number or a real number?</p>

<a name="163012630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163012630" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163012630">Joseph Corneli (Apr 10 2019 at 15:02)</a>:</h4>
<p>Personally I think natural is the right choice.</p>

<a name="163012775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163012775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163012775">Kevin Buzzard (Apr 10 2019 at 15:04)</a>:</h4>
<p>this might not be true if a=0</p>

<a name="163013004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163013004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163013004">Joseph Corneli (Apr 10 2019 at 15:06)</a>:</h4>
<p>Oops!  Even if <code>a=1</code>, though, the parsing might still be tricky. I'll set up a variant like that and test it.</p>

<a name="163058187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163058187" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163058187">Mario Carneiro (Apr 11 2019 at 00:17)</a>:</h4>
<p>A simple way to avoid the threshold is to break the pattern match down:</p>
<div class="codehilite"><pre><span></span><span class="kn">open</span> <span class="n">tactic</span>
<span class="n">meta</span> <span class="n">def</span> <span class="n">trace_goal_is_quad_eq&#39;&#39;</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="o">{</span> <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">e₁</span> <span class="bp">=</span> <span class="err">%%</span><span class="n">r</span><span class="o">)</span> <span class="err">←</span> <span class="n">target</span><span class="o">,</span>
     <span class="bp">`</span><span class="o">(</span><span class="err">%%</span><span class="n">A</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">x</span> <span class="err">^</span> <span class="err">%%</span><span class="n">e</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">B</span> <span class="bp">*</span> <span class="err">%%</span><span class="n">y</span> <span class="bp">+</span> <span class="err">%%</span><span class="n">C</span><span class="o">)</span> <span class="err">←</span> <span class="n">return</span> <span class="n">e₁</span><span class="o">,</span>
     <span class="n">guard</span> <span class="o">(</span><span class="n">x</span> <span class="bp">=</span><span class="err">ₐ</span> <span class="n">y</span><span class="o">),</span>
     <span class="n">guard</span> <span class="o">(</span><span class="n">e</span> <span class="bp">=</span><span class="err">ₐ</span> <span class="bp">`</span><span class="o">(</span><span class="mi">2</span><span class="o">:</span><span class="bp">ℕ</span><span class="o">)),</span>
     <span class="n">pA</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">A</span><span class="o">,</span> <span class="n">pB</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">B</span><span class="o">,</span> <span class="n">pC</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">C</span><span class="o">,</span> <span class="n">pr</span> <span class="err">←</span> <span class="n">pp</span> <span class="n">r</span><span class="o">,</span>
     <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="err">$</span> <span class="err">↑</span><span class="s2">&quot;Goal is equality between the quadratic &quot;</span>
                     <span class="bp">++</span> <span class="n">pA</span> <span class="bp">++</span> <span class="s2">&quot; x^2 + &quot;</span>
                     <span class="bp">++</span> <span class="n">pB</span> <span class="bp">++</span> <span class="s2">&quot; x + &quot;</span>
                     <span class="bp">++</span> <span class="n">pC</span> <span class="bp">++</span> <span class="s2">&quot; and &quot;</span> <span class="bp">++</span> <span class="n">pr</span> <span class="o">}</span>
   <span class="bp">&lt;|&gt;</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">trace</span> <span class="s2">&quot;Goal is not an equality&quot;</span>
<span class="kn">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℝ</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span><span class="n">ℝ</span><span class="o">),</span> <span class="n">a</span><span class="bp">*</span><span class="n">x</span><span class="err">^</span><span class="mi">2</span><span class="bp">+</span><span class="n">b</span><span class="bp">*</span><span class="n">x</span><span class="bp">+</span><span class="n">c</span> <span class="bp">=</span> <span class="n">a</span><span class="bp">*</span><span class="o">(</span><span class="n">x</span> <span class="bp">+</span> <span class="o">(</span><span class="mi">1</span><span class="bp">/</span><span class="o">(</span><span class="mi">2</span><span class="bp">*</span><span class="n">a</span><span class="o">))</span><span class="bp">*</span> <span class="n">b</span><span class="o">)</span><span class="err">^</span><span class="mi">2</span> <span class="bp">+</span> <span class="o">(</span><span class="n">c</span><span class="bp">-</span><span class="n">b</span><span class="err">^</span><span class="mi">2</span><span class="bp">/</span><span class="o">(</span><span class="mi">4</span><span class="bp">*</span><span class="n">a</span><span class="o">))</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">intro</span><span class="o">,</span>
  <span class="n">trace_goal_is_quad_eq&#39;&#39;</span><span class="o">,</span>
<span class="kn">end</span>
</pre></div>

<a name="163058477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/backticks%20-%20literals%20inside%20expr/near/163058477" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/28440backticksliteralsinsideexpr.html#163058477">Mario Carneiro (Apr 11 2019 at 00:23)</a>:</h4>
<p>But I think this kind of parsing is probably not a good idea in any case. It's very brittle</p>


{% endraw %}

{% include archive_update.html %}