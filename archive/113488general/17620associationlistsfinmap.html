---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/17620associationlistsfinmap.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html">association lists, finmap</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="134290992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134290992" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134290992">Sean Leather (Sep 20 2018 at 06:57)</a>:</h4>
<p>As some people know, I've been working on association lists and finite maps for mathlib (<a href="https://github.com/spl/lean-finmap" target="_blank" title="https://github.com/spl/lean-finmap">https://github.com/spl/lean-finmap</a>). Mario has decided he wants to get it into mathlib soon, so he has started rewriting it in his own fashion (<a href="https://github.com/leanprover-community/mathlib/tree/finmap" target="_blank" title="https://github.com/leanprover-community/mathlib/tree/finmap">https://github.com/leanprover-community/mathlib/tree/finmap</a>). I wanted to open up the discussion to get feedback from anyone else who might be interested.</p>

<a name="134291300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291300" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291300">Sean Leather (Sep 20 2018 at 07:05)</a>:</h4>
<p>One question is whether there is  the need for a <code>structure</code> to wrap a list without duplicate keys. Mario thinks it might be useful:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">alist</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">val</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">β</span><span class="o">))</span>
<span class="o">(</span><span class="n">nd</span> <span class="o">:</span> <span class="n">val</span><span class="bp">.</span><span class="n">knodup</span><span class="o">)</span>
</pre></div>


<p><a href="https://github.com/leanprover-community/mathlib/blob/e5ddd1d4dca984f6d7a77a87a1608b414296208f/data/list/alist.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/e5ddd1d4dca984f6d7a77a87a1608b414296208f/data/list/alist.lean">https://github.com/leanprover-community/mathlib/blob/e5ddd1d4dca984f6d7a77a87a1608b414296208f/data/list/alist.lean</a></p>
<p>I went down this path and found that, given that (a) there are so many useful definitions and theorems regarding lists and (b) the <code>structure</code> is such a thin wrapper, every definition or proof for the <code>structure</code> is simple, it created a large number of really simple statements. Considering that <code>alist</code> is really a list with a property and I believe it is useful to use other list definitions that don't involve this property, I think the <code>alist</code> structure either (a) makes it more difficult to work with the wrapped list or (b) creates the problem of scaling the number of statements about <code>alist</code> to match those already about <code>list</code>.</p>

<a name="134291437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291437" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291437">Sean Leather (Sep 20 2018 at 07:09)</a>:</h4>
<p>In another way of putting it, you could look at an <code>alist</code> as something unique on its own or you could look at a list  with a property that it has no duplicate keys. In the process of developing my library, I found the latter view much more useful.</p>

<a name="134291494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291494">Simon Hudon (Sep 20 2018 at 07:10)</a>:</h4>
<p>Why is latter more useful?</p>

<a name="134291573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291573" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291573">Sean Leather (Sep 20 2018 at 07:12)</a>:</h4>
<p>On a related note, that's also how I ended up with the <code>finmap</code> <code>structure</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">finmap</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="n">u</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">val</span> <span class="o">:</span> <span class="n">multiset</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">β</span><span class="o">))</span>
<span class="o">(</span><span class="n">nodupkeys</span> <span class="o">:</span> <span class="n">val</span><span class="bp">.</span><span class="n">nodupkeys</span><span class="o">)</span>
</pre></div>


<p><a href="https://github.com/spl/lean-finmap/blob/035f1faa218e47b9f411c4a243900955f4714a56/src/data/finmap.lean#L8-L10" target="_blank" title="https://github.com/spl/lean-finmap/blob/035f1faa218e47b9f411c4a243900955f4714a56/src/data/finmap.lean#L8-L10">https://github.com/spl/lean-finmap/blob/035f1faa218e47b9f411c4a243900955f4714a56/src/data/finmap.lean#L8-L10</a></p>
<p>You could say that this is a similar situation: a <code>finmap</code> is just a <code>multiset</code> with no duplicate keys. However, I found that it's more useful to look at it as a <code>finmap</code> because I didn't find a lot of the other <code>multiset</code> definitions to be very useful for a <code>finmap</code>.</p>

<a name="134291591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291591" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291591">Sean Leather (Sep 20 2018 at 07:13)</a>:</h4>
<blockquote>
<p>Why is latter more useful?</p>
</blockquote>
<p>The most important reason for me is that I care about the structure of the internal list: <code>nil</code>, <code>cons</code>, <code>append</code>, etc.</p>

<a name="134291598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291598" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291598">Sean Leather (Sep 20 2018 at 07:13)</a>:</h4>
<p>Also, regarding <code>finmap</code>, I don't care about the structure of the internal <code>multiset</code>.</p>

<a name="134291662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291662">Sean Leather (Sep 20 2018 at 07:15)</a>:</h4>
<p>... which makes sense, since a <code>multiset</code> is a <code>quotient</code>.</p>

<a name="134291736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291736" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291736">Sean Leather (Sep 20 2018 at 07:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Thanks for that question, BTW. It gets to a key reason I don't think <code>alist</code> is useful, a reason that hadn't yet come to mind.</p>

<a name="134291871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134291871" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134291871">Sean Leather (Sep 20 2018 at 07:20)</a>:</h4>
<p>That is, I found that it was useful to wrap a <code>quotient</code> like <code>multiset</code> in a <code>structure</code> but not that useful to wrap a <code>list</code> in a <code>structure</code> because the structure of the list is important when working with the <code>structure</code>. I ended up creating definitions to wrap <code>nil</code>, <code>cons</code>, <code>append</code>, etc., and all of that already existed for the <code>list</code>, so I came to ask why it was necessary. I couldn't come up with a good answer.</p>

<a name="134292027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134292027" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134292027">Simon Hudon (Sep 20 2018 at 07:25)</a>:</h4>
<blockquote>
<p>You could say that this is a similar situation: a finmap is just a multiset with no duplicate keys. However, I found that it's more useful to look at it as a finmap because I didn't find a lot of the other multiset definitions to be very useful for a finmap.</p>
</blockquote>
<p>I don't get this nuance</p>

<a name="134292185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134292185" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134292185">Sean Leather (Sep 20 2018 at 07:30)</a>:</h4>
<blockquote>
<p>I don't get this nuance</p>
</blockquote>
<p>I think it's similar to how you don't see a lot of the <code>multiset</code> definitions used for <code>finset</code>. There's a particular subset (mostly starting with <code>nd</code>) that are used in <code>finset</code>, but many of them are not.</p>

<a name="134292261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134292261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134292261">Sean Leather (Sep 20 2018 at 07:31)</a>:</h4>
<p><code>multiset</code> seems to be useful as a substrate for <code>finset</code> and <code>finmap</code>, but it also has a larger API that is oriented towards counting duplicates.</p>

<a name="134292305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134292305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134292305">Sean Leather (Sep 20 2018 at 07:32)</a>:</h4>
<p>Also, the subset of the <code>multiset</code> API used for <code>finset</code> is not useful for <code>finmap</code>.</p>

<a name="134308497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134308497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134308497">Mario Carneiro (Sep 20 2018 at 13:16)</a>:</h4>
<p>I think the comparison is apt, and applicable to <code>alist</code>. A finset is just a multiset with a property, but the API is different (some basic operations are not applicable, like <code>cons</code>, and others are slightly weird and become more useful on the subtype, like <code>ndinsert</code>).</p>

<a name="134308618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134308618" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134308618">Mario Carneiro (Sep 20 2018 at 13:18)</a>:</h4>
<p>In the case of <code>alist</code>, there are some operations that don't work anymore, like <code>cons</code>, and others are slightly weird and have been prefixed with <code>k</code> for lists. <code>cons</code> is just not a valid <code>alist</code> operation, <code>insert</code> is.</p>

<a name="134308803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134308803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134308803">Sean Leather (Sep 20 2018 at 13:21)</a>:</h4>
<blockquote>
<p>I think the comparison is apt, and applicable to <code>alist</code>.</p>
</blockquote>
<p>So does this mean you agree with me, since my comparison is apt, which is to say that <code>alist</code> is not a useful structure?</p>

<a name="134308937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134308937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134308937">Sean Leather (Sep 20 2018 at 13:23)</a>:</h4>
<blockquote>
<p>In the case of <code>alist</code>, there are some operations that don't work anymore, like <code>cons</code>, and others are slightly weird and have been prefixed with <code>k</code> for lists. <code>cons</code> is just not a valid <code>alist</code> operation, <code>insert</code> is.</p>
</blockquote>
<p>This hints of disagreement. My point is that lists are constructed with <code>nil</code> and <code>cons</code>, and it is useful to have that construction, and therefore more useful to have a bare list with no duplicate keys than to have a structure hide that construction.</p>

<a name="134309076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309076" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309076">Mario Carneiro (Sep 20 2018 at 13:25)</a>:</h4>
<p>In short: I think <code>finset</code> is useful, and I think <code>alist</code> is useful</p>

<a name="134309171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309171">Mario Carneiro (Sep 20 2018 at 13:26)</a>:</h4>
<p>I don't see why <code>alist</code> should provide a nil/cons construction. It's not natural. If you want to do such a construction then you should unpack the <code>alist</code> first</p>

<a name="134309182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309182">Sean Leather (Sep 20 2018 at 13:26)</a>:</h4>
<p>That's kind of my point. <span class="emoji emoji-1f609" title="wink">:wink:</span></p>

<a name="134309185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309185" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309185">Mario Carneiro (Sep 20 2018 at 13:26)</a>:</h4>
<p>Instead it has <code>empty</code>/<code>insert</code></p>

<a name="134309213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309213" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309213">Mario Carneiro (Sep 20 2018 at 13:27)</a>:</h4>
<p>My point is, why are you doing list things on <code>alist</code>s?</p>

<a name="134309308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309308">Sean Leather (Sep 20 2018 at 13:28)</a>:</h4>
<p>My point is that I want to construct lists with no duplicate keys as well as use any other existing definitions and theorems on lists.</p>

<a name="134309416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309416">Mario Carneiro (Sep 20 2018 at 13:30)</a>:</h4>
<p>then do so, on <code>list</code>. You don't need <code>alist</code> for that</p>

<a name="134309434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309434">Sean Leather (Sep 20 2018 at 13:30)</a>:</h4>
<p>Quite right, which is why I don't think <code>alist</code> is necessary.</p>

<a name="134309458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309458" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309458">Mario Carneiro (Sep 20 2018 at 13:31)</a>:</h4>
<p><code>alist</code> provides a compositional structure for safety-preserving functions on lists</p>

<a name="134309526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309526">Mario Carneiro (Sep 20 2018 at 13:32)</a>:</h4>
<blockquote>
<p>as well as use any other existing definitions and theorems on lists.</p>
</blockquote>
<p>Most list operations don't preserve the invariant. What do you do with these?</p>

<a name="134309548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309548" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309548">Sean Leather (Sep 20 2018 at 13:33)</a>:</h4>
<p>Well, if you want it, add it. I'm only trying to save you work.</p>

<a name="134309589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309589" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309589">Mario Carneiro (Sep 20 2018 at 13:33)</a>:</h4>
<p>This is an honest question. What is missing from the API of <code>alist</code> that you would want, that requires resorting to <code>list</code>?</p>

<a name="134309684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309684" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309684">Mario Carneiro (Sep 20 2018 at 13:35)</a>:</h4>
<p>Except for <code>union</code>, there's nothing I've missed that comes to mind</p>

<a name="134309698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309698" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309698">Sean Leather (Sep 20 2018 at 13:36)</a>:</h4>
<p>I'm not sure about <code>alist</code>, but I defined the minimum necessary to use <code>list</code>s with no duplicate keys. For example, <code>has_mem</code> and <code>append</code> don't need to be redefined. You only need some extra properties to use <code>append</code>, for example.</p>

<a name="134309747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309747">Mario Carneiro (Sep 20 2018 at 13:36)</a>:</h4>
<p>To answer your question from earlier, <code>alist</code> should also be available as a tool for programmers. "I need a map, I only have equality" -&gt; use <code>alist</code> or <code>finmap</code></p>

<a name="134309771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309771" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309771">Mario Carneiro (Sep 20 2018 at 13:37)</a>:</h4>
<p>Note that the <code>has_mem</code> on <code>alist</code> is different from the one on lists</p>

<a name="134309775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309775" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309775">Mario Carneiro (Sep 20 2018 at 13:37)</a>:</h4>
<p>and <code>append</code> doesn't apply</p>

<a name="134309778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309778" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309778">Sean Leather (Sep 20 2018 at 13:37)</a>:</h4>
<p>Which I don't think it should be.</p>

<a name="134309781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309781" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309781">Sean Leather (Sep 20 2018 at 13:37)</a>:</h4>
<p>As you'll see in my library.</p>

<a name="134309850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309850" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309850">Mario Carneiro (Sep 20 2018 at 13:39)</a>:</h4>
<p>I think in common programming parlance, <code>x \in m</code> where m is a dictionary / map / associative array, means <code>x</code> is a key contained in the map <code>m</code>, not <code>x</code> is a key-value pair in the map</p>

<a name="134309915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309915">Mario Carneiro (Sep 20 2018 at 13:40)</a>:</h4>
<p>The idiom for the other interpretation is <code>&lt;x, y&gt; \in m.val</code>, where <code>val</code> is the operation sometimes called <code>entries</code> in other libraries</p>

<a name="134309930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134309930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134309930">Mario Carneiro (Sep 20 2018 at 13:40)</a>:</h4>
<p>(indeed, maybe it should be renamed to that)</p>

<a name="134310185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310185" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310185">Mario Carneiro (Sep 20 2018 at 13:45)</a>:</h4>
<p>Note also that if it meant membership in the underlying list, then it wouldn't be decidable unless you assume decidability of the values, which is not needed for anything else</p>

<a name="134310257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310257" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310257">Sean Leather (Sep 20 2018 at 13:46)</a>:</h4>
<p>Fair enough. With <code>a : alist</code>, you can use <code>a.val</code>/<code>a.entries</code>.</p>

<a name="134310292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310292" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310292">Mario Carneiro (Sep 20 2018 at 13:47)</a>:</h4>
<p>right, I think this helps to view them as different things (a finite map vs a list of pairs)</p>

<a name="134310375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310375" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310375">Mario Carneiro (Sep 20 2018 at 13:48)</a>:</h4>
<p>You pointed out that it is possible to define operations like <code>append</code> if you assume side conditions (i.e. the key sets are disjoint). Does this come up often?</p>

<a name="134310406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310406">Sean Leather (Sep 20 2018 at 13:49)</a>:</h4>
<p>I don't know about “often,” but it has come up.</p>

<a name="134310494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310494">Sean Leather (Sep 20 2018 at 13:51)</a>:</h4>
<p>I'm now using <code>finmap</code> instead of association lists directly, and you have the same thing with union there.</p>

<a name="134310514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310514">Sean Leather (Sep 20 2018 at 13:51)</a>:</h4>
<p>I'm assuming you'll use <code>has_union</code> for <code>alist</code> instead of <code>has_append</code>?</p>

<a name="134310519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310519">Mario Carneiro (Sep 20 2018 at 13:51)</a>:</h4>
<p>yes</p>

<a name="134310530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310530">Mario Carneiro (Sep 20 2018 at 13:52)</a>:</h4>
<p>since it's union, not append :P</p>

<a name="134310581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310581" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310581">Mario Carneiro (Sep 20 2018 at 13:52)</a>:</h4>
<p>it's not even possible to give an <code>append</code> instance that uses <code>list.append</code></p>

<a name="134310582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310582" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310582">Sean Leather (Sep 20 2018 at 13:52)</a>:</h4>
<p>Well, it's debatable that it's not a form of append.</p>

<a name="134310612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310612" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310612">Mario Carneiro (Sep 20 2018 at 13:52)</a>:</h4>
<p>I prefer set terminology when duplicates are being dropped</p>

<a name="134310633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310633" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310633">Sean Leather (Sep 20 2018 at 13:53)</a>:</h4>
<p>It's still appending. <span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span></p>

<a name="134310663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310663" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310663">Sean Leather (Sep 20 2018 at 13:53)</a>:</h4>
<p>When it comes to the <code>finmap</code>, you can forget that there is any appending. But with <code>alist</code>, you can't.</p>

<a name="134310727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310727" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310727">Mario Carneiro (Sep 20 2018 at 13:54)</a>:</h4>
<p>Not sure what you mean. The underlying operation is not an append</p>

<a name="134310750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310750" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310750">Mario Carneiro (Sep 20 2018 at 13:55)</a>:</h4>
<p>It is true that <code>union</code> would be order-respecting on <code>alist</code></p>

<a name="134310760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310760" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310760">Mario Carneiro (Sep 20 2018 at 13:55)</a>:</h4>
<p>but then again, so is <code>union</code> on <code>list</code></p>

<a name="134310795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310795" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310795">Sean Leather (Sep 20 2018 at 13:56)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">append</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">list</span> <span class="n">α</span>
<span class="bp">|</span> <span class="o">[]</span>       <span class="n">l</span> <span class="o">:=</span> <span class="n">l</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">h</span> <span class="bp">::</span> <span class="n">s</span><span class="o">)</span> <span class="n">t</span> <span class="o">:=</span> <span class="n">h</span> <span class="bp">::</span> <span class="o">(</span><span class="n">append</span> <span class="n">s</span> <span class="n">t</span><span class="o">)</span>

<span class="n">def</span> <span class="n">kunion</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="n">list</span> <span class="o">(</span><span class="n">sigma</span> <span class="n">β</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span>         <span class="n">l</span> <span class="o">:=</span> <span class="n">l</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">hd</span> <span class="bp">::</span> <span class="n">tl</span><span class="o">)</span> <span class="n">l</span> <span class="o">:=</span> <span class="n">hd</span> <span class="bp">::</span> <span class="n">kunion</span> <span class="n">tl</span> <span class="o">(</span><span class="n">kerase</span> <span class="n">hd</span><span class="bp">.</span><span class="mi">1</span> <span class="n">l</span><span class="o">)</span>
</pre></div>

<a name="134310838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310838" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310838">Sean Leather (Sep 20 2018 at 13:56)</a>:</h4>
<p>Are you doing it differently?</p>

<a name="134310876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310876" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310876">Mario Carneiro (Sep 20 2018 at 13:57)</a>:</h4>
<p>I think the <code>erase</code> makes that a rather different kind of operation. But also I think we need two functions here - that is <code>unionl</code></p>

<a name="134310955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310955" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310955">Mario Carneiro (Sep 20 2018 at 13:58)</a>:</h4>
<p><code>unionr</code> would be</p>
<div class="codehilite"><pre><span></span>def kunionr : list (sigma β) → list (sigma β) → list (sigma β)
| []         l := l
| (hd :: tl) l := kinsert hd.1 hd.2 (kunionr tl l)
</pre></div>

<a name="134310975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134310975" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134310975">Mario Carneiro (Sep 20 2018 at 13:58)</a>:</h4>
<p>I'm not even sure if it should get a <code>has_union</code> notation</p>

<a name="134311002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311002">Sean Leather (Sep 20 2018 at 13:59)</a>:</h4>
<p>I'm not sure if you need it. I don't foresee people asking for it.</p>

<a name="134311082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311082" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311082">Mario Carneiro (Sep 20 2018 at 14:00)</a>:</h4>
<p>You need left and right preference. For <code>finmap</code> you can ignore it since the order of parameters gives the preference, but on <code>alist</code> you have order and preference separately</p>

<a name="134311233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311233" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311233">Sean Leather (Sep 20 2018 at 14:02)</a>:</h4>
<p>Why do you need it? Just because it's possible doesn't make it a need.</p>

<a name="134311266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311266" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311266">Mario Carneiro (Sep 20 2018 at 14:03)</a>:</h4>
<p>I'm okay with just assuming right preference (which is what <code>list.union</code> does), but you want left preference?</p>

<a name="134311344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311344">Sean Leather (Sep 20 2018 at 14:04)</a>:</h4>
<p>I stuck with the Haskell <code>Data.Map</code> approach because it seemed to the most intuitive to me.</p>

<a name="134311402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311402" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311402">Mario Carneiro (Sep 20 2018 at 14:05)</a>:</h4>
<p>Keep in mind that haskell has laziness to contend with, making your definition more natural for them</p>

<a name="134311408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311408">Sean Leather (Sep 20 2018 at 14:05)</a>:</h4>
<p>Yep.</p>

<a name="134311479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311479" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311479">Sean Leather (Sep 20 2018 at 14:06)</a>:</h4>
<p><code>∪</code> is <code>infixl</code>, so could that also indicate left-biased is preferred?</p>

<a name="134311485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311485" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311485">Mario Carneiro (Sep 20 2018 at 14:06)</a>:</h4>
<p>It seems like the difference between <code>foldl</code> and <code>foldr</code></p>

<a name="134311497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311497" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311497">Mario Carneiro (Sep 20 2018 at 14:06)</a>:</h4>
<p>and we have both of those</p>

<a name="134311510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311510" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311510">Mario Carneiro (Sep 20 2018 at 14:07)</a>:</h4>
<p>I'd rather not commit to one camp here</p>

<a name="134311595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311595" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311595">Mario Carneiro (Sep 20 2018 at 14:08)</a>:</h4>
<p>particularly since there are also performance characteristics to worry about, and the lean 4 compiler may change this as well</p>

<a name="134311611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311611">Sean Leather (Sep 20 2018 at 14:08)</a>:</h4>
<p>You have to commit to one for <code>∪</code> at the very least.</p>

<a name="134311653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311653" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311653">Sean Leather (Sep 20 2018 at 14:09)</a>:</h4>
<p>I guess if you're going with the <code>list.union</code> precedent, you would go with the right-biased option.</p>

<a name="134311734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311734">Mario Carneiro (Sep 20 2018 at 14:10)</a>:</h4>
<p>I think <code>alist</code> shouldn't have a notation, <code>finmap</code> can use left preference by default since the API properties take precedence there</p>

<a name="134311763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311763" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311763">Mario Carneiro (Sep 20 2018 at 14:11)</a>:</h4>
<p>I should look at other languages like java or python and see what preference is preferred</p>

<a name="134311849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311849" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311849">Sean Leather (Sep 20 2018 at 14:12)</a>:</h4>
<p>I would consider Haskell, ML, OCaml, Coq, Agda, Idris, etc. before looking at Java or Python.</p>

<a name="134311856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311856" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311856">Mario Carneiro (Sep 20 2018 at 14:12)</a>:</h4>
<p>hm, python has a mutation operation which makes the precedence obvious</p>

<a name="134311991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134311991" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134311991">Mario Carneiro (Sep 20 2018 at 14:14)</a>:</h4>
<p>Same with java. OCaml takes a merge function that resolves differences</p>

<a name="134312238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134312238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134312238">Mario Carneiro (Sep 20 2018 at 14:18)</a>:</h4>
<p>Haskell has both union (left bias) and unionWith that takes a merge function</p>

<a name="134312504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134312504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134312504">Mario Carneiro (Sep 20 2018 at 14:22)</a>:</h4>
<p>I couldn't find anything for Coq. Idris uses merge left bias and mergeWith</p>

<a name="134312515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134312515" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134312515">Mario Carneiro (Sep 20 2018 at 14:22)</a>:</h4>
<p>ML is roll your own dict</p>

<a name="134367053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134367053" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134367053">Sean Leather (Sep 21 2018 at 09:35)</a>:</h4>
<p>I'm coming to realize that what would be better for me than a <code>finmap</code> union that updates by <code>insert</code> or <code>erase</code> is something like an internal disjoint union. At least that's what I've gathered it would be called. [<a href="https://math.stackexchange.com/a/1631405" target="_blank" title="https://math.stackexchange.com/a/1631405">1</a>, <a href="https://ncatlab.org/nlab/show/disjoint+union#internal_version" target="_blank" title="https://ncatlab.org/nlab/show/disjoint+union#internal_version">2</a>] For <code>finmap</code>, perhaps the simplest definition would be:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">djunion</span> <span class="o">(</span><span class="n">f</span> <span class="n">g</span> <span class="o">:</span> <span class="n">finmap</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">finmap</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">disjoint</span> <span class="n">f</span><span class="bp">.</span><span class="n">keys</span> <span class="n">g</span><span class="bp">.</span><span class="n">keys</span> <span class="k">then</span> <span class="n">f</span> <span class="err">∪</span> <span class="n">g</span> <span class="k">else</span> <span class="err">∅</span>
</pre></div>


<p>But a more efficient version would probably use <code>list.append</code> instead of <code>list.kunion</code> as <code>∪</code> does.</p>
<p>I'm only dealing with unions of disjoint <code>finmap</code>s, and it would simplify some things if I didn't have to track all of the <code>disjoint f.keys g.keys</code>.</p>

<a name="134368101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/134368101" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#134368101">Sean Leather (Sep 21 2018 at 09:57)</a>:</h4>
<p>Likewise, a disjoint insert would be good. Conceptually:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">djinsert</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">finmap</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">finmap</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">a</span> <span class="err">∉</span> <span class="n">f</span><span class="bp">.</span><span class="n">keys</span> <span class="k">then</span> <span class="n">insert</span> <span class="n">a</span> <span class="n">b</span> <span class="n">f</span> <span class="k">else</span> <span class="err">∅</span>
</pre></div>


<p>But <code>cons</code> would be better than <code>kinsert</code>.</p>

<a name="135406194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135406194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135406194">Sean Leather (Oct 08 2018 at 14:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> What is your plan with <a href="https://github.com/leanprover-community/mathlib/tree/finmap" target="_blank" title="https://github.com/leanprover-community/mathlib/tree/finmap">https://github.com/leanprover-community/mathlib/tree/finmap</a> ? I'd like to see something get into mathlib. However, given the somewhat large difference between your rewrite and <a href="https://github.com/spl/lean-finmap" target="_blank" title="https://github.com/spl/lean-finmap">my library</a>, I'm a bit reluctant at this point to invest the time to port more definitions and theorems over to that branch without knowing what's going to happen to it. Do you plan to continue working on that branch?</p>

<a name="135406729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135406729" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135406729">Mario Carneiro (Oct 08 2018 at 14:25)</a>:</h4>
<p>would you like me to merge it?</p>

<a name="135406861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135406861" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135406861">Sean Leather (Oct 08 2018 at 14:27)</a>:</h4>
<blockquote>
<p>would you like me to merge it?</p>
</blockquote>
<p>“It” being the <code>leanprover-community/mathlib</code> branch? Sure, if you're happy with it in its current state. I would feel more comfortable extending it at that point.</p>

<a name="135406969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135406969" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135406969">Mario Carneiro (Oct 08 2018 at 14:28)</a>:</h4>
<p>I noticed you renamed some things. Not a fan of <code>knodup</code>?</p>

<a name="135407006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407006">Sean Leather (Oct 08 2018 at 14:29)</a>:</h4>
<blockquote>
<p>I noticed you renamed some things. Not a fan of <code>knodup</code>?</p>
</blockquote>
<p><span class="emoji emoji-1f642" title="slight smile">:slight_smile:</span> No. I think <code>nodupkeys</code> is better.</p>

<a name="135407143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407143" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407143">Mario Carneiro (Oct 08 2018 at 14:31)</a>:</h4>
<p>when I look at it I think "nine letters is long for a name segment"</p>

<a name="135407208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407208" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407208">Mario Carneiro (Oct 08 2018 at 14:31)</a>:</h4>
<p>You could have <code>nodup_keys</code> but then it confuses with <code>nodup</code> of <code>keys</code></p>

<a name="135407221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407221" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407221">Mario Carneiro (Oct 08 2018 at 14:31)</a>:</h4>
<p>what about <code>nodup_fst</code>?</p>

<a name="135407228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407228" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407228">Sean Leather (Oct 08 2018 at 14:31)</a>:</h4>
<blockquote>
<p>You could have <code>nodup_keys</code> but then it confuses with <code>nodup</code> of <code>keys</code></p>
</blockquote>
<p>Exactly.</p>

<a name="135407279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407279" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407279">Sean Leather (Oct 08 2018 at 14:32)</a>:</h4>
<blockquote>
<p>what about <code>nodup_fst</code>?</p>
</blockquote>
<p>How is that better than <code>nodupkeys</code> since <code>nodup</code> and <code>keys</code> already exist?</p>

<a name="135407304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407304" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407304">Sean Leather (Oct 08 2018 at 14:32)</a>:</h4>
<p>... exist in the association list/finmap API that is.</p>

<a name="135407323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407323">Mario Carneiro (Oct 08 2018 at 14:33)</a>:</h4>
<p>I mean for the list version, before the "map" interpretation</p>

<a name="135407650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407650" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407650">Sean Leather (Oct 08 2018 at 14:37)</a>:</h4>
<p>I'd prefer <code>nodupkeys</code> for both for consistency's sake. I think the name is clear in that it links <code>nodup</code> and <code>keys</code> and as short as it's needed to be.</p>

<a name="135407709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/association%20lists%2C%20finmap/near/135407709" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17620associationlistsfinmap.html#135407709">Sean Leather (Oct 08 2018 at 14:38)</a>:</h4>
<p>Anyway, I have to go now. If you want to discuss any other issues, I'll pick it up tomorrow.</p>


{% endraw %}
