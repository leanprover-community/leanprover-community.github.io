---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/79702rcasesnames.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html">rcases names</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="130971668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/130971668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#130971668">Patrick Massot (Aug 06 2018 at 11:08)</a>:</h4>
<p>I guess <code>rcases</code> doesn't (recursively) invent names because using autogenerated names is evil. But could we get a tactic which uses trace to indicate what is the structure of angle brackets that would need to be used, possibly with suggested names? Sometimes I spend quite a long time to figure out what to put after <code>rcases ... with</code></p>

<a name="130994054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/130994054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#130994054">Simon Hudon (Aug 06 2018 at 17:54)</a>:</h4>
<p>Let's say you have <code>h : a ∧ (b ∨ c)</code>, what would you like <code>rcases h with</code> to print?</p>

<a name="131002704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131002704" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131002704">Patrick Massot (Aug 06 2018 at 20:34)</a>:</h4>
<p>I didn't think about disjunctions. I'm always using <code>rcases</code> with exists and conjunctions.</p>

<a name="131002871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131002871" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131002871">Simon Hudon (Aug 06 2018 at 20:38)</a>:</h4>
<p>Can you show me an example where you'd like <code>rcases</code> to give you more information?</p>

<a name="131004847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131004847" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131004847">Mario Carneiro (Aug 06 2018 at 21:19)</a>:</h4>
<p>In that case it would probably print <code>rcases h with ⟨h_1, h_2 | h_2⟩</code></p>

<a name="131005023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005023" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005023">Simon Hudon (Aug 06 2018 at 21:23)</a>:</h4>
<p>It would be cool if that kind of information could be fed to the IDE to generate snippets, now that I think of it. Maybe that can be done</p>

<a name="131005164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005164" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005164">Mario Carneiro (Aug 06 2018 at 21:26)</a>:</h4>
<p>this certainly seems doable. I don't think it will be smart enough to not name variables that are eliminated after the match (i.e. <code>h : ∃ a b, a = b</code> should become <code>⟨a, _, rfl⟩</code> rather than <code>⟨a, b, rfl⟩</code>) but otherwise it should be possible. It may do weird things with dependent functions, like this:</p>
<div class="codehilite"><pre><span></span>def f : ℕ ⊕ ℕ → Prop
| (sum.inl a) := 0 &lt; a ∧ a &lt; 1
| (sum.inr a) := ∃ b, a &lt; b ∧ b &lt; a

example (h : ∃ n, f n) : false :=
by rcases h with ⟨a|a, _, _, _⟩
</pre></div>

<a name="131005264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005264" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005264">Reid Barton (Aug 06 2018 at 21:29)</a>:</h4>
<p>In the same spirit, how about filling in a <code>_</code> whose type is a structure with a <code>{ ... }</code> snippet with field names already entered</p>

<a name="131005267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005267" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005267">Mario Carneiro (Aug 06 2018 at 21:29)</a>:</h4>
<p>There is one example of "hints" being used in mathlib thus far, and I just use the error message in that case</p>
<div class="codehilite"><pre><span></span>example : ∃ n, 1 = n :=
by simpa using ⟨1, rfl⟩

-- simpa failed, &#39;using&#39; expression type not directly inferrable. Try:
--
-- simpa ... using
-- show Exists
--   (eq 1),
-- from Exists.intro 1 rfl
-- state:
-- ⊢ Exists (eq 1)
</pre></div>

<a name="131005339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005339">Mario Carneiro (Aug 06 2018 at 21:31)</a>:</h4>
<p>all support for editor interaction was focused on the "holes" API, and that seems to have died. We probably won't see anything new here until lean 4</p>

<a name="131005342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005342">Simon Hudon (Aug 06 2018 at 21:31)</a>:</h4>
<p>I had to stare at it for a while. It can be pretty aggressive indeed. I wonder if we could direct the IDE to do increasingly deep matching.</p>

<a name="131005351"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005351" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005351">Reid Barton (Aug 06 2018 at 21:31)</a>:</h4>
<p>I guess you could write a tactic which uses <code>trace</code> to produce some output which the user is supposed to copy and paste in, yeah. Kind of clunky but better than nothing</p>

<a name="131005397"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005397" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005397">Simon Hudon (Aug 06 2018 at 21:32)</a>:</h4>
<p>For now, we can already start supporting <code>snippet: </code> clauses in error messages. I have some ideas how to pick up on them in emacs at least.</p>

<a name="131005411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005411" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005411">Simon Hudon (Aug 06 2018 at 21:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> I agree. And then progressively, you can automate that "copy and paste"</p>

<a name="131005421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005421">Mario Carneiro (Aug 06 2018 at 21:33)</a>:</h4>
<p>Interesting idea. Whatever API you have has to be compatible with core lean error messages though</p>

<a name="131005496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131005496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131005496">Simon Hudon (Aug 06 2018 at 21:35)</a>:</h4>
<p>I agree. The best would be to choose a keyword (e.g. <code>snippet</code>) that we know isn't used in core lean. That way, in the worse case, the plugin does nothing</p>

<a name="131009017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009017" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009017">Mario Carneiro (Aug 06 2018 at 23:06)</a>:</h4>
<p>I started trying to implement this, but there is a problem with recursive definitions:</p>
<div class="codehilite"><pre><span></span>example (n : nat) : true :=
by rcases n with _|⟨_|⟨_|⟨_|⟨_|⟨_|_⟩⟩⟩⟩⟩; trivial
</pre></div>

<a name="131009083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009083" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009083">Simon Hudon (Aug 06 2018 at 23:09)</a>:</h4>
<p>I did not see that coming. How about we use a default depth, maybe 3? Or just don't follow recursive references</p>

<a name="131009154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009154" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009154">Mario Carneiro (Aug 06 2018 at 23:10)</a>:</h4>
<p>would the depth be cumulative over all splits or just for the one recursive? i.e. if there are two nats</p>

<a name="131009284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009284" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009284">Simon Hudon (Aug 06 2018 at 23:14)</a>:</h4>
<p>I would make that depth the maximum distance between any one case split and the root of the type term. E.g. in <code>ℕ × (ℕ ⊕ ℕ)</code> match on the root product (1) then twice on the nat on the left, then match on the sum on the right (2), and then once on each nat.</p>

<a name="131009289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009289" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009289">Simon Hudon (Aug 06 2018 at 23:14)</a>:</h4>
<p>It might get ugly fast though if you have structures with 10 fields include each other.</p>

<a name="131009423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009423" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009423">Mario Carneiro (Aug 06 2018 at 23:18)</a>:</h4>
<p>what do you mean include each other?</p>

<a name="131009471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009471" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009471">Simon Hudon (Aug 06 2018 at 23:20)</a>:</h4>
<p>like:</p>
<div class="codehilite"><pre><span></span><span class="kn">structure</span> <span class="n">big_struct1</span> <span class="o">:=</span> <span class="c1">-- ten fields</span>

<span class="kn">structure</span> <span class="n">big_struct2</span> <span class="o">:=</span> <span class="c1">-- ten fields of type `big_struct1`</span>

<span class="kn">structure</span> <span class="n">big_struct3</span> <span class="o">:=</span> <span class="c1">-- ten fields of type `big_struct2`</span>
</pre></div>

<a name="131009514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009514" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009514">Mario Carneiro (Aug 06 2018 at 23:21)</a>:</h4>
<p>meh, it's still finite. Users will have to use discretion</p>

<a name="131009515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131009515" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131009515">Mario Carneiro (Aug 06 2018 at 23:21)</a>:</h4>
<p>or adjust the depth</p>

<a name="131100819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131100819" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131100819">Mario Carneiro (Aug 08 2018 at 11:00)</a>:</h4>
<p><code>rcases_hint</code> and <code>rintro_hint</code> are now in mathlib! It was a bit more complicated than I originally thought, since you have to do basically the same thing as <code>rcases</code> except backwards so there is lots of similar but different code from <code>rcases</code>.</p>

<a name="131100895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131100895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131100895">Patrick Massot (Aug 08 2018 at 11:02)</a>:</h4>
<p>did you push that?</p>

<a name="131132812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131132812" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131132812">Simon Hudon (Aug 08 2018 at 21:07)</a>:</h4>
<p>Awesome! You really don't waste a minute, do you?</p>

<a name="131132974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131132974" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131132974">Patrick Massot (Aug 08 2018 at 21:10)</a>:</h4>
<p>Simon, beware that recent discussion about that happened in the add_comm_group tactic thread (my bad)</p>

<a name="131134087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/rcases%20names/near/131134087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/79702rcasesnames.html#131134087">Simon Hudon (Aug 08 2018 at 21:37)</a>:</h4>
<p>That's where you guys are hiding!</p>


{% endraw %}
