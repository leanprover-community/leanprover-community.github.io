---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/50870equivimagecompl.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html">equiv.image_compl</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="124501726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501726" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501726">Patrick Massot (Apr 01 2018 at 23:23)</a>:</h4>
<p>Do we have <code>example (f : equiv a b) (s : set a) : f '' -s = - f '' s</code> hidden somewhere?</p>

<a name="124501766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501766" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501766">Patrick Massot (Apr 01 2018 at 23:24)</a>:</h4>
<p>(or not hidden would also be good)</p>

<a name="124501930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501930">Mario Carneiro (Apr 01 2018 at 23:32)</a>:</h4>
<p>Didn't this come up earlier?</p>

<a name="124501972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501972" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501972">Mario Carneiro (Apr 01 2018 at 23:32)</a>:</h4>
<p>You asked about this identity and we found it wasn't there, then you wrote a proof</p>

<a name="124501974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501974" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501974">Patrick Massot (Apr 01 2018 at 23:32)</a>:</h4>
<p>Really?</p>

<a name="124501980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501980" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501980">Patrick Massot (Apr 01 2018 at 23:32)</a>:</h4>
<p>I'm trying to get back to doing Lean, but I forgot where I stopped</p>

<a name="124501988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124501988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124501988">Patrick Massot (Apr 01 2018 at 23:33)</a>:</h4>
<p>But I don't see that one in my file</p>

<a name="124502043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502043" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502043">Mario Carneiro (Apr 01 2018 at 23:34)</a>:</h4>
<p><a href="#narrow/stream/113488-general/subject/image.20of.20complement/near/123655801" title="#narrow/stream/113488-general/subject/image.20of.20complement/near/123655801">https://leanprover.zulipchat.com/#narrow/stream/113488-general/subject/image.20of.20complement/near/123655801</a></p>

<a name="124502045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502045" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502045">Patrick Massot (Apr 01 2018 at 23:34)</a>:</h4>
<p>Ok, I can see I already asked the question</p>

<a name="124502051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502051" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502051">Patrick Massot (Apr 01 2018 at 23:35)</a>:</h4>
<p>But I don't see my proof there</p>

<a name="124502052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502052" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502052">Patrick Massot (Apr 01 2018 at 23:35)</a>:</h4>
<p>So presumably I never proved it</p>

<a name="124502055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502055" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502055">Patrick Massot (Apr 01 2018 at 23:35)</a>:</h4>
<p>because real life caught me</p>

<a name="124502328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502328" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502328">Patrick Massot (Apr 01 2018 at 23:46)</a>:</h4>
<p>This is so painful</p>

<a name="124502482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124502482" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124502482">Patrick Massot (Apr 01 2018 at 23:50)</a>:</h4>
<p>I give up for tonight. I'm stuck at proving that if b is not in the image of S then its preimage is not in S</p>

<a name="124503021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503021" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503021">Patrick Massot (Apr 02 2018 at 00:11)</a>:</h4>
<p>I had a new idea while feeding the cat, so now I'm stuck at <code>example (f : equiv α β) (b) : f (f.inv_fun b) = b := sorry</code></p>

<a name="124503061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503061" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503061">Kenny Lau (Apr 02 2018 at 00:12)</a>:</h4>
<p><code>f.right_inv b</code>?</p>

<a name="124503062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503062" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503062">Patrick Massot (Apr 02 2018 at 00:12)</a>:</h4>
<p>This so frustrating <span class="emoji emoji-1f479" title="ogre">:ogre:</span></p>

<a name="124503067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503067" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503067">Patrick Massot (Apr 02 2018 at 00:13)</a>:</h4>
<p>that's funny (and frustrating). I tried a million variations on <code>rw f.right_inv b</code> in my main proof</p>

<a name="124503068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503068" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503068">Patrick Massot (Apr 02 2018 at 00:13)</a>:</h4>
<p>it always fail</p>

<a name="124503069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503069">Patrick Massot (Apr 02 2018 at 00:13)</a>:</h4>
<p>but when you extract the statement as a lemma it works</p>

<a name="124503109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503109">Kenny Lau (Apr 02 2018 at 00:14)</a>:</h4>
<p>maybe if you stop writing <code>f.to_fun</code> as <code>f</code> then <code>rw</code> will work</p>

<a name="124503110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503110" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503110">Patrick Massot (Apr 02 2018 at 00:14)</a>:</h4>
<p>I did not write this</p>

<a name="124503158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503158" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503158">Patrick Massot (Apr 02 2018 at 00:16)</a>:</h4>
<p>even inside conversion mode it fails</p>

<a name="124503205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503205">Patrick Massot (Apr 02 2018 at 00:18)</a>:</h4>
<p>I think this is the most ridiculous proof I ever wrote in Lean. The ratio "ugliness of proof"/"triviality of statement" is probably my worse so far</p>

<a name="124503210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503210" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503210">Patrick Massot (Apr 02 2018 at 00:19)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">fuck</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">inv_fun</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">f</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">b</span>

<span class="kn">lemma</span> <span class="n">equiv</span><span class="bp">.</span><span class="n">image_compl</span>  <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">equiv</span> <span class="n">α</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="bp">-</span><span class="n">s</span> <span class="bp">=</span> <span class="bp">-</span><span class="o">(</span><span class="n">f</span> <span class="err">&#39;&#39;</span> <span class="n">s</span><span class="o">)</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="n">apply</span> <span class="n">subset</span><span class="bp">.</span><span class="n">antisymm</span><span class="o">,</span>
  <span class="o">{</span> <span class="n">intros</span> <span class="n">b</span> <span class="n">b_in_image_compl</span><span class="o">,</span>
    <span class="n">rcases</span> <span class="n">b_in_image_compl</span> <span class="k">with</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">a_compl_s</span><span class="o">,</span> <span class="n">f_a_b</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">rw</span> <span class="o">(</span><span class="n">equiv</span><span class="bp">.</span><span class="n">apply_eq_iff_eq_inverse_apply</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="n">f_a_b</span> <span class="n">at</span> <span class="n">a_compl_s</span><span class="o">,</span>
    <span class="n">exact</span> <span class="o">(</span><span class="n">mt</span> <span class="o">(</span><span class="bp">@</span><span class="n">mem_image_iff_of_inverse</span> <span class="n">α</span> <span class="n">β</span> <span class="n">f</span><span class="bp">.</span><span class="n">to_fun</span> <span class="n">f</span><span class="bp">.</span><span class="n">inv_fun</span> <span class="n">b</span> <span class="n">s</span> <span class="n">f</span><span class="bp">.</span><span class="n">left_inv</span> <span class="n">f</span><span class="bp">.</span><span class="n">right_inv</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span>
<span class="n">a_compl_s</span> <span class="o">},</span>
  <span class="o">{</span> <span class="n">intros</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">subset_def</span><span class="o">,</span>
    <span class="n">intros</span> <span class="n">b</span> <span class="n">b_in_compl_image</span><span class="o">,</span>
    <span class="n">apply</span> <span class="o">(</span><span class="bp">@</span><span class="n">mem_image_iff_of_inverse</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">f</span><span class="bp">.</span><span class="n">left_inv</span> <span class="n">f</span><span class="bp">.</span><span class="n">right_inv</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">b_not_in_image</span> <span class="o">:=</span> <span class="n">not_mem_of_mem_compl</span> <span class="n">b_in_compl_image</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">set</span><span class="bp">.</span><span class="n">mem_compl_eq</span><span class="o">,</span>
    <span class="n">by_contra</span><span class="o">,</span>
    <span class="k">have</span> <span class="o">:=</span> <span class="n">mem_image_of_mem</span> <span class="n">f</span> <span class="n">a</span><span class="o">,</span>
    <span class="n">rw</span> <span class="n">fuck</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
    <span class="n">finish</span> <span class="o">}</span>
<span class="kn">end</span>
</pre></div>

<a name="124503212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503212" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503212">Patrick Massot (Apr 02 2018 at 00:20)</a>:</h4>
<p>But at least Lean was defeated</p>

<a name="124503802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124503802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124503802">Mario Carneiro (Apr 02 2018 at 00:45)</a>:</h4>
<p>Actually, I recommend not using <code>f.right_inv</code> in favor of the coercions</p>

<a name="124504087"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504087" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504087">Kevin Buzzard (Apr 02 2018 at 00:57)</a>:</h4>
<p>Another example of mathematicians getting very frustrated about how sometimes something which is "trivial in maths" can be hard in Lean.</p>

<a name="124504088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504088" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504088">Kevin Buzzard (Apr 02 2018 at 00:57)</a>:</h4>
<p>In the long term these really need to be fixed somehow</p>

<a name="124504090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504090" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504090">Kevin Buzzard (Apr 02 2018 at 00:57)</a>:</h4>
<p>if CS people want mathematicians to use the software.</p>

<a name="124504131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504131" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504131">Kevin Buzzard (Apr 02 2018 at 00:58)</a>:</h4>
<p>And funnily enough, just the same thing happened to me with rw</p>

<a name="124504132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504132">Simon Hudon (Apr 02 2018 at 00:58)</a>:</h4>
<p>I don't think it will ever happen that a mathematician using this or another theorem prover and will, 100% of the time, think "this is trivial" and have the prover confirm that (when the statement is true).</p>

<a name="124504133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504133">Kevin Buzzard (Apr 02 2018 at 00:58)</a>:</h4>
<p>no, with exact</p>

<a name="124504140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504140" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504140">Kevin Buzzard (Apr 02 2018 at 00:59)</a>:</h4>
<p><code>exact (congr_fun H HUigx)</code> failed (type mismatch)</p>

<a name="124504143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504143" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504143">Kevin Buzzard (Apr 02 2018 at 00:59)</a>:</h4>
<p>but <code>have H2 := congr_fun H HUigx, exact H2</code> succeeded</p>

<a name="124504524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504524" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504524">Kevin Buzzard (Apr 02 2018 at 01:14)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>  I definitely think that this should happen in the future.</p>

<a name="124504526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504526">Kevin Buzzard (Apr 02 2018 at 01:14)</a>:</h4>
<p>I am suggesting we meet you somewhere in the middle.</p>

<a name="124504533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504533" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504533">Kevin Buzzard (Apr 02 2018 at 01:15)</a>:</h4>
<p>But if it doesn't happen then what hope is there for people to start adopting this computer viewpoint?</p>

<a name="124504534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504534">Kevin Buzzard (Apr 02 2018 at 01:15)</a>:</h4>
<p>I think it's a matter of education on our part and adding lemmas on your part</p>

<a name="124504574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504574" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504574">Kevin Buzzard (Apr 02 2018 at 01:16)</a>:</h4>
<p>We already saw this week how Chris couldn't prove something which was mathematically trivial, and then we found a framework for it and it became straightforward to prove</p>

<a name="124504629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504629" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504629">Simon Hudon (Apr 02 2018 at 01:19)</a>:</h4>
<p>In that case, I think we're on the same page. In general, we probably need to build packages to better support undergraduate level mathematics and at least the basics of graduate level math.</p>

<a name="124504631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124504631" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124504631">Simon Hudon (Apr 02 2018 at 01:19)</a>:</h4>
<p>Improving the automation and the documentation for building your own tactics will probably help you bridge the gap too.</p>

<a name="124507833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124507833" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124507833">Mario Carneiro (Apr 02 2018 at 03:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>  I wrote a proof of this that should appear in mathlib once it finishes checking. It's not nearly as complicated as you made it, and after appropriate sublemmas it's a one-liner:</p>
<div class="codehilite"><pre><span></span>theorem image_compl_subset {f : α → β} {s : set α} (H : injective f) :
  f &#39;&#39; -s ⊆ -(f &#39;&#39; s) :=
subset_compl_iff_disjoint.2 $ by simp [image_inter H]

theorem subset_image_compl {f : α → β} {s : set α} (H : surjective f) :
  -(f &#39;&#39; s) ⊆ f &#39;&#39; -s :=
compl_subset_iff_union.2 $
by rw ← image_union; simp [image_univ_of_surjective H]

theorem image_compl_eq {f : α → β} {s : set α} (H : bijective f) :
  f &#39;&#39; -s = -(f &#39;&#39; s) :=
subset.antisymm (image_compl_subset H.1) (subset_image_compl H.2)
</pre></div>

<a name="124518916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124518916" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124518916">Patrick Massot (Apr 02 2018 at 10:47)</a>:</h4>
<p>Thank you very much <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>. I noticed that many support lemmas were missing. I'll use my crappy version in the mean time. But I'm still very much interested in any explanation why I could not avoid having this one lemma in order to rewrite.</p>

<a name="124518965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124518965" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124518965">Mario Carneiro (Apr 02 2018 at 10:49)</a>:</h4>
<p>I am not quite sure what you were doing, but I think you wrote things in a non-idiomatic way (which is to say, not the way that mathlib is designed to help with), which made the proof more painful than it should have been</p>

<a name="124519016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519016" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519016">Mario Carneiro (Apr 02 2018 at 10:50)</a>:</h4>
<p>The idiomatic version of your <code>fuck</code> lemma is <code>f (f.symm x) = x</code> (and it's called <code>apply_inverse_apply</code>)</p>

<a name="124519028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519028" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519028">Kenny Lau (Apr 02 2018 at 10:51)</a>:</h4>
<p><code> rw fuck at this </code></p>

<a name="124519031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519031">Kenny Lau (Apr 02 2018 at 10:51)</a>:</h4>
<p>i.e. <code>fuck this</code></p>

<a name="124519141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519141" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519141">Patrick Massot (Apr 02 2018 at 10:54)</a>:</h4>
<p>I'll tell you exactly what I was doing. First my brain absolutely refuses to think in this kind of situation, it's only filled with anger. Then I search for all lemmas in mathlib which seem vaguely related and try to apply them. But I got stuck with sorts of coercions issues, and stuff like rw refuses to rewrite etc, so I'm get even more upset. So of course the proof ends up not looking like what I would write on paper (of course in the beginning I would write nothing but then I'm able to write some proof on paper)</p>

<a name="124519148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519148" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519148">Patrick Massot (Apr 02 2018 at 10:55)</a>:</h4>
<p>But why does <code> rw f.right_inv b </code> fails?</p>

<a name="124519156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519156">Kenny Lau (Apr 02 2018 at 10:55)</a>:</h4>
<p><code>rw</code> matches exactly the expression</p>

<a name="124519157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519157" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519157">Kenny Lau (Apr 02 2018 at 10:55)</a>:</h4>
<p>without any definitorial expansion</p>

<a name="124519160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519160" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519160">Patrick Massot (Apr 02 2018 at 10:55)</a>:</h4>
<p>Something else I notice with your solution is I should have gave up on proving this on <code>equiv</code> but go back to functions and <code>bijective f</code></p>

<a name="124519200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519200" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519200">Patrick Massot (Apr 02 2018 at 10:56)</a>:</h4>
<p>At least this removes the coercion hell</p>

<a name="124519201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519201" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519201">Kenny Lau (Apr 02 2018 at 10:56)</a>:</h4>
<p>don't</p>

<a name="124519203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519203" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519203">Kenny Lau (Apr 02 2018 at 10:56)</a>:</h4>
<p>the <code>bijective f</code> has no data</p>

<a name="124519205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519205">Kenny Lau (Apr 02 2018 at 10:56)</a>:</h4>
<p>i.e. it is not constructive</p>

<a name="124519206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519206" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519206">Sebastian Ullrich (Apr 02 2018 at 10:57)</a>:</h4>
<blockquote>
<p><code>rw</code> matches exactly the expression </p>
</blockquote>
<p>This is only correct for the expression _head_</p>

<a name="124519212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519212" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519212">Kenny Lau (Apr 02 2018 at 10:57)</a>:</h4>
<p>matches the expression pattern</p>

<a name="124519265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519265">Patrick Massot (Apr 02 2018 at 10:58)</a>:</h4>
<p>I still fail to see how this explains my situation</p>

<a name="124519276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519276" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519276">Patrick Massot (Apr 02 2018 at 10:59)</a>:</h4>
<p>I only copied the hypothesis into the statement of a lemma, and this rw accepts to do its job</p>

<a name="124519374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519374">Mario Carneiro (Apr 02 2018 at 11:03)</a>:</h4>
<p>kenny, <code>bijective f</code> is a precondition to the theorem. Constructively, <code>bijective f</code> is weaker than <code>equiv</code>, so the theorem is stronger</p>

<a name="124519379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519379" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519379">Kenny Lau (Apr 02 2018 at 11:03)</a>:</h4>
<p>well</p>

<a name="124519430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519430">Mario Carneiro (Apr 02 2018 at 11:05)</a>:</h4>
<p>... but the proof uses excluded middle, although the theorem itself has no data anyway so it doesn't matter computation-wise</p>

<a name="124519479"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519479" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519479">Mario Carneiro (Apr 02 2018 at 11:06)</a>:</h4>
<p>It's not possible to prove the versions I stated without excluded middle</p>

<a name="124519482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519482" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519482">Patrick Massot (Apr 02 2018 at 11:06)</a>:</h4>
<p>Needless to say, I'm perfectly happy with excluded middle in this proof</p>

<a name="124519488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519488" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519488">Patrick Massot (Apr 02 2018 at 11:07)</a>:</h4>
<p>And it's even better if I can get the opportunity to deduce from this the statement for equiv which could be constructive</p>

<a name="124519491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equiv.image_compl/near/124519491" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/50870equivimagecompl.html#124519491">Kenny Lau (Apr 02 2018 at 11:07)</a>:</h4>
<p>excluded middle is an overgeneralization of the situation observed from finite situations</p>


{% endraw %}
