---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/39364compiletimestatistics.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html">compile time statistics</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="134506913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134506913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134506913">Kenny Lau (Sep 24 2018 at 05:47)</a>:</h4>
<p>Can we get some data on how long it takes for <em>each</em> file to compile?</p>

<a name="134506915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134506915" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134506915">Kenny Lau (Sep 24 2018 at 05:47)</a>:</h4>
<p>in mathlib, that is</p>

<a name="134507008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134507008" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134507008">Simon Hudon (Sep 24 2018 at 05:49)</a>:</h4>
<p>You can call <code>lean file.lean --profile</code> on each. You can get the list of all the files of <code>mathlib</code> with <code>git ls-files *.lean</code></p>

<a name="134508030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508030">Scott Morrison (Sep 24 2018 at 06:21)</a>:</h4>
<p>Make sure everything is already compiled before starting this, so it's only recompiling the particular file you've asked about.</p>

<a name="134508037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508037">Scott Morrison (Sep 24 2018 at 06:21)</a>:</h4>
<p>However I'd guess that even this could give misleading results: lean still has to reparse all the imported <code>.olean</code> files, so at the end of a huge development you'd expect even tiny files to have very large compile times with this technique.</p>

<a name="134508409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508409">Kenny Lau (Sep 24 2018 at 06:30)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> then what should I do?</p>

<a name="134508430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508430">Scott Morrison (Sep 24 2018 at 06:30)</a>:</h4>
<p>Well, I guess you could measure how bad the effect I pointed out it, by timing compiling an empty olean file that imports everything?</p>

<a name="134508454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508454" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508454">Scott Morrison (Sep 24 2018 at 06:31)</a>:</h4>
<p>Or even fancier, you could time compiling an empty olean file with the exact same imports, and subtract that time off.</p>

<a name="134508499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508499" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508499">Scott Morrison (Sep 24 2018 at 06:32)</a>:</h4>
<p>I really don't have a good sense of whether this is necessary!</p>

<a name="134508504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508504">Scott Morrison (Sep 24 2018 at 06:32)</a>:</h4>
<p>I can't think of any direct way to get these per-file timings, however.</p>

<a name="134508534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508534">Simon Hudon (Sep 24 2018 at 06:33)</a>:</h4>
<p>I'm really tempted to neglect that time</p>

<a name="134508584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134508584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134508584">Simon Hudon (Sep 24 2018 at 06:34)</a>:</h4>
<p>You can do it once with all the files to get an upper bound on how much time that is but I feel like that must be negligible compared with everything else</p>

<a name="134509157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509157" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509157">Kenny Lau (Sep 24 2018 at 06:53)</a>:</h4>
<p>if I have a file <code>e.lean</code> that imports <code>a</code> and <code>b</code> and <code>c</code> and <code>d</code>, can I look at the time of <code>e</code> and subtract from it the times of the other four files?</p>

<a name="134509337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509337" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509337">Kenny Lau (Sep 24 2018 at 06:58)</a>:</h4>
<p>I've now tracked 57 out of 255 files</p>

<a name="134509338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509338" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509338">Kenny Lau (Sep 24 2018 at 06:58)</a>:</h4>
<p>this is really slow</p>

<a name="134509339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509339">Simon Hudon (Sep 24 2018 at 06:58)</a>:</h4>
<p>You shouldn't do it that way.</p>

<a name="134509342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509342" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509342">Simon Hudon (Sep 24 2018 at 06:58)</a>:</h4>
<p>Start with <code>lean --make</code>, then build each file</p>

<a name="134509348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509348" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509348">Kenny Lau (Sep 24 2018 at 06:59)</a>:</h4>
<p>I have all the oleans already</p>

<a name="134509352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509352" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509352">Kenny Lau (Sep 24 2018 at 06:59)</a>:</h4>
<p>I'm running this command:<br>
<code> git ls-files *.lean | xargs -n1 /c/lean/bin/lean --profile &gt; junk.txt 2&gt; time.txt</code></p>

<a name="134509388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509388" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509388">Simon Hudon (Sep 24 2018 at 07:00)</a>:</h4>
<p>Ok, in that case, all that is left is wait. The travis build takes more than an hour</p>

<a name="134509410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509410" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509410">Kenny Lau (Sep 24 2018 at 07:00)</a>:</h4>
<p>brilliant</p>

<a name="134509424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134509424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134509424">Simon Hudon (Sep 24 2018 at 07:00)</a>:</h4>
<p>Yup</p>

<a name="134510040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134510040" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134510040">Kenny Lau (Sep 24 2018 at 07:16)</a>:</h4>
<p>117 out of 255 files</p>

<a name="134514042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134514042" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134514042">Kenny Lau (Sep 24 2018 at 08:55)</a>:</h4>
<p>there are 11 files that did not show any <code>cumulative profiling times:</code></p>

<a name="134514044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134514044" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134514044">Kenny Lau (Sep 24 2018 at 08:55)</a>:</h4>
<p>which 11 files is that?</p>

<a name="134514346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134514346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134514346">Kenny Lau (Sep 24 2018 at 09:02)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/6ea2ca42e517ad801564a86fe7a1b7bd" target="_blank" title="https://gist.github.com/kckennylau/6ea2ca42e517ad801564a86fe7a1b7bd">https://gist.github.com/kckennylau/6ea2ca42e517ad801564a86fe7a1b7bd</a></p>

<a name="134514354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134514354" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134514354">Kenny Lau (Sep 24 2018 at 09:02)</a>:</h4>
<p>time in seconds, may have indexing error by at most 11</p>

<a name="134514478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134514478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134514478">Kenny Lau (Sep 24 2018 at 09:05)</a>:</h4>
<div class="codehilite"><pre><span></span>commit ca7f118058342a2f077e836e643d26e0ad1f3ca6
Author: Rob Lewis &lt;Rob.y.lewis@gmail.com&gt;
Date:   Fri Sep 21 17:06:34 2018 +0200

    fix(docs/tactics.md): missing backquote, formatting

    I think I never previewed when I updated the `linarith` doc before, sorry.
</pre></div>

<a name="134514888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134514888" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134514888">Kenny Lau (Sep 24 2018 at 09:14)</a>:</h4>
<p>I guess afterall looking at the file size might be more reliable</p>

<a name="134515602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134515602" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134515602">Kenny Lau (Sep 24 2018 at 09:32)</a>:</h4>
<p>is it a good idea if I start working on making the files compile faster?</p>

<a name="134515606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134515606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134515606">Kenny Lau (Sep 24 2018 at 09:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> will you guys accept my PR?</p>

<a name="134515948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134515948" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134515948">Patrick Massot (Sep 24 2018 at 09:40)</a>:</h4>
<p>I think it's really a huge problem that we are tempted to sacrifice readability for compile time</p>

<a name="134516218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134516218" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134516218">Mario Carneiro (Sep 24 2018 at 09:48)</a>:</h4>
<p>yes, if you can make a significant improvement on compile times without making the proof much longer, I think I would accept it without issue. I assume you will start from really bad offenders. If you can get at least ~70% reduction in compile time then I would accept a modest increase in proof size</p>

<a name="134516273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134516273" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134516273">Mario Carneiro (Sep 24 2018 at 09:49)</a>:</h4>
<p>I find that readability is mostly orthogonal to compile time</p>

<a name="134516451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134516451" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134516451">Kenny Lau (Sep 24 2018 at 09:53)</a>:</h4>
<p>challenge accepted</p>

<a name="134526934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134526934" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134526934">Reid Barton (Sep 24 2018 at 13:41)</a>:</h4>
<p>I would guess the 11 files which had no profiling information are the <code>.default</code> modules which do nothing but import other modules</p>

<a name="134526938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134526938" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134526938">Reid Barton (Sep 24 2018 at 13:42)</a>:</h4>
<p>but I don't understand your data yet</p>

<a name="134528608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134528608" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134528608">Reid Barton (Sep 24 2018 at 14:11)</a>:</h4>
<blockquote>
<p>I think it's really a huge problem that we are tempted to sacrifice readability for compile time</p>
</blockquote>
<p>But <span class="user-mention" data-user-id="110031">@Patrick Massot</span>, it means we can join the programmers <a href="https://xkcd.com/303/" target="_blank" title="https://xkcd.com/303/">https://xkcd.com/303/</a></p>

<a name="134528990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134528990" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134528990">Keeley Hoek (Sep 24 2018 at 14:17)</a>:</h4>
<p><a href="https://xkcd.com/1205/" target="_blank" title="https://xkcd.com/1205/">https://xkcd.com/1205/</a></p>

<a name="134534111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134534111" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134534111">Kenny Lau (Sep 24 2018 at 15:40)</a>:</h4>
<blockquote>
<p>but I don't understand your data yet</p>
</blockquote>
<p>just assume that big numbers means bad, no matter how many there are</p>

<a name="134541798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134541798" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134541798">Simon Hudon (Sep 24 2018 at 17:56)</a>:</h4>
<p>Another approach is to look at the frequent offenders, the tactics that most often eat up most of the run time of proofs. Then we can work on making them faster. If you find such offenders, I wouldn't mind pitching in to improve the tactics.</p>

<a name="134552824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134552824" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134552824">Kenny Lau (Sep 24 2018 at 19:56)</a>:</h4>
<p>I think <code>simp</code> is like plastic</p>

<a name="134552838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134552838" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134552838">Kenny Lau (Sep 24 2018 at 19:56)</a>:</h4>
<p>when it was discovered, everyone thought it's the greatest idea in the world, and everyone used it</p>

<a name="134552843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134552843" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134552843">Kenny Lau (Sep 24 2018 at 19:56)</a>:</h4>
<p>and it's too late when everyone discovered the ramifications it brings</p>

<a name="134552865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134552865" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134552865">Kenny Lau (Sep 24 2018 at 19:57)</a>:</h4>
<p>Kurzgesagt compares plastic with the story of the king with the golden touch</p>

<a name="134553864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134553864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134553864">Simon Hudon (Sep 24 2018 at 20:13)</a>:</h4>
<p>One way to improve the performances of <code>simp</code> is to create specialized list of simp lemmas. You can have a look at <code>functor_norm</code>. Sometimes, <code>simp only with &lt;my-list&gt;</code> can be sufficient and will be faster.</p>

<a name="134553952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134553952" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134553952">Patrick Massot (Sep 24 2018 at 20:15)</a>:</h4>
<p>Are you really sure that <code>simp</code> is the slow thing? It seems to me elaboration is often very slow</p>

<a name="134554391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134554391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134554391">Simon Hudon (Sep 24 2018 at 20:22)</a>:</h4>
<p>Do you know what kind of situation makes elaboration slow? </p>
<p>Aside from that, if we divide a proof into proof search + elaboration + proof check, I think shrinking the proof search side will also shrink the elaboration and proof check side because proof search often uses both to select the right approach.</p>

<a name="134554606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134554606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134554606">Kenny Lau (Sep 24 2018 at 20:26)</a>:</h4>
<blockquote>
<p>One way to improve the performances of <code>simp</code> is to create specialized list of simp lemmas. You can have a look at <code>functor_norm</code>. Sometimes, <code>simp only with &lt;my-list&gt;</code> can be sufficient and will be faster.</p>
</blockquote>
<p><a href="#narrow/stream/113488-general/topic/simp_attr" title="#narrow/stream/113488-general/topic/simp_attr">https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/simp_attr</a></p>

<a name="134554943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134554943" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134554943">Simon Hudon (Sep 24 2018 at 20:32)</a>:</h4>
<p>Yes there are pitfalls</p>

<a name="134554995"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134554995" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134554995">Simon Hudon (Sep 24 2018 at 20:33)</a>:</h4>
<p>One thing you can do is create simp attributes local to files or modules and group in that lemma everything useful for its proofs.</p>

<a name="134555063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134555063" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134555063">Simon Hudon (Sep 24 2018 at 20:34)</a>:</h4>
<p>Then you can merge those lists as a shortcut for just listing all the useful lemmas.</p>

<a name="134555156"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134555156" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134555156">Simon Hudon (Sep 24 2018 at 20:36)</a>:</h4>
<p>The other possibility is to create a command for listing all the simp lemmas used in a file and printing out the way to create the required simp lemma</p>

<a name="134572292"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572292" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572292">Kenny Lau (Sep 25 2018 at 03:51)</a>:</h4>
<div class="codehilite"><pre><span></span>$ git checkout master
Switched to branch &#39;master&#39;
Your branch is up-to-date with &#39;origin/master&#39;.

$ /c/lean/bin/lean --profile algebra/big_operators.lean &gt;/dev/null
cumulative profiling times:
        compilation 1.37ms
        decl post-processing 7.92s
        elaboration 47.7s
        elaboration: tactic compilation 676ms
        elaboration: tactic execution 42s
        parsing 1.18s
        type checking 19.5ms

$ git checkout faster
Switched to branch &#39;faster&#39;

$ /c/lean/bin/lean --profile algebra/big_operators.lean &gt;/dev/null
cumulative profiling times:
        compilation 1.53ms
        decl post-processing 6.86s
        elaboration 7.37s
        elaboration: tactic compilation 561ms
        elaboration: tactic execution 3.82s
        parsing 995ms
        type checking 17.9ms
</pre></div>

<a name="134572294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572294" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572294">Kenny Lau (Sep 25 2018 at 03:51)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>

<a name="134572336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572336">Kenny Lau (Sep 25 2018 at 03:53)</a>:</h4>
<p>elaboration 47.7s --&gt; 7.37s<br>
elaboration: tactic execution 42s --&gt; 3.82s</p>

<a name="134572344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572344" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572344">Simon Hudon (Sep 25 2018 at 03:53)</a>:</h4>
<p>Nice! What did you do?</p>

<a name="134572391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572391">Kenny Lau (Sep 25 2018 at 03:54)</a>:</h4>
<p>I removed the simp</p>

<a name="134572396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572396" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572396">Kenny Lau (Sep 25 2018 at 03:54)</a>:</h4>
<p>and replaced them with either a term proof or <code>rw</code> or <code>simp only</code></p>

<a name="134572472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572472" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572472">Simon Hudon (Sep 25 2018 at 03:56)</a>:</h4>
<p>How long did it take for each proof?</p>

<a name="134572668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572668">Kenny Lau (Sep 25 2018 at 04:02)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/6d1e02b8289f24be38416642b5d91142" target="_blank" title="https://gist.github.com/kckennylau/6d1e02b8289f24be38416642b5d91142">https://gist.github.com/kckennylau/6d1e02b8289f24be38416642b5d91142</a></p>

<a name="134572694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134572694" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134572694">Kenny Lau (Sep 25 2018 at 04:03)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/commit/c347e9940c773faf79358b0bf320e73247f51023" target="_blank" title="https://github.com/leanprover-community/mathlib/commit/c347e9940c773faf79358b0bf320e73247f51023">https://github.com/leanprover-community/mathlib/commit/c347e9940c773faf79358b0bf320e73247f51023</a></p>

<a name="134590722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134590722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134590722">Keeley Hoek (Sep 25 2018 at 11:47)</a>:</h4>
<p>I've got a setup where I can hook-in to <code>begin</code> blocks and take control away from lean when they occur, and do whatever I want to the <code>texpr</code>s in the <code>begin ... end</code> just by importing a file. One use case is replacing <code>simp</code> by what it did last time and seeing if it works---and saving this in a file to be used again later (the idea I mentioned before). You'd enable it by adding <code>import tactic.caching</code> or something at the top of your file.</p>
<p>This would mean you'd be able to get performance benefits like this without obfuscating the code (but as Scott, or someone else mentioned last time stale caches could break a fresh build for someone else, so you'd have to clear before shipping). If I can get everything working robustly, would anyone hacking on mathlib be willing to try it out?</p>

<a name="134596822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134596822" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134596822">Kenny Lau (Sep 25 2018 at 13:33)</a>:</h4>
<p>I reckon if we removed all the simp, it can compile in under 10 minutes</p>

<a name="134672859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134672859" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134672859">Kenny Lau (Sep 26 2018 at 13:15)</a>:</h4>
<div class="codehilite"><pre><span></span>git ls-files *.lean | xargs -I % sh -c &#39;&gt;&amp;2 echo %; /c/lean/bin/lean --profile % &gt;/dev/null;&#39; &gt; profile.txt 2&gt;&amp;1
</pre></div>

<a name="134672866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134672866" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134672866">Kenny Lau (Sep 26 2018 at 13:15)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/04917450f71db69f29150d64f360dd0f" target="_blank" title="https://gist.github.com/kckennylau/04917450f71db69f29150d64f360dd0f">https://gist.github.com/kckennylau/04917450f71db69f29150d64f360dd0f</a></p>

<a name="134672884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134672884" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134672884">Kenny Lau (Sep 26 2018 at 13:15)</a>:</h4>
<p>if A imports B and C, do I need to subtract the times of B and C from the time of A to get a more accurate datum?</p>

<a name="134672933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134672933" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134672933">Kenny Lau (Sep 26 2018 at 13:16)</a>:</h4>
<p>also, I learnt the hard way that you need to <code>lean --make</code> it before doing this</p>

<a name="134674307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134674307" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134674307">Scott Morrison (Sep 26 2018 at 13:33)</a>:</h4>
<p>as long as you lean --make beforehand subtraction shouldn't be necessary</p>

<a name="134687725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687725" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687725">Kenny Lau (Sep 26 2018 at 16:39)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/7cd92fe25114061b706d6c86aa8059ea" target="_blank" title="https://gist.github.com/kckennylau/7cd92fe25114061b706d6c86aa8059ea">https://gist.github.com/kckennylau/7cd92fe25114061b706d6c86aa8059ea</a></p>

<a name="134687831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687831" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687831">Kenny Lau (Sep 26 2018 at 16:40)</a>:</h4>
<p>sorted: <a href="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852" target="_blank" title="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852">https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852</a></p>

<a name="134687841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687841">Kenny Lau (Sep 26 2018 at 16:41)</a>:</h4>
<p>all time in seconds</p>

<a name="134687864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687864">Mario Carneiro (Sep 26 2018 at 16:41)</a>:</h4>
<p>well I can't say that any of the top ten are a surprise</p>

<a name="134687936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687936" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687936">Mario Carneiro (Sep 26 2018 at 16:42)</a>:</h4>
<p>What do you get if you sort by compile time / length in characters?</p>

<a name="134687960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687960" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687960">Mario Carneiro (Sep 26 2018 at 16:43)</a>:</h4>
<p>the longest files are of course going to take a long time to compile</p>

<a name="134687974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134687974" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134687974">Mario Carneiro (Sep 26 2018 at 16:43)</a>:</h4>
<p>what do the multiple numbers mean in the first gist?</p>

<a name="134688034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688034" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688034">Kenny Lau (Sep 26 2018 at 16:44)</a>:</h4>
<p>so a raw datum looks like:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
        compilation 253ms
        decl post-processing 2.84s
        elaboration 114s
        elaboration: tactic compilation 3.57s
        elaboration: tactic execution 86.9s
        parsing 5.23s
        type checking 229ms
</pre></div>

<a name="134688037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688037" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688037">Kenny Lau (Sep 26 2018 at 16:44)</a>:</h4>
<p>I filtered out the <code>ms</code></p>

<a name="134688040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688040" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688040">Kenny Lau (Sep 26 2018 at 16:44)</a>:</h4>
<p>and listed each item</p>

<a name="134688045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688045" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688045">Kenny Lau (Sep 26 2018 at 16:44)</a>:</h4>
<p>and added the numbers together in the last gist</p>

<a name="134688450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688450" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688450">Kenny Lau (Sep 26 2018 at 16:52)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/7318d851eca2f951e7acdaa6ffbe65b7" target="_blank" title="https://gist.github.com/kckennylau/7318d851eca2f951e7acdaa6ffbe65b7">https://gist.github.com/kckennylau/7318d851eca2f951e7acdaa6ffbe65b7</a></p>

<a name="134688451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688451" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688451">Kenny Lau (Sep 26 2018 at 16:52)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> ^</p>

<a name="134688562"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688562" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688562">Mario Carneiro (Sep 26 2018 at 16:54)</a>:</h4>
<p>complex/basic is a surprise</p>

<a name="134688753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688753" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688753">Kenny Lau (Sep 26 2018 at 16:57)</a>:</h4>
<div class="codehilite"><pre><span></span>elaboration: tactic execution took 1.31s
elaboration of ext_iff took 1.45s
elaboration: tactic execution took 1.51s
elaboration of of_real_neg took 1.6s
elaboration of mk_eq_add_mul_I took 1.62s
elaboration: tactic execution took 1.61s
elaboration of of_real_mul took 1.75s
elaboration: tactic execution took 1.26s
elaboration of re_add_im took 1.37s
elaboration: tactic execution took 1.08s
elaboration of conj_of_real took 1.17s
elaboration of conj_I took 1.16s
elaboration: tactic execution took 1.38s
elaboration of conj_add took 1.5s
elaboration: tactic execution took 2.08s
elaboration of conj_neg took 2.22s
elaboration: tactic execution took 1.99s
elaboration of conj_conj took 2.14s
elaboration: tactic execution took 2.22s
elaboration of conj_mul took 2.39s
elaboration: tactic execution took 2s
elaboration of conj_eq_zero took 2.13s
elaboration: tactic execution took 1.32s
elaboration of norm_sq_of_real took 1.45s
elaboration: tactic execution took 1.23s
elaboration of norm_sq_zero took 1.35s
elaboration of norm_sq_one took 1.4s
elaboration: tactic execution took 1.24s
elaboration of norm_sq_I took 1.35s
elaboration: tactic execution took 1.19s
elaboration of norm_sq_pos took 1.27s
elaboration: tactic execution took 1.27s
elaboration of norm_sq_neg took 1.37s
elaboration: tactic execution took 1.23s
elaboration of norm_sq_conj took 1.34s
elaboration: tactic execution took 1.49s
elaboration of norm_sq_mul took 1.6s
elaboration: tactic execution took 1.13s
elaboration of norm_sq_add took 1.22s
elaboration of add_conj took 1.14s
elaboration: tactic execution took 1.17s
elaboration of mul_conj took 1.29s
elaboration: tactic execution took 2.3s
elaboration of comm_ring took 3.35s
elaboration of inv_im took 1.06s
elaboration of inv_re took 1.09s
elaboration: tactic execution took 1.05s
elaboration of sub_conj took 1.14s
elaboration: tactic execution took 1.04s
elaboration of norm_sq_sub took 1.13s
elaboration: tactic execution took 1.29s
elaboration: tactic execution took 1.01s
elaboration of of_real_inv took 1.71s
elaboration of conj_inv took 1.54s
elaboration: tactic execution took 1.3s
elaboration of norm_sq_inv took 1.51s
elaboration: tactic execution took 1.36s
elaboration of of_real_int_cast took 1.9s
elaboration of abs_of_real took 1.01s
elaboration of re_eq_add_conj took 1.06s
elaboration: tactic execution took 1.22s
elaboration of of_real_rat_cast took 1.32s
elaboration of abs_conj took 1.04s
elaboration: tactic execution took 1.05s
elaboration of abs_add took 1.18s
elaboration: tactic execution took 1.02s
elaboration of abs_le_abs_re_add_abs_im took 1.11s
elaboration: tactic execution took 1.1s
elaboration of is_cau_seq_re took 1.24s
elaboration: tactic execution took 1.1s
elaboration of is_cau_seq_im took 1.27s
elaboration: tactic execution took 1.02s
elaboration of equiv_lim took 1.44s
</pre></div>

<a name="134688766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688766" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688766">Kenny Lau (Sep 26 2018 at 16:58)</a>:</h4>
<p>that's <code>grep /\d+(\.\d+)?s/</code></p>

<a name="134688816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688816" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688816">Kenny Lau (Sep 26 2018 at 16:58)</a>:</h4>
<p>(I know, I should have done <code>grep /\d+s/</code></p>

<a name="134688835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688835" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688835">Kenny Lau (Sep 26 2018 at 16:58)</a>:</h4>
<p>also, 47 usages of <code>simp</code></p>

<a name="134688842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688842">Kenny Lau (Sep 26 2018 at 16:59)</a>:</h4>
<p>that's <code>/^simp|^.simp|[^@].simp/</code> because VScode doesn't have lookbehind</p>

<a name="134688935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134688935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134688935">Kenny Lau (Sep 26 2018 at 17:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> what do you think?</p>

<a name="134689238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134689238" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134689238">Mario Carneiro (Sep 26 2018 at 17:05)</a>:</h4>
<p>Here are the top 30 files on the second list that take more than 100 seconds:</p>
<div class="codehilite"><pre><span></span>data/complex/basic.lean                   0.008525  104.10
data/finset.lean                          0.006419  359.15
order/conditionally_complete_lattice.lean 0.005851  152.78
data/polynomial.lean                      0.004392  213.90
data/finsupp.lean                         0.003828  121.20
group_theory/perm.lean                    0.003750  101.33
set_theory/ordinal.lean                   0.003531  397.60
linear_algebra/basic.lean                 0.003494  123.04
analysis/topology/topological_space.lean  0.002850  161.68
</pre></div>


<p>I suggest focusing on these</p>

<a name="134689380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134689380" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134689380">Kenny Lau (Sep 26 2018 at 17:07)</a>:</h4>
<p>ok</p>

<a name="134689383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134689383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134689383">Mario Carneiro (Sep 26 2018 at 17:07)</a>:</h4>
<p>if you can decrease the compile times of all of these by half that will take 15 minutes off the total compile time, or 30%</p>

<a name="134690262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134690262" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134690262">Chris Hughes (Sep 26 2018 at 17:24)</a>:</h4>
<p>A ton of lemmas in <code>complex.basic</code> are <code>rfl</code>, but were proved with <code>simp</code></p>

<a name="134692162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134692162" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134692162">Chris Hughes (Sep 26 2018 at 17:56)</a>:</h4>
<blockquote>
<p>A ton of lemmas in <code>complex.basic</code> are <code>rfl</code>, but were proved with <code>simp</code></p>
</blockquote>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> I just pushed some improvements to <code>complex.basic</code></p>

<a name="134692189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134692189" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134692189">Kenny Lau (Sep 26 2018 at 17:57)</a>:</h4>
<p>thanks!</p>

<a name="134841829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134841829" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134841829">Kenny Lau (Sep 28 2018 at 18:08)</a>:</h4>
<p>before:</p>
<div class="codehilite"><pre><span></span>data/finset.lean
cumulative profiling times:
    compilation 138ms
    decl post-processing 178ms
    elaboration 173s
    elaboration: tactic compilation 1.83s
    elaboration: tactic execution 182s
    parsing 2.32s
    type checking 125ms
</pre></div>


<p>after:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
        compilation 85.2ms
        decl post-processing 130ms
        elaboration 10.2s
        elaboration: tactic compilation 1.06s
        elaboration: tactic execution 4.98s
        parsing 1.48s
        type checking 90ms
</pre></div>

<a name="134841841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134841841" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134841841">Kenny Lau (Sep 28 2018 at 18:08)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> that's way more than a 70% reduction :P</p>

<a name="134841994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134841994" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134841994">Bryan Gin-ge Chen (Sep 28 2018 at 18:11)</a>:</h4>
<p>That's awesome! Since I've been working almost exclusively with finset recently, I hope this gets in soon!</p>

<a name="134844724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134844724" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134844724">Kevin Buzzard (Sep 28 2018 at 19:01)</a>:</h4>
<p>Very impressive Kenny. Is this all changing <code>simp</code> to <code>simp only</code>?</p>

<a name="134847149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134847149" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134847149">Simon Hudon (Sep 28 2018 at 19:45)</a>:</h4>
<p>I'm going start an experiment to see if my idea for <code>squeeze_simp</code> is worthwhile. Is anybody else working on optimizing <code>conditionally_complete_lattice.lean</code>?</p>

<a name="134850447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134850447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134850447">Kenny Lau (Sep 28 2018 at 20:44)</a>:</h4>
<p>I'm going to work on <code>ordinal.lean</code> now</p>

<a name="134869784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134869784" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134869784">Johan Commelin (Sep 29 2018 at 05:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> How much improvement did <code>squeeze_simp</code> give in your experiment? Does it approach the magical 70%?</p>

<a name="134871081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134871081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134871081">Simon Hudon (Sep 29 2018 at 06:44)</a>:</h4>
<p>Yes, the file initially took 35s process, then, I used <code>squeeze_simp</code> and it went down to 11s.</p>

<a name="134873374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873374">Kenny Lau (Sep 29 2018 at 08:06)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">mul_le_of_limit</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ordinal</span><span class="bp">.</span><span class="o">{</span><span class="n">u</span><span class="o">}}</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">is_limit</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">↔</span> <span class="bp">∀</span> <span class="n">b&#39;</span> <span class="bp">&lt;</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">b&#39;</span> <span class="bp">≤</span> <span class="n">c</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">h</span> <span class="n">b&#39;</span> <span class="n">l</span><span class="o">,</span> <span class="n">le_trans</span> <span class="o">(</span><span class="n">mul_le_mul_left</span> <span class="bp">_</span> <span class="o">(</span><span class="n">le_of_lt</span> <span class="n">l</span><span class="o">))</span> <span class="n">h</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">H</span><span class="o">,</span> <span class="n">le_of_not_lt</span> <span class="err">$</span>
<span class="n">induction_on</span> <span class="n">a</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">α</span> <span class="n">r</span> <span class="bp">_</span><span class="o">,</span> <span class="n">induction_on</span> <span class="n">b</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">β</span> <span class="n">s</span> <span class="bp">_</span> <span class="n">h</span> <span class="n">H</span> <span class="n">l</span><span class="o">,</span> <span class="k">begin</span>
<span class="n">try_for</span> <span class="mi">300</span> <span class="o">{</span>
  <span class="n">resetI</span><span class="o">,</span>
  <span class="n">suffices</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">prod</span><span class="bp">.</span><span class="n">lex</span> <span class="n">s</span> <span class="n">r</span> <span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">enum</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">l</span><span class="o">),</span>
  <span class="o">{</span> <span class="n">cases</span> <span class="n">enum</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">l</span> <span class="k">with</span> <span class="n">b</span> <span class="n">a</span><span class="o">,</span> <span class="n">exact</span> <span class="n">irrefl</span> <span class="bp">_</span> <span class="o">(</span><span class="n">this</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span> <span class="o">},</span>
  <span class="n">intros</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span>
  <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">typein_lt_typein</span> <span class="o">(</span><span class="n">prod</span><span class="bp">.</span><span class="n">lex</span> <span class="n">s</span> <span class="n">r</span><span class="o">),</span> <span class="n">typein_enum</span><span class="o">],</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">H</span> <span class="bp">_</span> <span class="o">(</span><span class="n">h</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">_</span> <span class="o">(</span><span class="n">typein_lt_type</span> <span class="n">s</span> <span class="n">b</span><span class="o">)),</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">mul_succ</span><span class="o">]</span> <span class="n">at</span> <span class="n">this</span><span class="o">,</span>
  <span class="k">have</span> <span class="o">:=</span> <span class="n">lt_of_lt_of_le</span> <span class="o">((</span><span class="n">add_lt_add_iff_left</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>
    <span class="o">(</span><span class="n">typein_lt_type</span> <span class="bp">_</span> <span class="n">a</span><span class="o">))</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">refine</span> <span class="n">lt_of_le_of_lt</span> <span class="bp">_</span> <span class="n">this</span><span class="o">,</span>
  <span class="n">refine</span> <span class="o">(</span><span class="n">type_le&#39;</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">_</span><span class="o">),</span>
  <span class="n">constructor</span><span class="o">,</span>
<span class="o">},</span> <span class="n">try_for</span> <span class="mi">800</span> <span class="o">{</span>
  <span class="n">refine</span> <span class="n">order_embedding</span><span class="bp">.</span><span class="n">of_monotone</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="bp">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="bp">_</span><span class="o">),</span>
<span class="o">},</span>

<span class="c">/-</span><span class="cm">  { rcases a with ⟨⟨b&#39;, a&#39;⟩, h⟩,</span>
<span class="cm">    by_cases e : b = b&#39;,</span>
<span class="cm">    { refine sum.inr ⟨a&#39;, _⟩,</span>
<span class="cm">      subst e, cases h with _ _ _ _ h _ _ _ h,</span>
<span class="cm">      { exact (irrefl _ h).elim },</span>
<span class="cm">      { exact h } },</span>
<span class="cm">    { refine sum.inl (⟨b&#39;, _⟩, a&#39;),</span>
<span class="cm">      cases h with _ _ _ _ h _ _ _ h,</span>
<span class="cm">      { exact h }, { exact (e rfl).elim } } },</span>
<span class="cm">  { rcases a with ⟨⟨b₁, a₁⟩, h₁⟩,</span>
<span class="cm">    rcases b with ⟨⟨b₂, a₂⟩, h₂⟩,</span>
<span class="cm">    intro h, by_cases e₁ : b = b₁; by_cases e₂ : b = b₂,</span>
<span class="cm">    { substs b₁ b₂, simpa only [subrel_val, prod.lex_def, @irrefl _ s _ b, true_and, false_or, eq_self_iff_true, dif_pos, sum.lex_inr_inr] using h },</span>
<span class="cm">    { subst b₁, simp only [subrel_val, prod.lex_def, e₂, prod.lex_def, dif_pos, subrel_val, eq_self_iff_true, or_false, dif_neg, not_false_iff, sum.lex_inr_inl, false_and] at h ⊢,</span>
<span class="cm">      cases h₂; [exact asymm h h₂_h, exact e₂ rfl] },</span>
<span class="cm">    { squeeze_simp [e₁, e₂, dif_pos, eq_self_iff_true, dif_neg, not_false_iff, sum.lex.sep] },</span>
<span class="cm">    { simpa only [dif_neg e₁, dif_neg e₂, prod.lex_def, subrel_val, subtype.mk_eq_mk, sum.lex_inl_inl] using h } }-/</span>
<span class="kn">end</span><span class="o">)</span> <span class="n">h</span> <span class="n">H</span><span class="bp">⟩</span>
</pre></div>

<a name="134873377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873377" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873377">Kenny Lau (Sep 29 2018 at 08:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> this is your file</p>

<a name="134873382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873382" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873382">Kenny Lau (Sep 29 2018 at 08:07)</a>:</h4>
<p>I don't know what to do with this</p>

<a name="134873432"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873432" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873432">Mario Carneiro (Sep 29 2018 at 08:09)</a>:</h4>
<p>what's the question?</p>

<a name="134873433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873433" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873433">Kenny Lau (Sep 29 2018 at 08:09)</a>:</h4>
<p>that one line takes 800 ms</p>

<a name="134873435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873435" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873435">Kenny Lau (Sep 29 2018 at 08:09)</a>:</h4>
<p>not to mention the lines afterwards</p>

<a name="134873436"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873436" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873436">Kenny Lau (Sep 29 2018 at 08:09)</a>:</h4>
<p>somehow <code>order_embedding.of_monotone</code> is an expensive definition</p>

<a name="134873437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873437" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873437">Kenny Lau (Sep 29 2018 at 08:09)</a>:</h4>
<p>(it isn't a thoerem)</p>

<a name="134873478"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873478" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873478">Kenny Lau (Sep 29 2018 at 08:10)</a>:</h4>
<p>how can I make it faster?</p>

<a name="134873494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873494">Mario Carneiro (Sep 29 2018 at 08:11)</a>:</h4>
<p>I will let you know when my lean catches up to that definition :P</p>

<a name="134873495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873495" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873495">Mario Carneiro (Sep 29 2018 at 08:11)</a>:</h4>
<p>if only it compiled faster...</p>

<a name="134873534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873534" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873534">Kenny Lau (Sep 29 2018 at 08:12)</a>:</h4>
<p>right, ironic</p>

<a name="134873545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873545" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873545">Kenny Lau (Sep 29 2018 at 08:12)</a>:</h4>
<p>I wonder if anyone is working on it</p>

<a name="134873548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873548" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873548">Mario Carneiro (Sep 29 2018 at 08:12)</a>:</h4>
<p>Anyway, you can always skip it and return later</p>

<a name="134873556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873556" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873556">Kenny Lau (Sep 29 2018 at 08:13)</a>:</h4>
<p>right</p>

<a name="134873558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873558" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873558">Mario Carneiro (Sep 29 2018 at 08:13)</a>:</h4>
<p>I doubt anyone is working on <code>ordinal</code> other than you right now</p>

<a name="134873941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134873941" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134873941">Johan Commelin (Sep 29 2018 at 08:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Any chance you can register the hole command? After that we could easily distribute the work to everyone who has a couple of spare minutes.</p>

<a name="134874557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134874557" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134874557">Simon Hudon (Sep 29 2018 at 08:46)</a>:</h4>
<p>The hole command is not trivial to build because I have to come up with a syntax for the expression found in the hole. It has to allow the encoding of information such as <code>simp! [h0,h1] with attr at *</code>. I'm going to postpone that until I have a better idea on how to do it. In the mean time, if you have <code>simp! [h0,h1] with attr at *</code>, simply replace it with <code>squeeze_simp! [h0,h1] with attr at *</code> and it will print out a replacement that you simply have to copy and paste. That same also works for <code>simpa</code></p>

<a name="134874570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134874570" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134874570">Johan Commelin (Sep 29 2018 at 08:47)</a>:</h4>
<p>Ok, cool!</p>

<a name="134874575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134874575" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134874575">Johan Commelin (Sep 29 2018 at 08:47)</a>:</h4>
<p>Thanks a lot for this.</p>

<a name="134874583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134874583" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134874583">Simon Hudon (Sep 29 2018 at 08:48)</a>:</h4>
<p><span class="emoji emoji-1f44d" title="+1">:+1:</span></p>

<a name="134874623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134874623" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134874623">Simon Hudon (Sep 29 2018 at 08:48)</a>:</h4>
<p>Now I should really get some sleep :) Best of luck</p>

<a name="134874839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134874839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134874839">Johan Commelin (Sep 29 2018 at 08:55)</a>:</h4>
<p>Sleep tight <span class="emoji emoji-1f6cc" title="in bed">:in_bed:</span></p>

<a name="134875338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134875338" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134875338">Johan Commelin (Sep 29 2018 at 09:10)</a>:</h4>
<p>Hmm, I have proofs where <code>by simp</code> works, but <code>by squeeze_simp</code> fails. E.g., line 157 of <code>order/filter.lean</code>.</p>

<a name="134889142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134889142" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134889142">Johan Commelin (Sep 29 2018 at 17:05)</a>:</h4>
<p>I <code>squeeze_simp</code>ed <code>order/filter.lean</code>. I didn't time carefully but I think I got the compile time down to maybe 25s.</p>

<a name="134893202"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134893202" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134893202">Kenny Lau (Sep 29 2018 at 19:24)</a>:</h4>
<blockquote>
<p>I <code>squeeze_simp</code>ed <code>order/filter.lean</code>. I didn't time carefully but I think I got the compile time down to maybe 25s.</p>
</blockquote>
<p>from what?</p>

<a name="134893462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134893462" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134893462">Johan Commelin (Sep 29 2018 at 19:34)</a>:</h4>
<p>I think your gist said something like 150s</p>

<a name="134893465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134893465" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134893465">Johan Commelin (Sep 29 2018 at 19:34)</a>:</h4>
<p>But I don't have good tools to time an entire file</p>

<a name="134893468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134893468" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134893468">Johan Commelin (Sep 29 2018 at 19:34)</a>:</h4>
<p>I did see pretty nice speed-ups from some of the substitutions</p>

<a name="134893517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134893517" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134893517">Kenny Lau (Sep 29 2018 at 19:36)</a>:</h4>
<p>the time on my gist is relative to me and my computer</p>

<a name="134893916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134893916" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134893916">Simon Hudon (Sep 29 2018 at 19:52)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> In emacs at least, there's a <code>lean-std-exe</code> command. It will compile the current file, tell you the time at which it starts and the time at which it ends.</p>

<a name="134894297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134894297" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134894297">Kenny Lau (Sep 29 2018 at 20:04)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">add_le_add_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ordinal</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">c</span><span class="o">,</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span> <span class="o">:=</span>
<span class="n">induction_on</span> <span class="n">a</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">α₁</span> <span class="n">r₁</span> <span class="bp">_</span><span class="o">,</span> <span class="n">induction_on</span> <span class="n">b</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">α₂</span> <span class="n">r₂</span> <span class="bp">_</span> <span class="bp">⟨⟨⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">fo</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">fi</span><span class="bp">⟩⟩</span> <span class="n">c</span><span class="o">,</span>
<span class="n">induction_on</span> <span class="n">c</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">β</span> <span class="n">s</span> <span class="bp">_</span><span class="o">,</span>
<span class="bp">⟨⟨⟨</span><span class="o">(</span><span class="n">embedding</span><span class="bp">.</span><span class="n">refl</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">sum_congr</span> <span class="n">f</span><span class="o">,</span>
  <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="k">begin</span> <span class="n">try_for</span> <span class="mi">200</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">a</span> <span class="k">with</span> <span class="n">a</span> <span class="n">a</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">b</span> <span class="k">with</span> <span class="n">b</span> <span class="n">b</span><span class="bp">;</span>
    <span class="n">split</span><span class="bp">;</span> <span class="n">intro</span> <span class="n">H</span><span class="bp">;</span> <span class="n">cases</span> <span class="n">H</span> <span class="k">with</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">H</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">H</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">H</span><span class="bp">;</span> <span class="n">constructor</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span> <span class="o">{</span> <span class="n">assumption</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">fo</span><span class="o">,</span> <span class="n">assumption</span> <span class="o">},</span> <span class="o">{</span> <span class="n">rw</span> <span class="n">fo</span><span class="o">,</span> <span class="n">assumption</span> <span class="o">}</span> <span class="o">}</span>
  <span class="kn">end</span><span class="bp">⟩</span><span class="o">,</span>
  <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">H</span><span class="o">,</span> <span class="k">begin</span> <span class="n">try_for</span> <span class="mi">200</span> <span class="o">{</span> <span class="n">cases</span> <span class="n">b</span> <span class="k">with</span> <span class="n">b</span> <span class="n">b</span><span class="o">,</span> <span class="o">{</span> <span class="n">exact</span> <span class="bp">⟨</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="n">b</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span> <span class="o">},</span>
    <span class="n">cases</span> <span class="n">a</span> <span class="k">with</span> <span class="n">a</span> <span class="n">a</span><span class="o">,</span> <span class="o">{</span><span class="n">cases</span> <span class="n">H</span><span class="o">},</span>
    <span class="n">cases</span> <span class="n">fi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inr</span><span class="bp">.</span><span class="mi">1</span> <span class="n">H</span><span class="o">)</span> <span class="k">with</span> <span class="n">w</span> <span class="n">h</span><span class="o">,</span> <span class="n">exact</span> <span class="bp">⟨</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">w</span><span class="o">,</span> <span class="n">congr_arg</span> <span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">h</span><span class="bp">⟩</span> <span class="o">}</span>
  <span class="kn">end</span><span class="bp">⟩⟩</span>
</pre></div>

<a name="134894298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134894298" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134894298">Kenny Lau (Sep 29 2018 at 20:04)</a>:</h4>
<p>I'm at a bit of a loss here</p>

<a name="134894299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134894299" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134894299">Kenny Lau (Sep 29 2018 at 20:04)</a>:</h4>
<p>both blocks take &lt; 200 ms</p>

<a name="134894303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134894303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134894303">Kenny Lau (Sep 29 2018 at 20:05)</a>:</h4>
<p>but the whole thing takes 5 s</p>

<a name="134894935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134894935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134894935">Chris Hughes (Sep 29 2018 at 20:25)</a>:</h4>
<p>Presumably some elaboration is taking ages then? Computing lots of motives.</p>

<a name="134894939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134894939" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134894939">Kenny Lau (Sep 29 2018 at 20:25)</a>:</h4>
<p>i'm trying to convert it to term mode</p>

<a name="134895382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895382" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895382">Kenny Lau (Sep 29 2018 at 20:37)</a>:</h4>
<p>solved using term mode</p>

<a name="134895383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895383">Kenny Lau (Sep 29 2018 at 20:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">add_le_add_left</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ordinal</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">→</span> <span class="bp">∀</span> <span class="n">c</span><span class="o">,</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">+</span> <span class="n">b</span> <span class="o">:=</span>
<span class="n">induction_on</span> <span class="n">a</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">α₁</span> <span class="n">r₁</span> <span class="bp">_</span><span class="o">,</span> <span class="n">induction_on</span> <span class="n">b</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">α₂</span> <span class="n">r₂</span> <span class="bp">_</span> <span class="bp">⟨⟨⟨</span><span class="n">f</span><span class="o">,</span> <span class="n">fo</span><span class="bp">⟩</span><span class="o">,</span> <span class="n">fi</span><span class="bp">⟩⟩</span> <span class="n">c</span><span class="o">,</span>
<span class="n">induction_on</span> <span class="n">c</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">β</span> <span class="n">s</span> <span class="bp">_</span><span class="o">,</span>
<span class="bp">⟨⟨⟨</span><span class="o">(</span><span class="n">embedding</span><span class="bp">.</span><span class="n">refl</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">sum_congr</span> <span class="n">f</span><span class="o">,</span>
  <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="bp">⟨λ</span> <span class="n">H</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">H</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inl_inl</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">h</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inr</span><span class="bp">.</span><span class="mi">2</span> <span class="err">$</span> <span class="n">fo</span><span class="bp">.</span><span class="mi">1</span> <span class="n">h</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex</span><span class="bp">.</span><span class="n">sep</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">),</span>
    <span class="n">sum</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">a</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">b</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inl_inl</span><span class="bp">.</span><span class="mi">2</span> <span class="err">∘</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inl_inl</span><span class="bp">.</span><span class="mi">1</span><span class="o">)</span>
        <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex</span><span class="bp">.</span><span class="n">sep</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">))</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">b</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">false</span><span class="bp">.</span><span class="n">elim</span> <span class="err">∘</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inl</span><span class="o">)</span>
        <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inr</span><span class="bp">.</span><span class="mi">2</span> <span class="err">∘</span> <span class="n">fo</span><span class="bp">.</span><span class="mi">2</span> <span class="err">∘</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inr</span><span class="bp">.</span><span class="mi">1</span><span class="o">))</span><span class="bp">⟩⟩</span><span class="o">,</span>
  <span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">b</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="bp">⟨</span><span class="n">sum</span><span class="bp">.</span><span class="n">inl</span> <span class="bp">_</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span><span class="o">)</span>
    <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum</span><span class="bp">.</span><span class="n">rec_on</span> <span class="n">a</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">false</span><span class="bp">.</span><span class="n">elim</span> <span class="err">∘</span> <span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inl</span><span class="o">)</span>
      <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">H</span><span class="o">,</span> <span class="k">let</span> <span class="bp">⟨</span><span class="n">w</span><span class="o">,</span> <span class="n">h</span><span class="bp">⟩</span> <span class="o">:=</span> <span class="n">fi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="o">(</span><span class="n">sum</span><span class="bp">.</span><span class="n">lex_inr_inr</span><span class="bp">.</span><span class="mi">1</span> <span class="n">H</span><span class="o">)</span> <span class="k">in</span>
        <span class="bp">⟨</span><span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">w</span><span class="o">,</span> <span class="n">congr_arg</span> <span class="n">sum</span><span class="bp">.</span><span class="n">inr</span> <span class="n">h</span><span class="bp">⟩</span><span class="o">))</span><span class="bp">⟩⟩</span>
</pre></div>

<a name="134895385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895385" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895385">Kenny Lau (Sep 29 2018 at 20:37)</a>:</h4>
<p>&lt; 500 ms</p>

<a name="134895440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895440" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895440">Patrick Massot (Sep 29 2018 at 20:38)</a>:</h4>
<p>Is this copy and pasting the proof term built by tactic mode?</p>

<a name="134895441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895441" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895441">Kenny Lau (Sep 29 2018 at 20:38)</a>:</h4>
<p>hardly</p>

<a name="134895442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895442" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895442">Kenny Lau (Sep 29 2018 at 20:38)</a>:</h4>
<p>I built the proof myself</p>

<a name="134895494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134895494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134895494">Reid Barton (Sep 29 2018 at 20:40)</a>:</h4>
<p>hand-crafted artisanal proofs</p>

<a name="134898707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134898707" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134898707">Kenny Lau (Sep 29 2018 at 22:43)</a>:</h4>
<p>set_theory/ordinal.lean<br>
before:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
    compilation 75.5ms
    decl post-processing 255ms
    elaboration 208s
    elaboration: tactic compilation 3.75s
    elaboration: tactic execution 179s
    parsing 6.85s
    type checking 155ms
</pre></div>


<p>after:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
        compilation 81.1ms
        decl post-processing 286ms
        elaboration 39.8s
        elaboration: tactic compilation 3.67s
        elaboration: tactic execution 16.9s
        parsing 6.22s
        type checking 165ms
</pre></div>

<a name="134898752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134898752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134898752">Kenny Lau (Sep 29 2018 at 22:44)</a>:</h4>
<p>I really wish Mario could help me speed up this file</p>

<a name="134898756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134898756" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134898756">Kenny Lau (Sep 29 2018 at 22:44)</a>:</h4>
<p>there are some parts that I can't speed up</p>

<a name="134898873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134898873" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134898873">Kenny Lau (Sep 29 2018 at 22:48)</a>:</h4>
<p>also, which one of the number is (closest to) the actual build time?</p>

<a name="134899347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134899347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134899347">Kevin Buzzard (Sep 29 2018 at 23:06)</a>:</h4>
<blockquote>
<p>also, which one of the number is (closest to) the actual build time?</p>
</blockquote>
<p>The largest one.</p>

<a name="134900435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134900435" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134900435">Kevin Buzzard (Sep 29 2018 at 23:47)</a>:</h4>
<blockquote>
<p>I really wish Mario could help me speed up this file</p>
</blockquote>
<p>He's busy with modules, leave him be ;-)</p>

<a name="134900438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134900438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134900438">Kevin Buzzard (Sep 29 2018 at 23:47)</a>:</h4>
<p>After he does modules you can do algebraic closure remember!</p>

<a name="134901088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134901088" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134901088">Mario Carneiro (Sep 30 2018 at 00:13)</a>:</h4>
<blockquote>
<p>i'm trying to convert it to term mode</p>
</blockquote>
<p>Is there a particular reason you are doing this? I don't think that converting to term mode is necessarily an improvement; in particular some tactics like <code>rw</code> and <code>induction</code> can actually be faster than their term mode equivalents because they can fill in the motives in a straightforward way while the elaborator has to deal with other stuff at the same time that can confound the issue</p>

<a name="134901127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134901127" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134901127">Mario Carneiro (Sep 30 2018 at 00:14)</a>:</h4>
<p>Do you have evidence that a tactic proof that, say, does <code>refine refine rw cases exact</code> is faster than its term mode equivalent?</p>

<a name="134901227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134901227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134901227">Mario Carneiro (Sep 30 2018 at 00:18)</a>:</h4>
<p>In particular, if an elaboration is slow, I find that converting to a sequence of <code>refine</code>s often speeds it up, or at least narrows the problem down to a particular term that should be written a different way</p>

<a name="134906074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906074">Kenny Lau (Sep 30 2018 at 03:12)</a>:</h4>
<p>no I'm not converting every proof to term mode.</p>

<a name="134906076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906076" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906076">Kenny Lau (Sep 30 2018 at 03:12)</a>:</h4>
<p>I'm converting that particular proof to term mode and it turns out that the speed improved a lot.</p>

<a name="134906078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906078" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906078">Kenny Lau (Sep 30 2018 at 03:12)</a>:</h4>
<p>I'm not making a general claim.</p>

<a name="134906086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906086" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906086">Kenny Lau (Sep 30 2018 at 03:13)</a>:</h4>
<p>(although in my experience, pure term mode proofs do compile much faster)</p>

<a name="134906088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906088" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906088">Kenny Lau (Sep 30 2018 at 03:13)</a>:</h4>
<p>I can give you the statistics for that particular theorem if you want.</p>

<a name="134906137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906137" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906137">Kenny Lau (Sep 30 2018 at 03:14)</a>:</h4>
<p>it's not necessarily an improvement but in this case it is.</p>

<a name="134906248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906248" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906248">Mario Carneiro (Sep 30 2018 at 03:18)</a>:</h4>
<p>In this case I would probably take your term proof and reintroduce tactics to recover some of the original structure, while keeping an eye on the compile time and preventing it from growing again</p>

<a name="134906366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134906366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134906366">Kenny Lau (Sep 30 2018 at 03:22)</a>:</h4>
<p>fair enough.</p>

<a name="134911308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911308" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911308">Kenny Lau (Sep 30 2018 at 06:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Am I allowed to remove <code>exactI / resetI / letI</code> and use <code>@</code> to provide the typeclass instances whenever doing so would produce a significant speed boost?</p>

<a name="134911324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911324" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911324">Mario Carneiro (Sep 30 2018 at 06:27)</a>:</h4>
<p>oof, I really hope that's a last resort</p>

<a name="134911365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911365" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911365">Mario Carneiro (Sep 30 2018 at 06:28)</a>:</h4>
<p>I don't think it matters whether <code>exactI</code> is used or not, sometimes typeclass inference is slow</p>

<a name="134911366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911366">Mario Carneiro (Sep 30 2018 at 06:28)</a>:</h4>
<p>It is possible that with better hints you can shortcut the search</p>

<a name="134911416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911416">Kenny Lau (Sep 30 2018 at 06:31)</a>:</h4>
<p>well without exactI I can tell which typeclasses Lean is struggling to infer</p>

<a name="134911424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911424">Kenny Lau (Sep 30 2018 at 06:31)</a>:</h4>
<p>and I can provide it explicitly to save Lean's time</p>

<a name="134911468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911468" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911468">Mario Carneiro (Sep 30 2018 at 06:32)</a>:</h4>
<p>I would try to use limited typeclass inference, i.e. write the hard part of the term and have lean figure out the rest</p>

<a name="134911521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911521" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911521">Mario Carneiro (Sep 30 2018 at 06:34)</a>:</h4>
<p>But explicit typeclass parameters are a big loss in readability, especially if you have to say things more than once, so I would try <em>really</em> hard to avoid it</p>

<a name="134911522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911522" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911522">Kenny Lau (Sep 30 2018 at 06:34)</a>:</h4>
<p>I understand</p>

<a name="134911834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911834" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911834">Kenny Lau (Sep 30 2018 at 06:46)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">set_theory</span><span class="bp">.</span><span class="n">ordinal</span>

<span class="kn">universe</span> <span class="n">u</span>

<span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">class_instances</span> <span class="n">true</span>
<span class="bp">#</span><span class="kn">check</span>
<span class="bp">λ</span> <span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">r</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">hr</span> <span class="o">:</span> <span class="n">is_well_order</span> <span class="n">α</span> <span class="n">r</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">s</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">hs</span> <span class="o">:</span> <span class="n">is_well_order</span> <span class="n">β</span> <span class="n">s</span><span class="o">,</span>
<span class="bp">λ</span> <span class="n">x</span> <span class="o">:</span> <span class="n">β</span><span class="o">,</span> <span class="o">(</span><span class="k">by</span> <span class="n">apply_instance</span> <span class="o">:</span> <span class="n">is_asymm</span> <span class="o">(</span><span class="n">α</span> <span class="err">⊕</span> <span class="err">↥</span><span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">|</span> <span class="n">s</span> <span class="n">b</span> <span class="n">x</span><span class="o">})</span> <span class="o">(</span><span class="bp">@</span><span class="n">sum</span><span class="bp">.</span><span class="n">lex</span> <span class="n">α</span> <span class="err">↥</span><span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">|</span> <span class="n">s</span> <span class="n">b</span> <span class="n">x</span><span class="o">}</span> <span class="n">r</span> <span class="o">(</span><span class="bp">@</span><span class="n">subrel</span> <span class="n">β</span> <span class="n">s</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span> <span class="bp">|</span> <span class="n">s</span> <span class="n">b</span> <span class="n">x</span><span class="o">})))</span>
</pre></div>

<a name="134911839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911839" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911839">Kenny Lau (Sep 30 2018 at 06:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> how to shorten the path for class instance?</p>

<a name="134911953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911953">Mario Carneiro (Sep 30 2018 at 06:51)</a>:</h4>
<p>it is much faster if I use <code>is_asymm_of_is_trans_of_is_irrefl</code> instead of <code>by apply_instance</code></p>

<a name="134911994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134911994" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134911994">Mario Carneiro (Sep 30 2018 at 06:52)</a>:</h4>
<p>alternatively, prove and use <code>is_asymm_of_is_well_order</code></p>

<a name="134912045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134912045" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134912045">Kenny Lau (Sep 30 2018 at 06:54)</a>:</h4>
<p>well I'm not allowed to add / delete any theorem :P</p>

<a name="134912452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134912452" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134912452">Kenny Lau (Sep 30 2018 at 07:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Could you have a look at <a href="https://github.com/leanprover-community/mathlib/blob/a58bdb5ab50a3cb2d60e89b326e4f4d7afbf6b05/set_theory/ordinal.lean" target="_blank" title="https://github.com/leanprover-community/mathlib/blob/a58bdb5ab50a3cb2d60e89b326e4f4d7afbf6b05/set_theory/ordinal.lean">the 3 theorems I marked with <code>try_for</code></a>?</p>

<a name="134929631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134929631" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134929631">Kenny Lau (Sep 30 2018 at 17:25)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">forall₂_nil_left_iff</span> <span class="o">{</span><span class="n">l</span><span class="o">}</span> <span class="o">:</span> <span class="n">forall₂</span> <span class="n">r</span> <span class="n">nil</span> <span class="n">l</span> <span class="bp">↔</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">nil</span> <span class="o">:=</span>
<span class="k">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">forall₂_iff</span><span class="o">]</span><span class="bp">;</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">eq_self_iff_true</span><span class="o">,</span> <span class="n">true_and</span><span class="o">,</span> <span class="n">false_and</span><span class="o">,</span> <span class="n">and_false</span><span class="o">,</span> <span class="n">exists_false</span><span class="o">,</span> <span class="n">or_false</span><span class="o">]</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">forall₂_nil_left_iff&#39;</span> <span class="o">{</span><span class="n">l</span><span class="o">}</span> <span class="o">:</span> <span class="n">forall₂</span> <span class="n">r</span> <span class="n">nil</span> <span class="n">l</span> <span class="bp">↔</span> <span class="n">l</span> <span class="bp">=</span> <span class="n">nil</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">H</span><span class="o">,</span> <span class="k">by</span> <span class="n">cases</span> <span class="n">H</span><span class="bp">;</span> <span class="n">refl</span><span class="o">,</span> <span class="k">by</span> <span class="n">rintro</span> <span class="n">rfl</span><span class="bp">;</span> <span class="n">constructor</span><span class="bp">⟩</span>
</pre></div>

<a name="134929634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134929634" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134929634">Kenny Lau (Sep 30 2018 at 17:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> which one do you like more? they take the same time</p>

<a name="134929683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134929683" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134929683">Kenny Lau (Sep 30 2018 at 17:27)</a>:</h4>
<p>the original proof was <code>by rw [forall₂_iff]; simp</code> so maybe the first one in order to avoid changing too much</p>

<a name="134929728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134929728" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134929728">Kenny Lau (Sep 30 2018 at 17:28)</a>:</h4>
<p>I would prefer the one below</p>

<a name="134936006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134936006" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134936006">Mario Carneiro (Sep 30 2018 at 21:08)</a>:</h4>
<p>I would prefer the one below, although I would use <code>exact forall2.nil</code> instead of <code>constructor</code> (which has to search through the constructors to apply one)</p>

<a name="134957374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134957374" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134957374">Kenny Lau (Oct 01 2018 at 08:33)</a>:</h4>
<p>before:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
    compilation 85.7ms
    decl post-processing 1.17s
    elaboration 126s
    elaboration: tactic compilation 4.88s
    elaboration: tactic execution 90.9s
    parsing 7.79s
    type checking 145ms
</pre></div>


<p>after:</p>
<div class="codehilite"><pre><span></span>cumulative profiling times:
        compilation 46.9ms
        decl post-processing 159ms
        elaboration 12.5s
        elaboration: tactic compilation 1.58s
        elaboration: tactic execution 918ms
        parsing 5.4s
        type checking 109ms
</pre></div>

<a name="134959164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959164" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959164">Kevin Buzzard (Oct 01 2018 at 09:21)</a>:</h4>
<p>Is this <code>ordinal.lean</code>?</p>

<a name="134959180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959180" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959180">Kevin Buzzard (Oct 01 2018 at 09:21)</a>:</h4>
<p>Mario, is all of this making you rethink your writing style?</p>

<a name="134959310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959310" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959310">Mario Carneiro (Oct 01 2018 at 09:24)</a>:</h4>
<p>I'm worried about kenny's writing style</p>

<a name="134959318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959318" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959318">Mario Carneiro (Oct 01 2018 at 09:24)</a>:</h4>
<p>I don't want to sacrifice readability here if I can at all help it</p>

<a name="134959332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959332" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959332">Mario Carneiro (Oct 01 2018 at 09:25)</a>:</h4>
<p>but these numbers are hard to argue with</p>

<a name="134959355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959355">Mario Carneiro (Oct 01 2018 at 09:25)</a>:</h4>
<p>I think in the future we will need to work a post processing step into the workflow, using things like <code>squeeze_simp</code></p>

<a name="134959415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959415" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959415">Mario Carneiro (Oct 01 2018 at 09:26)</a>:</h4>
<p>But I <em>do not</em> want to be thinking about compile time when I am writing a proof</p>

<a name="134959421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959421" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959421">Mario Carneiro (Oct 01 2018 at 09:26)</a>:</h4>
<p>the mindset is completely different, it is a distraction</p>

<a name="134959496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959496">Johan Commelin (Oct 01 2018 at 09:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> You are talking like a mathematician.</p>

<a name="134959627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/134959627" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#134959627">Kenny Lau (Oct 01 2018 at 09:31)</a>:</h4>
<p>this is data/list/basic.lean</p>

<a name="135070742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135070742" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135070742">Kenny Lau (Oct 02 2018 at 23:32)</a>:</h4>
<div class="codehilite"><pre><span></span>$ /c/lean/bin/lean --profile analysis/topology/topological_space.lean &gt;/dev/null
cumulative profiling times:
        compilation 53.6ms
        decl post-processing 52.3ms
        elaboration 6.15s
        elaboration: tactic compilation 929ms
        elaboration: tactic execution 979ms
        parsing 1.24s
        type checking 35.9ms
</pre></div>

<a name="135070748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135070748" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135070748">Kenny Lau (Oct 02 2018 at 23:33)</a>:</h4>
<p>it was the 7th on my list sorted by time</p>

<a name="135070752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135070752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135070752">Kenny Lau (Oct 02 2018 at 23:33)</a>:</h4>
<p>now it's 6.15 s</p>

<a name="135079880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135079880" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135079880">Johan Commelin (Oct 03 2018 at 04:06)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Do you want to PR <code>faster</code> in one go or in stages?</p>

<a name="135079891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135079891" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135079891">Johan Commelin (Oct 03 2018 at 04:07)</a>:</h4>
<p>What does your profile list look like now?</p>

<a name="135083606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135083606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135083606">Kenny Lau (Oct 03 2018 at 06:09)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852" target="_blank" title="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852">https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852</a></p>

<a name="135085735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135085735" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135085735">Kevin Buzzard (Oct 03 2018 at 07:13)</a>:</h4>
<p>Is it worth PR'ing now? My impression is that Mario will want to check that you didn't do anything he doesn't approve of.</p>

<a name="135086194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135086194" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135086194">Patrick Massot (Oct 03 2018 at 07:24)</a>:</h4>
<p>I see <code>uniform_space</code> may be the next target. You may want to skip that one since Johannes and I are currently working on it (see completions branch in the community fork). Actually part of the file moved to a <code>completion</code> file</p>

<a name="135086353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135086353" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135086353">Kevin Buzzard (Oct 03 2018 at 07:28)</a>:</h4>
<p>That's all the more reason to PR now I guess. Kenny did you see if anyone is working on any files you have already changed? This seems like a difficult task -- there are a million branches in community mathlib.</p>

<a name="135086430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135086430" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135086430">Johan Commelin (Oct 03 2018 at 07:31)</a>:</h4>
<p>The <code>determinants</code> PR is touching like 10 basic files.</p>

<a name="135086437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135086437" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135086437">Johan Commelin (Oct 03 2018 at 07:31)</a>:</h4>
<p>Hopefully git's merging strategies will be smart enough</p>

<a name="135087752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135087752" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135087752">Kenny Lau (Oct 03 2018 at 08:03)</a>:</h4>
<blockquote>
<p>I see <code>uniform_space</code> may be the next target. You may want to skip that one since Johannes and I are currently working on it (see completions branch in the community fork). Actually part of the file moved to a <code>completion</code> file</p>
</blockquote>
<p>ah well I almost finished. I'll deal with the merging issues then.</p>

<a name="135244802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135244802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135244802">Kenny Lau (Oct 05 2018 at 09:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I still haven't finished, but do you want me to PR them (a) one by one when I finish (so you'll have 100 PRs), (b) one by one now (so you'll have 100 PRs distributed across a month), or (c) all in one go (so you'll have 1 big PR)?</p>

<a name="135244846"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135244846" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135244846">Kenny Lau (Oct 05 2018 at 09:42)</a>:</h4>
<p>and 100 is not a hyperbole</p>

<a name="135249251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135249251" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135249251">Johan Commelin (Oct 05 2018 at 11:34)</a>:</h4>
<p>I think we shouldn't have one mega-PR. It will only sit and wait and rot and die a silent death.</p>

<a name="135249258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135249258" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135249258">Johan Commelin (Oct 05 2018 at 11:34)</a>:</h4>
<p>100 PR's on 1 day won't work either.</p>

<a name="135249281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135249281" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135249281">Johan Commelin (Oct 05 2018 at 11:35)</a>:</h4>
<p>So I think it is best to either have 100 small PR's that appear on a continuous basis. Or chunk them into 20 PR's that take 5 files each.<br>
Just my €0.02</p>

<a name="135249828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135249828" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135249828">Sean Leather (Oct 05 2018 at 11:49)</a>:</h4>
<p>One issue that might influence the choice is whether the feedback from early changes will influence later changes. That is, from the reviewer's PoV, one doesn't want to make the same suggestion in large numbers. So to avoid this, you might start with a few small PRs and, as you get feedback, get them merged, and roll the feedback into later PRs, the PRs can either become larger or stay the same size but go through more easily. My R0.02.</p>

<a name="135249991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135249991" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135249991">Johan Commelin (Oct 05 2018 at 11:53)</a>:</h4>
<p>My €0.02 are worth R0.34 <span class="emoji emoji-1f606" title="lol">:lol:</span> <a href="https://duckduckgo.com/?q=0.02EUR+in+ZAR&amp;t=ffab&amp;ia=currency" target="_blank" title="https://duckduckgo.com/?q=0.02EUR+in+ZAR&amp;t=ffab&amp;ia=currency">https://duckduckgo.com/?q=0.02EUR+in+ZAR&amp;t=ffab&amp;ia=currency</a></p>

<a name="135250336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135250336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135250336">Sean Leather (Oct 05 2018 at 12:00)</a>:</h4>
<p>Hmm, I should have given my US$0.02 instead. (<a href="https://ddg.gg/?q=0.02USD+in+EUR" target="_blank" title="https://ddg.gg/?q=0.02USD+in+EUR">€ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.48312em;"></span><span class="strut bottom" style="height:0.48312em;vertical-align:0em;"></span><span class="base"><span class="mrel">≈</span></span></span></span> $!</a>)</p>

<a name="135250366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135250366" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135250366">Sean Leather (Oct 05 2018 at 12:01)</a>:</h4>
<p>Or you could say I'm thrifty...</p>

<a name="135253455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135253455" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135253455">Kenny Lau (Oct 05 2018 at 13:06)</a>:</h4>
<p>ok, I'll PR after this one</p>

<a name="135255097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135255097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135255097">Kenny Lau (Oct 05 2018 at 13:35)</a>:</h4>
<p><code>sum_sum_index</code> and friends™ have poor elaboration and often takes up time</p>

<a name="135255398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135255398" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135255398">Kenny Lau (Oct 05 2018 at 13:40)</a>:</h4>
<p>and it's worse than <code>simp</code> at friends™ because you can't track elaboration</p>

<a name="135255639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135255639" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135255639">Kenny Lau (Oct 05 2018 at 13:45)</a>:</h4>
<p>and I even used <code>calc</code></p>

<a name="135255642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135255642" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135255642">Kenny Lau (Oct 05 2018 at 13:45)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">finsupp</span>

<span class="kn">open</span> <span class="n">finsupp</span>

<span class="kn">variables</span> <span class="o">(</span><span class="n">α</span><span class="o">:</span><span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">β</span><span class="o">:</span><span class="kt">Type</span><span class="bp">*</span><span class="o">)</span> <span class="o">(</span><span class="n">γ</span><span class="o">:</span><span class="kt">Type</span><span class="bp">*</span><span class="o">)</span>

<span class="kn">set_option</span> <span class="n">profiler</span> <span class="n">true</span>
<span class="n">def</span> <span class="n">finsupp_prod_equiv</span> <span class="o">[</span><span class="n">add_comm_monoid</span> <span class="n">γ</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">decidable_eq</span> <span class="n">γ</span><span class="o">]</span> <span class="o">:</span>
  <span class="o">((</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">γ</span><span class="o">)</span> <span class="err">≃</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span><span class="err">₀</span> <span class="o">(</span><span class="n">β</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">γ</span><span class="o">))</span> <span class="o">:=</span>
<span class="bp">⟨</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">curry</span><span class="o">,</span> <span class="n">finsupp</span><span class="bp">.</span><span class="n">uncurry</span><span class="o">,</span>
  <span class="k">assume</span> <span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span> <span class="bp">→</span><span class="err">₀</span> <span class="n">γ</span><span class="o">,</span>
  <span class="k">calc</span>  <span class="o">(</span><span class="n">f</span><span class="bp">.</span><span class="n">sum</span> <span class="err">$</span> <span class="bp">λ</span><span class="n">p</span> <span class="n">c</span><span class="o">,</span> <span class="n">single</span> <span class="n">p</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">single</span> <span class="n">p</span><span class="bp">.</span><span class="mi">2</span> <span class="n">c</span><span class="o">))</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span><span class="n">a</span> <span class="n">g</span><span class="o">,</span> <span class="n">g</span><span class="bp">.</span><span class="n">sum</span> <span class="err">$</span> <span class="bp">λ</span><span class="n">b</span> <span class="n">c</span><span class="o">,</span> <span class="n">single</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span><span class="o">)</span>
      <span class="bp">=</span> <span class="n">f</span><span class="bp">.</span><span class="n">sum</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum</span> <span class="o">(</span><span class="n">single</span> <span class="n">a</span><span class="bp">.</span><span class="mi">1</span> <span class="o">(</span><span class="n">single</span> <span class="n">a</span><span class="bp">.</span><span class="mi">2</span> <span class="n">b</span><span class="o">))</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">g</span><span class="o">,</span> <span class="n">sum</span> <span class="n">g</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span> <span class="n">c</span><span class="o">,</span> <span class="n">single</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span><span class="o">)))</span> <span class="o">:</span>
    <span class="n">sum_sum_index</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum_zero_index</span><span class="o">)</span>
        <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">sum_add_index</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">single_zero</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">,</span> <span class="n">single_add</span><span class="o">))</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">sum</span> <span class="n">f</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum</span> <span class="o">(</span><span class="n">single</span> <span class="n">a</span><span class="bp">.</span><span class="mi">2</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">b</span> <span class="n">c</span><span class="o">,</span> <span class="n">single</span> <span class="o">(</span><span class="n">a</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="n">c</span><span class="o">))</span> <span class="o">:</span>
    <span class="n">congr_arg</span> <span class="o">(</span><span class="n">sum</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum_single_index</span> <span class="n">sum_zero_index</span><span class="o">)</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">sum</span> <span class="n">f</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">b</span><span class="o">,</span> <span class="n">single</span> <span class="o">(</span><span class="n">a</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="n">a</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">congr_arg</span> <span class="o">(</span><span class="n">sum</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">sum_single_index</span> <span class="n">single_zero</span><span class="o">)</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">sum</span> <span class="n">f</span> <span class="n">single</span> <span class="o">:</span>
    <span class="n">congr_arg</span> <span class="o">(</span><span class="n">sum</span> <span class="n">f</span><span class="o">)</span> <span class="o">(</span><span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">funext</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">b</span><span class="o">,</span> <span class="n">congr</span> <span class="o">(</span><span class="n">congr_arg</span> <span class="n">single</span> <span class="n">prod</span><span class="bp">.</span><span class="n">mk</span><span class="bp">.</span><span class="n">eta</span><span class="o">)</span> <span class="n">rfl</span><span class="o">)</span>
  <span class="bp">...</span> <span class="bp">=</span> <span class="n">f</span> <span class="o">:</span> <span class="n">sum_single</span><span class="o">,</span>
  <span class="k">assume</span> <span class="n">f</span><span class="o">,</span> <span class="n">sorry</span> <span class="bp">⟩</span>
</pre></div>

<a name="135255644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135255644" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135255644">Kenny Lau (Oct 05 2018 at 13:45)</a>:</h4>
<p>MWE ^</p>

<a name="135259451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135259451" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135259451">Kenny Lau (Oct 05 2018 at 14:52)</a>:</h4>
<div class="codehilite"><pre><span></span>$ /c/lean/bin/lean --profile data/finsupp.lean &gt;/dev/null
cumulative profiling times:
        compilation 143ms
        decl post-processing 1.9s
        elaboration 7.22s
        elaboration: tactic compilation 548ms
        elaboration: tactic execution 1.79s
        parsing 643ms
        type checking 110ms
</pre></div>

<a name="135259496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135259496" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135259496">Johan Commelin (Oct 05 2018 at 14:53)</a>:</h4>
<p>Hurray!</p>

<a name="135259677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135259677" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135259677">Johan Commelin (Oct 05 2018 at 14:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Will you share the total progress after you PR?</p>

<a name="135259725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135259725" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135259725">Johan Commelin (Oct 05 2018 at 14:56)</a>:</h4>
<p>I know it won't be 70% reduction yet. But I think you took off a massive chunk anyway.</p>

<a name="135260053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135260053" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135260053">Kevin Buzzard (Oct 05 2018 at 15:01)</a>:</h4>
<p>Kenny the sooner you PR what you've done so far the better. People like Chris will I think already appreciate your achievements.</p>

<a name="135261120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135261120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135261120">Kenny Lau (Oct 05 2018 at 15:18)</a>:</h4>
<blockquote>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> Will you share the total progress after you PR?</p>
</blockquote>
<p>it's always the same link</p>

<a name="135261122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135261122" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135261122">Kenny Lau (Oct 05 2018 at 15:18)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852" target="_blank" title="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852">https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852</a></p>

<a name="135262720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135262720" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135262720">Kenny Lau (Oct 05 2018 at 15:44)</a>:</h4>
<p><a href="https://github.com/leanprover/mathlib/pull/391" target="_blank" title="https://github.com/leanprover/mathlib/pull/391">The PR is live</a></p>

<a name="135264898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135264898" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135264898">Johan Commelin (Oct 05 2018 at 16:25)</a>:</h4>
<p><span class="user-mention" data-user-id="110064">@Kenny Lau</span> I meant some total stats: So the sum of the "before" column, and the sum of the "after" column.</p>

<a name="135264908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135264908" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135264908">Johan Commelin (Oct 05 2018 at 16:25)</a>:</h4>
<p>I know I could throw your file through <code>awk</code>, but maybe you had already done that...</p>

<a name="135266401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135266401" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135266401">Kenny Lau (Oct 05 2018 at 16:57)</a>:</h4>
<p>you see, the before column isnt exactly before, and the after column isnt exactly after</p>

<a name="135266463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135266463" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135266463">Johan Commelin (Oct 05 2018 at 16:58)</a>:</h4>
<p>I'm asking about <em>statistics</em> anyway... so you're allowed to be off by 10%.</p>

<a name="135280222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280222" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280222">Kenny Lau (Oct 05 2018 at 20:39)</a>:</h4>
<p>Here are the new measurements: <a href="https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185" target="_blank" title="https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185">https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185</a></p>

<a name="135280312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280312" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280312">Kenny Lau (Oct 05 2018 at 20:40)</a>:</h4>
<p>total compile time went from 3219 seconds to 3191 seconds</p>

<a name="135280347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280347" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280347">Patrick Massot (Oct 05 2018 at 20:41)</a>:</h4>
<p>28 seconds improvement!</p>

<a name="135280423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280423" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280423">Patrick Massot (Oct 05 2018 at 20:42)</a>:</h4>
<p>Impressive. No wonder that guy is the only one to get a personal message in Scott's talk</p>

<a name="135280480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280480" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280480">Kenny Lau (Oct 05 2018 at 20:43)</a>:</h4>
<p>which guy?</p>

<a name="135280580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280580" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280580">Patrick Massot (Oct 05 2018 at 20:45)</a>:</h4>
<p>You</p>

<a name="135280592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280592" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280592">Patrick Massot (Oct 05 2018 at 20:45)</a>:</h4>
<p>I guess there is a typo in your numbers</p>

<a name="135280641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280641" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280641">Patrick Massot (Oct 05 2018 at 20:46)</a>:</h4>
<p>Or I don't understand what you mean, and I should go to bed</p>

<a name="135280699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280699" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280699">Mario Carneiro (Oct 05 2018 at 20:47)</a>:</h4>
<p>those numbers indeed seem unreasonably small compared to your earlier quotes. I thought you had trimmed at least 5 minutes off, what happened or am I not understanding your claim?</p>

<a name="135280788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280788" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280788">Kenny Lau (Oct 05 2018 at 20:49)</a>:</h4>
<p>what happened is that the newly added <code>data/zmod/quadratic_reciprocity.lean</code> adds 2 minutes</p>

<a name="135280815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280815" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280815">Kevin Buzzard (Oct 05 2018 at 20:49)</a>:</h4>
<p>ha ha you are swimming against the tide. Oh boy.</p>

<a name="135280869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280869" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280869">Kenny Lau (Oct 05 2018 at 20:50)</a>:</h4>
<p>that's what happens when I'm the only one doing all this</p>

<a name="135280877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280877" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280877">Kevin Buzzard (Oct 05 2018 at 20:50)</a>:</h4>
<p>what happens when we replace you by a computer?</p>

<a name="135280913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280913">Kenny Lau (Oct 05 2018 at 20:51)</a>:</h4>
<p>and the newly added <code>data/padics/padic_numbers.lean</code> adds 1 minute</p>

<a name="135280978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280978" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280978">Kenny Lau (Oct 05 2018 at 20:52)</a>:</h4>
<p><code>linear_algebra/basic.lean</code> went from 67.3 to 87.1 despite nothing having been changed, so this might just be a statistical noise</p>

<a name="135280994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135280994" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135280994">Kenny Lau (Oct 05 2018 at 20:52)</a>:</h4>
<p><code>data/rat.lean</code> from 55.4 to 78 despite only having a small change</p>

<a name="135281021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281021" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281021">Kevin Buzzard (Oct 05 2018 at 20:53)</a>:</h4>
<p>Is there a more reliable way to time these things on average or something?</p>

<a name="135281097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281097" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281097">Kenny Lau (Oct 05 2018 at 20:54)</a>:</h4>
<p>I don't know. All of these times are measured on my computer, which is far from being a constant environment</p>

<a name="135281141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281141" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281141">Kenny Lau (Oct 05 2018 at 20:55)</a>:</h4>
<p>there might be some statistical methods to make the results more representative of the situation at hand</p>

<a name="135281151"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281151" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281151">Kenny Lau (Oct 05 2018 at 20:55)</a>:</h4>
<p>but I don't study statistics</p>

<a name="135281254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281254" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281254">Kevin Buzzard (Oct 05 2018 at 20:57)</a>:</h4>
<p>did you turn off discord?</p>

<a name="135281261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281261" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281261">Kenny Lau (Oct 05 2018 at 20:57)</a>:</h4>
<p>no</p>

<a name="135281333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281333" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281333">Kenny Lau (Oct 05 2018 at 20:58)</a>:</h4>
<p>one should just look at <a href="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852" target="_blank" title="https://gist.github.com/kckennylau/f7c6cbfb2aa8bf7e4784e8c65d6c4852">this bunch of data produced 9 days ago</a> and <a href="https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185" target="_blank" title="https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185">this bunch of data produced 1 hour ago</a> and make of them what one wills</p>

<a name="135281384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281384" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281384">Mario Carneiro (Oct 05 2018 at 21:00)</a>:</h4>
<p>It's time consuming, but if you want better data you should just run it multiple times, say 3 times and average</p>

<a name="135281467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281467" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281467">Kenny Lau (Oct 05 2018 at 21:01)</a>:</h4>
<p>that would take me 6 hours, so maybe I'll do this tomorrow</p>

<a name="135281473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281473" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281473">Mario Carneiro (Oct 05 2018 at 21:01)</a>:</h4>
<p>Obviously I wouldn't count any new material in the count. I assume your PR doesn't introduce quadratic reciprocity, you should just compare before/after on the branch</p>

<a name="135281492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281492" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281492">Kenny Lau (Oct 05 2018 at 21:01)</a>:</h4>
<p>I'll actually compare between the origin/master branch and the lean-community/faster branch, both in the current (i.e. tomorrow) state</p>

<a name="135281494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281494" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281494">Kenny Lau (Oct 05 2018 at 21:01)</a>:</h4>
<p>how does this sound?</p>

<a name="135281542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281542" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281542">Kenny Lau (Oct 05 2018 at 21:02)</a>:</h4>
<p>(I rebase the <code>faster</code> branch constantly to make sure that there are no conflicts with the origin/master branch)</p>

<a name="135281561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281561" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281561">Mario Carneiro (Oct 05 2018 at 21:02)</a>:</h4>
<p>that should be fine. For the test you should stop rebasing for a bit, just use master as of the beginning of the test</p>

<a name="135281592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281592" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281592">Kenny Lau (Oct 05 2018 at 21:03)</a>:</h4>
<p>so you mean origin/master as of now?</p>

<a name="135281696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281696" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281696">Kenny Lau (Oct 05 2018 at 21:05)</a>:</h4>
<p>oh, you mean no rebasing in those 6 hours</p>

<a name="135281723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281723" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281723">Kevin Buzzard (Oct 05 2018 at 21:05)</a>:</h4>
<p>Kenny if you send me instructions I can run some timing tests on a faster machine</p>

<a name="135281772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135281772" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135281772">Kenny Lau (Oct 05 2018 at 21:06)</a>:</h4>
<p>ok</p>

<a name="135306803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135306803" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135306803">Tobias Grosser (Oct 06 2018 at 10:03)</a>:</h4>
<p>I did some runs: <a href="https://gist.github.com/tobig/86477b42e1cc1d8f8f73666a002edc03" target="_blank" title="https://gist.github.com/tobig/86477b42e1cc1d8f8f73666a002edc03">https://gist.github.com/tobig/86477b42e1cc1d8f8f73666a002edc03</a></p>

<a name="135306849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135306849" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135306849">Tobias Grosser (Oct 06 2018 at 10:04)</a>:</h4>
<p>faster is at around 7m10s to 7m30s  vs master at 9m30s to 10m00.</p>

<a name="135306852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135306852" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135306852">Tobias Grosser (Oct 06 2018 at 10:04)</a>:</h4>
<p>On one of our faster servers.</p>

<a name="135306914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135306914" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135306914">Kenny Lau (Oct 06 2018 at 10:06)</a>:</h4>
<p>thanks</p>

<a name="135306925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135306925" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135306925">Tobias Grosser (Oct 06 2018 at 10:07)</a>:</h4>
<p>This is around 207m vs 320m single threaded.</p>

<a name="135307121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135307121" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135307121">Johan Commelin (Oct 06 2018 at 10:14)</a>:</h4>
<p>Well done Kenny! <span class="emoji emoji-1f44d" title="thumbs up">:thumbs_up:</span></p>

<a name="135313490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313490" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313490">Scott Morrison (Oct 06 2018 at 14:05)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110064">@Kenny Lau</span>, I just pushed <code>squeeze_simp</code> as a separate branch, as Simon requested.</p>

<a name="135313495"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313495" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313495">Scott Morrison (Oct 06 2018 at 14:05)</a>:</h4>
<p>If you'd like, I can rebase your <code>faster</code> branch on to that.</p>

<a name="135313500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313500" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313500">Johan Commelin (Oct 06 2018 at 14:05)</a>:</h4>
<p>I guess the current <code>faster</code> PR doesn't need it, right?</p>

<a name="135313545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313545" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313545">Scott Morrison (Oct 06 2018 at 14:06)</a>:</h4>
<p>Well, the current <code>faster</code> branch includes <code>squeeze_simp</code>.</p>

<a name="135313549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313549" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313549">Scott Morrison (Oct 06 2018 at 14:06)</a>:</h4>
<p>It's a bit of a mess, but Simon wanted the tactic PR'd separately from all the library improvements.</p>

<a name="135313551"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313551" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313551">Johan Commelin (Oct 06 2018 at 14:06)</a>:</h4>
<p>Sure</p>

<a name="135313552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135313552" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135313552">Scott Morrison (Oct 06 2018 at 14:06)</a>:</h4>
<p>Now I should sleep, however.</p>

<a name="135330404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135330404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135330404">Scott Morrison (Oct 06 2018 at 23:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span>,  I was  wondering if instead of have <code>squeeze_simp</code> be a <code>tactic unit</code>, we could have it be a <code>tactic string</code>, that also reports the <code>simp only ...</code> invocation it found via the return value.</p>

<a name="135330408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135330408" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135330408">Scott Morrison (Oct 06 2018 at 23:54)</a>:</h4>
<p>The benefit of doing this is that <code>tidy</code> already produces "proof scripts", showing the sequence of successful tactics it found.</p>

<a name="135330416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135330416" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135330416">Scott Morrison (Oct 06 2018 at 23:55)</a>:</h4>
<p>If <code>tidy</code> called <code>squeeze_simp</code>, then it would automatically generate <code>simp only ...</code> lines.</p>

<a name="135333526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135333526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135333526">Simon Hudon (Oct 07 2018 at 01:49)</a>:</h4>
<p>Nice! I like the idea. Yes it can do that. I just added an option for inhibiting the printout when nothing would change. I assume that would be detrimental to you. I can create a <code>tactic</code> version and an <code>interactive</code> version.</p>

<a name="135422821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135422821" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135422821">Kenny Lau (Oct 08 2018 at 19:19)</a>:</h4>
<p>So this is what I do to each file:<br>
1. Place <code>set_option profiler true</code> and <code>set_option trace.simplify.rewrite true</code> at the top of the file, and select "checking visible lines and above"<br>
2. Click the name of each theorem to see if it takes too long to compile. (<code>simp</code> and <code>simpa</code> are the most reliable indicator for proofs that take a long time, but I always check the actual time used to be sure)<br>
3. Then I click on each <code>simp</code> to see which simp lemmas are used, and decide what to do:<br>
3a. I can change <code>simp</code> to <code>simp only</code> and insert all the simp lemmas that are used. Usually <code>eq_self_iff_true</code> and <code>iff_self</code> are redundant. Sometimes if the lemmas don't involving rewriting under a lambda, I may change it to <code>rw</code>, but this actually doesn't save a lot of time.<br>
3b. If I see (with the help of the list of simp lemmas used) that the proof can be written to a short proof in term mode, then I may write it in term mode.<br>
3c. If I see that the simp lemmas are all proved using <code>rfl</code>, I will replace the proof with <code>rfl</code> to see if it works (surprise, it is not infrequent to see a <code>rfl</code> proof being proved by <code>simp</code>).<br>
4. And then I make sure that the proof is sped up after my changes.<br>
5. And you can always ask me if you don't know how to deal with a certain theorem.</p>

<a name="135422977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135422977" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135422977">Simon Hudon (Oct 08 2018 at 19:23)</a>:</h4>
<p>Do you keep a list of the worst offenders?</p>

<a name="135423054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135423054" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135423054">Kenny Lau (Oct 08 2018 at 19:25)</a>:</h4>
<p>What do you mean?</p>

<a name="135423245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135423245" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135423245">Simon Hudon (Oct 08 2018 at 19:29)</a>:</h4>
<p>I mean now that you've done all this work, what are the files that eat up most of the compile time</p>

<a name="135423247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135423247" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135423247">Kenny Lau (Oct 08 2018 at 19:29)</a>:</h4>
<p><a href="https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185" target="_blank" title="https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185">https://gist.github.com/kckennylau/fd94d8c3a1cd2be9953deffd53657185</a></p>

<a name="135423256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135423256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135423256">Kenny Lau (Oct 08 2018 at 19:29)</a>:</h4>
<p>this is the data as of Oct 05</p>

<a name="135444340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135444340" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135444340">Johan Commelin (Oct 09 2018 at 04:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> You now have experience with git hooks. Can we have a git hook that will disallow commits that import squeeze_simp?</p>

<a name="135446493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135446493" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135446493">Simon Hudon (Oct 09 2018 at 05:54)</a>:</h4>
<p>Yes, you write a script and you place it in <code>.git/hooks/</code> and call it <code>pre-commit</code> (no extensions). If you look in that directory, you can see a number of samples already present. They have <code>.sample</code> extension</p>

<a name="135447691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135447691" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135447691">Johan Commelin (Oct 09 2018 at 06:29)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Do you think it's worth it to PR such a hook into mathlib?</p>

<a name="135447694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135447694" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135447694">Johan Commelin (Oct 09 2018 at 06:29)</a>:</h4>
<p>Could also have a hook that checks for end-of-line-whitespace</p>

<a name="135447749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135447749" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135447749">Mario Carneiro (Oct 09 2018 at 06:30)</a>:</h4>
<p>I think there are a variety of style things you could check</p>

<a name="135448002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135448002" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135448002">Johan Commelin (Oct 09 2018 at 06:38)</a>:</h4>
<p>Sure, but I wouldn't mind to offload the more advanced checks to a proper linter.</p>

<a name="135449522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135449522" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135449522">Simon Hudon (Oct 09 2018 at 07:19)</a>:</h4>
<p>In terms of performances, I think it might be worthwhile to check the import structure and trim the redundant dependencies. I'm still unsure how to do it well though</p>

<a name="135463886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135463886" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135463886">Johan Commelin (Oct 09 2018 at 12:13)</a>:</h4>
<p><a href="https://gist.github.com/jcommelin/ab7b99ee1dcd9084e2f73a940e91bb40" target="_blank" title="https://gist.github.com/jcommelin/ab7b99ee1dcd9084e2f73a940e91bb40">https://gist.github.com/jcommelin/ab7b99ee1dcd9084e2f73a940e91bb40</a> is a python script that I hacked together. If we change <code>squeeze_simp</code> enough, maybe we can automate the replacement into batch mode.</p>

<a name="135463913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135463913" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135463913">Johan Commelin (Oct 09 2018 at 12:14)</a>:</h4>
<p>Problem is that if I change <code>squeeze_simp</code> to</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">squeeze_simp</span>
  <span class="o">(</span><span class="n">pbegin</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">cur_pos</span><span class="o">)</span>
  <span class="o">(</span><span class="n">use_iota_eqn</span> <span class="o">:</span> <span class="n">parse</span> <span class="o">(</span><span class="n">tk</span> <span class="s2">&quot;!&quot;</span><span class="o">)</span><span class="err">?</span><span class="o">)</span> <span class="o">(</span><span class="n">no_dflt</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">only_flag</span><span class="o">)</span> <span class="o">(</span><span class="n">hs</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">simp_arg_list</span><span class="o">)</span>
  <span class="o">(</span><span class="n">attr_names</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">with_ident_list</span><span class="o">)</span> <span class="o">(</span><span class="n">locat</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">location</span><span class="o">)</span>
  <span class="o">(</span><span class="n">cfg</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">record_lit</span><span class="err">?</span><span class="o">)</span>
  <span class="o">(</span><span class="n">pend</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">cur_pos</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
<span class="n">do</span> <span class="n">g</span> <span class="err">←</span> <span class="n">main_goal</span><span class="o">,</span>
   <span class="o">(</span><span class="n">cfg&#39;</span><span class="o">,</span><span class="n">c</span><span class="o">)</span> <span class="err">←</span> <span class="n">parse_config</span> <span class="n">cfg</span><span class="o">,</span>
   <span class="n">hs&#39;</span> <span class="err">←</span> <span class="n">hs</span><span class="bp">.</span><span class="n">mmap</span> <span class="n">arg</span><span class="bp">.</span><span class="n">to_tactic_format</span><span class="o">,</span>
   <span class="n">simp</span> <span class="n">use_iota_eqn</span> <span class="n">no_dflt</span> <span class="n">hs</span> <span class="n">attr_names</span> <span class="n">locat</span> <span class="n">cfg&#39;</span><span class="o">,</span>
   <span class="n">g</span> <span class="err">←</span> <span class="n">instantiate_mvars</span> <span class="n">g</span><span class="o">,</span>
   <span class="k">let</span> <span class="n">vs</span> <span class="o">:=</span> <span class="n">g</span><span class="bp">.</span><span class="n">list_constant</span><span class="o">,</span>
   <span class="n">vs</span> <span class="err">←</span> <span class="n">vs</span><span class="bp">.</span><span class="n">mfilter</span> <span class="o">(</span><span class="n">succeeds</span> <span class="err">∘</span> <span class="n">has_attribute</span> <span class="bp">`</span><span class="n">simp</span><span class="o">),</span>
   <span class="k">let</span> <span class="n">use_iota_eqn</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">use_iota_eqn</span><span class="bp">.</span><span class="n">is_some</span> <span class="k">then</span> <span class="s2">&quot;!&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="o">,</span>
   <span class="k">let</span> <span class="n">attrs</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">attr_names</span><span class="bp">.</span><span class="n">empty</span> <span class="k">then</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">string</span><span class="bp">.</span><span class="n">join</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">intersperse</span> <span class="s2">&quot; &quot;</span> <span class="o">(</span><span class="s2">&quot; with&quot;</span> <span class="bp">::</span> <span class="n">attr_names</span><span class="bp">.</span><span class="n">map</span> <span class="n">to_string</span><span class="o">)),</span>
   <span class="k">let</span> <span class="n">loc</span> <span class="o">:=</span> <span class="n">loc</span><span class="bp">.</span><span class="n">to_string</span> <span class="n">locat</span><span class="o">,</span>
   <span class="k">let</span> <span class="n">args</span> <span class="o">:=</span> <span class="n">hs&#39;</span> <span class="bp">++</span> <span class="n">vs</span><span class="bp">.</span><span class="n">to_list</span><span class="bp">.</span><span class="n">map</span> <span class="n">to_fmt</span><span class="o">,</span>
   <span class="n">trace</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;{pbegin.line}:{pbegin.column}:{pend.line}:{pend.column}:simp{use_iota_eqn} only {args}{attrs}{loc}{c}&quot;</span>
</pre></div>

<a name="135463953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135463953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135463953">Johan Commelin (Oct 09 2018 at 12:14)</a>:</h4>
<p>And I test with</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">:</span> <span class="n">true</span> <span class="o">:=</span>
<span class="k">begin</span>
  <span class="k">have</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">3</span> <span class="bp">=</span> <span class="mi">3</span> <span class="bp">+</span> <span class="mi">2</span> <span class="o">:=</span>
  <span class="k">begin</span>
    <span class="n">squeeze_simp</span> <span class="c1">-- this is line 105</span>
  <span class="kn">end</span><span class="o">,</span>
  <span class="n">trivial</span>
<span class="kn">end</span>
</pre></div>


<p>I get the output:</p>
<div class="codehilite"><pre><span></span><span class="mi">106</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">106</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">add_comm</span><span class="o">,</span> <span class="n">eq_self_iff_true</span><span class="o">,</span> <span class="n">add_right_inj</span><span class="o">]</span>
</pre></div>

<a name="135463971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135463971" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135463971">Johan Commelin (Oct 09 2018 at 12:15)</a>:</h4>
<p>So the line:col:line:col coordinates are not very useful atm</p>

<a name="135480544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135480544" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135480544">Reid Barton (Oct 09 2018 at 16:11)</a>:</h4>
<p>Does it help if you add a comma after squeeze_simp?</p>

<a name="135503455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135503455" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135503455">Kenny Lau (Oct 09 2018 at 22:28)</a>:</h4>
<p><code>conv _ in _ etc</code> is slow</p>

<a name="135503462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135503462" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135503462">Kenny Lau (Oct 09 2018 at 22:28)</a>:</h4>
<p>slower than <code>simp</code></p>

<a name="135508682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135508682" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135508682">Kenny Lau (Oct 10 2018 at 00:08)</a>:</h4>
<p><a href="/user_uploads/3121/WKTRF2rdqUEt60_Qu8goPD5c/2018-10-10.png" target="_blank" title="2018-10-10.png">2018-10-10.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/WKTRF2rdqUEt60_Qu8goPD5c/2018-10-10.png" target="_blank" title="2018-10-10.png"><img src="/user_uploads/3121/WKTRF2rdqUEt60_Qu8goPD5c/2018-10-10.png"></a></div>

<a name="135508741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135508741" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135508741">Kenny Lau (Oct 10 2018 at 00:09)</a>:</h4>
<p>if you do <code>set_option profiler true</code> and <code>set_option trace.simplify.rewrite true</code> then you can actually see which tactic takes the most time</p>

<a name="135508796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135508796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135508796">Kenny Lau (Oct 10 2018 at 00:10)</a>:</h4>
<p>by observing when the green squiggly line comes up</p>

<a name="135509069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135509069" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135509069">Kenny Lau (Oct 10 2018 at 00:17)</a>:</h4>
<p><a href="/user_uploads/3121/8zf8fXTD-Qbb-p_O1hIZTa2a/2018-10-10-1.png" target="_blank" title="2018-10-10-1.png">2018-10-10-1.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/8zf8fXTD-Qbb-p_O1hIZTa2a/2018-10-10-1.png" target="_blank" title="2018-10-10-1.png"><img src="/user_uploads/3121/8zf8fXTD-Qbb-p_O1hIZTa2a/2018-10-10-1.png"></a></div>

<a name="135509074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135509074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135509074">Kenny Lau (Oct 10 2018 at 00:17)</a>:</h4>
<p>so I changed one line and suddenly the proof takes 20s less to compile</p>

<a name="135509127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135509127" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135509127">Kenny Lau (Oct 10 2018 at 00:18)</a>:</h4>
<p>(ok part of it is due to caching, but whatever)</p>

<a name="135521322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135521322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135521322">Kevin Buzzard (Oct 10 2018 at 06:08)</a>:</h4>
<blockquote>
<p>(ok part of it is due to caching, but whatever)</p>
</blockquote>
<p>Can you get a more robust method for timing?</p>

<a name="135524641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135524641" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135524641">Johan Commelin (Oct 10 2018 at 07:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> How long does a full compile of mathlib take on your beast?</p>

<a name="135528668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135528668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135528668">Scott Morrison (Oct 10 2018 at 09:11)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span>  7 min 52 s</p>

<a name="135528937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135528937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135528937">Scott Morrison (Oct 10 2018 at 09:18)</a>:</h4>
<p>(During which 80m24s of core time is being used --- so it managed to average using 10 cores. I see it peak above 20 cores.)</p>

<a name="135566004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566004" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566004">Sebastian Ullrich (Oct 10 2018 at 20:24)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span> and me just talked a bit about mathlib's performance troubles. Much of this will change in Lean 4 anyway, but it may still be interesting if someone other than us could take a look and profile (using e.g. <code>perf</code>) what parts in the C++ code are so slow. Some time ago, <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> profiled that most time is spent in creating the simp lemmas cache from scratch, afair. Is this still the case? Does this mean the cache doesn't work at all, i.e. are subsequent <code>simp</code>s still slow even if no simp attributes have been changed in between? If not, might it be worth to e.g. delay and bundle up simp attribute additions where possible, instead of laboriously optimizing the proofs themselves? etc. pp.</p>

<a name="135566074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566074">Mario Carneiro (Oct 10 2018 at 20:25)</a>:</h4>
<p>I am not sure how much of a problem this is at large scale in mathlib, but I think <code>haveI</code> and friends just turn off caching altogether, which is pretty bad from a performance standpoint</p>

<a name="135566092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566092" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566092">Mario Carneiro (Oct 10 2018 at 20:25)</a>:</h4>
<p>The semantics I wanted them to have was that <code>haveI</code> would clear the cache but not turn it off permanently</p>

<a name="135566171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566171">Mario Carneiro (Oct 10 2018 at 20:27)</a>:</h4>
<p>there was at least one example of a large proof that had a <code>haveI</code> early on and lots of typeclass problems later and it was super slow. I fixed it by breaking out a lemma, but I would prefer to avoid this in many cases</p>

<a name="135566234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566234" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566234">Mario Carneiro (Oct 10 2018 at 20:29)</a>:</h4>
<p>Is it possible to run simp with a prebuilt cache somehow?</p>

<a name="135566338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566338" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566338">Sebastian Ullrich (Oct 10 2018 at 20:31)</a>:</h4>
<p>I see. I had the impression that most proofs Kenny changed were <code>simp</code> one-liners. The typeclass cache story will probably change in Lean 4, but I don't think we want to touch that part before that</p>

<a name="135566361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566361">Mario Carneiro (Oct 10 2018 at 20:32)</a>:</h4>
<p>they were about 80% simp and 20% typeclass inference</p>

<a name="135566404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566404" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566404">Sebastian Ullrich (Oct 10 2018 at 20:32)</a>:</h4>
<p>Ok, good to know</p>

<a name="135566434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566434" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566434">Mario Carneiro (Oct 10 2018 at 20:33)</a>:</h4>
<p>But it could also be that we (I) just use <code>simp</code> disproportionately</p>

<a name="135566435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566435" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566435">Sebastian Ullrich (Oct 10 2018 at 20:33)</a>:</h4>
<blockquote>
<p>Is it possible to run simp with a prebuilt cache somehow?</p>
</blockquote>
<p>That should be possible using the tactic primitives, no? E.g. put simp lemma generation in one <code>timeit</code> and <code>simp_core</code> or whatever it was called in another</p>

<a name="135566447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566447" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566447">Mario Carneiro (Oct 10 2018 at 20:33)</a>:</h4>
<p>i.e. <code>ring</code> is slow but I know it is slow and avoid it when possible</p>

<a name="135566500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566500" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566500">Mario Carneiro (Oct 10 2018 at 20:34)</a>:</h4>
<p>If I put two copies of the same theorem one after another, will the second one have a hot simp cache?</p>

<a name="135566519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566519">Mario Carneiro (Oct 10 2018 at 20:35)</a>:</h4>
<p>I guess multithreaded execution causes problems here</p>

<a name="135566530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566530" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566530">Sebastian Ullrich (Oct 10 2018 at 20:35)</a>:</h4>
<p>Yeah. You should try running it with <code>-j0</code>.</p>

<a name="135566539"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566539" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566539">Mario Carneiro (Oct 10 2018 at 20:35)</a>:</h4>
<p>There are a lot of files like <code>multiset</code> where there are lots of simp proofs, but almost every theorem is also a simp lemma so the cache doesn't stay still</p>

<a name="135566626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566626" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566626">Mario Carneiro (Oct 10 2018 at 20:37)</a>:</h4>
<p>What about running some proofs as though the previous lemmas are added to the bracket list rather than adding them to the default simp set? That way you can chunk up additions to the simp set a bit and decrease the number of rebuilds</p>

<a name="135566702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135566702" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135566702">Sebastian Ullrich (Oct 10 2018 at 20:39)</a>:</h4>
<p>Heh, that's kind of what we want to do in Lean 4. It would definitely be a helpful experiment</p>

<a name="135567209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135567209" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135567209">Simon Hudon (Oct 10 2018 at 20:49)</a>:</h4>
<p>It could probably be done with a wrapper around <code>simp</code></p>

<a name="135567298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135567298" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135567298">Simon Hudon (Oct 10 2018 at 20:50)</a>:</h4>
<p>And I'd use an attribute set on one dummy definition to keep track of the lemmas used in a proof.</p>

<a name="135567424"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135567424" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135567424">Simon Hudon (Oct 10 2018 at 20:52)</a>:</h4>
<blockquote>
<p>What about running some proofs as though the previous lemmas are added to the bracket list rather than adding them to the default simp set? That way you can chunk up additions to the simp set a bit and decrease the number of rebuilds</p>
</blockquote>
<p>Btw, do you mean the lemmas previously defined or the lemmas previously used?</p>

<a name="135567445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135567445" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135567445">Simon Hudon (Oct 10 2018 at 20:53)</a>:</h4>
<p>Also, what's the difference between the lemmas in the <code>simp</code> brackets and those that are simply in the <code>simp</code> list?</p>

<a name="135573105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135573105" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135573105">Kenny Lau (Oct 10 2018 at 22:49)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Can I add the following lemma to <a href="https://github.com/leanprover/mathlib/blob/master/data/rat.lean#L196-L203" target="_blank" title="https://github.com/leanprover/mathlib/blob/master/data/rat.lean#L196-L203"><code>data/rat.lean</code></a>?</p>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">elab_as_eliminator</span><span class="o">]</span> <span class="kn">theorem</span> <span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">num_denom_cases_on&#39;&#39;</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">}</span>
   <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span><span class="o">:</span><span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span><span class="o">:</span><span class="bp">ℤ</span><span class="o">),</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">))</span> <span class="o">:</span> <span class="n">C</span> <span class="n">a</span> <span class="o">:=</span>
<span class="n">num_denom_cases_on&#39;</span> <span class="n">a</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h</span><span class="o">,</span>
<span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="err">$</span> <span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_ne_zero</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span>
</pre></div>

<a name="135580682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135580682" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135580682">Mario Carneiro (Oct 11 2018 at 02:00)</a>:</h4>
<p>Sure. You sure you don't want <code>d &gt; 0</code> in the assumptions instead?</p>

<a name="135593540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135593540" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135593540">Kenny Lau (Oct 11 2018 at 08:21)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> yes, because <code>add_def</code> and friends all use <code>n /. d</code> with <code>d \ne 0</code></p>

<a name="135594056"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135594056" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135594056">Kenny Lau (Oct 11 2018 at 08:34)</a>:</h4>
<p>well now <code>mk_nonneg</code> uses <code>n /. d</code> with <code>d &gt; 0</code> so can I get another recursor?</p>

<a name="135594135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135594135" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135594135">Kenny Lau (Oct 11 2018 at 08:36)</a>:</h4>
<p>actually I need <code>add_def</code> and <code>mk_nonneg</code> at the same time, so maybe I don't need a new recursor, but I would like to have this instead:</p>

<a name="135594154"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135594154" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135594154">Kenny Lau (Oct 11 2018 at 08:37)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="n">elab_as_eliminator</span><span class="o">]</span> <span class="kn">theorem</span> <span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">num_denom_cases_on&#39;&#39;</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">}</span>
   <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span><span class="o">:</span><span class="bp">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span><span class="o">:</span><span class="bp">ℤ</span><span class="o">),</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">d</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">))</span> <span class="o">:</span> <span class="n">C</span> <span class="n">a</span> <span class="o">:=</span>
<span class="n">num_denom_cases_on&#39;</span> <span class="n">a</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h</span><span class="o">,</span>
<span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="o">(</span><span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_ne_zero</span><span class="bp">.</span><span class="mi">2</span> <span class="n">h</span><span class="o">)</span> <span class="o">(</span><span class="n">int</span><span class="bp">.</span><span class="n">coe_nat_pos</span><span class="bp">.</span><span class="mi">2</span> <span class="err">$</span> <span class="n">nat</span><span class="bp">.</span><span class="n">pos_of_ne_zero</span> <span class="n">h</span><span class="o">)</span>
</pre></div>

<a name="135645931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135645931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135645931">Kenny Lau (Oct 12 2018 at 00:38)</a>:</h4>
<div class="codehilite"><pre><span></span>git ls-files *.lean | xargs -I % sh -c &#39;&gt;&amp;2 echo %; /c/lean/bin/lean --profile % &gt;/dev/null;&#39; &gt; profile.txt 2&gt;&amp;1
</pre></div>

<a name="135645933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135645933" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135645933">Kenny Lau (Oct 12 2018 at 00:38)</a>:</h4>
<p>I'm starting to think that this is the wrong thing to type</p>

<a name="135645935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135645935" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135645935">Kenny Lau (Oct 12 2018 at 00:38)</a>:</h4>
<p>somehow it only uses one thread</p>

<a name="135645937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135645937" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135645937">Kenny Lau (Oct 12 2018 at 00:38)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> do you know enough bash magic to make it work?</p>

<a name="135645949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135645949" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135645949">Kenny Lau (Oct 12 2018 at 00:39)</a>:</h4>
<p>or one core. I'm just guessing based on the output</p>

<a name="135646003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646003" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646003">Mario Carneiro (Oct 12 2018 at 00:40)</a>:</h4>
<p>did you try setting the <code>-j</code> option of lean?</p>

<a name="135646023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646023" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646023">Mario Carneiro (Oct 12 2018 at 00:41)</a>:</h4>
<p>also, your latest version of <code>num_denom_cases_on''</code> seems sillier than the last. Is <code>ne_of_gt</code> so expensive?</p>

<a name="135646035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646035">Kenny Lau (Oct 12 2018 at 00:41)</a>:</h4>
<p>well it's long</p>

<a name="135646084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646084" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646084">Mario Carneiro (Oct 12 2018 at 00:42)</a>:</h4>
<p>you have a strange sense of long</p>

<a name="135646095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646095" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646095">Kenny Lau (Oct 12 2018 at 00:42)</a>:</h4>
<p>you have a strange interpretation of convention</p>

<a name="135646109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646109" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646109">Mario Carneiro (Oct 12 2018 at 00:43)</a>:</h4>
<p>which one?</p>

<a name="135646128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646128" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646128">Kenny Lau (Oct 12 2018 at 00:43)</a>:</h4>
<p>that there can be two conventions</p>

<a name="135646133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646133" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646133">Kenny Lau (Oct 12 2018 at 00:43)</a>:</h4>
<p>maybe we shouldn't have two conventions to start with</p>

<a name="135646176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646176" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646176">Mario Carneiro (Oct 12 2018 at 00:44)</a>:</h4>
<p>I will defend my right to have exceptions to rules, but I still don't know what you are talking about</p>

<a name="135646188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646188" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646188">Kenny Lau (Oct 12 2018 at 00:44)</a>:</h4>
<p>that add_def and friends uses "denom ne zero" and mk_nonneg uses "denom &gt; zero"</p>

<a name="135646197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646197" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646197">Mario Carneiro (Oct 12 2018 at 00:45)</a>:</h4>
<p>um... <code>mk_nonneg</code> is about nonnegative things</p>

<a name="135646211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646211" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646211">Mario Carneiro (Oct 12 2018 at 00:45)</a>:</h4>
<p>of course it needs to know the inputs are nonnegative</p>

<a name="135646215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646215" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646215">Kenny Lau (Oct 12 2018 at 00:45)</a>:</h4>
<p>and who thought the original <code>num_denom_cases_on'</code> is a good idea despite literally every instance of it needing a fix</p>

<a name="135646269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646269" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646269">Mario Carneiro (Oct 12 2018 at 00:46)</a>:</h4>
<p>I don't see it. It gets used like 20 times immediately afterwards and there are no fixes</p>

<a name="135646286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646286" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646286">Kenny Lau (Oct 12 2018 at 00:47)</a>:</h4>
<p>by "fix" I mean, wrapper</p>

<a name="135646297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646297" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646297">Mario Carneiro (Oct 12 2018 at 00:47)</a>:</h4>
<p>The fact that <code>d</code> is referred to in a <code>\u</code> is deliberate</p>

<a name="135646303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646303">Mario Carneiro (Oct 12 2018 at 00:48)</a>:</h4>
<p>it's a cheap way of saying nonnegative integer without any overhead</p>

<a name="135646339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646339">Kenny Lau (Oct 12 2018 at 00:48)</a>:</h4>
<p>but matches none of the theorem's hypothesis</p>

<a name="135646403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646403">Mario Carneiro (Oct 12 2018 at 00:50)</a>:</h4>
<p>Maybe you are right, most of the theorems don't care that it's nonnegative so having it be an integer is just as well. But in that case I would stick to your first proposal</p>

<a name="135646438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/compile%20time%20statistics/near/135646438" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/39364compiletimestatistics.html#135646438">Kenny Lau (Oct 12 2018 at 00:51)</a>:</h4>
<p>ok</p>


{% endraw %}
