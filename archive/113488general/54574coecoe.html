---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/54574coecoe.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html">coe_coe</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="125958400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125958400" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125958400">Chris Hughes (May 02 2018 at 05:20)</a>:</h4>
<p>Just noticed the lemma <code>coe_coe</code>, which is tagged as <code>simp</code>, does this mean I need to be careful about tagging lemmas that make a double coercion into a single coercion with simp?</p>

<a name="125960662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125960662" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125960662">Kenny Lau (May 02 2018 at 06:15)</a>:</h4>
<blockquote>
<p>Just noticed the lemma <code>coe_coe</code>, which is tagged as <code>simp</code>, does this mean I need to be careful about tagging lemmas that make a double coercion into a single coercion with simp?</p>
</blockquote>
<p>yes</p>

<a name="125960853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125960853" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125960853">Chris Hughes (May 02 2018 at 06:19)</a>:</h4>
<p>What's the difference between <code>has_coe</code> and <code>has_coe_t</code>?</p>

<a name="125960953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125960953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125960953">Kenny Lau (May 02 2018 at 06:21)</a>:</h4>
<p>L37:</p>
<div class="codehilite"><pre><span></span><span class="n">class</span> <span class="n">has_coe</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">coe</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">b</span><span class="o">)</span>

<span class="c">/-</span><span class="cm">- Auxiliary class that contains the transitive closure of has_coe. -/</span>
<span class="n">class</span> <span class="n">has_coe_t</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">coe</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">→</span> <span class="n">b</span><span class="o">)</span>
</pre></div>


<hr>
<p>L94:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">coe_trans</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u₁</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u₂</span><span class="o">}</span> <span class="o">{</span><span class="n">c</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u₃</span><span class="o">}</span> <span class="o">[</span><span class="n">has_coe</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">[</span><span class="n">has_coe_t</span> <span class="n">b</span> <span class="n">c</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_coe_t</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">coe_t</span> <span class="o">(</span><span class="n">coe_b</span> <span class="n">x</span> <span class="o">:</span> <span class="n">b</span><span class="o">)</span><span class="bp">⟩</span>
</pre></div>

<a name="125961550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961550" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961550">Kevin Buzzard (May 02 2018 at 06:35)</a>:</h4>
<p>Maybe the type class coercion system uses this instance?</p>

<a name="125961600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961600" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961600">Kenny Lau (May 02 2018 at 06:36)</a>:</h4>
<p>curiously, this <code>has_coe_t</code> appears literally nowhere</p>

<a name="125961607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961607">Kevin Buzzard (May 02 2018 at 06:36)</a>:</h4>
<p>Did you check the C++ bit?</p>

<a name="125961611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961611" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961611">Kenny Lau (May 02 2018 at 06:36)</a>:</h4>
<p>maybe it's because of this:</p>
<div class="codehilite"><pre><span></span><span class="kn">instance</span> <span class="n">coe_to_lift</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">[</span><span class="n">has_coe_t</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_lift_t</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span>
<span class="bp">⟨</span><span class="n">coe_t</span><span class="bp">⟩</span>
</pre></div>

<a name="125961620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961620" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961620">Kenny Lau (May 02 2018 at 06:37)</a>:</h4>
<p>so my conjecture is that they use <code>has_coe_t</code> to do transitive stuff, and then make <code>has_lift_t</code> the interface</p>

<a name="125961671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961671" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961671">Kevin Buzzard (May 02 2018 at 06:38)</a>:</h4>
<p>I remember Mario once saying something like he couldn't see the point of has_lift</p>

<a name="125961673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961673" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961673">Kevin Buzzard (May 02 2018 at 06:38)</a>:</h4>
<p>There's something about it in TPIL IIRC</p>

<a name="125961919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125961919" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125961919">Chris Hughes (May 02 2018 at 06:44)</a>:</h4>
<p>So I don't need to worry unless it's a <code>coe_t</code>. The reason I noticed is because the coercion from pnat to int is a coe_t obviously, so it was being rewritten by coe_coe.</p>

<a name="125962001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125962001" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125962001">Chris Hughes (May 02 2018 at 06:46)</a>:</h4>
<p>Which means I need double the lemmas</p>

<a name="125962030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125962030" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125962030">Kevin Buzzard (May 02 2018 at 06:47)</a>:</h4>
<p>Has_lift gives you access to the \u uparrow notation but lean won't ever insert them for you if you're not has_coe</p>

<a name="125962081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125962081" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125962081">Kevin Buzzard (May 02 2018 at 06:49)</a>:</h4>
<p>But each lemma is twice as easy to prove <span class="emoji emoji-1f642" title="simple smile">:simple_smile:</span></p>

<a name="125984523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125984523" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125984523">Mario Carneiro (May 02 2018 at 18:58)</a>:</h4>
<p>You shouldn't need "double the lemmas", you just need to make sure that any simp lemmas LHS are already split up into multiple coe arrows</p>

<a name="125984671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125984671" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125984671">Chris Hughes (May 02 2018 at 19:02)</a>:</h4>
<p>But I also want the single arrows for rw's, because if I don't use simp, most of my coercions are single coercions</p>

<a name="125984685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125984685" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125984685">Mario Carneiro (May 02 2018 at 19:03)</a>:</h4>
<p>why are you using composite coercions to begin with?</p>

<a name="125984693"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125984693" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125984693">Mario Carneiro (May 02 2018 at 19:04)</a>:</h4>
<p>I honestly wish the parser inserted multiple coe arrows, but the best I can do to recreate that is <code>coe_coe</code></p>

<a name="125984738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125984738" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125984738">Mario Carneiro (May 02 2018 at 19:04)</a>:</h4>
<p>but you can always write <code>((a:B):C)</code> to get multiple coe arrows inserted</p>

<a name="125987058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987058" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987058">Kevin Buzzard (May 02 2018 at 20:17)</a>:</h4>
<p>He wants to go from <code>pnat</code> to <code>int</code></p>

<a name="125987205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987205" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987205">Mario Carneiro (May 02 2018 at 20:22)</a>:</h4>
<p>I can see that. But why? What is the simp lemma under consideration? Like I said, you can use <code>((n:nat):int)</code> to double-coerce</p>

<a name="125987207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987207" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987207">Chris Hughes (May 02 2018 at 20:23)</a>:</h4>
<p>But that means having to type ((n : nat):int) all the time, instead of just n.</p>

<a name="125987218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987218" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987218">Mario Carneiro (May 02 2018 at 20:23)</a>:</h4>
<p>all the time meaning only on the LHS of rules marked <code>[simp]</code></p>

<a name="125987222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987222" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987222">Mario Carneiro (May 02 2018 at 20:23)</a>:</h4>
<p>in proofs you can do whatever</p>

<a name="125987263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987263" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987263">Mario Carneiro (May 02 2018 at 20:24)</a>:</h4>
<p>but it is important to state your lemmas correctly</p>

<a name="125987270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987270">Chris Hughes (May 02 2018 at 20:25)</a>:</h4>
<p>But for any lemma marked simp, I also want it's single coercion corollary if I want to rewrite something.</p>

<a name="125987271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987271" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987271">Mario Carneiro (May 02 2018 at 20:25)</a>:</h4>
<p>like what?</p>

<a name="125987314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987314" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987314">Mario Carneiro (May 02 2018 at 20:26)</a>:</h4>
<p>just <code>rw coe_coe</code></p>

<a name="125987315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987315" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987315">Chris Hughes (May 02 2018 at 20:26)</a>:</h4>
<p>I could do that too.</p>

<a name="125987320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987320" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987320">Mario Carneiro (May 02 2018 at 20:27)</a>:</h4>
<p>I think you underestimate the number of "single coercion corollaries"</p>

<a name="125987321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987321" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987321">Mario Carneiro (May 02 2018 at 20:27)</a>:</h4>
<p>(hint: it's infinite)</p>

<a name="125987359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987359" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987359">Kenny Lau (May 02 2018 at 20:28)</a>:</h4>
<p>infinity doesn't exist</p>

<a name="125987364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/coe_coe/near/125987364" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54574coecoe.html#125987364">Mario Carneiro (May 02 2018 at 20:28)</a>:</h4>
<p>and neither do those corollaries, in mathlib</p>


{% endraw %}
