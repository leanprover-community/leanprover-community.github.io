---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/54462crec.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html">crec</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="148651094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651094" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148651094">Reid Barton (Nov 27 2018 at 16:54)</a>:</h4>
<p>I wrote a version of well-founded recursion which allows you to maintain a "consistency" condition in the recursion.<br>
<a href="https://gist.github.com/rwbarton/7bd5b3b19d930f577355a596a5ed8b4d" target="_blank" title="https://gist.github.com/rwbarton/7bd5b3b19d930f577355a596a5ed8b4d">https://gist.github.com/rwbarton/7bd5b3b19d930f577355a596a5ed8b4d</a></p>

<a name="148651153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651153" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148651153">Reid Barton (Nov 27 2018 at 16:55)</a>:</h4>
<p>Compared to <code>well_founded.fix</code>, the difference is that you get to specify a condition <code>q : Π ⦃i j⦄ (h : i &lt; j), C i → C j → Prop</code>. In the induction step you can assume that all the previous choices are consistent according to <code>q</code>, and you need to produce a new value which is consistent with all the previous choices.</p>

<a name="148651171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651171" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148651171">Reid Barton (Nov 27 2018 at 16:55)</a>:</h4>
<p>In the end, you get a function whose values are all consistent according to <code>q</code></p>

<a name="148651327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651327" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148651327">Reid Barton (Nov 27 2018 at 16:57)</a>:</h4>
<p>Mostly it's useful when you need to have the consistency condition in hand in order to perform the next step of the recursive construction.</p>

<a name="148651402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651402" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148651402">Reid Barton (Nov 27 2018 at 16:58)</a>:</h4>
<p>For example, you could take <code>C n</code> to be sequences defined up to <code>n</code>, and <code>q</code> to say that the first sequence is a prefix of the second</p>

<a name="148651842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148651842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148651842">Reid Barton (Nov 27 2018 at 17:03)</a>:</h4>
<p>For example, suppose you want to construct an order-preserving map from <code>nat</code> to an order <code>P</code> without a greatest element. It's easy to prove by induction on <code>n</code> that there is an order-preserving map from <code>fin n</code> to <code>P</code>, but this is not good enough if these maps are all unrelated!</p>

<a name="148654463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148654463" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148654463">Mario Carneiro (Nov 27 2018 at 17:42)</a>:</h4>
<p>I think this could be stated as a "dependent choice" problem</p>

<a name="148654486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148654486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148654486">Mario Carneiro (Nov 27 2018 at 17:43)</a>:</h4>
<p>you want the definition of <code>F a</code> to depend on <code>F b</code> for all <code>b &lt; a</code></p>

<a name="148656204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148656204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148656204">Mario Carneiro (Nov 27 2018 at 18:06)</a>:</h4>
<p>ah, nevermind, I don't think I can simplify it past what you've already done. You want to define the type and value together in the recursion, but that's what <code>crec_core</code> accomplishes</p>

<a name="148656406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148656406" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148656406">Mario Carneiro (Nov 27 2018 at 18:08)</a>:</h4>
<p>You can probably remove the <code>i &lt; j</code> from <code>q</code>, since it's defining a prop</p>

<a name="148656641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148656641" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148656641">Mario Carneiro (Nov 27 2018 at 18:11)</a>:</h4>
<p>the <code>f</code> parameter of <code>H</code> can be uncurried, I don't know whether it is better or worse to also split it up into two parameters for the subtype in the target</p>

<a name="148670810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/148670810" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#148670810">Reid Barton (Nov 27 2018 at 21:52)</a>:</h4>
<p>Thanks for the suggestions. I haven't tried actually using this for anything yet, so I'll have to see what seems more natural at the use site.</p>

<a name="155322663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/155322663" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#155322663">Johannes Hölzl (Jan 17 2019 at 09:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110032">@Reid Barton</span> can I add <code>crec</code> to mathlib?</p>

<a name="156330667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/156330667" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#156330667">Reid Barton (Jan 17 2019 at 23:57)</a>:</h4>
<p>Yes, absolutely.<br>
<a href="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/logic/crec.lean" target="_blank" title="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/logic/crec.lean">https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/logic/crec.lean</a> is the version I actually use at the moment.<br>
I think the usability could still be improved; in particular it's not very convenient to use <code>crec</code> and <code>crec_consistent</code> separately because you typically have to repeat <code>q</code>, which could be rather complicated.</p>

<a name="156330879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/crec/near/156330879" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/54462crec.html#156330879">Reid Barton (Jan 18 2019 at 00:00)</a>:</h4>
<p><code>crec'</code> was an attempt to improve on that, but I still haven't found the best way to use it, for example <a href="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/top_small.lean#L110-L137" target="_blank" title="https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/top_small.lean#L110-L137">https://github.com/rwbarton/lean-model-categories/blob/top-dev/src/top_small.lean#L110-L137</a> is a bit awkward.</p>


{% endraw %}
