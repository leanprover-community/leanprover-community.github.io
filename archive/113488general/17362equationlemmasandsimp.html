---
layout: archive
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/17362equationlemmasandsimp.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html">equation lemmas and simp</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="123126635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123126635" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123126635">Sean Leather (Mar 01 2018 at 07:18)</a>:</h4>
<p>What is the effect of putting <code>@[simp]</code> on a <code>def</code> defined with pattern-matching equations? Does it annotate the equation lemmas with <code>@[simp]</code>?</p>

<a name="123126899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123126899" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123126899">Sean Leather (Mar 01 2018 at 07:29)</a>:</h4>
<p>When I look at <code>#print &lt;def-name&gt;._main.equations._eqn_1</code>, it only has <code>@[_refl_lemma]</code>.</p>

<a name="123126955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123126955" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123126955">Simon Hudon (Mar 01 2018 at 07:30)</a>:</h4>
<p>what do you see if you look at the other equations? (see them listed in <code>#print prefix &lt;def-name&gt;</code>)</p>

<a name="123127031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127031" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127031">Sean Leather (Mar 01 2018 at 07:33)</a>:</h4>
<p>I had to use a fully-qualified <code>&lt;def-name&gt;</code>, but that's a useful command:</p>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">print</span> <span class="kn">prefix</span> <span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">},</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">)</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">},</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">)</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span><span class="bp">._</span><span class="n">meta_aux</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">},</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">)</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span> <span class="n">ts</span> <span class="o">(</span><span class="n">varb</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">option</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">nth</span> <span class="n">ts</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">varb</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">V</span><span class="o">),</span> <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span> <span class="n">ts</span> <span class="o">(</span><span class="n">varf</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">varf</span> <span class="n">x</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">t₁</span> <span class="n">t₂</span> <span class="o">:</span> <span class="n">typ</span> <span class="n">V</span><span class="o">),</span>
  <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span> <span class="n">ts</span> <span class="o">(</span><span class="n">arr</span> <span class="n">t₁</span> <span class="n">t₂</span><span class="o">)</span> <span class="bp">=</span> <span class="n">arr</span> <span class="o">(</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span> <span class="n">ts</span> <span class="n">t₁</span><span class="o">)</span> <span class="o">(</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span> <span class="n">ts</span> <span class="n">t₂</span><span class="o">)</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">sunfold</span> <span class="o">:</span> <span class="bp">Π</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">},</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">)</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span> <span class="bp">→</span> <span class="n">typ</span> <span class="n">V</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="n">ts</span> <span class="o">(</span><span class="n">varb</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">option</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">nth</span> <span class="n">ts</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">varb</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">V</span><span class="o">),</span> <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="n">ts</span> <span class="o">(</span><span class="n">varf</span> <span class="n">x</span><span class="o">)</span> <span class="bp">=</span> <span class="n">varf</span> <span class="n">x</span>
<span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_3</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">t₁</span> <span class="n">t₂</span> <span class="o">:</span> <span class="n">typ</span> <span class="n">V</span><span class="o">),</span>
  <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="n">ts</span> <span class="o">(</span><span class="n">arr</span> <span class="n">t₁</span> <span class="n">t₂</span><span class="o">)</span> <span class="bp">=</span> <span class="n">arr</span> <span class="o">(</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="n">ts</span> <span class="n">t₁</span><span class="o">)</span> <span class="o">(</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="n">ts</span> <span class="n">t₂</span><span class="o">)</span>
</pre></div>

<a name="123127074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127074" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127074">Simon Hudon (Mar 01 2018 at 07:34)</a>:</h4>
<p>What if you look at <code>#print tts.typ.open.equations._eqn_1 </code>?</p>

<a name="123127075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127075" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127075">Sean Leather (Mar 01 2018 at 07:35)</a>:</h4>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">print</span> <span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="bp">@</span><span class="o">[</span><span class="bp">_</span><span class="n">refl_lemma</span><span class="o">]</span>
<span class="kn">theorem</span> <span class="n">tts</span><span class="bp">.</span><span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">))</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">),</span> <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span> <span class="n">ts</span> <span class="o">(</span><span class="n">varb</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">option</span><span class="bp">.</span><span class="n">get_or_else</span> <span class="o">(</span><span class="n">list</span><span class="bp">.</span><span class="n">nth</span> <span class="n">ts</span> <span class="n">i</span><span class="o">)</span> <span class="o">(</span><span class="n">varb</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">typ</span> <span class="n">V</span><span class="o">)),</span> <span class="n">typ</span><span class="bp">.</span><span class="kn">open</span><span class="bp">._</span><span class="n">main</span><span class="bp">.</span><span class="n">equations</span><span class="bp">._</span><span class="n">eqn_1</span> <span class="n">ts</span>
</pre></div>

<a name="123127129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127129" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127129">Simon Hudon (Mar 01 2018 at 07:36)</a>:</h4>
<p>That's curious. The effect I see is as if those equations were labeled with <code>simp</code>. I wonder if <code>simp</code> is implied by <code>_refl_lemma</code></p>

<a name="123127137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127137" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127137">Sean Leather (Mar 01 2018 at 07:37)</a>:</h4>
<p><code>@[_refl_lemma]</code> is there whether or not I use <code>@[simp]</code>.</p>

<a name="123127138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127138" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127138">Simon Hudon (Mar 01 2018 at 07:37)</a>:</h4>
<p>We can check something else:</p>
<div class="codehilite"><pre><span></span>run_cmd attribute.get_instances `simp &gt;&gt;= trace
</pre></div>

<a name="123127182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127182">Simon Hudon (Mar 01 2018 at 07:38)</a>:</h4>
<p>Correction: </p>
<div class="codehilite"><pre><span></span>run_cmd attribute.get_instances `simp &gt;&gt;= tactic.trace ∘ list.take 3
</pre></div>

<a name="123127192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127192" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127192">Sean Leather (Mar 01 2018 at 07:39)</a>:</h4>
<div class="codehilite"><pre><span></span>parsing at line 7[tts.typ.open, finset.sort_to_finset, finset.sort_nodup]
</pre></div>

<a name="123127237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127237" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127237">Sean Leather (Mar 01 2018 at 07:40)</a>:</h4>
<p><span class="user-mention" data-user-email="simon.hudon@gmail.com" data-user-id="110026">@Simon Hudon</span>: What does that mean?</p>

<a name="123127248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127248" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127248">Simon Hudon (Mar 01 2018 at 07:41)</a>:</h4>
<p>so the whole thing is labelled as <code>simp</code>. The <code>simp</code> tactic must have some logic to retrieve the equations related to a definition.</p>

<a name="123127256"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127256" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127256">Sean Leather (Mar 01 2018 at 07:41)</a>:</h4>
<p>Could be.</p>

<a name="123127303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127303" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127303">Simon Hudon (Mar 01 2018 at 07:42)</a>:</h4>
<p><code>attribute.get_instance ```simp``` </code> gives you the list of the names that are labelled with <code>simp</code>. It works with any attribute. Every definition is appended at the beginning so taking only 3 of them was enough and I wanted to see if more than one name was being labelled</p>

<a name="123127356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127356" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127356">Sean Leather (Mar 01 2018 at 07:44)</a>:</h4>
<p><code>library/init/meta/simp_tactic.lean</code>:</p>
<div class="codehilite"><pre><span></span><span class="c">/-</span><span class="cm">- `get_eqn_lemmas_for deps d` returns the automatically generated equational lemmas for definition d.</span>
<span class="cm">   If deps is tt, then lemmas for automatically generated auxiliary declarations used to define d are also included. -/</span>
<span class="n">meta</span> <span class="kn">constant</span> <span class="n">get_eqn_lemmas_for</span> <span class="o">:</span> <span class="n">bool</span> <span class="bp">→</span> <span class="n">name</span> <span class="bp">→</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">list</span> <span class="n">name</span><span class="o">)</span>
</pre></div>

<a name="123127357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127357" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127357">Simon Hudon (Mar 01 2018 at 07:44)</a>:</h4>
<blockquote>
<p>Could be.</p>
</blockquote>
<p>It could mean that the behavior can differ from that of using <code>simp</code> lemma or it could just be a way of compressing the list of <code>simp</code> lemmas.</p>

<a name="123127361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127361" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127361">Simon Hudon (Mar 01 2018 at 07:44)</a>:</h4>
<p>Nice! Thanks!</p>

<a name="123127419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127419" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127419">Sean Leather (Mar 01 2018 at 07:47)</a>:</h4>
<p>This is with <code>set_option trace.simplify true</code>:</p>
<div class="codehilite"><pre><span></span>3. [simplify.rewrite] [tts.typ.open.equations._eqn_3]: typ.open ts (arr t₁_a t₁_a_1) ==&gt; arr (typ.open ts t₁_a) (typ.open ts t₁_a_1)
[simplify] eq: typ.open ts t₁_a
[simplify] eq: ts
[simplify] eq: t₁_a
[simplify] eq: typ.open
</pre></div>

<a name="123127526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127526">Sean Leather (Mar 01 2018 at 07:50)</a>:</h4>
<p>So, it seems to be that <code>simp</code> uses the equation lemmas if a <code>def</code> is annotated with <code>@[simp]</code>. This makes me wonder why more definitions in the standard library and mathlib aren't <code>@[simp]</code>. It also makes me wonder if I should use <code>@[simp] def</code> more instead of writing equation lemmas myself.</p>

<a name="123127584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127584" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127584">Sean Leather (Mar 01 2018 at 07:52)</a>:</h4>
<p><code>library/init/meta/interactive.lean</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">private</span> <span class="n">meta</span> <span class="n">def</span> <span class="n">simp_lemmas</span><span class="bp">.</span><span class="n">resolve_and_add</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">simp_lemmas</span><span class="o">)</span> <span class="o">(</span><span class="n">u</span> <span class="o">:</span> <span class="n">list</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">name</span><span class="o">)</span> <span class="o">(</span><span class="n">ref</span> <span class="o">:</span> <span class="n">pexpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="o">(</span><span class="n">simp_lemmas</span> <span class="bp">×</span> <span class="n">list</span> <span class="n">name</span><span class="o">)</span> <span class="o">:=</span>
<span class="n">do</span>
  <span class="n">p</span> <span class="err">←</span> <span class="n">resolve_name</span> <span class="n">n</span><span class="o">,</span>
  <span class="n">check_no_overload</span> <span class="n">p</span><span class="o">,</span>
  <span class="c1">-- unpack local refs</span>
  <span class="k">let</span> <span class="n">e</span> <span class="o">:=</span> <span class="n">p</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="bp">.</span><span class="n">get_app_fn</span><span class="bp">.</span><span class="n">erase_annotations</span><span class="o">,</span>
  <span class="k">match</span> <span class="n">e</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">const</span> <span class="n">n</span> <span class="bp">_</span>           <span class="o">:=</span>
    <span class="o">(</span><span class="n">do</span> <span class="n">b</span> <span class="err">←</span> <span class="n">is_valid_simp_lemma_cnst</span> <span class="n">n</span><span class="o">,</span> <span class="n">guard</span> <span class="n">b</span><span class="o">,</span> <span class="n">save_const_type_info</span> <span class="n">n</span> <span class="n">ref</span><span class="o">,</span> <span class="n">s</span> <span class="err">←</span> <span class="n">s</span><span class="bp">.</span><span class="n">add_simp</span> <span class="n">n</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">u</span><span class="o">))</span>
    <span class="bp">&lt;|&gt;</span>
    <span class="o">(</span><span class="n">do</span> <span class="n">eqns</span> <span class="err">←</span> <span class="n">get_eqn_lemmas_for</span> <span class="n">tt</span> <span class="n">n</span><span class="o">,</span> <span class="n">guard</span> <span class="o">(</span><span class="n">eqns</span><span class="bp">.</span><span class="n">length</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">),</span> <span class="n">save_const_type_info</span> <span class="n">n</span> <span class="n">ref</span><span class="o">,</span> <span class="n">s</span> <span class="err">←</span> <span class="n">add_simps</span> <span class="n">s</span> <span class="n">eqns</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">u</span><span class="o">))</span>
    <span class="bp">&lt;|&gt;</span>
    <span class="o">(</span><span class="n">do</span> <span class="n">env</span> <span class="err">←</span> <span class="n">get_env</span><span class="o">,</span> <span class="n">guard</span> <span class="o">(</span><span class="n">env</span><span class="bp">.</span><span class="n">is_projection</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">is_some</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">n</span><span class="bp">::</span><span class="n">u</span><span class="o">))</span>
    <span class="bp">&lt;|&gt;</span>
    <span class="n">report_invalid_simp_lemma</span> <span class="n">n</span>
  <span class="bp">|</span> <span class="bp">_</span> <span class="o">:=</span>
    <span class="o">(</span><span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">i_to_expr_no_subgoals</span> <span class="n">p</span><span class="o">,</span> <span class="n">b</span> <span class="err">←</span> <span class="n">is_valid_simp_lemma</span> <span class="n">e</span><span class="o">,</span> <span class="n">guard</span> <span class="n">b</span><span class="o">,</span> <span class="n">try</span> <span class="o">(</span><span class="n">save_type_info</span> <span class="n">e</span> <span class="n">ref</span><span class="o">),</span> <span class="n">s</span> <span class="err">←</span> <span class="n">s</span><span class="bp">.</span><span class="n">add</span> <span class="n">e</span><span class="o">,</span> <span class="n">return</span> <span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">u</span><span class="o">))</span>
    <span class="bp">&lt;|&gt;</span>
    <span class="n">report_invalid_simp_lemma</span> <span class="n">n</span>
  <span class="kn">end</span>
</pre></div>

<a name="123127639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127639" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127639">Simon Hudon (Mar 01 2018 at 07:54)</a>:</h4>
<p>To your second question: I think you should, it's often less repetitive</p>

<a name="123127642"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123127642" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123127642">Simon Hudon (Mar 01 2018 at 07:54)</a>:</h4>
<p>I don't know how to answer your first question</p>

<a name="123131391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131391" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131391">Sebastian Ullrich (Mar 01 2018 at 10:01)</a>:</h4>
<p>There's also <code>#print attribute simp</code></p>

<a name="123131399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131399">Sebastian Ullrich (Mar 01 2018 at 10:01)</a>:</h4>
<p>I believe Leo rather wants us to use <code>simp!</code> than to tag every single def with <code>[simp]</code></p>

<a name="123131449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131449" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131449">Sean Leather (Mar 01 2018 at 10:03)</a>:</h4>
<blockquote>
<p>There's also <code>#print attribute simp</code></p>
</blockquote>
<p><code>error: invalid #print command</code></p>

<a name="123131615"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131615" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131615">Sebastian Ullrich (Mar 01 2018 at 10:08)</a>:</h4>
<p>Ah, this is fun. You can do <code>#print [refl]</code>, but not <code>#print [simp]</code>.</p>

<a name="123131630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131630" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131630">Sean Leather (Mar 01 2018 at 10:09)</a>:</h4>
<p><a href="https://github.com/leanprover/lean/commit/368f17d0b1392a5a72c9eb974f15b14462cc1475#diff-f5ed07a9ca7e18052989b6ce28b7eb30" target="_blank" title="https://github.com/leanprover/lean/commit/368f17d0b1392a5a72c9eb974f15b14462cc1475#diff-f5ed07a9ca7e18052989b6ce28b7eb30"><code>simp!</code></a>:</p>
<blockquote>
<ul>
<li>Add <code>iota_eqn : bool</code> field to <code>simp_config</code>. <code>simp {iota_eqn := tt}</code> uses all non trivial equation lemmas generated by equation/pattern-matching compiler. A lemma is considered non trivial if it is not of the form <code>forall x_1 ... x_n, f x_1 ... x_n = t</code> and a proof by reflexivity. <code>simp!</code> is a shorthand for <code>simp {iota_eqn := tt}</code>. For example, given the goal <code>... |- [1,2].map nat.succ = t</code>, <code>simp!</code> reduces the left-hand-side of the equation to <code>[nat.succ 1, nat.succ 2]</code>. In this example, <code>simp!</code> is equivalent to <code>simp [list.map]</code>.</li>
</ul>
</blockquote>

<a name="123131668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131668" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131668">Moses Schönfinkel (Mar 01 2018 at 10:10)</a>:</h4>
<p>Getting closer to Coq <code>cbn</code> :).</p>

<a name="123131694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131694" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131694">Sean Leather (Mar 01 2018 at 10:11)</a>:</h4>
<p>“non-trivial equation lemmas” - What does this imply about the trivial equation lemmas, which all of mine probably are?</p>

<a name="123131778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131778" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131778">Sean Leather (Mar 01 2018 at 10:14)</a>:</h4>
<blockquote>
<p>Ah, this is fun. You can do <code>#print [refl]</code>, but not <code>#print [simp]</code>.</p>
</blockquote>
<p>Is that just a matter of forgetting to include <code>simp</code> somewhere?</p>

<a name="123131796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131796">Sean Leather (Mar 01 2018 at 10:15)</a>:</h4>
<p><code>#print [_refl_lemma]</code> works.</p>

<a name="123131840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131840" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131840">Sebastian Ullrich (Mar 01 2018 at 10:17)</a>:</h4>
<p>No, <code>#print [simp]</code> is just a different syntax <a href="https://github.com/leanprover/lean/blob/39270fd46f49fecb30649f5ec527da7bbd4cdb13/tests/lean/run/simplifier_custom_relations.lean#L23" target="_blank" title="https://github.com/leanprover/lean/blob/39270fd46f49fecb30649f5ec527da7bbd4cdb13/tests/lean/run/simplifier_custom_relations.lean#L23">https://github.com/leanprover/lean/blob/39270fd46f49fecb30649f5ec527da7bbd4cdb13/tests/lean/run/simplifier_custom_relations.lean#L23</a></p>

<a name="123131843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131843" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131843">Sebastian Ullrich (Mar 01 2018 at 10:17)</a>:</h4>
<p>So yeah, <code>#print [simp] default</code> works</p>

<a name="123131887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131887">Sean Leather (Mar 01 2018 at 10:18)</a>:</h4>
<blockquote>
<p>“non-trivial equation lemmas” - What does this imply about the trivial equation lemmas, which all of mine probably are?</p>
</blockquote>
<p>Considering <a href="http://httpsf//github.com/leanprover/lean/commit/368f17d0b1392a5a72c9eb974f15b14462cc1475#diff-f3c3d54612bd08c035a1578e952b2aeaR216" target="_blank" title="http://httpsf//github.com/leanprover/lean/commit/368f17d0b1392a5a72c9eb974f15b14462cc1475#diff-f3c3d54612bd08c035a1578e952b2aeaR216">this comment</a>, I think the description in <code>doc/changes.md</code> above is either confusing or misleading:</p>
<div class="codehilite"><pre><span></span><span class="gi">+(iota_eqn : bool           := ff) -- reduce using all equation lemmas generated by equation/pattern-matching compiler</span>
</pre></div>

<a name="123131894"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131894" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131894">Sebastian Ullrich (Mar 01 2018 at 10:19)</a>:</h4>
<p>No, "non-trivial" basically means "defined by pattern matching"</p>

<a name="123131895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131895">Sebastian Ullrich (Mar 01 2018 at 10:19)</a>:</h4>
<p>I.e. "more than one equation"</p>

<a name="123131966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123131966" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123131966">Sean Leather (Mar 01 2018 at 10:21)</a>:</h4>
<p>So, could you replace “<em>non trivial equation lemmas generated by equation/pattern-matching compiler. A lemma is considered non trivial if it is not of the form <code>forall x_1 ... x_n, f x_1 ... x_n = t</code> and a proof by reflexivity</em>” above with “<em>equation lemmas generated by equation/pattern-matching compiler</em>” and the statement would be the same?</p>

<a name="123132241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123132241" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123132241">Sebastian Ullrich (Mar 01 2018 at 10:30)</a>:</h4>
<p>I'm not sure anymore. Perhaps the <code>iota_eqn</code> comment should instead be extended with a "non-trivial"</p>

<a name="123132382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123132382" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123132382">Sean Leather (Mar 01 2018 at 10:34)</a>:</h4>
<blockquote>
<p>So yeah, <code>#print [simp] default</code> works</p>
</blockquote>
<p>Yeah, it's nice to see my equation lemmas appear in that list after adding <code>@[simp]</code> to a <code>def</code>.</p>

<a name="123132395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123132395" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123132395">Sean Leather (Mar 01 2018 at 10:35)</a>:</h4>
<p>I'm not sure if there are any alternative arguments to <code>#print [simp]</code>. It doesn't appear to take a prefix or identifier name: <code>unknown simp_lemmas collection</code>.</p>

<a name="123133132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123133132" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123133132">Sean Leather (Mar 01 2018 at 10:59)</a>:</h4>
<p>I get syntax errors on the second <code>simp!</code> in <code>induction xs; [simp!, {cases ts, simp!}]</code>.</p>

<a name="123133208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123133208" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123133208">Sean Leather (Mar 01 2018 at 11:01)</a>:</h4>
<p>But <code>induction xs; [simp!, {cases ts, simp {iota_eqn := tt}}]</code> works.</p>

<a name="123133979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/equation%20lemmas%20and%20simp/near/123133979" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/17362equationlemmasandsimp.html#123133979">Sebastian Ullrich (Mar 01 2018 at 11:28)</a>:</h4>
<p><code>!}</code> is a separate token used for hole commands</p>


{% endraw %}
