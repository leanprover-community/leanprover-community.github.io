---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/15873helpwithleanIR.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html">help with lean IR</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="191729686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191729686" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191729686">Matthew Weingarten (Mar 25 2020 at 11:11)</a>:</h4>
<p>Are there some specifications for intermediate representation Lean uses? If so, where can I find them?<br>
How can I dump the IR of a given lean program? <br>
Thanks, <br>
Matt</p>

<a name="191732155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191732155" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191732155">Anton Lorenzen (Mar 25 2020 at 11:37)</a>:</h4>
<p>Do you mean something like the export format? <a href="https://github.com/leanprover-community/lean/blob/master/doc/export_format.md" title="https://github.com/leanprover-community/lean/blob/master/doc/export_format.md">https://github.com/leanprover-community/lean/blob/master/doc/export_format.md</a> The type theory is explained in <a href="https://github.com/digama0/lean-type-theory" title="https://github.com/digama0/lean-type-theory">https://github.com/digama0/lean-type-theory</a></p>

<a name="191732336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191732336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191732336">Gabriel Ebner (Mar 25 2020 at 11:38)</a>:</h4>
<p>Another interesting IR is the bytecode used by the VM (which is used by <code>#eval</code> and for tactics).  You can view the generated bytecode by enabling an option:</p>
<div class="codehilite"><pre><span></span><span class="kn">set_option</span> <span class="n">trace</span><span class="bp">.</span><span class="n">compiler</span><span class="bp">.</span><span class="n">optimize_bytecode</span> <span class="n">true</span>
<span class="n">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:=</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">42</span>
</pre></div>

<a name="191753517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191753517" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191753517">Matthew Weingarten (Mar 25 2020 at 14:33)</a>:</h4>
<p>Thanks for the responses Gabriel. I think the Bytecode IR is interpreted in the lean3 system is that correct? I am looking more in the direction of the lean4 IR, basically, the one described in the 'Counting Immutable Beans' as the lambda pure IR.</p>

<a name="191753749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191753749" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191753749">Patrick Massot (Mar 25 2020 at 14:34)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/" title="https://github.com/leanprover/lean4/">https://github.com/leanprover/lean4/</a></p>

<a name="191753864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191753864" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191753864">Matthew Weingarten (Mar 25 2020 at 14:35)</a>:</h4>
<p>Thanks as well Anton, is this IR only used for typechecking?</p>

<a name="191755323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/191755323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#191755323">Matthew Weingarten (Mar 25 2020 at 14:44)</a>:</h4>
<p>Oh it took a while to click, I  understand now, everything is done by set_options command in the .lean file ( so set_option trace.compiler.labda_pure true) <br>
Thanks for the help!</p>

<a name="192124747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/192124747" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#192124747">Matthew Weingarten (Mar 28 2020 at 14:02)</a>:</h4>
<p>Hey, what exactly is the difference between the IRs generated by these two commands? </p>
<div class="codehilite"><pre><span></span>set_option trace.compiler.ir.init true
</pre></div>


<div class="codehilite"><pre><span></span>set_option trace.compiler.lambda_pure true
</pre></div>


<p>Can I assume they are semantically equivalent? From anecdotal evidence on small programs they seem to produce the same code, but just show lambda-calculus functions in more 'traditional' style.</p>

<a name="192124953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/192124953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#192124953">Marc Huisinga (Mar 28 2020 at 14:06)</a>:</h4>
<p>(deleted)</p>

<a name="192129135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/192129135" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#192129135">Simon Hudon (Mar 28 2020 at 15:52)</a>:</h4>
<p>The Lean 4 compiler has 2 distinct phases, one where it treats the code as pure functional code, which <code>lambda_pure</code> seems to print results from, and one where it uses the IR and treats it as imperative code. In functional transformations, you have things like common subexpression eliminations and constant folding and I'm not sure if <code>lambda_pure</code> includes those. If it does include all of those, you could see <code>lambda_pure</code> as the output of the functional phase and <code>ir.init</code> as the input of the next phase. I recommend looking through the Lean source code for <code>lambda_pure</code> and seeing if it has done all the functional optimizations at the time where it prints it.</p>

<a name="192129572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/192129572" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#192129572">Sebastian Ullrich (Mar 28 2020 at 16:03)</a>:</h4>
<p>No, they are exactly the same IR. The only difference is that <code>lambda_pure</code> is traced from C++ and <code>ir.init</code> from Lean. One of them could be removed.</p>

<a name="192133010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/192133010" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#192133010">Matthew Weingarten (Mar 28 2020 at 17:22)</a>:</h4>
<p>OK great! Thanks for the answer Sebastian, very helpful.</p>

<a name="192133172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/help%20with%20lean%20IR/near/192133172" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/15873helpwithleanIR.html#192133172">Matthew Weingarten (Mar 28 2020 at 17:26)</a>:</h4>
<p>Also thank you Simon! I am fairly sure lambda pure includes those as it is written in the paper, that exactly the way I am looking at it so far (output of the functional phase)</p>


{% endraw %}

{% include archive_update.html %}