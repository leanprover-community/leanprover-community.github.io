---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/40080linuxscheduler.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html">linux scheduler</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="161128789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161128789" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161128789">Johan Commelin (Mar 19 2019 at 08:01)</a>:</h4>
<p>Is there some way to tell the linux scheduler that it should never allow Lean to freeze my system? I want Lean to use all the available juice it can get, but as soon as something else asks for attention, that should get higher prio.</p>

<a name="161128801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161128801" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161128801">Johan Commelin (Mar 19 2019 at 08:01)</a>:</h4>
<p>For example X should always be able to kill VScode</p>

<a name="161128872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161128872" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161128872">Kevin Buzzard (Mar 19 2019 at 08:02)</a>:</h4>
<p>Just renice it?</p>

<a name="161128933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161128933" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161128933">Johan Commelin (Mar 19 2019 at 08:03)</a>:</h4>
<p>Can this be automated?</p>

<a name="161128976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161128976" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161128976">Johan Commelin (Mar 19 2019 at 08:04)</a>:</h4>
<p>As you can guess... Lean just froze my desktop machine</p>

<a name="161129203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161129203" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161129203">Mario Carneiro (Mar 19 2019 at 08:07)</a>:</h4>
<p>I have to routinely set the process priority for lean to "below average" on windows so it doesn't kill vscode responsiveness (on windows)</p>

<a name="161129930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161129930" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161129930">Johan Commelin (Mar 19 2019 at 08:20)</a>:</h4>
<p>Aaah, I guess <code>RightAlt</code> + <code>SysRq</code> + <code>f</code> is exactly what I need for these situations</p>

<a name="161130582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161130582" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161130582">Keeley Hoek (Mar 19 2019 at 08:34)</a>:</h4>
<p>When this happens to me it's because my memory has been exhausted and the kernel is busy writing gigabytes to disk, and as a lazy defence I've <code>swapoff</code>'d the swap so the oom killer is forced to come in automatically. I think a more legit thing to do would be to <code>ulimit</code> the lean process, but I've never been bothered enough to do this---and recently I've bought a bucket of RAM so the problem's gone away</p>

<a name="161134035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161134035" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161134035">Kevin Buzzard (Mar 19 2019 at 09:31)</a>:</h4>
<p>I have 16 gigs of ram on the desktop I'm using now and twice recently Lean has taken it down when compiling mathlib. Do you have a bigger bucket?</p>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> when I used to run big <code>magma</code> processes I used the <code>ulimit</code> trick. Maybe this is worth looking into.</p>

<a name="161450227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161450227" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161450227">Edward Ayers (Mar 22 2019 at 14:05)</a>:</h4>
<p>Might help: I was having Lean freezing issues on my linux box and I found that adding more swap space at least kept the system responsive enough that I could kill Lean.</p>

<a name="161499383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161499383" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161499383">Keeley Hoek (Mar 23 2019 at 01:17)</a>:</h4>
<p>Yeah kevin Lean usage inspired me to 8gb -&gt; 32gb upgrade</p>

<a name="161516896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161516896" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161516896">Kevin Buzzard (Mar 23 2019 at 09:19)</a>:</h4>
<p>Lean has taken down my 16gb system three times in the last month, and this thing never normally crashes. I'll try bumping up swap. It's pretty hideous. I go from completely fine to essentially totally unresponsive instantly, and I can't ssh in and the lights on the keyboard stop working. Funnily enough I can still move my mouse cursor, very slowly, but clicks don't seem to register</p>

<a name="161519470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161519470" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161519470">Patrick Massot (Mar 23 2019 at 10:30)</a>:</h4>
<p>Why Lean needs so much RAM? I would have thought that having many CPU would be the crucial Lean speed factor</p>

<a name="161520519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161520519" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161520519">Kevin Buzzard (Mar 23 2019 at 10:59)</a>:</h4>
<p>I think it's a memory leak. I think every time it happened I was compiling mathlib -- I am making a few mathlib PR's now so I edit mathlib source and then recompile before I push. It has been a change in behaviour for me -- I did not usually make mathlib PR's until recently when I felt that the perfectoid project's <a href="https://github.com/leanprover-community/lean-perfectoid-spaces/tree/master/src/for_mathlib" target="_blank" title="https://github.com/leanprover-community/lean-perfectoid-spaces/tree/master/src/for_mathlib">for_mathlib directory</a> was getting a bit out of hand.</p>

<a name="161520596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161520596" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161520596">Kevin Buzzard (Mar 23 2019 at 11:01)</a>:</h4>
<p>But it's not the classic "get slower, get slower, you know there's a problem, quick killall lean before they kill you" thing, it's an instantaneous "you are now screwed, things were working fine 1 second ago but now you just may as well reboot"</p>

<a name="161521613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161521613" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161521613">Patrick Massot (Mar 23 2019 at 11:28)</a>:</h4>
<p>Yes, I've seen that too. But in this case I don't see how buying RAM could help</p>

<a name="161624028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161624028" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161624028">Johan Commelin (Mar 25 2019 at 08:44)</a>:</h4>
<p>My Lean process is currently using 45% of my GB RAM. That means its very risky to run two compiles at the same time.</p>

<a name="161624120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161624120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161624120">Johan Commelin (Mar 25 2019 at 08:46)</a>:</h4>
<p>I guess <code>leanpkg build -M 3072</code> might be helpful. That means that if I run two compiles in parallel, I will be sure to have 2GB left for my system.</p>

<a name="161624248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161624248" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161624248">Johan Commelin (Mar 25 2019 at 08:49)</a>:</h4>
<p>Can the amount of memory for the lean server process be changed while the server is live? If so, we could have a dial for VScode where you can increase/decrease the amount of memory.</p>

<a name="161624305"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161624305" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161624305">Johan Commelin (Mar 25 2019 at 08:50)</a>:</h4>
<p>Is there an easy way to know the minimum amount of memory that Lean needs to compile current mathlib?</p>

<a name="161674270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161674270" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161674270">Gabriel Ebner (Mar 25 2019 at 18:40)</a>:</h4>
<p>There is a configuration setting for the memory limit in the vscode extension.  Any change requires a server restart though.  And this limit is only enforced cooperatively: the Lean server regularly checks if it uses more memory than the limit, and raises an exception if it exceeds the limit.</p>

<a name="161674452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/linux%20scheduler/near/161674452" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/40080linuxscheduler.html#161674452">Kevin Buzzard (Mar 25 2019 at 18:42)</a>:</h4>
<p>And for manual compilation with <code>lean --make</code> I can run <code>ulimit</code> beforehand</p>


{% endraw %}
