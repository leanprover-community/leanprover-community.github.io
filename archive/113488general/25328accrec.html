---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/25328accrec.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html">acc.rec</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="123928942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123928942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123928942">Chris Hughes (Mar 19 2018 at 19:54)</a>:</h4>
<p>I've been trying to prove things using acc.rec, and I'm finding it difficult to deal with. Of these three lemmas, only the first compiled. Definitional equality doesn't always seem to work. I'm particularly surprised that the third lemma doesn't reduce, given that the two terms differ only by a proof with the same type.</p>
<div class="codehilite"><pre><span></span><span class="kn">lemma</span> <span class="n">acc</span><span class="bp">.</span><span class="n">rec_1</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">y</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">y</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span>
<span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">@</span><span class="n">acc</span><span class="bp">.</span><span class="n">rec</span> <span class="n">α</span> <span class="n">r</span> <span class="n">C</span> <span class="n">f</span> <span class="n">b</span> <span class="o">(</span><span class="n">acc</span><span class="bp">.</span><span class="n">intro</span> <span class="n">b</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span>
<span class="n">f</span> <span class="n">b</span> <span class="n">h</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span> <span class="n">hyb</span><span class="o">,</span> <span class="bp">@</span><span class="n">acc</span><span class="bp">.</span><span class="n">rec</span> <span class="n">α</span> <span class="n">r</span> <span class="n">C</span> <span class="n">f</span> <span class="n">y</span> <span class="o">(</span><span class="n">h</span> <span class="n">y</span> <span class="n">hyb</span><span class="o">))</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">acc</span><span class="bp">.</span><span class="n">rec_2</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">y</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">y</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span>
<span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">@</span><span class="n">acc</span><span class="bp">.</span><span class="n">rec</span> <span class="n">α</span> <span class="n">r</span> <span class="n">C</span> <span class="n">f</span> <span class="n">b</span> <span class="n">h₁</span> <span class="bp">=</span>
<span class="n">f</span> <span class="n">b</span> <span class="n">h</span> <span class="o">(</span><span class="bp">λ</span> <span class="n">y</span> <span class="n">hyb</span><span class="o">,</span> <span class="bp">@</span><span class="n">acc</span><span class="bp">.</span><span class="n">rec</span> <span class="n">α</span> <span class="n">r</span> <span class="n">C</span> <span class="n">f</span> <span class="n">y</span> <span class="o">(</span><span class="n">h</span> <span class="n">y</span> <span class="n">hyb</span><span class="o">))</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kn">lemma</span> <span class="n">acc</span><span class="bp">.</span><span class="n">rec_3</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">r</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">Sort</span> <span class="n">v</span><span class="o">}</span>
<span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="bp">Π</span> <span class="n">x</span><span class="o">,</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">y</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="bp">Π</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">x</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">y</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span>
<span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span> <span class="n">y</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">y</span><span class="o">)</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">acc</span> <span class="n">r</span> <span class="n">b</span><span class="o">)</span> <span class="o">:</span>
<span class="bp">@</span><span class="n">acc</span><span class="bp">.</span><span class="n">rec</span> <span class="n">α</span> <span class="n">r</span> <span class="n">C</span> <span class="n">f</span> <span class="n">b</span> <span class="n">h₁</span> <span class="bp">=</span>
<span class="bp">@</span><span class="n">acc</span><span class="bp">.</span><span class="n">rec</span> <span class="n">α</span> <span class="n">r</span> <span class="n">C</span> <span class="n">f</span> <span class="n">b</span> <span class="o">(</span><span class="n">acc</span><span class="bp">.</span><span class="n">intro</span> <span class="n">b</span> <span class="n">h</span><span class="o">)</span> <span class="o">:=</span> <span class="n">rfl</span>
</pre></div>

<a name="123929213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123929213" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123929213">Mario Carneiro (Mar 19 2018 at 20:00)</a>:</h4>
<p>heh, I was just discussing how acc.rec is the root of all evil...</p>

<a name="123929240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123929240" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123929240">Chris Hughes (Mar 19 2018 at 20:01)</a>:</h4>
<p><code>(show acc.intro b h = h₁, from rfl) ▸ rfl</code> works for the second two proofs</p>

<a name="123929323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123929323" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123929323">Mario Carneiro (Mar 19 2018 at 20:02)</a>:</h4>
<p>suffice it to say, yes this happens. Probably <code>congr rfl rfl</code> will also work</p>

<a name="123929578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123929578" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123929578">Chris Hughes (Mar 19 2018 at 20:08)</a>:</h4>
<p>Might be worth putting this in docs, since it is very weird behaviour.</p>

<a name="123936259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123936259" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123936259">Kevin Buzzard (Mar 19 2018 at 23:07)</a>:</h4>
<p>See end of section 3.7 in the reference manual: <a href="https://leanprover.github.io/reference/expressions.html#computation" target="_blank" title="https://leanprover.github.io/reference/expressions.html#computation">https://leanprover.github.io/reference/expressions.html#computation</a></p>

<a name="123936268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123936268" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123936268">Kevin Buzzard (Mar 19 2018 at 23:07)</a>:</h4>
<p>There is a problem with definitional equality, in that there is provably no algorithm which checks to see that two things are definitionally equal!</p>

<a name="123936316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123936316" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123936316">Kevin Buzzard (Mar 19 2018 at 23:08)</a>:</h4>
<p>Lean's algorithm is an algorithm :-) so it can't be doing definitional equality correctly.</p>

<a name="123936399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/acc.rec/near/123936399" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/25328accrec.html#123936399">Kevin Buzzard (Mar 19 2018 at 23:11)</a>:</h4>
<p>See Mario's Masters thesis <a href="https://github.com/digama0/lean-type-theory/releases/download/v0.1/main.pdf" target="_blank" title="https://github.com/digama0/lean-type-theory/releases/download/v0.1/main.pdf">https://github.com/digama0/lean-type-theory/releases/download/v0.1/main.pdf</a> for some more info -- section 3.1.</p>


{% endraw %}
