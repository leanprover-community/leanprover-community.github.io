---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/87882mathlibonwindows.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html">mathlib on windows</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="134031931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134031931" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134031931">Jeremy Avigad (Sep 16 2018 at 00:34)</a>:</h4>
<p>I am trying to install mathlib on a windows laptop. In mingw I set all the paths, but I get this:</p>
<div class="codehilite"><pre><span></span>$ leanpkg install https://github.com/leanprover/mathlib
&gt; mkdir -p C:\msys64\home\aviga/.lean
&gt; cd C:\msys64\home\aviga/.lean
fatal: not a git repository (or any of the parent directories): .git
fatal: not a git repository (or any of the parent directories): .git
mathlib: trying to update _target/deps/mathlib to revision lean-3.4.1
cannot find revision lean-3.4.1 in repository _target/deps/mathlib
</pre></div>


<p>What am I doing wrong?  And -- out of curiosity -- why does it take so long for <code>leanpkg</code> to start up?</p>

<a name="134032148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134032148" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134032148">Sebastian Ullrich (Sep 16 2018 at 00:42)</a>:</h4>
<p>Hi Jeremy! If leanpkg takes a while to start up, it's most likely not running from its .olean files. I don't know about the git error unfortunately</p>

<a name="134032556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134032556" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134032556">Jeremy Avigad (Sep 16 2018 at 00:58)</a>:</h4>
<p>I suspected that, but I can't imagine why not. I installed the binary from <code>leanprover.github.io</code>, and the files are all there.<br>
Maybe I'll ask Mario to help me on Monday.</p>

<a name="134032624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134032624" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134032624">Andrew Ashworth (Sep 16 2018 at 01:01)</a>:</h4>
<p>Hmm, I use Lean on Windows.  I've never installed mathlib user-wide. I know it works if you do <code>leanpkg add</code> per project.</p>

<a name="134033297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134033297" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134033297">Jeremy Avigad (Sep 16 2018 at 01:21)</a>:</h4>
<p>Thanks for the suggestion. Indeed, using <code>leanpkg add</code> worked (modulo the problem with not using the <code>.olean</code> files).</p>

<a name="134034346"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134034346" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134034346">Sebastian Ullrich (Sep 16 2018 at 02:03)</a>:</h4>
<p>Heh, well, we do have the following source comment :) : <a href="https://github.com/leanprover/lean/blob/master/src/util/lean_path.cpp#L45" target="_blank" title="https://github.com/leanprover/lean/blob/master/src/util/lean_path.cpp#L45">https://github.com/leanprover/lean/blob/master/src/util/lean_path.cpp#L45</a></p>

<a name="134034502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134034502" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134034502">Jeremy Avigad (Sep 16 2018 at 02:09)</a>:</h4>
<p>Thanks. Things seem to be ok now. Using <code>lean --make</code> in the <code>library</code> directory seems to have fixed the <code>.olean</code> problem. And deleting the <code>.lean</code> directory and running <code>leanpkg install</code> again seems to be working. It is building <code>mathlib</code> now.</p>

<a name="134041464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134041464" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134041464">Sebastian Ullrich (Sep 16 2018 at 06:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110865">@Jeremy Avigad</span> Now that I think about it, I'm surprised the .olean files haven't been a bigger issue before. We check the modification time of the .olean file against that of the corresponding .lean file. Extracting files from a zip file resets the modification time, so the result depends on the extraction order (at least in the zip file itself, .olean files are listed after their .lean files). And even then, Windows touches each downloaded file again to mark them as "potentially dangerous"</p>

<a name="134044339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134044339" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134044339">Kevin Buzzard (Sep 16 2018 at 07:35)</a>:</h4>
<p>Just to remark that I am nowadays completely resigned to the fact that every invocation of <code>leanpkg</code> on a Windows machine begins with a 15 second wait during which nothing seems to happen other than me moaning about Windows.</p>

<a name="134045713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134045713" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134045713">Kevin Buzzard (Sep 16 2018 at 08:30)</a>:</h4>
<p>A little test shows that on linux the <code>tar</code> command seems to preserve file timestamps. Is this just a problem with zip on Windows? And am I right in thinking I can fix on a user's Windows machine by somehow re-compiling leanpkg just once?</p>

<a name="134060613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134060613" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134060613">Sebastian Ullrich (Sep 16 2018 at 16:41)</a>:</h4>
<p>elan seems to reset the modifications times even on Linux, though that's probably its own fault. Anyway, I've never had an issue with it on Linux, whereas I could reproduce the issue on Windows on the first try</p>

<a name="134060655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134060655" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134060655">Sebastian Ullrich (Sep 16 2018 at 16:42)</a>:</h4>
<p>As Jeremy said, you should go into the <code>library</code> folder and call <code>lean --make</code>. You could do the same in <code>leanpkg</code>, but that's probably not the expensive part</p>

<a name="134065460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134065460" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134065460">Jeremy Avigad (Sep 16 2018 at 19:38)</a>:</h4>
<p>An old post from Kevin (<a href="https://xenaproject.wordpress.com/2017/12/02/how-to-install-mathlib-and-keep-it-up-to-date/" target="_blank" title="https://xenaproject.wordpress.com/2017/12/02/how-to-install-mathlib-and-keep-it-up-to-date/">https://xenaproject.wordpress.com/2017/12/02/how-to-install-mathlib-and-keep-it-up-to-date/</a>) suggests he has been struggling with this issue for a while. <br>
Actually, for me, the situation is even more mysterious. When I do <code>lean --make</code> in the <code>library</code> folder, it compiles a bunch of files, say list <code>A</code>. If I type <code>lean --make</code> again, it compiles another bunch, say, list <code>B</code>. Then if I do it again, it then recompiles list <code>A</code>! If I keep doing it,  it continues to cycle through those two. It is almost as though <code>lean</code> thinks there is a cyclic dependency, or there is some kind of funny race condition with timestamps. (I think the wait to start <code>leanpkg</code> became less painful only because I landed on the shorter side of the cycle.)<br>
I'll be out all afternoon and the laptop is at home, but I'll experiment more later tonight.</p>

<a name="134065730"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134065730" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134065730">Sebastian Ullrich (Sep 16 2018 at 19:49)</a>:</h4>
<p>Oof, that doesn't sound good at all</p>

<a name="134065734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134065734" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134065734">Sebastian Ullrich (Sep 16 2018 at 19:49)</a>:</h4>
<p>One good news, Lean 4 will have a trace option to debug why an .olean file wasn't imported...</p>

<a name="134065838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134065838" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134065838">Bryan Gin-ge Chen (Sep 16 2018 at 19:53)</a>:</h4>
<p>This might be only tangentially related, but I experienced <a href="https://github.com/leanprover/mathlib/issues/308" target="_blank" title="https://github.com/leanprover/mathlib/issues/308">something like this</a> when I ran <code>leanpkg build</code> inside <code>_target/deps/mathlib</code> in a package and then ran it from the base folder afterwards. I had also expected that once the .olean files were generated once, they didn't have to be rebuilt if nothing changed, but I guess that's not true.</p>

<a name="134065939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134065939" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134065939">Mario Carneiro (Sep 16 2018 at 19:57)</a>:</h4>
<p>You should not run <code>leanpkg</code> inside the <code>target</code> folder, I think it gets confused</p>

<a name="134065945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134065945" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134065945">Mario Carneiro (Sep 16 2018 at 19:57)</a>:</h4>
<p>you can just run <code>lean --make</code> instead</p>

<a name="134074893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134074893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134074893">Jeremy Avigad (Sep 17 2018 at 01:28)</a>:</h4>
<p>Update: deleting all the<code>. olean</code> files (<code>del /s *.olean</code> in <code>library</code>) and rebuilding (<code>lean --make</code>) seems to work fine. After that, <code>lean --make</code> does nothing. I had to go into the <code>leanpkg</code> directory and run <code>lean --make</code> there too. Now <code>leanpkg</code> runs instantaneously.</p>

<a name="134075802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/mathlib%20on%20windows/near/134075802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/87882mathlibonwindows.html#134075802">Sebastian Ullrich (Sep 17 2018 at 02:02)</a>:</h4>
<p>I just released a new version of elan that seems to fix the issue</p>


{% endraw %}

{% include archive_update.html %}