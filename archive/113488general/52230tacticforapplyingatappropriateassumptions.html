---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/52230tacticforapplyingatappropriateassumptions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html">tactic for applying at appropriate assumptions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="126035144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126035144" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126035144">Sean Leather (May 03 2018 at 10:35)</a>:</h4>
<p>I've got a theorem:</p>
<div class="codehilite"><pre><span></span><span class="kn">theorem</span> <span class="n">lc_value</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">e</span> <span class="o">:</span> <span class="n">exp</span> <span class="n">V</span><span class="o">},</span> <span class="n">e</span><span class="bp">.</span><span class="n">value</span> <span class="bp">→</span> <span class="n">e</span><span class="bp">.</span><span class="n">lc</span>
</pre></div>


<p>Is there a tactical way to apply this theorem to all assumptions matching <code>_.value</code> to produce more assumptions <code>_.lc</code>?</p>

<a name="126043003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126043003" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126043003">Sean Leather (May 03 2018 at 14:29)</a>:</h4>
<p>How's this for my first attempt at writing a tactic? It can be improved, of course.</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">apply_matching</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">texpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">expr</span> <span class="o">:=</span>
  <span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="n">p</span><span class="o">,</span>
     <span class="n">et</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
     <span class="n">guard</span> <span class="n">et</span><span class="bp">.</span><span class="n">is_arrow</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
     <span class="n">any_hyp</span> <span class="err">$</span> <span class="bp">λ</span> <span class="n">h</span><span class="o">,</span> <span class="n">do</span>
       <span class="n">ht</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span>
       <span class="n">unify</span> <span class="n">ht</span> <span class="n">et</span><span class="bp">.</span><span class="n">binding_domain</span><span class="o">,</span>
       <span class="n">n</span> <span class="err">←</span> <span class="n">mk_fresh_name</span><span class="o">,</span>
       <span class="n">note</span> <span class="n">n</span> <span class="n">none</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">mk_app</span> <span class="n">e</span> <span class="o">[</span><span class="n">h</span><span class="o">])</span>
</pre></div>

<a name="126043088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126043088" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126043088">Sean Leather (May 03 2018 at 14:30)</a>:</h4>
<p>That is, I know some ways in which it can be improved, but comments to that effect are most welcome.</p>

<a name="126043239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126043239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126043239">Sean Leather (May 03 2018 at 14:34)</a>:</h4>
<p>I believe I've jumped into the rabbit hole now.</p>

<a name="126055842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126055842" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126055842">Simon Hudon (May 03 2018 at 19:35)</a>:</h4>
<p>If I understand correctly, given a rule <code>r : p -&gt; q</code> (where you call my <code>r</code> <code>p</code>) you're looking for an assumption <code>h : p</code> which would allow you to add an assumption <code>h' : q</code>. </p>
<p>First question: do you expect the user to see the name of that new assumption? If so, I doubt <code>mk_fresh_name</code> will give you appealing names. Maybe you should give at least the option of specifying the name.</p>

<a name="126055958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126055958" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126055958">Simon Hudon (May 03 2018 at 19:37)</a>:</h4>
<p>Second question: is there a reason that your rule wouldn't be desirable if you had a pi type where the bound variable occurs in the term?</p>

<a name="126056021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126056021" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126056021">Simon Hudon (May 03 2018 at 19:38)</a>:</h4>
<p>Third question:  could it not be useful to repeat the process a certain number of times (if the user provides a list of names for the new assumptions, repeat until you run out of names; otherwise, repeat as many times as you can).</p>

<a name="126083155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126083155" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126083155">Sean Leather (May 04 2018 at 08:39)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> Thanks for looking at it!</p>
<blockquote>
<p>If I understand correctly, given a rule <code>r : p -&gt; q</code> (where you call my <code>r</code> <code>p</code>) you're looking for an assumption <code>h : p</code> which would allow you to add an assumption <code>h' : q</code>. </p>
</blockquote>
<p>That's almost correct. My current thinking is to look for all assumptions <code>h_i : p</code> and create all possible new assumptions <code>h_i' : q</code> where <code>h_i' = r h_i</code>.</p>
<blockquote>
<p>First question: do you expect the user to see the name of that new assumption? If so, I doubt <code>mk_fresh_name</code> will give you appealing names. Maybe you should give at least the option of specifying the name.</p>
</blockquote>
<p>In general, I would expect the new assumptions to be used in something like <code>tauto</code> or possibly just <code>assumption</code>. But I would certainly like to have useful fresh names and not the stuff spit out by <code>mk_fresh_name</code>. (I'm now using <code>get_unused_name</code>, but that doesn't seem much better.) Since multiple fresh names may be created, I think the option of specifying one name is not enough. I thought about doing something like adding a suffix to the name of <code>h</code>. How do I get the name of the hypothesis from the <code>expr</code>?  What do you think?</p>
<blockquote>
<p>Second question: is there a reason that your rule wouldn't be desirable if you had a pi type where the bound variable occurs in the term?</p>
</blockquote>
<p>Perhaps not. Are you suggesting I use <code>is_pi</code> instead of <code>is_arrow</code>?</p>
<blockquote>
<p>Third question:  could it not be useful to repeat the process a certain number of times (if the user provides a list of names for the new assumptions, repeat until you run out of names; otherwise, repeat as many times as you can).</p>
</blockquote>
<p>Repeating is indeed my intention. Is it not doing that? I haven't yet tested. But, looking again at <code>any_hyp_aux</code>, it looks like it does stop at the first success. Is there an existing function for iterating over all of the local context or <code>list expr</code>, or should I write one?</p>

<a name="126083607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126083607" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126083607">Sean Leather (May 04 2018 at 08:55)</a>:</h4>
<blockquote>
<p>Is there an existing function for iterating over all of the local context or <code>list expr</code>, or should I write one?</p>
</blockquote>
<p>Answering my own question: <code>list.mfoldl</code>/<code>list.mfoldr</code></p>

<a name="126085893"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126085893" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126085893">Sean Leather (May 04 2018 at 10:13)</a>:</h4>
<p>The latest version with <code>expr.is_pi</code> and <code>list.mfoldl</code>:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">apply_matching</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">texpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="n">p</span><span class="o">,</span>
     <span class="n">et</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
     <span class="n">guard</span> <span class="n">et</span><span class="bp">.</span><span class="n">is_pi</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
     <span class="n">local_context</span> <span class="bp">&gt;&gt;=</span> <span class="n">mfoldl</span>
       <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">h</span><span class="o">,</span> <span class="n">do</span>
         <span class="n">ht</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span>
         <span class="n">tactic</span><span class="bp">.</span><span class="n">try</span> <span class="o">(</span><span class="n">do</span>
           <span class="n">unify</span> <span class="n">ht</span> <span class="n">et</span><span class="bp">.</span><span class="n">binding_domain</span><span class="o">,</span>
           <span class="n">n</span> <span class="err">←</span> <span class="n">get_unused_name</span><span class="o">,</span>
           <span class="n">note</span> <span class="n">n</span> <span class="n">none</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">mk_app</span> <span class="n">e</span> <span class="o">[</span><span class="n">h</span><span class="o">])))</span>
       <span class="o">()</span>
</pre></div>

<a name="126085942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126085942" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126085942">Sean Leather (May 04 2018 at 10:14)</a>:</h4>
<p>It's funny and annoying that I keep forgetting the commas in Lean <code>do</code>-notation.</p>

<a name="126088409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126088409" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126088409">Sean Leather (May 04 2018 at 11:32)</a>:</h4>
<p>Now with a <code>'</code> appended to the name of the source hypothesis:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">name</span><span class="bp">.</span><span class="n">update_suffix</span> <span class="o">:</span> <span class="n">name</span> <span class="bp">→</span> <span class="o">(</span><span class="n">string</span> <span class="bp">→</span> <span class="n">string</span><span class="o">)</span> <span class="bp">→</span> <span class="n">name</span>
<span class="bp">|</span> <span class="n">name</span><span class="bp">.</span><span class="n">anonymous</span>        <span class="bp">_</span> <span class="o">:=</span> <span class="n">name</span><span class="bp">.</span><span class="n">anonymous</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">name</span><span class="bp">.</span><span class="n">mk_string</span> <span class="n">s</span> <span class="n">p</span><span class="o">)</span>  <span class="n">f</span> <span class="o">:=</span> <span class="n">name</span><span class="bp">.</span><span class="n">mk_string</span> <span class="o">(</span><span class="n">f</span> <span class="n">s</span><span class="o">)</span> <span class="n">p</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">name</span><span class="bp">.</span><span class="n">mk_numeral</span> <span class="n">n</span> <span class="n">p</span><span class="o">)</span> <span class="bp">_</span> <span class="o">:=</span> <span class="n">name</span><span class="bp">.</span><span class="n">mk_numeral</span> <span class="n">n</span> <span class="n">p</span>

<span class="n">meta</span> <span class="n">def</span> <span class="n">apply_matching</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">texpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="n">p</span><span class="o">,</span>
     <span class="n">et</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
     <span class="n">guard</span> <span class="n">et</span><span class="bp">.</span><span class="n">is_pi</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
     <span class="n">local_context</span> <span class="bp">&gt;&gt;=</span> <span class="n">mfoldl</span>
       <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">h</span><span class="o">,</span> <span class="n">do</span>
         <span class="n">ht</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span>
         <span class="n">tactic</span><span class="bp">.</span><span class="n">try</span> <span class="err">$</span> <span class="n">do</span>
           <span class="n">unify</span> <span class="n">ht</span> <span class="n">et</span><span class="bp">.</span><span class="n">binding_domain</span><span class="o">,</span>
           <span class="n">note</span> <span class="o">(</span><span class="n">h</span><span class="bp">.</span><span class="n">local_pp_name</span><span class="bp">.</span><span class="n">update_suffix</span> <span class="o">(</span><span class="n">flip</span> <span class="n">append</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">))</span> <span class="n">none</span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">mk_app</span> <span class="n">e</span> <span class="o">[</span><span class="n">h</span><span class="o">]))</span>
       <span class="o">()</span>
</pre></div>

<a name="126088722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126088722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126088722">Sean Leather (May 04 2018 at 11:42)</a>:</h4>
<p>Hmm. I thought perhaps I could remove <code>ht ← infer_type h</code> and <code>unify ht et.binding_domain</code> because <code>note</code> would type check the expression <code>expr.mk_app e [h])</code>, but I ended up generating a new hypothesis for every existing hypothesis. <code>note</code> is defined with <code>assertv_core</code>, but it didn't do what I would expect from a cursory reading.</p>

<a name="126093166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093166" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093166">Simon Hudon (May 04 2018 at 14:06)</a>:</h4>
<p>Sorry I missed the first question. At least, you didn't miss it</p>

<a name="126093228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093228" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093228">Simon Hudon (May 04 2018 at 14:08)</a>:</h4>
<p>I would change:</p>
<div class="codehilite"><pre><span></span> et ← infer_type e,
 guard et.is_pi &lt;|&gt; fail format!&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;,
</pre></div>


<p>to</p>
<div class="codehilite"><pre><span></span> (expr.pi _ _ ed _) &lt;- infer_type | fail format!&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;,
</pre></div>

<a name="126093239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093239" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093239">Simon Hudon (May 04 2018 at 14:09)</a>:</h4>
<p>and <code>.local_pp_name.update_suffix (flip append "'")</code> to <code>.local_pp_name.update_suffix (++ "'")</code></p>

<a name="126093335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093335" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093335">Simon Hudon (May 04 2018 at 14:12)</a>:</h4>
<blockquote>
<p><code>note</code> is defined with <code>assertv_core</code>, but it didn't do what I would expect from a cursory reading.</p>
</blockquote>
<p>Care to elaborate?</p>

<a name="126093336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093336" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093336">Sean Leather (May 04 2018 at 14:12)</a>:</h4>
<blockquote>
<div class="codehilite"><pre><span></span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span> <span class="bp">|</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
</pre></div>


</blockquote>
<p>What is <code>|</code> here? Is this equivalent to the following bracketing (assuming said bracketing is valid)?</p>
<div class="codehilite"><pre><span></span><span class="o">((</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span><span class="o">)</span> <span class="bp">|</span> <span class="o">(</span><span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">),</span>
</pre></div>

<a name="126093350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093350" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093350">Sean Leather (May 04 2018 at 14:13)</a>:</h4>
<blockquote>
<p>and <code>.local_pp_name.update_suffix (flip append "'")</code> to <code>.local_pp_name.update_suffix (++ "'")</code></p>
</blockquote>
<p>Ah, sections are supported. I wasn't sure and didn't try.</p>

<a name="126093403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093403" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093403">Simon Hudon (May 04 2018 at 14:14)</a>:</h4>
<p>No, I don't think that's syntactically valid. It's because <code>(expr.pi _ _ ed _) &lt;- infer_type</code> is an incomplete pattern matching statement. <code>|</code> comes in to say "here's what you do if it doesn't match ..."</p>

<a name="126093486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093486" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093486">Sean Leather (May 04 2018 at 14:16)</a>:</h4>
<blockquote>
<blockquote>
<p><code>note</code> is defined with <code>assertv_core</code>, but it didn't do what I would expect from a cursory reading.</p>
</blockquote>
<p>Care to elaborate?</p>
</blockquote>
<p>About? <span class="emoji emoji-1f642" title="simple smile">:simple_smile:</span></p>

<a name="126093504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093504" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093504">Sean Leather (May 04 2018 at 14:17)</a>:</h4>
<blockquote>
<p>No, I don't think that's syntactically valid. It's because <code>(expr.pi _ _ ed _) &lt;- infer_type</code> is an incomplete pattern matching statement. <code>|</code> comes in to say "here's what you do if it doesn't match ..."</p>
</blockquote>
<p>I see. Is this <code>|</code> strictly for pattern-matching in <code>do</code>-notation? Is it notation defined somewhere, or is it built in?</p>

<a name="126093554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093554" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093554">Simon Hudon (May 04 2018 at 14:18)</a>:</h4>
<p>And there's a subtle difference with <code>&lt;|&gt;</code>. While <code>do x &lt;- a &lt;|&gt; b, c</code> means <code>a &lt;|&gt; b &gt;&gt;= λ x, c</code>, <code>do x &lt;- a | b, c</code> means:</p>
<div class="codehilite"><pre><span></span>a &gt;&gt;= λ x₀,
match x₀ with
 | x := c
 | _ := b
end
</pre></div>

<a name="126093560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093560" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093560">Simon Hudon (May 04 2018 at 14:19)</a>:</h4>
<p>i.e. when you run <code>b</code>, you exit immediately. If <code>b</code> is not a fail statement but a statement like <code>return none</code>, the whole function returns <code>non</code>.</p>

<a name="126093665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093665" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093665">Sean Leather (May 04 2018 at 14:22)</a>:</h4>
<blockquote>
<div class="codehilite"><pre><span></span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span> <span class="bp">|</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
</pre></div>


</blockquote>
<p>Except that, with this, I no longer have <code>et</code>. <span class="emoji emoji-1f609" title="wink">:wink:</span></p>

<a name="126093722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093722" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093722">Simon Hudon (May 04 2018 at 14:24)</a>:</h4>
<blockquote>
<blockquote>
<blockquote>
<p>note is defined with assertv_core, but it didn't do what I would expect from a cursory reading.</p>
</blockquote>
<p>Care to elaborate?</p>
</blockquote>
<p>About? </p>
</blockquote>
<p>Hoping to break records of quotes within quotes, here's my answer. Please, let's make this an Inception of quotes.</p>
<p>What did you expect from <code>assertv_core</code> and how did the reality differ?</p>

<a name="126093796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093796" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093796">Simon Hudon (May 04 2018 at 14:27)</a>:</h4>
<blockquote>
<blockquote>
<div class="codehilite"><pre><span></span> <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span> <span class="bp">|</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
</pre></div>


</blockquote>
<p>Except that, with this, I no longer have <code>et</code>. <span class="emoji emoji-1f609" title="wink">:wink:</span></p>
</blockquote>
<p>I missed the occurrence in the error message. What a bummer! I thought we could get rid of it. Let's go with:</p>
<div class="codehilite"><pre><span></span> <span class="n">et</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span><span class="o">,</span>
 <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">pure</span> <span class="n">et</span> <span class="bp">|</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
</pre></div>

<a name="126093802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093802" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093802">Sean Leather (May 04 2018 at 14:27)</a>:</h4>
<blockquote>
<p>What did you expect from <code>assertv_core</code> and how did the reality differ?</p>
</blockquote>
<p>As I said, I expected it to type-check the expression.</p>

<a name="126093848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093848" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093848">Sean Leather (May 04 2018 at 14:29)</a>:</h4>
<blockquote>
<p>Let's go with:</p>
<div class="codehilite"><pre><span></span> <span class="n">et</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span><span class="o">,</span>
 <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">pure</span> <span class="n">et</span> <span class="bp">|</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
</pre></div>


</blockquote>
<p>Hmm, I'm not convinced that's better. <span class="emoji emoji-1f609" title="wink">:wink:</span></p>

<a name="126093923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093923" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093923">Simon Hudon (May 04 2018 at 14:31)</a>:</h4>
<p>Oh I see. I would think that too. But as the developers keep pointing out, they are very aggressive in their optimization. They try to never type check by default. The whole proof will be type checked at the end so that's not unsafe but it does mean that you have to <code>unify</code> or <code>type_check</code> when you think you need it.</p>

<a name="126093981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093981" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093981">Sean Leather (May 04 2018 at 14:32)</a>:</h4>
<blockquote>
<p>Oh I see. I would think that too. But as the developers keep pointing out, they are very aggressive in their optimization. They try to never type check by default. The whole proof will be type checked at the end so that's not unsafe but it does mean that you have to <code>unify</code> or <code>type_check</code> when you think you need it.</p>
</blockquote>
<p>Oh, interesting. So, you can introduce badly typed hypotheses?</p>

<a name="126093988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093988" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093988">Sean Leather (May 04 2018 at 14:33)</a>:</h4>
<blockquote>
<p>Oh, interesting. So, you can introduce badly typed hypotheses?</p>
</blockquote>
<p>... and goals?</p>

<a name="126093993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126093993" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126093993">Simon Hudon (May 04 2018 at 14:33)</a>:</h4>
<blockquote>
<blockquote>
<p>Let's go with:</p>
<div class="codehilite"><pre><span></span> <span class="n">et</span> <span class="bp">&lt;-</span> <span class="n">infer_type</span><span class="o">,</span>
 <span class="o">(</span><span class="n">expr</span><span class="bp">.</span><span class="n">pi</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">ed</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">&lt;-</span> <span class="n">pure</span> <span class="n">et</span> <span class="bp">|</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;apply_matching&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
</pre></div>


</blockquote>
<p>Hmm, I'm not convinced that's better. <span class="emoji emoji-1f609" title="wink">:wink:</span></p>
</blockquote>
<p>Yeah, that's less of an improvement</p>

<a name="126094048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094048" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094048">Simon Hudon (May 04 2018 at 14:35)</a>:</h4>
<blockquote>
<blockquote>
<p>Oh, interesting. So, you can introduce badly typed hypotheses?</p>
</blockquote>
<p>... and goals?</p>
</blockquote>
<p>The expressions and goals are still type checked from time to time but you can find a way.</p>

<a name="126094114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094114" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094114">Simon Hudon (May 04 2018 at 14:36)</a>:</h4>
<p>I think <code>to_expr</code> type checks the expression so that already filters out a lot of nonsense</p>

<a name="126094120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094120" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094120">Sean Leather (May 04 2018 at 14:37)</a>:</h4>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>note is defined with assertv_core, but it didn't do what I would expect from a cursory reading.</p>
</blockquote>
<p>Care to elaborate?</p>
</blockquote>
<p>About? </p>
</blockquote>
<p>Hoping to break records of quotes within quotes, here's my answer. Please, let's make this an Inception of quotes.</p>
</blockquote>
<p>I think Zulip needs threads within topics within streams... <span class="emoji emoji-1f3d8" title="house buildings">:house_buildings:</span></p>

<a name="126094324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094324" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094324">Sean Leather (May 04 2018 at 14:42)</a>:</h4>
<p>Current version:</p>
<div class="codehilite"><pre><span></span><span class="n">meta</span> <span class="n">def</span> <span class="n">note_all_applied</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">parse</span> <span class="n">texpr</span><span class="o">)</span> <span class="o">:</span> <span class="n">tactic</span> <span class="n">unit</span> <span class="o">:=</span>
  <span class="n">do</span> <span class="n">e</span> <span class="err">←</span> <span class="n">to_expr</span> <span class="n">p</span><span class="o">,</span>
     <span class="n">et</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">e</span><span class="o">,</span>
     <span class="n">guard</span> <span class="n">et</span><span class="bp">.</span><span class="n">is_pi</span> <span class="bp">&lt;|&gt;</span> <span class="n">fail</span> <span class="n">format</span><span class="bp">!</span><span class="s2">&quot;&#39;note_all_applied&#39; expected a function, got &#39;{et}&#39;&quot;</span><span class="o">,</span>
     <span class="n">local_context</span> <span class="bp">&gt;&gt;=</span> <span class="n">mfoldl</span>
       <span class="o">(</span><span class="bp">λ</span> <span class="n">a</span> <span class="n">h</span><span class="o">,</span> <span class="n">do</span>
         <span class="n">ht</span> <span class="err">←</span> <span class="n">infer_type</span> <span class="n">h</span><span class="o">,</span>
         <span class="n">tactic</span><span class="bp">.</span><span class="n">try</span> <span class="err">$</span> <span class="n">do</span>
           <span class="n">unify</span> <span class="n">ht</span> <span class="n">et</span><span class="bp">.</span><span class="n">binding_domain</span><span class="o">,</span>
           <span class="n">note</span> <span class="o">(</span><span class="n">h</span><span class="bp">.</span><span class="n">local_pp_name</span><span class="bp">.</span><span class="n">update_suffix</span> <span class="o">(</span><span class="bp">++</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">))</span> <span class="n">none</span> <span class="o">(</span><span class="n">e</span><span class="bp">.</span><span class="n">mk_app</span> <span class="o">[</span><span class="n">h</span><span class="o">]))</span>
       <span class="o">()</span>
</pre></div>


<p>I'm not really sure about a good name. <code>apply_matching</code> is certainly not good: too much of a connection to <code>apply</code>.</p>

<a name="126094606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094606" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094606">Simon Hudon (May 04 2018 at 14:51)</a>:</h4>
<p>how about <code>have_spec</code> (for specialization)?</p>

<a name="126094623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094623" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094623">Simon Hudon (May 04 2018 at 14:51)</a>:</h4>
<p>I think you you should check if the domain of <code>e</code> is a proposition. If it is, having multiple specializations will only be noisy</p>

<a name="126094786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094786" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094786">Sean Leather (May 04 2018 at 14:57)</a>:</h4>
<blockquote>
<p>how about <code>have_spec</code> (for specialization)?</p>
</blockquote>
<p>1. My immediate thought is to expand <code>spec</code> to <code>specification</code>.<br>
2. I would not naturally think of this as specialization. The resulting type depends on the argument.</p>

<a name="126094897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126094897" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126094897">Johan Commelin (May 04 2018 at 15:00)</a>:</h4>
<p>and Kevin is defining the <code>spec</code>trum of a ring... although that will probably be called <code>Spec</code>.</p>

<a name="126095717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126095717" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126095717">Sean Leather (May 04 2018 at 15:23)</a>:</h4>
<blockquote>
<p>I think you you should check if the domain of <code>e</code> is a proposition. If it is, having multiple specializations will only be noisy</p>
</blockquote>
<p>I don't follow. If I have this:</p>
<div class="codehilite"><pre><span></span><span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="n">true</span><span class="o">,</span>
<span class="n">note_all_applied</span> <span class="n">or_true</span>
</pre></div>


<p>I see this:</p>
<div class="codehilite"><pre><span></span><span class="n">h</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">,</span>
<span class="n">h&#39;</span> <span class="o">:</span> <span class="n">h</span> <span class="bp">∨</span> <span class="n">true</span> <span class="bp">↔</span> <span class="n">true</span>
</pre></div>

<a name="126096992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126096992" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126096992">Simon Hudon (May 04 2018 at 15:59)</a>:</h4>
<p><em>a proposition</em></p>
<div class="codehilite"><pre><span></span><span class="k">assume</span> <span class="n">h</span> <span class="o">:</span>  <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">,</span>
<span class="k">assume</span> <span class="n">h&#39;</span> <span class="o">:</span>  <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">,</span>
<span class="n">note_all_applied</span> <span class="o">(</span><span class="n">not_lt_of_ge</span> <span class="n">x</span> <span class="n">y</span><span class="o">)</span>
</pre></div>


<p>The above should only produce one more assumption, not two.</p>

<a name="126170825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126170825" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126170825">Sean Leather (May 06 2018 at 11:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110026">@Simon Hudon</span> I'm sorry, but I'm still not getting what you're saying.</p>
<p>What do you mean by a proposition? I used <code>h : Prop</code>, but you may be thinking of something else.</p>
<p>I tried to make a working example out of your code, and this is what I have:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">{</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="n">h&#39;</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">note_all_applied</span> <span class="n">not_lt_of_ge</span>
</pre></div>


<p>The state:</p>
<div class="codehilite"><pre><span></span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">,</span>
<span class="n">h</span> <span class="n">h&#39;</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">y</span><span class="o">,</span>
<span class="n">h&#39;</span> <span class="n">h&#39;&#39;</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">y</span> <span class="bp">&lt;</span> <span class="n">x</span>
<span class="err">⊢</span> <span class="err">?</span><span class="n">m_1</span>
</pre></div>


<p>So, two things are clearly problematic here:</p>
<ul>
<li>Output hypotheses (<code>h'</code>, <code>h''</code>) with the same type (<code>¬y &lt; x</code>). However, there are input hypotheses with the same type. I'm not sure this is something the tactic should handle because:<ul>
<li>Handling duplicate outputs adds complexity when the duplicate inputs already exist, and, consequently, this complexity appears unnecessary.</li>
<li>If the tactic did something else, what would it be, and would it still be predictable?</li>
</ul>
</li>
<li>Duplicate <code>h'</code> hypotheses. The output hypothesis naming could certainly be better. It would be nice to have fresh, readable, predictable names, perhaps similar to what <code>cases</code> and <code>induction</code> do. Do you have any suggestions for this?</li>
</ul>
<p>That said, I'm not sure what the above has to do with propositions. The same issues can be shown with non-<code>Prop</code> types:</p>
<div class="codehilite"><pre><span></span><span class="kn">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">note_all_applied</span> <span class="n">nat</span><span class="bp">.</span><span class="n">succ</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">x</span> <span class="n">y</span> <span class="n">x&#39;</span> <span class="n">y&#39;</span> <span class="o">:</span> <span class="bp">ℕ</span>
<span class="err">⊢</span> <span class="kt">Prop</span>
</pre></div>

<a name="126183355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126183355" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126183355">Simon Hudon (May 06 2018 at 19:52)</a>:</h4>
<p>What I was trying to point out is that the types of <code>h</code>,<code>h'</code>,<code>h'</code> and <code>h''</code> themselves have type <code>Prop</code>. Maybe I should have called them proofs instead of proposition. Sorry for the confusion.</p>
<p>I was saying that using many of them in your tactic would result in repetition because of proof irrelevant.</p>

<a name="126183363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126183363" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126183363">Simon Hudon (May 06 2018 at 19:52)</a>:</h4>
<p>As you point out, that might make for a highly redundant tactic code.</p>

<a name="126183637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126183637" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126183637">Simon Hudon (May 06 2018 at 20:02)</a>:</h4>
<p>If you decide to adopt that more aggressive simplification, you can replace <code>mfold</code> or <code>for_each</code> with:</p>
<div class="codehilite"><pre><span></span>meta def for_each_considering_proof_irrelevance {α : Type}
  (irrel : bool) (f : α → tactic unit) (xs : list α) : tactic unit :=
if irrel then
  xs.any_of f
else
  xs.for_each f
</pre></div>

<a name="126202657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/126202657" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#126202657">Sean Leather (May 07 2018 at 08:26)</a>:</h4>
<p>Thanks for pointing at <code>for_each</code> and <code>any_of</code>. Funny that they don't seem to be used at all in the Lean core library.</p>

<a name="131154182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/131154182" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#131154182">Scott Morrison (Aug 09 2018 at 08:44)</a>:</h4>
<p>Hi <span class="user-mention" data-user-id="110045">@Sean Leather</span>, what happened to this tactic? I think I want it now, and I'm not sure where to look for it.</p>

<a name="131155526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/tactic%20for%20applying%20at%20appropriate%20assumptions/near/131155526" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/52230tacticforapplyingatappropriateassumptions.html#131155526">Sean Leather (Aug 09 2018 at 09:18)</a>:</h4>
<p>You mean the one and only tactic I ever wrote? It's <a href="https://github.com/spl/tts/blob/69893255c64e407f3b3ca6e9ff6242f7120177d8/src/tactics.lean#L15-L24" target="_blank" title="https://github.com/spl/tts/blob/69893255c64e407f3b3ca6e9ff6242f7120177d8/src/tactics.lean#L15-L24">here</a>. I think I use it in the same repository, but I'm not convinced it is actually that useful.</p>


{% endraw %}
