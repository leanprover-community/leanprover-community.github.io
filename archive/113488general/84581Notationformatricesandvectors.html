---
layout: archive
title: Lean Prover Zulip Chat Archive
permalink: archive/113488general/84581Notationformatricesandvectors.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html">Notation for matrices and vectors</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">

{% raw %}
<a name="188196887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188196887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188196887">Anne Baanen (Feb 14 2020 at 11:13)</a>:</h4>
<p>This morning, I was playing around with defining notation for vectors and matrices, which would allow us to write:</p>
<div class="codehilite"><pre><span></span><span class="n">def</span> <span class="n">v2</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">}</span>
<span class="n">def</span> <span class="n">m22</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">}}</span>
<span class="n">def</span> <span class="n">m32</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}}</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">det_2x2</span> <span class="o">{</span><span class="n">α</span><span class="o">}</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="o">({{</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">},</span> <span class="o">{</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">}}</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="o">({{</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">},</span> <span class="o">{</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">}}</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">α</span><span class="o">)</span>
    <span class="bp">=</span> <span class="o">((</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(((</span><span class="bp">-</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">rfl</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>
</pre></div>

<a name="188196895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188196895" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188196895">Anne Baanen (Feb 14 2020 at 11:13)</a>:</h4>
<p>My first implementation generalizes the notation in core Lean for <code>has_insert.insert : h → t → t</code> to <code>has_dependent_insert.insert : h → t → ht</code>:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">matrix</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">determinant</span>
<span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">ring</span>

<span class="n">universes</span> <span class="n">u</span> <span class="n">v</span>
<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>

<span class="n">class</span> <span class="n">has_dependent_insert</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">out_param</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u</span><span class="o">))</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">out_param</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">v</span><span class="o">))</span> <span class="o">(</span><span class="n">ht</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span>
<span class="o">(</span><span class="n">insert</span> <span class="o">{}</span> <span class="o">:</span> <span class="n">h</span> <span class="bp">→</span> <span class="n">t</span> <span class="bp">→</span> <span class="n">ht</span><span class="o">)</span>

<span class="kn">notation</span> <span class="bp">`</span><span class="o">{</span><span class="bp">`</span> <span class="n">l</span><span class="o">:(</span><span class="n">foldr</span> <span class="bp">`</span><span class="o">,</span> <span class="bp">`</span> <span class="o">(</span><span class="n">h</span> <span class="n">t</span><span class="o">,</span> <span class="n">has_dependent_insert</span><span class="bp">.</span><span class="n">insert</span> <span class="n">h</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">has_emptyc</span><span class="bp">.</span><span class="n">emptyc</span> <span class="bp">_</span><span class="o">)</span> <span class="bp">`</span><span class="o">}</span><span class="bp">`</span><span class="o">)</span> <span class="o">:=</span> <span class="n">l</span>

<span class="c">/-</span><span class="cm"></span>
<span class="cm">-- Optionally:</span>
<span class="cm">@[priority 100]</span>
<span class="cm">instance insert_to_dependent_insert {γ} [has_insert α γ] : has_dependent_insert α γ γ := ⟨insert⟩</span>
<span class="cm">-/</span>

<span class="kn">instance</span> <span class="n">insert_vector</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">has_dependent_insert</span> <span class="n">α</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨@</span><span class="n">fin</span><span class="bp">.</span><span class="n">cases</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">α</span><span class="o">)</span><span class="bp">⟩</span>

<span class="kn">instance</span> <span class="n">empty_vector</span> <span class="o">:</span> <span class="n">has_emptyc</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="n">exfalso</span><span class="bp">;</span> <span class="n">rcases</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">⟨⟩⟩⟩</span>

<span class="c1">-- Either:</span>
<span class="c1">-- local attribute [reducible] matrix</span>
<span class="c1">-- Or:</span>
<span class="kn">instance</span> <span class="n">insert_matrix</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">{</span><span class="n">m</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">:</span>
  <span class="n">has_dependent_insert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span><span class="o">)</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="n">m</span><span class="bp">.</span><span class="n">succ</span><span class="o">)</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨@</span><span class="n">fin</span><span class="bp">.</span><span class="n">cases</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span><span class="bp">⟩</span>
<span class="kn">instance</span> <span class="n">empty_matrix</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">fintype</span> <span class="n">n</span><span class="o">]</span> <span class="o">:</span> <span class="n">has_emptyc</span> <span class="o">(</span><span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">0</span><span class="o">)</span> <span class="n">n</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">⟨λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="o">{</span><span class="n">exfalso</span><span class="o">,</span> <span class="n">rcases</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">⟨⟩⟩</span><span class="o">}</span><span class="bp">⟩</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">det_2x2</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="o">({{</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">},</span> <span class="o">{</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">}}</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="o">({{</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">},</span> <span class="o">{</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">}}</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="n">α</span><span class="o">)</span>
    <span class="bp">=</span> <span class="o">((</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(((</span><span class="bp">-</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">rfl</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">}</span>
<span class="n">def</span> <span class="n">m22</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">}}</span>
<span class="n">def</span> <span class="n">m32</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}}</span>
<span class="n">def</span> <span class="n">wrong_m22</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}}</span>
<span class="n">def</span> <span class="n">wrong_m32</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">}}</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="n">m22</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">*</span> <span class="mi">4</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="mi">3</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">m22</span><span class="o">]</span>
</pre></div>

<a name="188196953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188196953" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188196953">Anne Baanen (Feb 14 2020 at 11:14)</a>:</h4>
<p>Although I prefer the braces, this will probably give overload issues because the notation for <code>has_insert.insert</code> is still around. The elaborator also gets stuck quite easily, for example if you remove the type hint in <code>({{a, b}, {c, d}} : matrix (fin 2) (fin 2) α)</code>. We could also make the notation specific to <code>fin n → α</code>, solving the second issue somewhat:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">matrix</span><span class="bp">.</span><span class="n">basic</span>
<span class="kn">import</span> <span class="n">linear_algebra</span><span class="bp">.</span><span class="n">determinant</span>
<span class="kn">import</span> <span class="n">tactic</span><span class="bp">.</span><span class="n">ring</span>

<span class="kn">variables</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span>

<span class="n">def</span> <span class="n">vector_insert</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">fin</span> <span class="n">n</span><span class="bp">.</span><span class="n">succ</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">fin</span><span class="bp">.</span><span class="n">cases</span> <span class="bp">_</span> <span class="o">(</span><span class="bp">λ</span> <span class="bp">_</span><span class="o">,</span> <span class="n">α</span><span class="o">)</span>

<span class="n">def</span> <span class="n">vector_empty</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">α</span> <span class="o">:=</span>
<span class="bp">λ</span> <span class="n">x</span><span class="o">,</span> <span class="k">by</span> <span class="n">exfalso</span><span class="bp">;</span> <span class="n">rcases</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">⟨_</span><span class="o">,</span> <span class="bp">⟨⟩⟩</span>

<span class="kn">notation</span> <span class="bp">`</span><span class="o">{</span><span class="bp">`</span> <span class="n">l</span><span class="o">:(</span><span class="n">foldr</span> <span class="bp">`</span><span class="o">,</span> <span class="bp">`</span> <span class="o">(</span><span class="n">h</span> <span class="n">t</span><span class="o">,</span> <span class="n">vector_insert</span> <span class="n">h</span> <span class="n">t</span><span class="o">)</span> <span class="n">vector_empty</span> <span class="bp">`</span><span class="o">}</span><span class="bp">`</span><span class="o">)</span> <span class="o">:=</span> <span class="n">l</span>

<span class="bp">@</span><span class="o">[</span><span class="n">simp</span><span class="o">]</span> <span class="kn">lemma</span> <span class="n">det_2x2</span> <span class="o">[</span><span class="n">comm_ring</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
  <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="o">{{</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">},</span> <span class="o">{</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">}}</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="o">{{</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">},</span> <span class="o">{</span><span class="n">c</span><span class="o">,</span> <span class="n">d</span><span class="o">}}</span>
    <span class="bp">=</span> <span class="o">((</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="bp">*</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="o">(</span><span class="n">d</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="o">(((</span><span class="bp">-</span> <span class="o">(</span><span class="mi">0</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="bp">*</span> <span class="o">(</span><span class="n">c</span> <span class="bp">*</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="mi">1</span><span class="o">)))</span> <span class="bp">+</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">rfl</span>
<span class="bp">...</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">-</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">c</span> <span class="o">:</span> <span class="k">by</span> <span class="n">ring</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">2</span> <span class="bp">→</span> <span class="bp">ℕ</span> <span class="o">:=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">}</span>
<span class="n">def</span> <span class="n">m22</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">}}</span>
<span class="n">def</span> <span class="n">m32</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}}</span>
<span class="n">def</span> <span class="n">wrong_m22</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">},</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">}}</span>
<span class="c1">-- Type mismatch: `{{4, 5}}` has type `fin 1 → fin 2 → ℤ`</span>
<span class="c1">-- but was expected to have type `fin 0 → fin 2 → ℤ`</span>
<span class="n">def</span> <span class="n">wrong_m32</span> <span class="o">:</span> <span class="n">matrix</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">2</span><span class="o">)</span> <span class="bp">ℤ</span> <span class="o">:=</span> <span class="o">{{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">},</span> <span class="o">{</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">}}</span>
<span class="c1">-- Type mismatch: `vector_empty` has type `fin 0 → ?m_1 → ℤ`</span>
<span class="c1">-- but was expected to have type `fin 1 → fin 2 → ℤ`</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">matrix</span><span class="bp">.</span><span class="n">det</span> <span class="n">m22</span> <span class="bp">=</span> <span class="mi">1</span> <span class="bp">*</span> <span class="mi">4</span> <span class="bp">-</span> <span class="mi">2</span> <span class="bp">*</span> <span class="mi">3</span> <span class="o">:=</span> <span class="k">by</span> <span class="n">simp</span> <span class="o">[</span><span class="n">m22</span><span class="o">]</span>
</pre></div>

<a name="188196962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188196962" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188196962">Anne Baanen (Feb 14 2020 at 11:14)</a>:</h4>
<p>What do you all think?</p>

<a name="188197689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188197689" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188197689">Johan Commelin (Feb 14 2020 at 11:27)</a>:</h4>
<p>Something like this is certainly a good idea.</p>

<a name="188197703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188197703" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188197703">Johan Commelin (Feb 14 2020 at 11:27)</a>:</h4>
<p>I think that a very long time ago, Johannes Hölzl also showed how to do something like this</p>

<a name="188197706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188197706" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188197706">Johan Commelin (Feb 14 2020 at 11:27)</a>:</h4>
<p>I'll try to find the posts on zulip</p>

<a name="188197883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188197883" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188197883">Johan Commelin (Feb 14 2020 at 11:30)</a>:</h4>
<p>Aha, it was in a private chat (we were writing code for <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>'s birthday): </p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="n">data</span><span class="bp">.</span><span class="n">vector</span>

<span class="n">def</span> <span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="n">fast_matrix</span> <span class="o">(</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span> <span class="o">:=</span> <span class="n">vector</span> <span class="o">(</span><span class="n">vector</span> <span class="n">α</span> <span class="n">n</span><span class="o">)</span> <span class="n">m</span>

<span class="n">def</span> <span class="n">vec</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">vector</span> <span class="n">α</span> <span class="n">l</span><span class="bp">.</span><span class="n">length</span> <span class="o">:=</span> <span class="bp">⟨</span><span class="n">l</span><span class="o">,</span> <span class="n">rfl</span><span class="bp">⟩</span>

<span class="n">local</span> <span class="kn">notation</span> <span class="bp">`!</span><span class="o">[</span><span class="bp">`</span> <span class="n">l</span><span class="o">:(</span><span class="n">foldr</span> <span class="bp">`</span><span class="o">,</span> <span class="bp">`</span> <span class="o">(</span><span class="n">h</span> <span class="n">t</span><span class="o">,</span> <span class="n">list</span><span class="bp">.</span><span class="n">cons</span> <span class="n">h</span> <span class="n">t</span><span class="o">)</span> <span class="n">list</span><span class="bp">.</span><span class="n">nil</span> <span class="bp">`</span><span class="o">]</span><span class="bp">`</span><span class="o">)</span> <span class="o">:=</span> <span class="n">vec</span> <span class="n">l</span>

<span class="kn">example</span> <span class="o">:</span> <span class="n">fast_matrix</span> <span class="mi">2</span> <span class="mi">2</span> <span class="bp">ℤ</span> <span class="o">:=</span>
<span class="bp">!</span><span class="o">[</span>
  <span class="bp">!</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span>
  <span class="bp">!</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span>
<span class="o">]</span>
</pre></div>

<a name="188197973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188197973" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188197973">Johan Commelin (Feb 14 2020 at 11:32)</a>:</h4>
<p><span class="user-mention" data-user-id="238446">@Anne Baanen</span> Isn't your <code>vector_insert</code> the same as <code>fin.cons</code>?</p>

<a name="188199204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188199204" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188199204">Anne Baanen (Feb 14 2020 at 11:55)</a>:</h4>
<p>It is indeed exactly the same!</p>

<a name="188199927"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188199927" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188199927">Kevin Buzzard (Feb 14 2020 at 12:06)</a>:</h4>
<p>I was moaning about notation in my talk in Bonn two weeks ago (in front of Sebastian Ullrich!) in the context of algebraic geometry, and afterwards <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> sent me a file with some ideas in, which I still have not looked at but have certainly not forgotten about. I'm hoping to have a weekend of Lean where I can catch up -- I've had to deal with real life this week...</p>

<a name="188201776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188201776" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188201776">Patrick Massot (Feb 14 2020 at 12:35)</a>:</h4>
<p>The elaborator always struggles with explicit sets. Look at:</p>
<div class="codehilite"><pre><span></span><span class="bp">#</span><span class="kn">check</span> <span class="o">{</span><span class="mi">1</span><span class="o">}</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">{(</span><span class="mi">1</span> <span class="o">:</span> <span class="bp">ℕ</span><span class="o">)}</span>
<span class="bp">#</span><span class="kn">check</span> <span class="o">({</span><span class="mi">1</span><span class="o">}</span> <span class="o">:</span> <span class="n">set</span> <span class="bp">ℕ</span><span class="o">)</span>
</pre></div>

<a name="188201809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188201809" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188201809">Patrick Massot (Feb 14 2020 at 12:35)</a>:</h4>
<p>So I wouldn't expect the situation for matrices to be better. We can only hope <span aria-label="four leaf clover" class="emoji emoji-1f340" role="img" title="four leaf clover">:four_leaf_clover:</span></p>

<a name="188913984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188913984" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188913984">Anne Baanen (Feb 24 2020 at 10:20)</a>:</h4>
<p>I'm ready to revisit this topic and do some bikeshedding today. It turns out that notation with <code>{...}</code> is special-cased in the C++ parser, so defining our own <code>{...}</code>-based notation will definitely result in unfixable notation conflicts (the first one I saw was with <code>simp {contextual := tt}</code> of all things), meaning that option is out.</p>

<a name="188914012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188914012" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188914012">Anne Baanen (Feb 24 2020 at 10:21)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Do you have some time to send that file?</p>

<a name="188925322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188925322" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188925322">Kevin Buzzard (Feb 24 2020 at 13:26)</a>:</h4>
<p>Your message prompted me to finally take a look at what <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> sent me -- but I can't get it to work right now. Perhaps he should be the one talking to you about this?</p>

<a name="188953425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Notation%20for%20matrices%20and%20vectors/near/188953425" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/84581Notationformatricesandvectors.html#188953425">Floris van Doorn (Feb 24 2020 at 18:44)</a>:</h4>
<p>Since braces already have many different meanings and are handled in a special way in the parser, I think it would be better to use a different symbol for matrices. </p>
<p>The file I sent to Kevin was about pretty printing the tactic state by defining a new interactive tactic environment.</p>


{% endraw %}

{% include archive_update.html %}