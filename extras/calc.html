<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://leanprover-community.github.io//css/lean.css" >
  <link rel="shortcut icon" href="https://leanprover-community.github.io//img/favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Open+Sans&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    

	<script>
                function buildShortcutsForStructures(names) {
                        const o = {}
                        names.forEach(name => o[name] = `\\mathbb\{${name}\}`)
                        return o
                }
		MathJax = {
			  tex: {
                                  macros: {
                                          ...buildShortcutsForStructures(["R", "Q", "Z", "N", "C"]),
                                  },
				      inlineMath: [['$', '$'], ['\\(', '\\)']]
				    },
		};
	</script>
	<script type="text/javascript" id="MathJax-script" async
		  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
	</script>

	<title>How to use calc</title>
  </head>
  <body>
  <nav class="navbar navbar-expand-lg navbar-light bg-gradient-light d-md-none">
    <div class="d-flex flex-grow-1">
		<a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community
    </a>
    </div>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  </nav>

<div id="mainbox">

  <main>
	  
<h1 id="how-to-use-calc" class="markdown-heading">How to use calc <a class="hover-link" href="#how-to-use-calc">#</a></h1>
<p><code>calc</code> is an environment -- so a &quot;mode&quot; like tactic mode, term mode and
<a href="conv.html">conv mode</a>. Documentation and basic examples for how to use it are in Theorem Proving In Lean, in
<a href="https://leanprover.github.io/theorem_proving_in_lean/quantifiers_and_equality.html#calculational-proofs">section 4.3</a>.</p>
<p>Basic example usage:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">H2</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">c</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">H1</span>
<span class="bp">...</span>    <span class="bp">=</span> <span class="n">c</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="kd">by</span> <span class="n">rw</span> <span class="n">H2</span>
</code></pre></div>

<h2 id="error-messages-and-how-to-avoid-them" class="markdown-heading">Error messages, and how to avoid them <a class="hover-link" href="#error-messages-and-how-to-avoid-them">#</a></h2>
<p>Note that the error messages can be quite obscure when things aren't quite right, and often the red
squiggles end up under a random <code>...</code>. A tip to avoid these problems with calc usage is to first
populate a skeleton proof such as</p>
<div class="codehilite"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">D</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:</span> <span class="gr">sorry</span>
<span class="bp">...</span>    <span class="bp">=</span> <span class="n">C</span> <span class="o">:</span> <span class="gr">sorry</span>
<span class="bp">...</span>    <span class="bp">=</span> <span class="n">D</span> <span class="o">:</span> <span class="gr">sorry</span>
</code></pre></div>

<p>(in tactic mode this might look more like</p>
<div class="codehilite"><pre><span></span><code><span class="k">have</span> <span class="n">H</span> <span class="o">:</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">D</span><span class="o">,</span>
  <span class="n">exact</span> <span class="k">calc</span> <span class="n">A</span> <span class="bp">=</span> <span class="n">B</span> <span class="o">:</span> <span class="gr">sorry</span>
  <span class="bp">...</span>          <span class="bp">=</span> <span class="n">C</span> <span class="o">:</span> <span class="gr">sorry</span>
  <span class="bp">...</span>          <span class="bp">=</span> <span class="n">D</span> <span class="o">:</span> <span class="gr">sorry</span><span class="o">,</span>
</code></pre></div>

<p>with a comma at the end), and then to start filling in the sorries after that. (Idle thought: could
one write a VS Code snippet to write this skeleton?)</p>
<h2 id="using-operators-other-than-equality" class="markdown-heading">Using operators other than equality <a class="hover-link" href="#using-operators-other-than-equality">#</a></h2>
<p>Many of the basic examples in TPIL use equality for most or all of
the operators, but actually <code>calc</code> will work with any relation for which
the corresponding transitivity statement is tagged <code>[trans]</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">definition</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">@[trans]</span> <span class="kd">theorem</span> <span class="n">r_trans</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">r</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">r</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">r</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">infix</span> <span class="bp">`***`</span><span class="o">:</span> <span class="mi">50</span> <span class="o">:=</span> <span class="n">r</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">***</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">H2</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">***</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">***</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">a</span> <span class="bp">***</span> <span class="n">b</span> <span class="o">:</span> <span class="n">H1</span>
<span class="bp">...</span>    <span class="bp">***</span> <span class="n">c</span> <span class="o">:</span> <span class="n">H2</span>
</code></pre></div>

<h2 id="using-more-than-one-operator" class="markdown-heading">Using more than one operator <a class="hover-link" href="#using-more-than-one-operator">#</a></h2>
<p>This is possible; TPIL has the following example:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">theorem</span> <span class="n">T2</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">h2</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">h3</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">&lt;</span> <span class="n">d</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">d</span> <span class="o">:=</span>
<span class="k">calc</span>
  <span class="n">a</span>     <span class="bp">=</span> <span class="n">b</span>     <span class="o">:</span> <span class="n">h1</span>
    <span class="bp">...</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">nat.lt_succ_self</span> <span class="n">b</span>
    <span class="bp">...</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">nat.succ_le_succ</span> <span class="n">h2</span>
    <span class="bp">...</span> <span class="bp">&lt;</span> <span class="n">d</span>     <span class="o">:</span> <span class="n">h3</span>
</code></pre></div>

<p>What is actually going on here? The proofs themselves are not a mystery,
for example <code>nat.succ_le_succ h2</code> is a proof of <code>b + 1 ≤ c + 1</code>. The
clever part is that lean can put all of these together to correctly
deduce that if <code>U = V &lt; W ≤ X &lt; Y</code> then <code>U &lt; Y</code>. The way this is done,
Kevin thinks (can someone verify this?) is that Lean continually tries
to amalgamate the first two operators in the list, until there
is only one left. In other words, Lean will attempt to reduce
the equations thus:</p>
<div class="codehilite"><pre><span></span><code><span class="n">U</span> <span class="bp">=</span> <span class="n">V</span> <span class="bp">&lt;</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">X</span> <span class="bp">&lt;</span> <span class="n">Y</span>
<span class="n">U</span> <span class="bp">&lt;</span> <span class="n">W</span> <span class="bp">≤</span> <span class="n">X</span> <span class="bp">&lt;</span> <span class="n">Y</span>
<span class="n">U</span> <span class="bp">&lt;</span> <span class="n">X</span> <span class="bp">&lt;</span> <span class="n">Y</span>
<span class="n">U</span> <span class="bp">&lt;</span> <span class="n">Y</span>
</code></pre></div>

<p>Note the following subtlety: given <code>U op1 V</code> and <code>V op2 W</code> Lean
has to conclude <code>U op3 W</code> for some operator, which might be <code>op1</code>
or <code>op2</code> (or even, as we shall see, a new operator). How is Lean
doing this? The easiest case is when one of <code>op1</code> and <code>op2</code>
is <code>=</code>. Lean knows</p>
<div class="codehilite"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">trans_rel_right</span> <span class="c1">-- ∀ {α : Sort u_1} {a b c : α} (r : α → α → Prop), a = b → r b c → r a c</span>
<span class="k">#check</span> <span class="bp">@</span><span class="n">trans_rel_left</span> <span class="c1">-- ∀ {α : Sort u_1} {a b c : α} (r : α → α → Prop), r a b → b = c → r a c</span>
</code></pre></div>

<p>and (Kevin believes) uses them if one of the operators is an equality operator. If however neither
operator is the equality operator, Lean looks through the theorems in its database which are tagged
<code>[trans]</code> and applies these instead. For example Lean has the following definitions:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">@[trans]</span> <span class="kd">lemma</span> <span class="n">lt_of_lt_of_le</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">},</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">c</span>
<span class="kd">@[trans]</span> <span class="kd">lemma</span> <span class="n">lt_trans</span> <span class="o">[</span><span class="n">preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">},</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">b</span> <span class="bp">&lt;</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">c</span>
</code></pre></div>

<p>and it is easily seen that these lemmas can be used to justify the example in the manual.</p>
<h2 id="using-user-defined-operators" class="markdown-heading">Using user-defined operators <a class="hover-link" href="#using-user-defined-operators">#</a></h2>
<p>It is as simple as tagging the relevant results with <code>trans</code>. For example</p>
<div class="codehilite"><pre><span></span><code><span class="kd">definition</span> <span class="n">r</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">definition</span> <span class="n">s</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">definition</span> <span class="n">t</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">@[trans]</span> <span class="kd">theorem</span> <span class="n">rst_trans</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">r</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">s</span> <span class="n">b</span> <span class="n">c</span> <span class="bp">→</span> <span class="n">t</span> <span class="n">a</span> <span class="n">c</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">infix</span> <span class="bp">`***`</span><span class="o">:</span> <span class="mi">50</span> <span class="o">:=</span> <span class="n">r</span>
<span class="kd">infix</span> <span class="bp">`&amp;&amp;&amp;`</span> <span class="o">:</span> <span class="mi">50</span> <span class="o">:=</span> <span class="n">s</span>
<span class="kd">infix</span> <span class="bp">`%%%`</span> <span class="o">:</span> <span class="mi">50</span> <span class="o">:=</span> <span class="n">t</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">***</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">H2</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">&amp;&amp;&amp;</span> <span class="n">c</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">%%%</span> <span class="n">c</span> <span class="o">:=</span>
<span class="k">calc</span> <span class="n">a</span> <span class="bp">***</span> <span class="n">b</span> <span class="o">:</span> <span class="n">H1</span>
<span class="bp">...</span>    <span class="bp">&amp;&amp;&amp;</span> <span class="n">c</span> <span class="o">:</span> <span class="n">H2</span>
</code></pre></div>

<p>This example shows us that the third operator <code>op3</code> can be different to both <code>op1</code> and <code>op2</code>.</p>

  </main>

    <nav id="navbar" class="d-md-block bg-light sidebar collapse navbar-light pb-4">
      <div class="d-none d-md-block mt-4"><a class="navbar-brand" href="https://leanprover-community.github.io/index.html">Lean Community</a></div>
      
        <h6 class="sidebar-heading mt-4">Community</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover.zulipchat.com/">Zulip chat</a></li>
        
          <li class="nav-item col-12"><a href="https://github.com/leanprover-community/mathlib">GitHub</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/blog">Blog</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/meet.html">Community information</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/papers.html">Papers about Lean</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/lean_projects.html">Projects using Lean</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Installation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/get_started.html">Get started</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/debian.html">Debian/Ubuntu installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/linux.html">Generic Linux installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/macos.html">MacOS installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/install/windows.html">Windows installation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/lean-web-editor">Online version (no installation)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/leanproject.html">Using leanproject</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/toolchain.html">The Lean toolchain</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Documentation</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/learn.html">Learning resources (start here)</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib_docs">API documentation</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/calc.html">Calc mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/conv.html">Conv mode</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/simp.html">Simplifier</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/tactic_writing.html">Tactic writing tutorial</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/extras/well_founded_recursion.html">Well-founded recursion</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mwe.html">About MWEs</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Library overviews</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib-overview.html">Library overview</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/undergrad.html">Undergraduate maths</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/100.html">Wiedijk's 100 theorems</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Theory docs</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/category_theory.html">Category theory</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/linear_algebra.html">Linear algebra</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/naturals.html">Natural numbers</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/sets.html">Sets and set-like objects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/theories/topology.html">Topology</a></li>
        </ul>
      
        <h6 class="sidebar-heading mt-4">Contributing</h6>
        <ul class="nav">
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/index.html">Pull request lifecycle</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/naming.html">Naming conventions</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/style.html">Code style guideline</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/contribute/doc.html">Documentation style</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/ci.html">CI for 3rd party projects</a></li>
        
          <li class="nav-item col-12"><a href="https://leanprover-community.github.io/mathlib_stats.html">Contribution statistics</a></li>
        </ul>
      
    </nav>

</div>


  <nav class="footer navbar navbar-expand-lg navbar-light bg-light justify-content-end">
  <ul class="nav">
    <li class="nav-item">
      <a class="nav-link active" href="https://github.com/leanprover-community/leanprover-community.github.io/blob/newsite/templates/extras/calc.md">Suggest edits to this page on GitHub</a>
    </li>
  </ul>
  </nav>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"></script>
    <script src="https://leanprover-community.github.io//js/bootstrap.min.js"></script>
    
  </body>
</html>